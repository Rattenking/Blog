<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
  <meta name="theme-color" content="#222">
  <meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>
  <script id="hexo-configurations">
    var NexT = window.NexT ||
    {};
    var CONFIG = {
      "hostname": "cuiqingcai.com",
      "root": "/",
      "scheme": "Pisces",
      "version": "7.8.0",
      "exturl": true,
      "sidebar":
      {
        "position": "right",
        "width": 360,
        "display": "post",
        "padding": 18,
        "offset": 12,
        "onmobile": false,
        "widgets": [
          {
            "type": "image",
            "name": "阿布云",
            "enable": false,
            "url": "https://www.abuyun.com/http-proxy/introduce.html",
            "src": "https://qiniu.cuiqingcai.com/88au8.jpg",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "爬虫书",
            "url": "https://item.jd.com/13527222.html",
            "src": "https://qiniu.cuiqingcai.com/ei5og.jpg",
            "width": "100%",
            "enable": true
      },
          {
            "type": "categories",
            "name": "分类",
            "enable": true
      },
          {
            "type": "image",
            "name": "IPIDEA",
            "url": "http://www.ipidea.net/?utm-source=cqc&utm-keyword=?cqc",
            "src": "https://qiniu.cuiqingcai.com/0ywun.png",
            "width": "100%",
            "enable": true
      },
          {
            "type": "image",
            "name": "深度学习课",
            "enable": true,
            "url": "https://tutorial.lengyue.video/?coupon=12ef4b1a-a3db-11ea-bb37-0242ac130002_cqx_850",
            "src": "https://qiniu.cuiqingcai.com/bco2a.png",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "TianQiIP",
            "enable": true,
            "url": "https://www.tianqiip.com/?did=OP6kGa",
            "src": "https://qiniu.cuiqingcai.com/bv71c.png",
            "width": "100%"
      },
          {
            "type": "friends",
            "name": "友情链接",
            "enable": true
      },
          {
            "type": "hot",
            "name": "猜你喜欢",
            "enable": true
      },
          {
            "type": "tags",
            "name": "标签云",
            "enable": true
      }]
      },
      "copycode":
      {
        "enable": true,
        "show_result": true,
        "style": "mac"
      },
      "back2top":
      {
        "enable": true,
        "sidebar": false,
        "scrollpercent": true
      },
      "bookmark":
      {
        "enable": false,
        "color": "#222",
        "save": "auto"
      },
      "fancybox": false,
      "mediumzoom": false,
      "lazyload": false,
      "pangu": true,
      "comments":
      {
        "style": "tabs",
        "active": "gitalk",
        "storage": true,
        "lazyload": false,
        "nav": null,
        "activeClass": "gitalk"
      },
      "algolia":
      {
        "hits":
        {
          "per_page": 10
        },
        "labels":
        {
          "input_placeholder": "Search for Posts",
          "hits_empty": "We didn't find any results for the search: ${query}",
          "hits_stats": "${hits} results found in ${time} ms"
        }
      },
      "localsearch":
      {
        "enable": true,
        "trigger": "auto",
        "top_n_per_article": 10,
        "unescape": false,
        "preload": false
      },
      "motion":
      {
        "enable": false,
        "async": false,
        "transition":
        {
          "post_block": "bounceDownIn",
          "post_header": "slideDownIn",
          "post_body": "slideDownIn",
          "coll_header": "slideLeftIn",
          "sidebar": "slideUpIn"
        }
      },
      "path": "search.xml"
    };

  </script>
  <meta name="keywords" content="爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书,静觅,崔庆才">
  <meta name="robots" content="index,follow">
  <meta name="GOOGLEBOT" content="index,follow">
  <meta name="author" content="静觅丨崔庆才的个人站点">
  <meta name="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  <meta property="og:type" content="website">
  <meta property="og:title" content="静觅">
  <meta property="og:url" content="https://cuiqingcai.com/page/9/index.html">
  <meta property="og:site_name" content="静觅">
  <meta property="og:description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  <meta property="og:locale" content="zh_CN">
  <meta property="article:author" content="崔庆才">
  <meta property="article:tag" content="爬虫教程">
  <meta property="article:tag" content="爬虫">
  <meta property="article:tag" content="Python">
  <meta property="article:tag" content="Python爬虫">
  <meta property="article:tag" content="Python爬虫教程">
  <meta property="article:tag" content="爬虫书">
  <meta property="article:tag" content="静觅">
  <meta property="article:tag" content="崔庆才">
  <meta name="twitter:card" content="summary">
  <link rel="canonical" href="https://cuiqingcai.com/page/9/">
  <script id="page-configurations">
    // https://hexo.io/docs/variables.html
    CONFIG.page = {
      sidebar: "",
      isHome: true,
      isPost: false,
      lang: 'zh-CN'
    };

  </script>
  <title>静觅丨崔庆才的个人站点 - Python爬虫教程</title>
  <meta name="google-site-verification" content="p_bIcnvirkFzG2dYKuNDivKD8-STet5W7D-01woA2fc" />
  <meta name="sogou_site_verification" content="kBOV53NQqT" />
  <noscript>
    <style>
      .use-motion .brand,
      .use-motion .menu-item,
      .sidebar-inner,
      .use-motion .post-block,
      .use-motion .pagination,
      .use-motion .comments,
      .use-motion .post-header,
      .use-motion .post-body,
      .use-motion .collection-header
      {
        opacity: initial;
      }

      .use-motion .site-title,
      .use-motion .site-subtitle
      {
        opacity: initial;
        top: initial;
      }

      .use-motion .logo-line-before i
      {
        left: initial;
      }

      .use-motion .logo-line-after i
      {
        right: initial;
      }

    </style>
  </noscript>
  <link rel="alternate" href="/atom.xml" title="静觅" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner">
        <div class="site-brand-container">
          <div class="site-nav-toggle">
            <div class="toggle" aria-label="切换导航栏">
              <span class="toggle-line toggle-line-first"></span>
              <span class="toggle-line toggle-line-middle"></span>
              <span class="toggle-line toggle-line-last"></span>
            </div>
          </div>
          <div class="site-meta">
            <a href="/" class="brand" rel="start">
              <span class="logo-line-before"><i></i></span>
              <h1 class="site-title">静觅 <span class="site-subtitle"> 崔庆才的个人站点 - Python爬虫教程 </span>
              </h1>
              <span class="logo-line-after"><i></i></span>
            </a>
          </div>
          <div class="site-nav-right">
            <div class="toggle popup-trigger">
              <i class="fa fa-search fa-fw fa-lg"></i>
            </div>
          </div>
        </div>
        <nav class="site-nav">
          <ul id="menu" class="main-menu menu">
            <li class="menu-item menu-item-home">
              <a href="/" rel="section">首页</a>
            </li>
            <li class="menu-item menu-item-archives">
              <a href="/archives/" rel="section">文章列表</a>
            </li>
            <li class="menu-item menu-item-tags">
              <a href="/tags/" rel="section">文章标签</a>
            </li>
            <li class="menu-item menu-item-categories">
              <a href="/categories/" rel="section">文章分类</a>
            </li>
            <li class="menu-item menu-item-about">
              <a href="/about/" rel="section">关于博主</a>
            </li>
            <li class="menu-item menu-item-message">
              <a href="/message/" rel="section">给我留言</a>
            </li>
            <li class="menu-item menu-item-search">
              <a role="button" class="popup-trigger">搜索 </a>
            </li>
          </ul>
        </nav>
        <div class="search-pop-overlay">
          <div class="popup search-popup">
            <div class="search-header">
              <span class="search-icon">
                <i class="fa fa-search"></i>
              </span>
              <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
              </div>
              <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
              </span>
            </div>
            <div id="search-result">
              <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span>0%</span>
    </div>
    <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content index posts-expand">
            <div class="carousel">
              <div id="wowslider-container">
                <div class="ws_images">
                  <ul>
                    <li><a target="_blank" href="https://item.jd.com/13527222.html"><img title="Python3网络爬虫开发实战（第二版）上市了！" src="https://qiniu.cuiqingcai.com/prwgs.png" /></a></li>
                    <li><a target="_blank" href="https://t.lagou.com/fRCBRsRCSN6FA"><img title="52讲轻松搞定网络爬虫" src="https://qiniu.cuiqingcai.com/fqq5e.png" /></a></li>
                    <li><a target="_blank" href="https://brightdata.grsm.io/cuiqingcai"><img title="亮网络解锁器" src="https://qiniu.cuiqingcai.com/6qnb7.png" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/4320.html"><img title="Python3网络爬虫开发视频教程" src="https://qiniu.cuiqingcai.com/bjrny.jpg" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/5094.html"><img title="爬虫代理哪家强？十大付费代理详细对比评测出炉！" src="https://qiniu.cuiqingcai.com/nifs6.jpg" /></a></li>
                  </ul>
                </div>
                <div class="ws_thumbs">
                  <div>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/prwgs.png" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/fqq5e.png" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/6qnb7.png" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/bjrny.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/nifs6.jpg" /></a>
                  </div>
                </div>
                <div class="ws_shadow"></div>
              </div>
            </div>
            <link rel="stylesheet" href="/lib/wowslide/slide.css">
            <script src="/lib/wowslide/jquery.min.js"></script>
            <script src="/lib/wowslide/slider.js"></script>
            <script>
              jQuery("#wowslider-container").wowSlider(
              {
                effect: "cube",
                prev: "",
                next: "",
                duration: 20 * 100,
                delay: 100 * 100,
                width: 716,
                height: 297,
                autoPlay: true,
                playPause: true,
                stopOnHover: false,
                loop: false,
                bullets: 0,
                caption: true,
                captionEffect: "slide",
                controls: true,
                onBeforeStep: 0,
                images: 0
              });

            </script>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6721.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6721.html" class="post-title-link" itemprop="url">Python 深度学习脚手架 ModelZoo</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>想必大家都或多或少听过 TensorFlow 的大名，这是 Google 开源的一个深度学习框架，里面的模型和 API 可以说基本是一应俱全，但 TensorFlow 其实有很多让人吐槽的地方，比如 TensorFlow 早期是只支持静态图的，你要调试和查看变量的值的话就得一个个变量运行查看它的结果，这是极其不友好的，而 PyTorch、Chainer 等框架就天生支持动态图，可以直接进行调试输出，非常方便。另外 TensorFlow 的 API 各个版本之间经常会出现不兼容的情况，比如 1.4 升到 1.7，里面有相当一部分 API 都被改了，里面有的是 API 名，有的直接改参数名，有的还给你改参数的顺序，如果要做版本兼容升级，非常痛苦。还有就是用 TensorFlow 写个模型，其实相对还是比较繁琐的，需要定义模型图，配置 Loss Function，配置 Optimizer，配置模型保存位置，配置 Tensor Summary 等等，其实并没有那么简洁。 然而为啥这么多人用 TensorFlow？因为它是 Google 家的，社区庞大，还有一个原因就是 API 你别看比较杂，但是确实比较全，contrib 模块里面你几乎能找到你想要的所有实现，而且更新确实快，一些前沿论文现在基本都已经在新版本里面实现了，所以，它的确是有它自己的优势。 然后再说说 Keras，这应该是除了 TensorFlow 之外，用的第二广泛的框架了，如果你用过 TensorFlow，再用上 Keras，你会发现用 Keras 搭模型实在是太方便了，而且如果你仔细研究下它的 API 设计，你会发现真的封装的非常科学，我感觉如果要搭建一个简易版的模型，Keras 起码得节省一半时间吧。 一个好消息是 TensorFlow 现在已经把 Keras 包进来了，也就是说如果你装了 TensorFlow，那就能同时拥有 TensorFlow 和 Keras 两个框架，哈哈，所以你最后还是装个 TensorFlow 就够了。 还有另一个好消息，刚才我不是吐槽了 TensorFlow 的静态图嘛？这的确是个麻烦的东西，不过现在的 TensorFlow 不一样了，它支持了 Eager 模式，也就是支持了动态图，有了它，我们可以就像写 Numpy 操作一样来搭建模型了，要看某个变量的值，很简单，直接 print 就 OK 了，不需要再去调用各种 run 方法了，可以直接抛弃 Session 这些繁琐的东西，所以基本上和 PyTorch 是一个套路的了，而且这个 Eager 模式在后续的 TensorFlow 2.0 版本将成为主打模式。简而言之，TensorFlow 比之前好用多了！ 好，以上说了这么多，我今天的要说的正题是什么呢？嗯，就是我基于 TensorFlow Eager 模式和 Keras 写了一个深度学习的框架。说框架也不能说框架，更准确地说应该叫脚手架，项目名字叫做 ModelZoo，中文名字可以理解成模型动物园。 有了这个脚手架，我们可以更加方便地实现一个深度学习模型，进一步提升模型开发的效率。 另外，既然是 ModelZoo，模型必不可少，我也打算以后把一些常用的模型来基于这个脚手架的架构实现出来，开源供大家使用。</p>
                  <h2 id="动机"><a href="#动机" class="headerlink" title="动机"></a>动机</h2>
                  <p>有人说，你这不是闲的蛋疼吗？人家 Keras 已经封装得很好了，你还写个啥子哦？嗯，没错，它的确是封装得很好了，但是我觉得某些地方是可以写得更精炼的。比如说，Keras 里面在模型训练的时候可以自定义 Callback，比如可以实现 Tensor Summary 的记录，可以保存 Checkpoint，可以配置 Early Stop 等等，但基本上，你写一个模型就要配一次吧，即使没几行代码，但这些很多情况都是需要配置的，所以何必每个项目都要再去写一次呢？所以，这时候就可以把一些公共的部分抽离出来，做成默认的配置，省去不必要的麻烦。 另外，我在使用过程中发现 Keras 的某些类并没有提供我想要的某些功能，所以很多情况下我需要重写某个功能，然后自己做封装，这其实也是一个可抽离出来的组件。 另外还有一个比较重要的一点就是，Keras 里面默认也不支持 Eager 模式，而 TensorFlow 新的版本恰恰又有了这一点，所以二者的兼并必然是一个绝佳的组合。 所以我写这个框架的目的是什么呢？</p>
                  <ul>
                    <li>第一，模型存在很多默认配置且可复用的地方，可以将默认的一些配置在框架中进行定义，这样我们只需要关注模型本身就好了。</li>
                    <li>第二，TensorFlow 的 Eager 模式便于 TensorFlow 的调试，Keras 的高层封装 API 便于快速搭建模型，取二者之精华。</li>
                    <li>第三，现在你可以看到要搜一个模型，会有各种花式的实现，有的用的这个框架，有的用的那个框架，而且参数、数据输入输出方式五花八门，实在是让人头大，定义这个脚手架可以稍微提供一些规范化的编写模式。</li>
                    <li>第四，框架名称叫做 ModelZoo，但我的理想也并不仅仅于实现一个简单的脚手架，我的愿景是把当前业界流行的模型都用这个框架实现出来，格式规范，API 统一，开源之后分享给所有人用，给他人提供便利。</li>
                  </ul>
                  <p>所以，ModelZoo 诞生了！</p>
                  <h2 id="开发过程"><a href="#开发过程" class="headerlink" title="开发过程"></a>开发过程</h2>
                  <p>开发的时候，我自己首先先实现了一些基本的模型，使用的是 TensorFlow Eager 和 Keras，然后试着抽离出来一些公共部分，将其封装成基础类，同时把模型独有的实现放开，供子类复写。然后在使用过程中自己还封装和改写过一些工具类，这部分也集成进来。另外就是把一些配置都规范化，将一些常用参数配置成默认参数，同时放开重写开关，在外部可以重定义。 秉承着上面的思想，我大约是在 10 月 6 日 那天完成了框架的搭建，然后在后续的几天基于这个框架实现了几个基础模型，最终打磨成了现在的样子。</p>
                  <h2 id="框架介绍"><a href="#框架介绍" class="headerlink" title="框架介绍"></a>框架介绍</h2>
                  <p>GitHub 地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01vZGVsWm9vL01vZGVsWm9v">https://github.com/ModelZoo/ModelZoo<i class="fa fa-external-link-alt"></i></span> 框架我已经发布到 PyPi，直接使用 pip 安装即可，目前支持 Python3，Python 2 尚未做测试，安装方式：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> <span class="keyword">model</span>-zoo</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其实我是很震惊，这个名字居然没有被注册！GitHub 和 PyPi 都没有！不过现在已经被我注册了。 OK，接下来让我们看看用了它能怎样快速搭建一个模型吧！ 我们就以基本的线性回归模型为例来说明吧，这里有一组数据，是波士顿房价预测数据，输入是影响房价的各个因素，输出是房价本身，具体的数据集可以搜 Boston housing price regression dataset 了解一下。 总之，我们只需要知道这是一个回归模型就好了，输入 x 是一堆 Feature，输出 y 是一个数值，房价。好，那么我们就开始定义模型吧，模型的定义我们继承 ModelZoo 里面的 BaseModel 就好了，实现 model.py 如下：</p>
                  <figure class="highlight haskell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="title">from</span> model_zoo.model <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">BostonHousingModel</span>(<span class="type">BaseModel</span>):</span></span><br><span class="line"><span class="class">    def __init__(<span class="title">self</span>, <span class="title">config</span>):</span></span><br><span class="line"><span class="class">        super(<span class="type">BostonHousingModel</span>, <span class="title">self</span>).__init__(<span class="title">config</span>)</span></span><br><span class="line"><span class="class">        self.dense = tf.keras.layers.<span class="type">Dense</span>(1)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    def call(<span class="title">self</span>, <span class="title">inputs</span>, <span class="title">training</span>=<span class="type">None</span>, <span class="title">mask</span>=<span class="type">None</span>):</span></span><br><span class="line"><span class="class">        o = self.dense(<span class="title">inputs</span>)</span></span><br><span class="line"><span class="class">        return o</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好了，这就定义完了！有人会说，你的 Loss Function 呢？你的 Optimizer 呢？你的 Checkpoint 保存呢？你的 Tensor Summary 呢？不需要！因为我已经把这些配置封装到 BaseModel 了，有默认的 Loss Function、Optimizer、Checkpoint、Early Stop、Tensor Summary，这里只需要关注模型本身即可。 有人说，要是想自定义 Loss Function 咋办呢？自定义 Optimizer 咋办呢？很简单，只需要复写一些基本的配置或复写某个方法就好了。 如改写 Optimizer，只需要重写 optimizer 方法即可：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">optimizer</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">return</span> tf.train.AdamOptimizer(<span class="number">0</span>.<span class="number">001</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，定义了模型之后怎么办？那当然是拿数据训练了，又要写数据加载，数据标准化，数据切分等等操作了吧，写到什么方法里？定义成什么样比较科学？现在，我们只需要实现一个 Trainer 就好了，然后复写 prepare_data 方法就好了，实现 train.py 如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> model_zoo.trainer <span class="keyword">import</span> BaseTrainer</span><br><span class="line"><span class="keyword">from</span> model_zoo.preprocess <span class="keyword">import</span> standardize</span><br><span class="line"></span><br><span class="line">tf.flags.DEFINE_integer(<span class="string">'epochs'</span>, <span class="number">100</span>, <span class="string">'Max epochs'</span>)</span><br><span class="line">tf.flags.DEFINE_string(<span class="string">'model_class'</span>, <span class="string">'BostonHousingModel'</span>, <span class="string">'Model class name'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trainer</span><span class="params">(BaseTrainer)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prepare_data</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">from</span> tensorflow.python.keras.datasets <span class="keyword">import</span> boston_housing</span><br><span class="line">        (x_train, y_train), (x_eval, y_eval) = boston_housing.load_data()</span><br><span class="line">        x_train, x_eval = standardize(x_train, x_eval)</span><br><span class="line">        train_data, eval_data = (x_train, y_train), (x_eval, y_eval)</span><br><span class="line">        <span class="keyword">return</span> train_data, eval_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    Trainer().run()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好了，完事了，模型现在已经全部搭建完成！在这里只需要实现 prepare_data 方法，返回训练集和验证集即可，其他的什么都不需要！ 数据标准化在哪做的？这里我也封装好了方法。 运行在哪运行的？这里我也做好了封装。 模型保存在哪里做的？同样做好了封装。 Batch 切分怎么做的？这里也做好了封装。 我们只需要按照格式，返回这两组数据就好了，其他的什么都不用管！ 那同样的，模型保存位置，模型名称，Batch Size 多大，怎么设置？还是简单改下配置就好了。 如要修改模型保存位置，只需要复写一个 Flag 就好了：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">tf.flags.<span class="constructor">DEFINE_string('<span class="params">checkpoint_dir</span>', '<span class="params">checkpoints</span>', <span class="params">help</span>='Data <span class="params">source</span> <span class="params">dir</span>')</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好了，现在模型可以训练了！直接运行上面的代码就好了：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">python3</span> train.<span class="keyword">py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果是这样子的：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Epoch 1/100</span><br><span class="line"> 1/13 [=&gt;<span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span>] - ETA: 0s - loss: 816.1798</span><br><span class="line">13/13 [==============================] - 0s 4ms/<span class="keyword">step</span> - loss: 457.9925 - val_loss: 343.2489</span><br><span class="line"></span><br><span class="line">Epoch 2/100</span><br><span class="line"> 1/13 [=&gt;<span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span>] - ETA: 0s - loss: 361.5632</span><br><span class="line">13/13 [==============================] - 0s 3ms/<span class="keyword">step</span> - loss: 274.7090 - val_loss: 206.7015</span><br><span class="line">Epoch 00002: saving model <span class="keyword">to</span> checkpoints/model.ckpt</span><br><span class="line"></span><br><span class="line">Epoch 3/100</span><br><span class="line"> 1/13 [=&gt;<span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span>] - ETA: 0s - loss: 163.5308</span><br><span class="line">13/13 [==============================] - 0s 3ms/<span class="keyword">step</span> - loss: 172.4033 - val_loss: 128.0830</span><br><span class="line"></span><br><span class="line">Epoch 4/100</span><br><span class="line"> 1/13 [=&gt;<span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span>] - ETA: 0s - loss: 115.4743</span><br><span class="line">13/13 [==============================] - 0s 3ms/<span class="keyword">step</span> - loss: 112.6434 - val_loss: 85.0848</span><br><span class="line">Epoch 00004: saving model <span class="keyword">to</span> checkpoints/model.ckpt</span><br><span class="line"></span><br><span class="line">Epoch 5/100</span><br><span class="line"> 1/13 [=&gt;<span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span>] - ETA: 0s - loss: 149.8252</span><br><span class="line">13/13 [==============================] - 0s 3ms/<span class="keyword">step</span> - loss: 77.0281 - val_loss: 57.9716</span><br><span class="line"><span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line"></span><br><span class="line">Epoch 42/100</span><br><span class="line"> 7/13 [===============&gt;<span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span>] - ETA: 0s - loss: 20.5911</span><br><span class="line">13/13 [==============================] - 0s 8ms/<span class="keyword">step</span> - loss: 22.4666 - val_loss: 23.7161</span><br><span class="line">Epoch 00042: saving model <span class="keyword">to</span> checkpoints/model.ckpt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到模型每次运行都会实时输出训练集和验证集的 Loss 的变化，另外还会自动保存模型，自动进行 Early Stop，自动保存 Tensor Summary。 可以看到这里运行了 42 个 Epoch 就完了，为什么？因为 Early Stop 的存在，当验证集经过了一定的 Epoch 一直不见下降，就直接停了，继续训练下去也没什么意义了。Early Stop 哪里配置的？框架也封装好了。 然后我们还可以看到当前目录下还生成了 events 和 checkpoints 文件夹，这一个是 TensorFlow Summary，供 TensorBoard 看的，另一个是保存的模型文件。 现在可以打开 TensorBoard 看看有什么情况，运行命令：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">cd events</span></span><br><span class="line"><span class="attribute">tensorboard --logdir</span>=.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><img src="https://qiniu.cuiqingcai.com/2019-06-25-115250.jpg" alt=""> 可以看到训练和验证的 Loss 都被记录下来，并化成了图表展示。而这些东西我们配置过吗？没有，因为框架封装好了。 好，现在模型有了，我们要拿来做预测咋做呢？又得构建一边图，又得重新加载模型，又得准备数据，又得切分数据等等，还是麻烦，并没有，这里只需要这么定义就好了，定义 infer.py 如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> model_zoo.inferer <span class="keyword">import</span> BaseInferer</span><br><span class="line"><span class="keyword">from</span> model_zoo.preprocess <span class="keyword">import</span> standardize</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">tf.flags.DEFINE_string(<span class="string">'checkpoint_name'</span>, <span class="string">'model.ckpt-20'</span>, help=<span class="string">'Model name'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Inferer</span><span class="params">(BaseInferer)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prepare_data</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">from</span> tensorflow.python.keras.datasets <span class="keyword">import</span> boston_housing</span><br><span class="line">        (x_train, y_train), (x_test, y_test) = boston_housing.load_data()</span><br><span class="line">        _, x_test = standardize(x_train, x_test)</span><br><span class="line">        <span class="keyword">return</span> x_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    result = Inferer().run()</span><br><span class="line">    print(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里只需要继承 BaseInferer，实现 prepare_data 方法就好了，返回的就是 test 数据集的 x 部分，其他的还是什么都不用干！ 另外这里额外定义了一个 Flag，就是 checkpoint_name，这个是必不可少的，毕竟要用哪个 Checkpoint 需要指定一下。 这里我们还是那数据集中的数据当测试数据，来看下它的输出结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[[ <span class="number">9.637125</span> ]</span><br><span class="line"> [<span class="number">21.368305</span> ]</span><br><span class="line"> [<span class="number">20.898445</span> ]</span><br><span class="line"> [<span class="number">33.832504</span> ]</span><br><span class="line"> [<span class="number">25.756516</span> ]</span><br><span class="line"> [<span class="number">21.264557</span> ]</span><br><span class="line"> [<span class="number">29.069794</span> ]</span><br><span class="line"> [<span class="number">24.968184</span> ]</span><br><span class="line"> ...</span><br><span class="line"> [<span class="number">36.027283</span> ]</span><br><span class="line"> [<span class="number">39.06852</span>  ]</span><br><span class="line"> [<span class="number">25.728745</span> ]</span><br><span class="line"> [<span class="number">41.62165</span>  ]</span><br><span class="line"> [<span class="number">34.340042</span> ]</span><br><span class="line"> [<span class="number">24.821484</span> ]]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就这样，预测房价结果就计算出来了，这个和输入的 x 内容都是一一对应的。 那有人又说了，我如果想拿到模型中的某个变量结果怎么办？还是很简单，因为有了 Eager 模式，直接输出就好。我要自定义预测函数怎么办？也很简单，复写 infer 方法就好了。 好，到现在为止，我们通过几十行代码就完成了这些内容：</p>
                  <ul>
                    <li>数据加载和预处理</li>
                    <li>模型图的搭建</li>
                    <li>Optimizer 的配置</li>
                    <li>运行结果的保存</li>
                    <li>Early Stop 的配置</li>
                    <li>Checkpoint 的保存</li>
                    <li>Summary 的生成</li>
                    <li>预测流程的实现</li>
                  </ul>
                  <p>总而言之，用了这个框架可以省去很多不必要的麻烦，同时相对来说比较规范，另外灵活可扩展。 以上就是 ModelZoo 的一些简单介绍。</p>
                  <h2 id="愿景"><a href="#愿景" class="headerlink" title="愿景"></a>愿景</h2>
                  <p>现在这个框架刚开发出来几天，肯定存在很多不成熟的地方，另外文档也还没有来得及写，不过我肯定是准备长期优化和维护下去的。另外既然取名叫做 ModelZoo，我后面也会把一些常用的深度学习模型基于该框架实现出来并发布，包括 NLP、CV 等各大领域，同时在实现过程中，也会发现框架本身的一些问题，并不断迭代优化。 比如基于该框架实现的人脸情绪识别的项目：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01vZGVsWm9vL0Vtb3Rpb25SZWNvZ25pdGlvbg==">https://github.com/ModelZoo/EmotionRecognition<i class="fa fa-external-link-alt"></i></span> 其识别准确率还是可以的，比如输入这些图片： <img src="https://qiniu.cuiqingcai.com/2019-06-25-115311.jpg" alt=""> 模型便可以输出对应的情绪类型和情绪分布：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">Image Path:</span> <span class="string">test1.png</span></span><br><span class="line"><span class="attr">Predict Result:</span> <span class="string">Happy</span></span><br><span class="line"><span class="attr">Emotion Distribution:</span> <span class="string">&#123;'Angry':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Disgust':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Fear':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Happy':</span> <span class="number">1.0</span><span class="string">,</span> <span class="attr">'Sad':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Surprise':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Neutral':</span> <span class="number">0.0</span><span class="string">&#125;</span></span><br><span class="line"><span class="string">====================</span></span><br><span class="line"><span class="attr">Image Path:</span> <span class="string">test2.png</span></span><br><span class="line"><span class="attr">Predict Result:</span> <span class="string">Happy</span></span><br><span class="line"><span class="attr">Emotion Distribution:</span> <span class="string">&#123;'Angry':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Disgust':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Fear':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Happy':</span> <span class="number">0.998</span><span class="string">,</span> <span class="attr">'Sad':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Surprise':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Neutral':</span> <span class="number">0.002</span><span class="string">&#125;</span></span><br><span class="line"><span class="string">====================</span></span><br><span class="line"><span class="attr">Image Path:</span> <span class="string">test3.png</span></span><br><span class="line"><span class="attr">Predict Result:</span> <span class="string">Surprise</span></span><br><span class="line"><span class="attr">Emotion Distribution:</span> <span class="string">&#123;'Angry':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Disgust':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Fear':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Happy':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Sad':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Surprise':</span> <span class="number">1.0</span><span class="string">,</span> <span class="attr">'Neutral':</span> <span class="number">0.0</span><span class="string">&#125;</span></span><br><span class="line"><span class="string">====================</span></span><br><span class="line"><span class="attr">Image Path:</span> <span class="string">test4.png</span></span><br><span class="line"><span class="attr">Predict Result:</span> <span class="string">Angry</span></span><br><span class="line"><span class="attr">Emotion Distribution:</span> <span class="string">&#123;'Angry':</span> <span class="number">1.0</span><span class="string">,</span> <span class="attr">'Disgust':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Fear':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Happy':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Sad':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Surprise':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Neutral':</span> <span class="number">0.0</span><span class="string">&#125;</span></span><br><span class="line"><span class="string">====================</span></span><br><span class="line"><span class="attr">Image Path:</span> <span class="string">test5.png</span></span><br><span class="line"><span class="attr">Predict Result:</span> <span class="string">Fear</span></span><br><span class="line"><span class="attr">Emotion Distribution:</span> <span class="string">&#123;'Angry':</span> <span class="number">0.04</span><span class="string">,</span> <span class="attr">'Disgust':</span> <span class="number">0.002</span><span class="string">,</span> <span class="attr">'Fear':</span> <span class="number">0.544</span><span class="string">,</span> <span class="attr">'Happy':</span> <span class="number">0.03</span><span class="string">,</span> <span class="attr">'Sad':</span> <span class="number">0.036</span><span class="string">,</span> <span class="attr">'Surprise':</span> <span class="number">0.31</span><span class="string">,</span> <span class="attr">'Neutral':</span> <span class="number">0.039</span><span class="string">&#125;</span></span><br><span class="line"><span class="string">====================</span></span><br><span class="line"><span class="attr">Image Path:</span> <span class="string">test6.png</span></span><br><span class="line"><span class="attr">Predict Result:</span> <span class="string">Sad</span></span><br><span class="line"><span class="attr">Emotion Distribution:</span> <span class="string">&#123;'Angry':</span> <span class="number">0.005</span><span class="string">,</span> <span class="attr">'Disgust':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Fear':</span> <span class="number">0.027</span><span class="string">,</span> <span class="attr">'Happy':</span> <span class="number">0.002</span><span class="string">,</span> <span class="attr">'Sad':</span> <span class="number">0.956</span><span class="string">,</span> <span class="attr">'Surprise':</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">'Neutral':</span> <span class="number">0.009</span><span class="string">&#125;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果大家对这个框架感兴趣，或者也想加入实现一些有趣的模型的话，可以在框架主页提 Issue 留言，我非常欢迎你的加入！另外如果大家感觉框架有不足的地方，也非常欢迎提 Issue 或发 PR，非常非常感谢！ 最后，如果你喜欢的话，还望能赠予它一个 Star，这样我也更有动力去维护下去。 项目的 GitHub 地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01vZGVsWm9vL01vZGVsWm9v">https://github.com/ModelZoo/ModelZoo<i class="fa fa-external-link-alt"></i></span>。 谢谢！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-06-25 20:00:54" itemprop="dateCreated datePublished" datetime="2019-06-25T20:00:54+08:00">2019-06-25</time>
                </span>
                <span id="/6721.html" class="post-meta-item leancloud_visitors" data-flag-title="Python 深度学习脚手架 ModelZoo" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>8.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>8 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6485.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6485.html" class="post-title-link" itemprop="url">Python 机器学习算法二之逻辑回归的推导及实战</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在线性回归模型中，我们实际上是建立了一个模型来拟合自变量和因变量之间的线性关系，但是在某些时候，我们要做的可能是一个分类模型，那么这里就可能用到线性回归模型的变种——逻辑回归，本节我们就逻辑回归来做一个详细的说明。</p>
                  <h2 id="实例引入"><a href="#实例引入" class="headerlink" title="实例引入"></a>实例引入</h2>
                  <p>我们还是以上一节的例子为例，张三、李四、王五、赵六都要贷款了，贷款时银行调查了他们的月薪和住房面积等因素，两个因素决定了贷款款项是否可以立即到账，下面列出来了他们四个人的工资情况、住房面积和到账的具体情况：</p>
                  <p>姓名</p>
                  <p>工资(元)</p>
                  <p>房屋面积(平方)</p>
                  <p>是否可立即到账</p>
                  <p>张三</p>
                  <p>6000</p>
                  <p>58</p>
                  <p>否</p>
                  <p>李四</p>
                  <p>9000</p>
                  <p>77</p>
                  <p>否</p>
                  <p>王五</p>
                  <p>11000</p>
                  <p>89</p>
                  <p>是</p>
                  <p>赵六</p>
                  <p>15000</p>
                  <p>54</p>
                  <p>是</p>
                  <p>看到了这样的数据，又来了一位孙七，他工资是 12000 元，房屋面积是 60 平，那的贷款可以立即到账吗？</p>
                  <h2 id="思路探索"><a href="#思路探索" class="headerlink" title="思路探索"></a>思路探索</h2>
                  <p>在这个例子中，我们不再是预测贷款金额具体是多少了，而是要对款项是否可以立即到账做一个分类，分类的结果要么是“否”要么是“是”，所以输出结果我们需要将其映射到一个区间内，让 0 代表“否”，1 代表“是”，这里我们就需要用一个函数来帮助我们实现这个功能，它的名字叫做 Sigmoid 函数，它的表达式是这样的： <script type="math/tex">g(z) = \\dfrac{1}{1+e^{-z}}</script> 它的函数图像是这样的： <img src="https://qiniu.cuiqingcai.com/2019-05-07-171241.jpg" alt=""> 它的定义域是全体实数，值域是 (0, 1)，当自变量小于 -5 的时候，其值就趋近于 0，当自变量大于 5 的时候，其值就趋近于 1，当自变量为 0 的时候，其值就等于 1/2。 所以我们如果在线性回归模型的基础上加一层 Sigmoid 函数，结果不就可以被转化为 0 到 1 了吗？这就很自然而然地转化为了一个分类模型。 我们知道，线性回归模型的表达形式是这样的： <script type="math/tex">h_{\\theta}(x) = \\sum_{i=0}^{n}\\theta_ix_i = \\theta^Tx</script> 如果我们在它的基础上加一层 Sigmoid 函数，其表达式就变成了： <script type="math/tex">h_{\\theta}(x) = g(\\theta^Tx) = \\dfrac{1}{1+e^{-\\theta^Tx}}</script> 好，现在我们来考虑下这个表达式表达的什么意思。 我们举例来说吧，如果这个函数的输出结果为 1，那么我们肯定认为结果为“是”。如果输出结果为 0 呢？我们就当然认为结果为 “否”了，但如果输出结果为 0.5 呢？我们只能模棱两可，此时我们既可以判断为“是”，也可以判断为“否”，但恰好为 0.5 的概率太小了，多多少少也有点偏差吧。所以如果输出结果为 0.51，那么我们怎么认为？我们认为“是”的概率会更大，否的概率更小，概率是多少？0.49。如果输出结果是 0.95 呢？“是”的概率是多少？不用多说，必然是 0.95。 因此，我们可以看出来，函数输出的结果就代表了预测为“是”的概率，也就是真实结果为 1 的概率。我们用公式表达下，这里我们用 $ h<em>{theta}(x) $ 表示预测结果，因此对于输入 x，分类类别为 1 和 0 的概率分别为： $$ \begin{cases} P(y = 1|x;\theta) = h</em>{\theta}(x) \\\\ P(y = 0|x;\theta) = 1 - h<em>{\theta}(x) \end{cases} <script type="math/tex">还是像线性回归一样，我们需要定义一个代价函数，让模型来优化这个代价函数。 在线性回归中，我们的代价函数是这样的：</script> J(\theta) = \dfrac{1}{2m}\sum</em>{i=1}^{m}(h<em>\theta(x^{(i)}) - y^{(i)})^2 <script type="math/tex">为什么是这样呢？是因为模型的输出结果和真实结果有一定的偏差，我们用它们的距离差的平方来定义了代价函数。 但是逻辑回归不一样啊，它又不是预测一个具体的数值，而是预测一个分类的概率，所以这里的代价函数我们可以写成这样子：</script> Cost(h</em>\theta(x), y) = \begin{cases} -log(h<em>\theta(x)), y = 1 \\\\ -log(1- h</em>\theta(x)), y = 0 \end{cases} <script type="math/tex">这里我们用了对数函数来定义它的损失值。比如当真实值 y 等于 1 的时候，如果我们的函数预测为 1，即 $ h_theta(x) $ 趋近于 1，这就代表预测对了，取对数再取反，结果趋近于 0，代表损失非常小。假如此时我们的函数预测结果趋近于 0，这就代表预测错了，取对数再取反，结果趋近于正无穷，代表损失特别大。所以，这个代价函数使用对数对预测错的结果进行了惩罚，偏离越大，其损失越大。 但是这个代价函数不好表示啊，我们想要把它写成一个表达式该怎么写？是这样的：</script> Cost(h<em>\theta(x), y) = -ylog(h</em>\theta(x)) - (1-y)log(1-h<em>\theta(x)) <script type="math/tex">这个式子和上面的式子是完全等价的。 好了，接下来我们计算所有样本的总的损失函数：</script> J(\theta) = \dfrac{1}{m}\sum</em>{i=1}^{m}Cost(h<em>\theta(x^{(i)}), y^{(i)})\\\\ = -\dfrac{1}{m}\sum</em>{i=1}^{m}[y^{(i)}log(h<em>\theta(x^{(i)})) + (1-y^{(i)})log(1-h</em>\theta(x^{(i)}))] $$ 和线性回归类似，这次我们的目的就是找到 $ theta $，使得 $ J(theta) $ 最小。</p>
                  <h2 id="推导过程"><a href="#推导过程" class="headerlink" title="推导过程"></a>推导过程</h2>
                  <p>这次我们就不能向上次一样用直接求偏导数，然后将偏导数置 0 的方法来求解 $ theta $ 了，这样是无法求解出具体的值的。 我们可以使用梯度下降法来进行求解，也就是一步步地求出 $theta$ 的更新过程，公式如下： <script type="math/tex">\\theta_j := \\theta_j - \\alpha\\dfrac{\\partial{J(\\theta)}}{\\partial(\\theta_j)}</script> 这里面最主要的就是求偏导，过程如下： <script type="math/tex">\\dfrac{\\partial{J(\\theta)}}{\\partial(\\theta_j)} \\\\\\\\ =-\\dfrac{1}{m}\\dfrac{\\partial{\\sum_{i=1}^{n}(y^{(i)}\\mathop{log}h_{\\theta}(x^{(i)}) + (1-y^{(i)})\\mathop{log}(1-h_{\\theta}(x^{(i)})))}}{\\partial(\\theta_j)} \\\\\\\\ =-\\dfrac{1}{m}\\sum_{i=1}^{n}(y^{(i)}\\dfrac{1}{h_{\\theta}(x^{(i)})}\\dfrac{\\partial{h_{\\theta}(x^{(i)})}}{\\partial{\\theta_j}} + (1-y^{(i)})\\dfrac{1}{1-h_{\\theta}(x^{(i)})}\\dfrac{\\partial{h_{\\theta}(x^{(i)})}}{\\partial{\\theta_j}}) \\\\\\\\ =-\\dfrac{1}{m}\\sum_{i=1}^{n}[y^{(i)}\\dfrac{1}{h_{\\theta}(x^{(i)})} + (1-y^{(i)})\\dfrac{1}{1-h_{\\theta}(x^{(i)})}] \\dfrac{\\partial{h_{\\theta}(x^{(i)})}}{\\partial{\\theta_j}} \\\\\\\\ =-\\dfrac{1}{m}\\sum_{i=1}^{n}[y^{(i)}\\dfrac{1}{h_{\\theta}(x^{(i)})} + (1-y^{(i)})\\dfrac{1}{1-h_{\\theta}(x^{(i)})}] h_{\\theta}(x^{(i)})(1-h_{\\theta}(x^{(i)}))\\dfrac{\\partial{\\theta^Tx^{(i)}}}{\\partial{\\theta_j}} \\\\\\\\ =-\\dfrac{1}{m}\\sum_{i=1}^{n}[y^{(i)}(1-h_{\\theta}(x^{(i)})) - (1-y^{(i)})h_{\\theta}(x^{(i)})]x_j^{(i)} \\\\\\\\ =-\\dfrac{1}{m}\\sum_{i=1}^{n}(y^{(i)} - h_{\\theta}(x^{(i)}))x_j^{(i)}</script> 因此： <script type="math/tex">\\theta_j := \\theta_j + \\dfrac{\\alpha}{m}\\sum_{i=1}^{n}(y^{(i)} - h_{\\theta}(x^{(i)}))x_j^{(i)}</script> 这时候我们发现，其梯度下降的推导结果和线性回归是一样的！</p>
                  <h2 id="编程实现"><a href="#编程实现" class="headerlink" title="编程实现"></a>编程实现</h2>
                  <p>下面我们还是用 Sklearn 中的 API 来实现逻辑回归模型，使用的库为 LogisticRegression，其 API 如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">class sklearn.linear_model.LogisticRegression(<span class="attribute">penalty</span>=’l2’, <span class="attribute">dual</span>=<span class="literal">False</span>, <span class="attribute">tol</span>=0.0001, <span class="attribute">C</span>=1.0, <span class="attribute">fit_intercept</span>=<span class="literal">True</span>, <span class="attribute">intercept_scaling</span>=1, <span class="attribute">class_weight</span>=None, <span class="attribute">random_state</span>=None, <span class="attribute">solver</span>=’liblinear’, <span class="attribute">max_iter</span>=100, <span class="attribute">multi_class</span>=’ovr’, <span class="attribute">verbose</span>=0, <span class="attribute">warm_start</span>=<span class="literal">False</span>, <span class="attribute">n_jobs</span>=1)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>参数说明如下：</p>
                  <ul>
                    <li>penalty：惩罚项，str 类型，可选参数为 l1 和 l2，默认为 l2。用于指定惩罚项中使用的规范。newton-cg、sag 和 lbfgs 求解算法只支持 L2 规范。L1G 规范假设的是模型的参数满足拉普拉斯分布，L2 假设的模型参数满足高斯分布，所谓的范式就是加上对参数的约束，使得模型更不会过拟合(overfit)，但是如果要说是不是加了约束就会好，这个没有人能回答，只能说，加约束的情况下，理论上应该可以获得泛化能力更强的结果。</li>
                    <li>dual：对偶或原始方法，bool 类型，默认为False。对偶方法只用在求解线性多核(liblinear)的 L2惩 罚项上。当样本数量 &gt; 样本特征的时候，dual 通常设置为 False。</li>
                    <li>tol：停止求解的标准，float类型，默认为1e-4。就是求解到多少的时候，停止，认为已经求出最优解。</li>
                    <li>c：正则化系数 λ 的倒数，float 类型，默认为 1.0。必须是正浮点型数。像 SVM 一样，越小的数值表示越强的正则化。</li>
                    <li>fit_intercept：是否存在截距或偏差，bool 类型，默认为 True。</li>
                    <li>intercept_scaling：仅在正则化项为”liblinear”，且fit_intercept 设置为 True 时有用。float 类型，默认为 1。</li>
                    <li>class_weight：用于标示分类模型中各种类型的权重，可以是一个字典或者’balanced’字符串，默认为不输入，也就是不考虑权重，即为 None。如果选择输入的话，可以选择 balanced 让类库自己计算类型权重，或者自己输入各个类型的权重。举个例子，比如对于0,1的二元模型，我们可以定义 class_weight={0:0.9,1:0.1}，这样类型0的权重为 90%，而类型 1 的权重为 10%。如果 class_weight选择 balanced，那么类库会根据训练样本量来计算权重。某种类型样本量越多，则权重越低，样本量越少，则权重越高。</li>
                    <li>random_state：随机数种子，int类型，可选参数，默认为无，仅在正则化优化算法为 sag，liblinear时有用。</li>
                    <li>solver：优化算法选择参数，只有五个可选参数，即newton-cg, lbfgs, liblinear, sag, saga。默认为liblinear。solver 参数决定了我们对逻辑回归损失函数的优化方法，有四种算法可以选择，分别是：<ul>
                        <li>liblinear：使用了开源的 liblinear 库实现，内部使用了坐标轴下降法来迭代优化损失函数。</li>
                        <li>lbfgs：拟牛顿法的一种，利用损失函数二阶导数矩阵即海森矩阵来迭代优化损失函数。</li>
                        <li>newton-cg：也是牛顿法家族的一种，利用损失函数二阶导数矩阵即海森矩阵来迭代优化损失函数。</li>
                        <li>sag：即随机平均梯度下降，是梯度下降法的变种，和普通梯度下降法的区别是每次迭代仅仅用一部分的样本来计算梯度，适合于样本数据多的时候。</li>
                        <li>saga：线性收敛的随机优化算法的的变重。</li>
                      </ul>
                    </li>
                    <li>max_iter：算法收敛最大迭代次数，int 类型，默认为10。仅在正则化优化算法为 newton-cg, sag 和 lbfgs 才有用，算法收敛的最大迭代次数。</li>
                    <li>multi_class：分类方式选择参数，str 类型，可选参数为 ovr 和 multinomial，默认为 ovr。ovr 即前面提到的one-vs-rest(OvR)，而 multinomial 即前面提到的 many-vs-many(MvM)。如果是二元逻辑回归，ovr 和 multinomial 并没有任何区别，区别主要在多元逻辑回归上。</li>
                    <li>verbose：日志冗长度，int 类型。默认为 0。就是不输出训练过程，1 的时候偶尔输出结果，大于 1，对于每个子模型都输出。</li>
                    <li>warm_start：热启动参数，bool 类型。默认为 False。如果为 True，则下一次训练是以追加树的形式进行（重新使用上一次的调用作为初始化）。</li>
                    <li>n_jobs：并行数。int 类型，默认为 1。1 的时候，用 CPU 的一个内核运行程序，2 的时候，用 CPU 的 2 个内核运行程序。为 -1 的时候，用所有 CPU 的内核运行程序。</li>
                  </ul>
                  <p>属性说明如下：</p>
                  <ul>
                    <li>coef_：斜率</li>
                    <li>intercept_：截距项</li>
                  </ul>
                  <p>我们现在来解决上面的示例，代码如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</span><br><span class="line"></span><br><span class="line">x_data = [</span><br><span class="line">    [<span class="number">6000</span>, <span class="number">58</span>],</span><br><span class="line">    [<span class="number">9000</span>, <span class="number">77</span>],</span><br><span class="line">    [<span class="number">11000</span>, <span class="number">89</span>],</span><br><span class="line">    [<span class="number">15000</span>, <span class="number">54</span>]</span><br><span class="line">]</span><br><span class="line">y_data = [</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">lr = LogisticRegression()</span><br><span class="line">lr.fit(x_data, y_data)</span><br><span class="line">x_test = [[<span class="number">12000</span>, <span class="number">60</span>]]</span><br><span class="line">print(<span class="string">'Intercept'</span>, lr.<span class="built_in">int</span>ercept_)</span><br><span class="line">print(<span class="string">'Coef'</span>, lr.coef_)</span><br><span class="line">print(<span class="string">'款项是否可以立即到账'</span>, lr.predict(x_test)[<span class="number">0</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们的 y_data 数据就变了，变成了是非判断，这里 0 代表“否”，1 代表“是”。这里做逻辑回归时使用了 LogisticRegression 对象，然后调用 fit() 方法进行拟合，拟合完毕之后，使用 [12000, 60] 这条数据作为输入，让模型输出它的预测值。 运行结果：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Intercept [<span class="number">-0.03142387</span>]</span><br><span class="line">Coef <span class="string">[[ 0.00603919 -0.72587703]]</span></span><br><span class="line">款项是否可以立即到账 <span class="number">1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果中输出了截距项和系数项，然后预测了是否可以立即到账，结果为 1，这表明孙七进行贷款，款项可以立即到账。 以上就是逻辑回归的基本推导和代码应用实现。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-06-21 10:54:19" itemprop="dateCreated datePublished" datetime="2019-06-21T10:54:19+08:00">2019-06-21</time>
                </span>
                <span id="/6485.html" class="post-meta-item leancloud_visitors" data-flag-title="Python 机器学习算法二之逻辑回归的推导及实战" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6645.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6645.html" class="post-title-link" itemprop="url">推荐给大家一个我整理的 Python 书单</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>六一八来了，现在各大平台都开始促销了，作为一名程序员，除了自己买一些大件和帮女朋友疯狂抢购，最好的选择就是买书好好学习技术了。 关注我的朋友可能很多都是学习 <strong>Python、爬虫、Web、数据分析、机器学习</strong>相关的。当然大家可能接触某个方向的时间不一样，可能有的同学已经对某个方向特别精通，有的同学在某个方向还处于入门阶段。 所以我花时间调研了一些大佬的推荐书单，同时结合我个人所看的一些书籍，另外参考了豆瓣、京东等排行榜和一些书评，选取了一些经典好评书籍和近期上市且反响不错的书籍，推荐给大家，内容涉及 <strong>Python 基础、**</strong>数据分析、机器学习、Web 开发<strong>等方向。 另外当当这边也有相当大力度的折扣，我也联系了当当获取了两个优惠码，大家可以用起来！这里也没有推销的意思，也没有用官方推荐的书单，是单纯根据书的内容来推荐的。 现在当当的书是</strong>每满 100 减 50<strong>，下面给大家两个优惠码，可以直接在满减的基础上</strong>继续折扣<strong>。 全品类优惠码： </strong>Y6NDPP<strong> 这个码买什么书都可以享受优惠，可享受</strong>满 200 减 40<strong> 优惠，叠加后相当于</strong>满 400 减 240<strong>，即 160 元可以购买 400 元的书籍，在</strong>当当 App 或小程序<strong>上下单有效。 计算机类： </strong>P6HFCE<strong> 这个码只能买计算机类的图书，可享受满 </strong>100 减 20<strong> 优惠，叠加后相当于</strong>满 200 减 120<strong>，在</strong>当当 App 或小程序上下单<strong>有效。 注意这两个优惠码</strong>有效期到 2019.06.20<strong>，过期就不能用了，而且</strong>数量是有限**的，多人共享，到了一定的使用次数就不能用了，后面我也没有办法补了，所以还是先到先得。 好，下面是我挑选的一些书籍，大家可以自行选购。也由于个人水平有限，很可能大家觉得优秀的书籍没有列出，如果大家有觉得不错的书籍，欢迎大家留言，大家也可以参考留言区的书籍来购买，谢谢大家支持。</p>
                  <h2 id="Python-编程"><a href="#Python-编程" class="headerlink" title="Python 编程"></a>Python 编程</h2>
                  <p>这一部分书籍是单纯讲解 Python 编程的，有入门的有进阶的，大家可以参考评分和出版时间选购。</p>
                  <h3 id="Python-入门"><a href="#Python-入门" class="headerlink" title="Python 入门"></a>Python 入门</h3>
                  <p>《Python编程：从入门到实践》/ 豆瓣 9.1 / 2016-7-1 出版 / [美] 埃里克·马瑟斯 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/Python编程：从入门到实践.jpg" alt=""> 《Python基础教程（第3版）》/ 豆瓣 8.0 / 2018-2-1 出版 / [挪] 海特兰德 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/Python基础教程（第3版）.jpg" alt=""> 《Python编程快速上手》/ 豆瓣 9.0 / 2016-7-1 出版 / [美] 思维加特 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/Python编程快速上手.jpg" alt=""> 《笨办法学Python3》/ 豆瓣 8.4 / 2018-6-1 出版 / [美] 泽德 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/笨办法学Python3.jpg" alt=""></p>
                  <h3 id="Python-进阶"><a href="#Python-进阶" class="headerlink" title="Python 进阶"></a>Python 进阶</h3>
                  <p>《流畅的Python》/ 豆瓣 9.4 / 2017-5-15 出版 / [巴西] 拉马略 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/流畅的Python.jpg" alt=""> 《Python Cookbook 中文版》/ 豆瓣 9.2 / 2015-5-1 出版 / [美] 比斯利 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/Python-Cookbook-中文版.jpg" alt=""> 《Effective Python》/ 豆瓣 9.0 / 2016-1-18 出版 / [美] 斯拉特金 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/Effective-Python.jpg" alt=""> 《Python编程之美》/ 豆瓣 8.4 / 2018-8-1 出版 / [美] 肯尼思·赖茨 Kenneth Reitz <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/Python编程之美.jpg" alt=""> 《Python高性能编程》/ 豆瓣 7.2 / 2017-7-1 出版 / [美] 戈雷利克 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/Python高性能编程.jpg" alt=""></p>
                  <h2 id="数据及算法"><a href="#数据及算法" class="headerlink" title="数据及算法"></a>数据及算法</h2>
                  <h3 id="网络爬虫"><a href="#网络爬虫" class="headerlink" title="网络爬虫"></a>网络爬虫</h3>
                  <p>《Python网络爬虫权威指南（第2版）》/ 新书 / 2019-4-1 出版 / [美] 米切尔 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/Python网络爬虫权威指南（第2版）.jpg" alt=""> 《Python3网络爬虫开发实战》/ 豆瓣 9.0 / 2018-4-1 出版 / 崔庆才 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/Python3网络爬虫开发实战.jpg" alt=""> 数据分析 《利用Python进行数据分析（第2版）》/ 豆瓣 8.5 / 2018-7-30 出版 / [美] 麦金尼 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/利用Python进行数据分析（第2版）.jpg" alt=""> 《对比Excel，轻松学习Python数据分析》/ 豆瓣 7.8 / 2019-2-1 出版 / 张俊红 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/对比Excel，轻松学习Python数据分析.jpg" alt=""> 《Python数据分析与挖掘实战》/ 豆瓣 7.8 / 2016-1-1 出版 / 张良均 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/Python数据分析与挖掘实战.jpg" alt=""></p>
                  <h3 id="机器学习"><a href="#机器学习" class="headerlink" title="机器学习"></a>机器学习</h3>
                  <p>《统计学习方法（第2版）》/ 豆瓣 9.5 / 2018-5-5 出版 / 李航 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/统计学习方法（第2版）.jpg" alt=""> 《白话深度学习与TensorFlow》/ 豆瓣 7.1 / 2017-7-31 出版 / 高扬 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/白话深度学习与TensorFlow.jpg" alt=""> 《机器学习》/ 豆瓣 8.7 / 2016-1-1 出版 / 周志华 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/机器学习.jpg" alt=""> 《Python机器学习基础教程》/ 豆瓣 8.2 / 2018-1-1 出版 / [德] 穆勒 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/Python机器学习基础教程.jpg" alt=""> 《Python深度学习》/ 豆瓣 9.6 / 2018-8-1 出版 / [美] 肖莱 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/Python深度学习.jpg" alt=""> 《Python神经网络编程》/ 豆瓣 9.0 / 2018-4-1 出版 / [英] 拉希德 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/Python神经网络编程.jpg" alt=""></p>
                  <h2 id="前后端技术"><a href="#前后端技术" class="headerlink" title="前后端技术"></a>前后端技术</h2>
                  <h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3>
                  <p>《你不知道的JavaScript》/ 豆瓣 9.3 / 2018-1-1 出版 / [美] 辛普森 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/你不知道的JavaScript.jpg" alt=""> 《深入浅出Vue.js》/ 新书 / 2018-3-1 出版 / 刘博文 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/深入浅出Vue.js.jpg" alt=""></p>
                  <h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3>
                  <p>《Django企业开发实战》/ 豆瓣 7.7 / 2019-2-1 出版 / 胡阳 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/Django企业开发实战.jpg" alt=""> 《Flask Web开发（第2版）》/ 豆瓣 9.4 / 2018-8-1 出版 / [美] 格雷贝格 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/Flask-Web开发（第2版）.jpg" alt=""> 《深入浅出Docker》/ 豆瓣 8.4 / 2019-4-1 出版 / [英] 波尔顿 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/深入浅出Docker.jpg" alt=""> 《深入理解Kafka》/ 新书 / 2019-1-1 出版 / 朱忠华 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/深入理解Kafka.jpg" alt=""> 《Kubernetes权威指南（第4版）》/ 新书 / 2018-5-1 出版 / 龚正 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/Kubernetes权威指南（第4版）.jpg" alt=""></p>
                  <h2 id="程序员经典"><a href="#程序员经典" class="headerlink" title="程序员经典"></a>程序员经典</h2>
                  <p>这是一些程序员通用的技能书，非常经典而且有用，几乎是必备书籍，强烈推荐。 《集体智慧编程》/ 豆瓣 9.0 / 2015-3-1 出版 / 西格兰 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/集体智慧编程.jpg" alt=""> 《程序员的数学》/ 豆瓣 8.6 / 2016-6-25 出版 / [日] 结城浩 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/程序员的数学.jpg" alt=""> 《程序员修炼之道》/ 豆瓣 8.6 / 2011-1-1 出版 / [美] 亨特 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/程序员修炼之道.jpg" alt=""> 《代码整洁之道》/ 豆瓣 8.6 / 2016-9-1 出版 / [美] 罗伯特 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/代码整洁之道.jpg" alt=""> 《持续交付2.0》/ 豆瓣 9.4 / 2019-1-1 出版 / 乔梁 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/持续交付2.0.jpg" alt=""> 《鸟哥的Linux私房菜（第4版）》/ 豆瓣 8.0 / 2018-11-1 出版 / 鸟哥 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/鸟哥的Linux私房菜（第4版）.jpg" alt=""> 《颈椎病康复指南》/ 豆瓣 8.6 / 2012-4-1 出版 / 陈选宁 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/颈椎病康复指南.jpg" alt=""> 以上便是我所推荐的书籍，数量有限，如果大家还有推荐的书籍，欢迎留言~</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-06-19 18:55:49" itemprop="dateCreated datePublished" datetime="2019-06-19T18:55:49+08:00">2019-06-19</time>
                </span>
                <span id="/6645.html" class="post-meta-item leancloud_visitors" data-flag-title="推荐给大家一个我整理的 Python 书单" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6613.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6613.html" class="post-title-link" itemprop="url">Python 机器学习算法一之线性回归的推导及实战</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>线性回归是机器学习中最基本的算法了，一般要学习机器学习都要从线性回归开始讲起，本节就对线性回归做一个详细的解释。</p>
                  <h2 id="实例引入"><a href="#实例引入" class="headerlink" title="实例引入"></a>实例引入</h2>
                  <p>在讲解线性回归之前，我们首先引入一个实例，张三、李四、王五、赵六都要贷款了，贷款时银行调查了他们的月薪和住房面积等因素，月薪越高，住房面积越大，可贷款金额越多，下面列出来了他们四个人的工资情况、住房面积和可贷款金额的具体情况：</p>
                  <p>姓名</p>
                  <p>工资(元)</p>
                  <p>房屋面积(平方)</p>
                  <p>可贷款金额(元)</p>
                  <p>张三</p>
                  <p>6000</p>
                  <p>58</p>
                  <p>30000</p>
                  <p>李四</p>
                  <p>9000</p>
                  <p>77</p>
                  <p>55010</p>
                  <p>王五</p>
                  <p>11000</p>
                  <p>89</p>
                  <p>73542</p>
                  <p>赵六</p>
                  <p>15000</p>
                  <p>54</p>
                  <p>63201</p>
                  <p>看到了这样的数据，又来了一位孙七，他工资是 12000 元，房屋面积是 60 平，那他大约能贷款多少呢？</p>
                  <h2 id="思路探索"><a href="#思路探索" class="headerlink" title="思路探索"></a>思路探索</h2>
                  <p>那这时候应该往哪方面考虑呢？如果我们假定可贷款金额和工资、房屋面积都是线性相关的，要解决这个问题，首先我们想到的应该就是初高中所学的一次函数吧，它的一般表达方式是 $ y = wx + b $，$ x $ 就是自变量，$ y $ 就是因变量，$ w $ 是自变量的系数，$ b $ 是偏移量，这个式子表明 $ y $ 和 $ x $ 是线性相关的，$ y $ 会随着 $ x $ 的变化而呈现线性变化。 现在回到我们的问题中，情况稍微不太一样，这个例子中是可贷款金额会随着工资和房屋面积而呈现线性变化，此时如果我们将工资定义为 $ x<em>1 $，房屋面积定义为 $ x_2 $，可贷款金额定义为 $ y $，那么它们三者的关系就可以表示为： $ y = w_1x_1 + w_2x_2 + b $，这里的自变量就不再是一个了，而是两个，分别是 $ x_1 $ 和 $ x_2 $，自变量系数就表示为了 $ w_1 $ 和 $ w_2 $，我们将其转化为表达的形式，同时将变量的名字换一下，就成了这个样子： $$ h</em>{\theta}(x) = \theta_0 + \theta_1x_1 + \theta_2x_2 $$ 这里只不过是将原表达式转为函数形式，换了个表示名字，另外参数名称从 $ w $ 换成了 $ \theta $，$ b $ 换成了 $ \theta_0 $，为什么要换？因为在机器学习算法中 $ \theta $ 用的更广泛一些，约定俗成。 然后这个问题怎么解？我们只需要求得一组近似的 $ \theta $ 参数使得我们的函数可以拟合已有的数据，然后整个函数表达式就可以表示出来了，然后再将孙七的工资和房屋面积代入进去，就求出来他可以贷款的金额了。</p>
                  <h2 id="思路拓展"><a href="#思路拓展" class="headerlink" title="思路拓展"></a>思路拓展</h2>
                  <p>那假如此时情景变一变，变得更复杂一些，可贷款金额不仅仅和工资、房屋面积有关，还有当前存款数、年龄等等因素有关，那我们的表达式应该怎么写？不用担心，我们有几个影响因素，就写定义几个变量，比如我们可以将存款数定义为 $ x<em>3 $，年龄定义为 $ x_4 $，如果还有其他影响因素我们可以继续接着定义，如果一共有 $ n $ 个影响因素，我们就定义到 $ x_n $，这时候函数表达式就可以变成这样子了： $$ h</em>{\theta}(x) = \theta<em>0 + \theta_1x_1 + \theta_2x_2 + … + \theta_nx_n <script type="math/tex">这个式子看起来挺长的不好写的吧，我们可以使用求和公式写成如下形式：</script> h</em>{\theta}(x) = \sum_{i=0}^{n}\theta_ix_i = \theta^Tx $$ 如果要使得这个公式成立，这里需要满足一个条件就是 $ x_0 = 1 $，其实在实际场景中 $ x_0 $ 是不存在的，因为第一个影响因素我们用 $ x_1 $ 来表示了，第二个影响因素我们用 $ x_2 $ 来表示了，依次类推。所以这里我们直接指定 $ x_0 = 1 $ 即可。 后来我们又将公式简化为线性代数的向量表示，这里 $ \theta^T $ 是 $ \theta $ 向量转置的结果，而 $ \theta $ 向量又表示为 $ (\theta_0, \theta_1, …, \theta_n) $，同样地，$ x $ 向量可以表示为 $ (x_0, x_1, …, x_n) $，总之，表达成后面的式子，看起来更简洁明了。 好了，这就是最基本的线性判别解析函数的写法，是不是很简单。</p>
                  <h2 id="实际求解"><a href="#实际求解" class="headerlink" title="实际求解"></a>实际求解</h2>
                  <p>那接下来我们怎样实际求解这个问题呢？比如拿张三的数据代入到这个函数表达式中，这里还是假设有两个影响因素，张三的数据我们可以表示为 $ x<em>1^{(1)} = 6000, x_2^{(1)} = 58, y^{(1)} = 30000 $，注意这里我们在数据的右上角加了一个小括号，里面带有数字，如果我们把张三的数据看成一个条目，那么这个数字就代表了这个条目的序号，1 就代表第一条数据，2 就代表第二条数据，为啥这么写？也是约定俗成，以后也会经常采用这样的写法，记住就好了。 所以，我们的愿景是要使得我们的函数能够拟合当前的这条数据，所以我们希望是这样的情况： $$ y^{(1)} = \sum</em>{i=0}^{n}\theta<em>{i}x</em>{i}^{(1)} = \theta^Tx^{(1)} <script type="math/tex">其中 $ y^{(1)} $ 是真实值，但我们知道，哪有那么容易十全十美，丝毫不差的拟合函数，所以上面的式子一般来说是不成立的，函数计算值和真实值还是多少还是有一定的误差的吧，如果我们想知道函数真实拟合的结果的话，我们需要把 $ x $ 变量代入函数，会得到一个函数本身拟合的结果，是这样的：</script> h<em>{\theta}(x^{(1)}) = \sum</em>{i=0}^{n}\theta<em>{i}x</em>{i}^{(1)} = \theta^Tx^{(1)} <script type="math/tex">这里的 $ h_{\\theta}(x^{(1)}) $ 就是我们函数得到的结果了。一般来说，二者是会存在一定的误差的，所以误差我们一般可以写成他们的差的绝对值或平方的形式，使用绝对值或平方的目的是消去正负号的影响，比如写成平方的形式就是这样子：</script> (h<em>{\theta}(x^{(1)}) - y^{(1)})^2 <script type="math/tex">这个式子就是我们函数真实拟合值和真实值之间的差距，没问题吧。 相应的，如果是李四的数据，误差就可以写为：</script> (h</em>{\theta}(x^{(2)}) - y^{(2)})^2 <script type="math/tex">依次类推，如果是第 $ i $ 条数据，误差就可以写成：</script> (h<em>{\theta}(x^{(i)}) - y^{(i)})^2 <script type="math/tex">要使得我们的函数对所有的数据都能尽量很好地拟合，我们可以把这些误差加起来求个平均，假设一共 $ m $ 条数据，那么所有数据的误差可以写成如下形式：</script> J(\theta) = \dfrac{1}{2m}\sum</em>{i=1}^{m}(h_\theta(x^{(i)}) - y^{(i)})^2 $$ 注意这里 $ i $ 指的是第几条数据，是从 1 开始的，一直到 $ m $ 为止，然后使用了求和公式对每一条数据的误差进行累加和，最后除以了 $ 2m $，我们的最终目的就是找出合适的 $ \theta $，使得这个 $ J(\theta ) $ 的值最小，即误差最小，在机器学习中，我们就把 $ J(\theta) $ 称为损失函数（Loss Function），即我们要使得损失值最小。 有的小伙伴可能好奇损失函数前面为什么是 $ 2m $，而不是 $ m $？因为我们后面要用到这个算式的导数，所以这里多了个 2 是为了便于求导计算。况且一个表达式要求最小值，前面乘一个常数是对结果没影响的。</p>
                  <h2 id="求解过程"><a href="#求解过程" class="headerlink" title="求解过程"></a>求解过程</h2>
                  <p>由于我们求解的是线性回归问题，所以整个损失函数的图像非常简单清晰，如果只有 $ \theta<em>1 $ 和 $ \theta_2 $ 两个参数，我们甚至可以直接画出其图像，整个损失函数大小随 $ \theta_1 $ 和 $ \theta_2 $ 的变化实际上类似于这样子： <img src="https://qiniu.cuiqingcai.com/2019-06-12-074355.jpg" alt=""> 可以看到这是一个凸函数，竖轴代表损失函数的大小，横纵两轴代表 $ \theta_1 $ 和 $ \theta_2 $ 的变化，可见在中间的最低谷损失函数取得最小值，这时候损失函数在 $ \theta_1 $ 和 $ \theta_2 $ 上的导数都是 0，因此我们可以一步到位，直接用偏导置零的方式来求解损失函数取得最小值时的 $ \theta $ 值的大小。 所以我们可以先对每个 $ \theta $ 求解其偏导结果，这里 $ \theta $ 表示为 $ \theta_j $，代表 $ \theta $ 中的某一维： $$ \dfrac{\partial{J(\theta)}}{\partial{\theta_j}} = \dfrac{1}{2m} \dfrac{\partial({\sum</em>{i=1}^{m}{(y^{(i)} - h<em>{\theta}(x^{(i)}))^2}})}{\partial{\theta_j}} \\\\ =\dfrac{1}{m}\sum</em>{i=1}^{m}((h<em>{\theta}(x^{(i)}) - y^{(i)})x_j^{(i)}) <script type="math/tex">直接将偏导置零即可直接求解 $ \\theta_j $： ​</script> \sum</em>{i=1}^{m} {h<em>{\theta}(x^{(i)})x_j^{(i)}} - \sum</em>{i=1}^{m}y^{(i)}x<em>j^{(i)} = 0 <script type="math/tex">这里将所有数据代入，即可通过求解方程组的形式直接解出 $ \\theta_j $ 的值，但这些方程组里面其实 $ \\theta_j $ 之间存在彼此依赖关系，需要联立求解出来。 如果不用这种求解方式，我们可以使用梯度下降的方式来进行求解，在这里 $ \\theta_j $ 只需要逐步更新即可：</script> \theta_j = \theta_j - \alpha\dfrac{\partial{J(\theta)}}{\partial{\theta_j}} \\\\ = \theta_j - \dfrac{\alpha}{m}\sum</em>{i=1}^{m}((h_{\theta}(x^{(i)}) - y^{(i)})x_j^{(i)}) $$ 这里 $ \alpha $ 就是学习率，$ \theta_j $ 每经过一步都会进行一次更新，得到新的结果，经过梯度下降过程，$ \theta_j $ 都会更新为使得梯度最小化的数值，最后就完成了 $ \theta $ 的求解。 以上便是线性回归的整个推导和求解过程。</p>
                  <h2 id="实战操作"><a href="#实战操作" class="headerlink" title="实战操作"></a>实战操作</h2>
                  <p>现在呢，我们想要根据前面的数据来求解这个真实的问题，为了解决这个问题，我们在这里用 Python 的 Sklearn 库来实现。 对于线性回归来说，Sklearn 已经做好了封装，直接使用 LinearRegression 即可。 它的 API 如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">class sklearn.linear_model.LinearRegression(<span class="attribute">fit_intercept</span>=<span class="literal">True</span>, <span class="attribute">normalize</span>=<span class="literal">False</span>, <span class="attribute">copy_X</span>=<span class="literal">True</span>, <span class="attribute">n_jobs</span>=None)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>参数解释如下：</p>
                  <ul>
                    <li>fit_intercept : 布尔值，是否使用偏置项，默认是 True。</li>
                    <li>normalize : 布尔值，是否启用归一化，默认是 False。当 fit_intercept 被置为 False 的时候，这个参数会被忽略。当该参数为 True 时，数据会被归一化处理。</li>
                    <li>copy_X : 布尔值，默认是 True，如果为 True，x 参数会被拷贝不会影响原来的值，否则会被复写。</li>
                    <li>n_jobs：数值或者布尔，如果设置了，则多核并行处理。</li>
                  </ul>
                  <p>属性如下：</p>
                  <ul>
                    <li>coef_：x 的权重系数大小</li>
                    <li>intercept_：偏置项大小</li>
                  </ul>
                  <p>代码实现如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression</span><br><span class="line"></span><br><span class="line">x_data = [</span><br><span class="line">    [<span class="number">6000</span>, <span class="number">58</span>],</span><br><span class="line">    [<span class="number">9000</span>, <span class="number">77</span>],</span><br><span class="line">    [<span class="number">11000</span>, <span class="number">89</span>],</span><br><span class="line">    [<span class="number">15000</span>, <span class="number">54</span>]</span><br><span class="line">]</span><br><span class="line">y_data = [</span><br><span class="line">    <span class="number">30000</span>, <span class="number">55010</span>, <span class="number">73542</span>, <span class="number">63201</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">lr = LinearRegression()</span><br><span class="line">lr.fit(x_data, y_data)</span><br><span class="line">print(<span class="string">'方程为：y=&#123;w1&#125;x1+&#123;w2&#125;x2+&#123;b&#125;'</span>.format(w1=round(lr.coef_[<span class="number">0</span>], <span class="number">2</span>),</span><br><span class="line">                                       w2=round(lr.coef_[<span class="number">1</span>], <span class="number">2</span>),</span><br><span class="line">                                       b=lr.<span class="built_in">int</span>ercept_))</span><br><span class="line">x_test = [[<span class="number">12000</span>, <span class="number">60</span>]]</span><br><span class="line">print(<span class="string">'贷款金额为：'</span>, lr.predict(x_test)[<span class="number">0</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">方程为：y=<span class="number">4.06</span>x1+<span class="number">743.15</span>x2+<span class="number">-37831.862532707615</span></span><br><span class="line">贷款金额为：<span class="number">55484.33779181102</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们首先声明了 LinearRegression 对象，然后将数据整合成 x<em>data 和 y_data 的形式，然后通过调用 fit() 方法来对数据进行拟合。 拟合完毕之后，LinearRegression 的 coef</em> 对象就是各个 x 变量的权重大小，即对应着 $ \theta<em>1, \theta_2 $，intercept</em> 则是偏移量，对应着 $ \theta_0 $，这样我们就可以得到一个线性回归表达式了。 然后我们再调用 predict() 方法，将新的测试数据传入，便可以得到其预测结果，最终结果为 55484.34，即孙七的可贷款额度为 55484.34 元。 以上便是机器学习中线性回归算法的推导解析和相关调用实现。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-06-19 11:30:36" itemprop="dateCreated datePublished" datetime="2019-06-19T11:30:36+08:00">2019-06-19</time>
                </span>
                <span id="/6613.html" class="post-meta-item leancloud_visitors" data-flag-title="Python 机器学习算法一之线性回归的推导及实战" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>5.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6552.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6552.html" class="post-title-link" itemprop="url">Python 使用 attrs 和 cattrs 实现面向对象编程</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>Python 是支持面向对象的，很多情况下使用面向对象编程会使得代码更加容易扩展，并且可维护性更高，但是如果你写的多了或者某一对象非常复杂了，其中的一些写法会相当相当繁琐，而且我们会经常碰到对象和 JSON 序列化及反序列化的问题，原生的 Python 转起来还是很费劲的。 可能这么说大家会觉得有点抽象，那么这里举几个例子来感受一下。 首先让我们定义一个对象吧，比如颜色。我们常用 RGB 三个原色来表示颜色，R、G、B 分别代表红、绿、蓝三个颜色的数值，范围是 0-255，也就是每个原色有 256 个取值。如 RGB(0, 0, 0) 就代表黑色，RGB(255, 255, 255) 就代表白色，RGB(255, 0, 0) 就代表红色，如果不太明白可以具体看看 RGB 颜色的定义哈。 好，那么我们现在如果想定义一个颜色对象，那么正常的写法就是这样了，创建这个对象的时候需要三个参数，就是 R、G、B 三个数值，定义如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Color</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Color Object of RGB</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, r, g, b)</span>:</span></span><br><span class="line">        self.r = r</span><br><span class="line">        self.g = g</span><br><span class="line">        self.b = b</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其实对象一般就是这么定义的，初始化方法里面传入各个参数，然后定义全局变量并赋值这些值。其实挺多常用语言比如 Java、PHP 里面都是这么定义的。但其实这种写法是比较冗余的，比如 r、g、b 这三个变量一写就写了三遍。 好，那么我们初始化一下这个对象，然后打印输出下，看看什么结果：</p>
                  <figure class="highlight dos">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">color</span> = <span class="built_in">Color</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">color</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果是什么样的呢？或许我们也就能看懂一个 Color 吧，别的都没有什么有效信息，像这样子：</p>
                  <figure class="highlight dos">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;__main__.<span class="built_in">Color</span> object <span class="built_in">at</span> <span class="number">0</span>x103436f60&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们知道，在 Python 里面想要定义某个对象本身的打印输出结果的时候，需要实现它的 <code>__repr__</code> 方法，所以我们比如我们添加这么一个方法：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f'<span class="subst">&#123;self.__class__.__name__&#125;</span>(r=<span class="subst">&#123;self.r&#125;</span>, g=<span class="subst">&#123;self.g&#125;</span>, b=<span class="subst">&#123;self.b&#125;</span>)'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里使用了 Python 中的 fstring 来实现了 <code>__repr__</code> 方法，在这里我们构造了一个字符串并返回，字符串中包含了这个 Color 类中的 r、g、b 属性，这个返回的结果就是 print 的打印结果，我们再重新执行一下，结果就变成这样子了：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Color(<span class="attribute">r</span>=255, <span class="attribute">g</span>=255, <span class="attribute">b</span>=255)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>改完之后，这样打印的对象就会变成这样的字符串形式了，感觉看起来清楚多了吧？ 再继续，如果我们要想实现这个对象里面的 <code>__eq__</code>、<code>__lt__</code> 等各种方法来实现对象之间的比较呢？照样需要继续定义成类似这样子的形式：</p>
                  <figure class="highlight gml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def __lt__(<span class="literal">self</span>, <span class="literal">other</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isinstance(<span class="literal">other</span>, <span class="literal">self</span>.__class__): <span class="keyword">return</span> NotImplemented</span><br><span class="line">    <span class="keyword">return</span> (<span class="literal">self</span>.r, <span class="literal">self</span>.g, <span class="literal">self</span>.b) &lt; (<span class="literal">other</span>.r, <span class="literal">other</span>.g, <span class="literal">other</span>.b)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里是 <code>__lt__</code> 方法，有了这个方法就可以使用比较符来对两个 Color 对象进行比较了，但这里又把这几个属性写了两遍。 最后再考虑考虑，如果我要把 JSON 转成 Color 对象，难道我要读完 JSON 然后一个个属性赋值吗？如果我想把 Color 对象转化为 JSON，又得把这几个属性写几遍呢？如果我突然又加了一个属性比如透明度 a 参数，那么整个类的方法和参数都要修改，这是极其难以扩展的。不知道你能不能忍，反正我不能忍！ 如果你用过 Scrapy、Django 等框架，你会发现 Scrapy 里面有一个 Item 的定义，只需要定义一些 Field 就可以了，Django 里面的 Model 也类似这样，只需要定义其中的几个字段属性就可以完成整个类的定义了，非常方便。 说到这里，我们能不能把 Scrapy 或 Django 里面的定义模式直接拿过来呢？能是能，但是没必要，因为我们还有专门为 Python 面向对象而专门诞生的库，没错，就是 attrs 和 cattrs 这两个库。 有了 attrs 库，我们就可以非常方便地定义各个对象了，另外对于 JSON 的转化，可以进一步借助 cattrs 这个库，非常有帮助。 说了这么多，还是没有介绍这两个库的具体用法，下面我们来详细介绍下。</p>
                  <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2>
                  <p>安装这两个库非常简单，使用 pip 就好了，命令如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> attrs cattrs</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装好了之后我们就可以导入并使用这两个库了。</p>
                  <h2 id="简介与特性"><a href="#简介与特性" class="headerlink" title="简介与特性"></a>简介与特性</h2>
                  <p>首先我们来介绍下 attrs 这个库，其官方的介绍如下：</p>
                  <blockquote>
                    <p>attrs 是这样的一个 Python 工具包，它能将你从繁综复杂的实现上解脱出来，享受编写 Python 类的快乐。它的目标就是在不减慢你编程速度的前提下，帮助你来编写简洁而又正确的代码。</p>
                  </blockquote>
                  <p>其实意思就是用了它，定义和实现 Python 类变得更加简洁和高效。</p>
                  <h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2>
                  <p>首先明确一点，我们现在是装了 attrs 和 cattrs 这两个库，但是实际导入的时候是使用 attr 和 cattr 这两个包，是不带 s 的。 在 attr 这个库里面有两个比较常用的组件叫做 attrs 和 attr，前者是主要用来修饰一个自定义类的，后者是定义类里面的一个字段的。有了它们，我们就可以将上文中的定义改写成下面的样子：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> attr <span class="keyword">import</span> attrs, attrib</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Color</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">r</span> = <span class="symbol">attrib</span>(<span class="symbol">type</span>=<span class="symbol">int, <span class="symbol">default</span></span>=<span class="symbol">0</span>)</span><br><span class="line">    <span class="symbol">g</span> = <span class="symbol">attrib</span>(<span class="symbol">type</span>=<span class="symbol">int, <span class="symbol">default</span></span>=<span class="symbol">0</span>)</span><br><span class="line">    <span class="symbol">b</span> = <span class="symbol">attrib</span>(<span class="symbol">type</span>=<span class="symbol">int, <span class="symbol">default</span></span>=<span class="symbol">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="symbol">if</span> <span class="symbol">__name__</span> == '<span class="symbol">__main__</span>':</span><br><span class="line">    <span class="symbol">color</span> = <span class="symbol">Color</span>(<span class="symbol">255, <span class="symbol">255</span>, <span class="symbol">255</span></span>)</span><br><span class="line">    <span class="symbol">print</span>(<span class="symbol">color</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>看我们操作的，首先我们导入了刚才所说的两个组件，然后用 attrs 里面修饰了 Color 这个自定义类，然后用 attrib 来定义一个个属性，同时可以指定属性的类型和默认值。最后打印输出，结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Color(<span class="attribute">r</span>=255, <span class="attribute">g</span>=255, <span class="attribute">b</span>=255)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>怎么样，达成了一样的输出效果！ 观察一下有什么变化，是不是变得更简洁了？r、g、b 三个属性都只写了一次，同时还指定了各个字段的类型和默认值，另外也不需要再定义 <code>__init__</code> 方法和 <code>__repr__</code> 方法了，一切都显得那么简洁。一个字，爽！ 实际上，主要是 attrs 这个修饰符起了作用，然后根据定义的 attrib 属性自动帮我们实现了 <code>__init__</code>、<code>__repr__</code>、<code>__eq__</code>、<code>__ne__</code>、<code>__lt__</code>、<code>__le__</code>、<code>__gt__</code>、<code>__ge__</code>、<code>__hash__</code> 这几个方法。 如使用 attrs 修饰的类定义是这样子：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> attr <span class="keyword">import</span> attrs, attrib</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">SmartClass</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">a</span> = <span class="symbol">attrib</span>()</span><br><span class="line">    <span class="symbol">b</span> = <span class="symbol">attrib</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其实就相当于已经实现了这些方法：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoughClass</span>(<span class="title">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, a, b)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.a = a</span><br><span class="line">        <span class="keyword">self</span>.b = b</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"RoughClass(a=&#123;&#125;, b=&#123;&#125;)"</span>.format(<span class="keyword">self</span>.a, <span class="keyword">self</span>.b)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(<span class="keyword">self</span>, other)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">if</span> other.__class_<span class="number">_</span> is <span class="keyword">self</span>.<span class="symbol">__class__:</span></span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">self</span>.a, <span class="keyword">self</span>.b) == (other.a, other.b)</span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">            <span class="keyword">return</span> NotImplemented</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__ne__</span><span class="params">(<span class="keyword">self</span>, other)</span></span><span class="symbol">:</span></span><br><span class="line">        result = <span class="keyword">self</span>.__eq_<span class="number">_</span>(other)</span><br><span class="line">        <span class="keyword">if</span> result is <span class="symbol">NotImplemented:</span></span><br><span class="line">            <span class="keyword">return</span> NotImplemented</span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">not</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span><span class="params">(<span class="keyword">self</span>, other)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">if</span> other.__class_<span class="number">_</span> is <span class="keyword">self</span>.<span class="symbol">__class__:</span></span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">self</span>.a, <span class="keyword">self</span>.b) &lt; (other.a, other.b)</span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">            <span class="keyword">return</span> NotImplemented</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__le__</span><span class="params">(<span class="keyword">self</span>, other)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">if</span> other.__class_<span class="number">_</span> is <span class="keyword">self</span>.<span class="symbol">__class__:</span></span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">self</span>.a, <span class="keyword">self</span>.b) &lt;= (other.a, other.b)</span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">            <span class="keyword">return</span> NotImplemented</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__gt__</span><span class="params">(<span class="keyword">self</span>, other)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">if</span> other.__class_<span class="number">_</span> is <span class="keyword">self</span>.<span class="symbol">__class__:</span></span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">self</span>.a, <span class="keyword">self</span>.b) &gt; (other.a, other.b)</span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">            <span class="keyword">return</span> NotImplemented</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__ge__</span><span class="params">(<span class="keyword">self</span>, other)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">if</span> other.__class_<span class="number">_</span> is <span class="keyword">self</span>.<span class="symbol">__class__:</span></span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">self</span>.a, <span class="keyword">self</span>.b) &gt;= (other.a, other.b)</span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">            <span class="keyword">return</span> NotImplemented</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hash__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> hash((<span class="keyword">self</span>.__class_<span class="number">_</span>, <span class="keyword">self</span>.a, <span class="keyword">self</span>.b))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所以说，如果我们用了 attrs 的话，就可以不用再写这些冗余又复杂的代码了。 翻看源码可以发现，其内部新建了一个 ClassBuilder，通过一些属性操作来动态添加了上面的这些方法，如果想深入研究，建议可以看下 attrs 库的源码。</p>
                  <h2 id="别名使用"><a href="#别名使用" class="headerlink" title="别名使用"></a>别名使用</h2>
                  <p>这时候大家可能有个小小的疑问，感觉里面的定义好乱啊，库名叫做 attrs，包名叫做 attr，然后又导入了 attrs 和 attrib，这太奇怪了。为了帮大家解除疑虑，我们来梳理一下它们的名字。 首先库的名字就叫做 attrs，这个就是装 Python 包的时候这么装就行了。但是库的名字和导入的包的名字确实是不一样的，我们用的时候就导入 attr 这个包就行了，里面包含了各种各样的模块和组件，这是完全固定的。 好，然后接下来看看 attr 包里面包含了什么，刚才我们引入了 attrs 和 attrib。 首先是 attrs，它主要是用来修饰 class 类的，而 attrib 主要是用来做属性定义的，这个就记住它们两个的用法就好了。 翻了一下源代码，发现其实它还有一些别名：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">s</span> = attributes = attrs</span><br><span class="line"><span class="attr">ib</span> = attr = attrib</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>也就是说，attrs 可以用 s 或 attributes 来代替，attrib 可以用 attr 或 ib 来代替。 既然是别名，那么上面的类就可以改写成下面的样子：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> attr <span class="keyword">import</span> s, ib</span><br><span class="line"></span><br><span class="line">@s</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Color</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">r</span> = <span class="symbol">ib</span>(<span class="symbol">type</span>=<span class="symbol">int, <span class="symbol">default</span></span>=<span class="symbol">0</span>)</span><br><span class="line">    <span class="symbol">g</span> = <span class="symbol">ib</span>(<span class="symbol">type</span>=<span class="symbol">int, <span class="symbol">default</span></span>=<span class="symbol">0</span>)</span><br><span class="line">    <span class="symbol">b</span> = <span class="symbol">ib</span>(<span class="symbol">type</span>=<span class="symbol">int, <span class="symbol">default</span></span>=<span class="symbol">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="symbol">if</span> <span class="symbol">__name__</span> == '<span class="symbol">__main__</span>':</span><br><span class="line">    <span class="symbol">color</span> = <span class="symbol">Color</span>(<span class="symbol">255, <span class="symbol">255</span>, <span class="symbol">255</span></span>)</span><br><span class="line">    <span class="symbol">print</span>(<span class="symbol">color</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>是不是更加简洁了，当然你也可以把 s 改写为 attributes，ib 改写为 attr，随你怎么用啦。 不过我觉得比较舒服的是 attrs 和 attrib 的搭配，感觉可读性更好一些，当然这个看个人喜好。 所以总结一下：</p>
                  <ul>
                    <li>库名：attrs</li>
                    <li>导入包名：attr</li>
                    <li>修饰类：s 或 attributes 或 attrs</li>
                    <li>定义属性：ib 或 attr 或 attrib</li>
                  </ul>
                  <p>OK，理清了这几部分内容，我们继续往下深入了解它的用法吧。</p>
                  <h2 id="声明和比较"><a href="#声明和比较" class="headerlink" title="声明和比较"></a>声明和比较</h2>
                  <p>在这里我们再声明一个简单一点的数据结构，比如叫做 Point，包含 x、y 的坐标，定义如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> attr <span class="keyword">import</span> attrs, attrib</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Point</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">x</span> = <span class="symbol">attrib</span>()</span><br><span class="line">    <span class="symbol">y</span> = <span class="symbol">attrib</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中 attrib 里面什么参数都没有，如果我们要使用的话，参数可以顺次指定，也可以根据名字指定，如：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">p1 = Point(1, 2)</span><br><span class="line"><span class="builtin-name">print</span>(p1)</span><br><span class="line">p2 = Point(<span class="attribute">x</span>=1, <span class="attribute">y</span>=2)</span><br><span class="line"><span class="builtin-name">print</span>(p2)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其效果都是一样的，打印输出结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Point(<span class="attribute">x</span>=1, <span class="attribute">y</span>=2)</span><br><span class="line">Point(<span class="attribute">x</span>=1, <span class="attribute">y</span>=2)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>OK，接下来让我们再验证下类之间的比较方法，由于使用了 attrs，相当于我们定义的类已经有了 <code>__eq__</code>、<code>__ne__</code>、<code>__lt__</code>、<code>__le__</code>、<code>__gt__</code>、<code>__ge__</code> 这几个方法，所以我们可以直接使用比较符来对类和类之间进行比较，下面我们用实例来感受一下：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">print('Equal:', Point(<span class="number">1</span>, <span class="number">2</span>) == Point(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">print('Not Equal(<span class="name">ne</span>):', Point(<span class="number">1</span>, <span class="number">2</span>) != Point(<span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">print('Less Than(<span class="name">lt</span>):', Point(<span class="number">1</span>, <span class="number">2</span>) &lt; Point(<span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">print('Less or Equal(<span class="name">le</span>):', Point(<span class="number">1</span>, <span class="number">2</span>) &lt;= Point(<span class="number">1</span>, <span class="number">4</span>), Point(<span class="number">1</span>, <span class="number">2</span>) &lt;= Point(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">print('Greater Than(<span class="name">gt</span>):', Point(<span class="number">4</span>, <span class="number">2</span>) &gt; Point(<span class="number">3</span>, <span class="number">2</span>), Point(<span class="number">4</span>, <span class="number">2</span>) &gt; Point(<span class="number">3</span>, <span class="number">1</span>))</span><br><span class="line">print('Greater or Equal(<span class="name">ge</span>):', Point(<span class="number">4</span>, <span class="number">2</span>) &gt;= Point(<span class="number">4</span>, <span class="number">1</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">Same:</span> <span class="literal">False</span></span><br><span class="line"><span class="attr">Equal:</span> <span class="literal">True</span></span><br><span class="line"><span class="string">Not</span> <span class="string">Equal(ne):</span> <span class="literal">True</span></span><br><span class="line"><span class="string">Less</span> <span class="string">Than(lt):</span> <span class="literal">True</span></span><br><span class="line"><span class="string">Less</span> <span class="string">or</span> <span class="string">Equal(le):</span> <span class="literal">True</span> <span class="literal">True</span></span><br><span class="line"><span class="string">Greater</span> <span class="string">Than(gt):</span> <span class="literal">True</span> <span class="literal">True</span></span><br><span class="line"><span class="string">Greater</span> <span class="string">or</span> <span class="string">Equal(ge):</span> <span class="literal">True</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可能有的朋友不知道 ne、lt、le 什么的是什么意思，不过看到这里你应该明白啦，ne 就是 Not Equal 的意思，就是不相等，le 就是 Less or Equal 的意思，就是小于或等于。 其内部怎么实现的呢，就是把类的各个属性转成元组来比较了，比如 <code>Point(1, 2) &lt; Point(3, 4)</code> 实际上就是比较了 <code>(1, 2)</code> 和 <code>(3, 4)</code> 两个元组，那么元组之间的比较逻辑又是怎样的呢，这里就不展开了，如果不明白的话可以参考官方文档：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy9saWJyYXJ5L3N0ZHR5cGVzLmh0bWwjY29tcGFyaXNvbnM=">https://docs.python.org/3/library/stdtypes.html#comparisons<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="属性定义"><a href="#属性定义" class="headerlink" title="属性定义"></a>属性定义</h2>
                  <p>现在看来，对于这个类的定义莫过于每个属性的定义了，也就是 attrib 的定义。对于 attrib 的定义，我们可以传入各种参数，不同的参数对于这个类的定义有非常大的影响。 下面我们就来详细了解一下每个属性的具体参数和用法吧。 首先让我们概览一下总共可能有多少可以控制一个属性的参数，我们用 attrs 里面的 fields 方法可以查看一下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> attr <span class="keyword">import</span> attrs, attrib, fields</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Point</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">x</span> = <span class="symbol">attrib</span>()</span><br><span class="line">    <span class="symbol">y</span> = <span class="symbol">attrib</span>()</span><br><span class="line"></span><br><span class="line"><span class="symbol">print</span>(<span class="symbol">fields</span>(<span class="symbol">Point</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这就可以输出 Point 的所有属性和对应的参数，结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(Attribute(<span class="attribute">name</span>=<span class="string">'x'</span>, <span class="attribute">default</span>=<span class="literal">NOTHING</span>, <span class="attribute">validator</span>=None, <span class="attribute">repr</span>=<span class="literal">True</span>, <span class="attribute">cmp</span>=<span class="literal">True</span>, <span class="attribute">hash</span>=None, <span class="attribute">init</span>=<span class="literal">True</span>, <span class="attribute">metadata</span>=mappingproxy(&#123;&#125;), <span class="attribute">type</span>=None, <span class="attribute">converter</span>=None, <span class="attribute">kw_only</span>=<span class="literal">False</span>), Attribute(<span class="attribute">name</span>=<span class="string">'y'</span>, <span class="attribute">default</span>=<span class="literal">NOTHING</span>, <span class="attribute">validator</span>=None, <span class="attribute">repr</span>=<span class="literal">True</span>, <span class="attribute">cmp</span>=<span class="literal">True</span>, <span class="attribute">hash</span>=None, <span class="attribute">init</span>=<span class="literal">True</span>, <span class="attribute">metadata</span>=mappingproxy(&#123;&#125;), <span class="attribute">type</span>=None, <span class="attribute">converter</span>=None, <span class="attribute">kw_only</span>=<span class="literal">False</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出出来了，可以看到结果是一个元组，元组每一个元素都其实是一个 Attribute 对象，包含了各个参数，下面详细解释下几个参数的含义：</p>
                  <ul>
                    <li>name：属性的名字，是一个字符串类型。</li>
                    <li>default：属性的默认值，如果没有传入初始化数据，那么就会使用默认值。如果没有默认值定义，那么就是 NOTHING，即没有默认值。</li>
                    <li>validator：验证器，检查传入的参数是否合法。</li>
                    <li>init：是否参与初始化，如果为 False，那么这个参数不能当做类的初始化参数，默认是 True。</li>
                    <li>metadata：元数据，只读性的附加数据。</li>
                    <li>type：类型，比如 int、str 等各种类型，默认为 None。</li>
                    <li>converter：转换器，进行一些值的处理和转换器，增加容错性。</li>
                    <li>kw_only：是否为强制关键字参数，默认为 False。</li>
                  </ul>
                  <h3 id="属性名"><a href="#属性名" class="headerlink" title="属性名"></a>属性名</h3>
                  <p>对于属性名，非常清楚了，我们定义什么属性，属性名就是什么，例如上面的例子，定义了：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">x</span> = attrib()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么其属性名就是 x。</p>
                  <h3 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h3>
                  <p>对于默认值，如果在初始化的时候没有指定，那么就会默认使用默认值进行初始化，我们看下面的一个实例：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> attr <span class="keyword">import</span> attrs, attrib, fields</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Point</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">x</span> = <span class="symbol">attrib</span>()</span><br><span class="line">    <span class="symbol">y</span> = <span class="symbol">attrib</span>(<span class="symbol">default</span>=<span class="symbol">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="symbol">if</span> <span class="symbol">__name__</span> == '<span class="symbol">__main__</span>':</span><br><span class="line">    <span class="symbol">print</span>(<span class="symbol">Point</span>(<span class="symbol">x</span>=<span class="symbol">1, <span class="symbol">y</span></span>=<span class="symbol">3</span>))</span><br><span class="line">    <span class="symbol">print</span>(<span class="symbol">Point</span>(<span class="symbol">x</span>=<span class="symbol">1</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们将 y 属性的默认值设置为了 100，在初始化的时候，第一次都传入了 x、y 两个参数，第二次只传入了 x 这个参数，看下运行结果：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Point(<span class="attribute">x</span>=1, <span class="attribute">y</span>=3)</span><br><span class="line">Point(<span class="attribute">x</span>=1, <span class="attribute">y</span>=100)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到结果，当设置了默认参数的属性没有被传入值时，他就会使用设置的默认值进行初始化。 那假如没有设置默认值但是也没有初始化呢？比如执行下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">Point</span><span class="params">()</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么就会报错了，错误如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">TypeError:</span> __init__() missing <span class="number">1</span> required positional <span class="string">argument:</span> <span class="string">'x'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所以说，如果一个属性，我们一旦没有设置默认值同时没有传入的话，就会引起错误。所以，一般来说，为了稳妥起见，设置一个默认值比较好，即使是 None 也可以的。</p>
                  <h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3>
                  <p>如果一个类的某些属性不想参与初始化，比如想直接设置一个初始值，一直固定不变，我们可以将属性的 init 参数设置为 False，看一个实例：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> attr <span class="keyword">import</span> attrs, attrib</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Point</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">x</span> = <span class="symbol">attrib</span>(<span class="symbol">init</span>=<span class="symbol">False, <span class="symbol">default</span></span>=<span class="symbol">10</span>)</span><br><span class="line">    <span class="symbol">y</span> = <span class="symbol">attrib</span>()</span><br><span class="line"></span><br><span class="line"><span class="symbol">if</span> <span class="symbol">__name__</span> == '<span class="symbol">__main__</span>':</span><br><span class="line">    <span class="symbol">print</span>(<span class="symbol">Point</span>(<span class="symbol">3</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>比如 x 我们只想在初始化的时候设置固定值，不想初始化的时候被改变和设定，我们将其设置了 init 参数为 False，同时设置了一个默认值，如果不设置默认值，默认为 NOTHING。然后初始化的时候我们只传入了一个值，其实也就是为 y 这个属性赋值。 这样的话，看下运行结果：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Point(<span class="attribute">x</span>=10, <span class="attribute">y</span>=3)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>没什么问题，y 被赋值为了我们设置的值 3。 那假如我们非要设置 x 呢？会发生什么，比如改写成这样子：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">Point</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>报错了，错误如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">TypeError:</span> <span class="string">__init__()</span> <span class="string">takes</span> <span class="number">2</span> <span class="string">positional</span> <span class="string">arguments</span> <span class="string">but</span> <span class="number">3</span> <span class="string">were</span> <span class="string">given</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>参数过多，也就是说，已经将 init 设置为 False 的属性就不再被算作可以被初始化的属性了。</p>
                  <h3 id="强制关键字"><a href="#强制关键字" class="headerlink" title="强制关键字"></a>强制关键字</h3>
                  <p>强制关键字是 Python 里面的一个特性，在传入的时候必须使用关键字的名字来传入，如果不太理解可以再了解下 Python 的基础。 设置了强制关键字参数的属性必须要放在后面，其后面不能再有非强制关键字参数的属性，否则会报这样的错误：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ValueError: Non keyword-<span class="keyword">only</span> attributes are <span class="keyword">not</span> allowed <span class="keyword">after</span> a keyword-<span class="keyword">only</span> <span class="keyword">attribute</span> (unless they are init=<span class="keyword">False</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，我们来看一个例子，我们将最后一个属性设置 kw_only 参数为 True：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> attr <span class="keyword">import</span> attrs, attrib, fields</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Point</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">x</span> = <span class="symbol">attrib</span>(<span class="symbol">default</span>=<span class="symbol">0</span>)</span><br><span class="line">    <span class="symbol">y</span> = <span class="symbol">attrib</span>(<span class="symbol">kw_only</span>=<span class="symbol">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="symbol">if</span> <span class="symbol">__name__</span> == '<span class="symbol">__main__</span>':</span><br><span class="line">    <span class="symbol">print</span>(<span class="symbol">Point</span>(<span class="symbol">1, <span class="symbol">y</span></span>=<span class="symbol">3</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果设置了 kw_only 参数为 True，那么在初始化的时候必须传入关键字的名字，这里就必须指定 y 这个名字，运行结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Point(<span class="attribute">x</span>=1, <span class="attribute">y</span>=3)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果没有指定 y 这个名字，像这样调用：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">Point</span><span class="params">(<span class="number">1</span>, <span class="number">3</span>)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么就会报错：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">TypeError: __init__() takes <span class="keyword">from</span> <span class="number">1</span> to <span class="number">2</span> positional arguments but <span class="number">3</span> were given</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所以，这个参数就是设置初始化传参必须要用名字来传，否则会出现错误。 注意，如果我们将一个属性设置了 init 为 False，那么 kw_only 这个参数会被忽略。</p>
                  <h3 id="验证器"><a href="#验证器" class="headerlink" title="验证器"></a>验证器</h3>
                  <p>有时候在设置一个属性的时候必须要满足某个条件，比如性别必须要是男或者女，否则就不合法。对于这种情况，我们就需要有条件来控制某些属性不能为非法值。 下面我们看一个实例：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> attr <span class="keyword">import</span> attrs, attrib</span><br><span class="line"></span><br><span class="line">def is_valid_gender(instance, attribute, value):</span><br><span class="line">    <span class="keyword">if</span> value <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">'male'</span>, <span class="string">'female'</span>]:</span><br><span class="line">        raise ValueError(f<span class="string">'gender &#123;value&#125; is not valid'</span>)</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Person</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">name</span> = <span class="symbol">attrib</span>()</span><br><span class="line">    <span class="symbol">gender</span> = <span class="symbol">attrib</span>(<span class="symbol">validator</span>=<span class="symbol">is_valid_gender</span>)</span><br><span class="line"></span><br><span class="line"><span class="symbol">if</span> <span class="symbol">__name__</span> == '<span class="symbol">__main__</span>':</span><br><span class="line">    <span class="symbol">print</span>(<span class="symbol">Person</span>(<span class="symbol">name</span>='<span class="symbol">Mike</span>', <span class="symbol">gender</span>='<span class="symbol">male</span>'))</span><br><span class="line">    <span class="symbol">print</span>(<span class="symbol">Person</span>(<span class="symbol">name</span>='<span class="symbol">Mike</span>', <span class="symbol">gender</span>='<span class="symbol">mlae</span>'))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们定义了一个验证器 Validator 方法，叫做 is_valid_gender。然后定义了一个类 Person 还有它的两个属性 name 和 gender，其中 gender 定义的时候传入了一个参数 validator，其值就是我们定义的 Validator 方法。 这个 Validator 定义的时候有几个固定的参数：</p>
                  <ul>
                    <li>instance：类对象</li>
                    <li>attribute：属性名</li>
                    <li>value：属性值</li>
                  </ul>
                  <p>这是三个参数是固定的，在类初始化的时候，其内部会将这三个参数传递给这个 Validator，因此 Validator 里面就可以接受到这三个值，然后进行判断即可。在 Validator 里面，我们判断如果不是男性或女性，那么就直接抛出错误。 下面做了两个实验，一个就是正常传入 male，另一个写错了，写的是 mlae，观察下运行结果：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Person(<span class="attribute">name</span>=<span class="string">'Mike'</span>, <span class="attribute">gender</span>=<span class="string">'male'</span>)</span><br><span class="line">TypeError: __init__() missing 1 required positional argument: <span class="string">'gender'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>OK，结果显而易见了，第二个报错了，因为其值不是正常的性别，所以程序直接报错终止。 注意在 Validator 里面返回 True 或 False 是没用的，错误的值还会被照常复制。所以，一定要在 Validator 里面 raise 某个错误。 另外 attrs 库里面还给我们内置了好多 Validator，比如判断类型，这里我们再增加一个属性 age，必须为 int 类型：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">age = attrib(<span class="name">validator=validators</span>.instance_of(<span class="name">int</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时候初始化的时候就必须传入 int 类型，如果为其他类型，则直接抛错：</p>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">TypeError</span>: ("<span class="string">'age'</span> must be &lt;class <span class="string">'int'</span>&gt; (got <span class="string">'x'</span> that is a &lt;class <span class="string">'str'</span>&gt;).</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外还有其他的一些 Validator，比如与或运算、可执行判断、可迭代判断等等，可以参考官方文档：<span class="exturl" data-url="aHR0cHM6Ly93d3cuYXR0cnMub3JnL2VuL3N0YWJsZS9hcGkuaHRtbCN2YWxpZGF0b3Jz">https://www.attrs.org/en/stable/api.html#validators<i class="fa fa-external-link-alt"></i></span>。 另外 validator 参数还支持多个 Validator，比如我们要设置既要是数字，又要小于 100，那么可以把几个 Validator 放到一个列表里面并传入：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from attr import attrs, attrib, validators</span><br><span class="line"></span><br><span class="line">def is<span class="constructor">_less_than_100(<span class="params">instance</span>, <span class="params">attribute</span>, <span class="params">value</span>)</span>:</span><br><span class="line">    <span class="keyword">if</span> value &gt; <span class="number">100</span>:</span><br><span class="line">        raise <span class="constructor">ValueError(<span class="params">f</span>'<span class="params">age</span> &#123;<span class="params">value</span>&#125; <span class="params">must</span> <span class="params">less</span> <span class="params">than</span> 100')</span></span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> <span class="constructor">Person(<span class="params">object</span>)</span>:</span><br><span class="line">    name = attrib<span class="literal">()</span></span><br><span class="line">    gender = attrib(validator=is_valid_gender)</span><br><span class="line">    age = attrib(validator=<span class="literal">[<span class="identifier">validators</span>.<span class="identifier">instance_of</span>(<span class="identifier">int</span>), <span class="identifier">is_less_than_100</span>]</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__<span class="operator"> == </span>'__main__':</span><br><span class="line">    print(<span class="constructor">Person(<span class="params">name</span>='Mike', <span class="params">gender</span>='<span class="params">male</span>', <span class="params">age</span>=500)</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就会将所有的 Validator 都执行一遍，必须每个 Validator 都满足才可以。这里 age 传入了 500，那么不符合第二个 Validator，直接抛错：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">ValueError:</span> <span class="string">age</span> <span class="number">500</span> <span class="string">must</span> <span class="string">less</span> <span class="string">than</span> <span class="number">100</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="转换器"><a href="#转换器" class="headerlink" title="转换器"></a>转换器</h3>
                  <p>其实很多时候我们会不小心传入一些形式不太标准的结果，比如本来是 int 类型的 100，我们传入了字符串类型的 100，那这时候直接抛错应该不好吧，所以我们可以设置一些转换器来增强容错机制，比如将字符串自动转为数字等等，看一个实例：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> attr <span class="keyword">import</span> attrs, attrib</span><br><span class="line"></span><br><span class="line">def to_int(value):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(value)</span><br><span class="line">    except:</span><br><span class="line">        <span class="keyword">return</span> None</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Point</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">x</span> = <span class="symbol">attrib</span>(<span class="symbol">converter</span>=<span class="symbol">to_int</span>)</span><br><span class="line">    <span class="symbol">y</span> = <span class="symbol">attrib</span>()</span><br><span class="line"></span><br><span class="line"><span class="symbol">if</span> <span class="symbol">__name__</span> == '<span class="symbol">__main__</span>':</span><br><span class="line">    <span class="symbol">print</span>(<span class="symbol">Point</span>('<span class="symbol">100</span>', <span class="symbol">3</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>看这里，我们定义了一个方法，可以将值转化为数字类型，如果不能转，那么就返回 None，这样保证了任何可以被转数字的值都被转为数字，否则就留空，容错性非常高。 运行结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Point(<span class="attribute">x</span>=100, <span class="attribute">y</span>=3)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3>
                  <p>为什么把这个放到最后来讲呢，因为 Python 中的类型是非常复杂的，有原生类型，有 typing 类型，有自定义类的类型。 首先我们来看看原生类型是怎样的，这个很容易理解了，就是普通的 int、float、str 等类型，其定义如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> attr <span class="keyword">import</span> attrs, attrib</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Point</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">x</span> = <span class="symbol">attrib</span>(<span class="symbol">type</span>=<span class="symbol">int</span>)</span><br><span class="line">    <span class="symbol">y</span> = <span class="symbol">attrib</span>()</span><br><span class="line"></span><br><span class="line"><span class="symbol">if</span> <span class="symbol">__name__</span> == '<span class="symbol">__main__</span>':</span><br><span class="line">    <span class="symbol">print</span>(<span class="symbol">Point</span>(<span class="symbol">100, <span class="symbol">3</span></span>))</span><br><span class="line">    <span class="symbol">print</span>(<span class="symbol">Point</span>('<span class="symbol">100</span>', <span class="symbol">3</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们将 x 属性定义为 int 类型了，初始化的时候传入了数值型 100 和字符串型 100，结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Point(<span class="attribute">x</span>=100, <span class="attribute">y</span>=3)</span><br><span class="line">Point(<span class="attribute">x</span>=<span class="string">'100'</span>, <span class="attribute">y</span>=3)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但我们发现，虽然定义了，但是不会被自动转类型的。 另外我们还可以自定义 typing 里面的类型，比如 List，另外 attrs 里面也提供了类型的定义：</p>
                  <figure class="highlight elm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="title">from</span> attr <span class="keyword">import</span> attrs, attrib, Factory</span><br><span class="line"><span class="keyword">import</span> typing</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="title">class</span> <span class="type">Point</span>(object):</span><br><span class="line">    x = attrib(<span class="keyword">type</span>=int)</span><br><span class="line">    y = attrib(<span class="keyword">type</span>=typing.<span class="type">List</span>[int])</span><br><span class="line">    z = attrib(<span class="keyword">type</span>=<span class="type">Factory</span>(list))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们引入了 typing 这个包，定义了 y 为 int 数字组成的列表，z 使用了 attrs 里面定义的 Factory 定义了同样为列表类型。 另外我们也可以进行类型的嵌套，比如像这样子：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> attr <span class="keyword">import</span> attrs, attrib, Factory</span><br><span class="line"><span class="keyword">import</span> typing</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> <span class="type">Point</span>(<span class="keyword">object</span>):</span><br><span class="line">    x = attrib(<span class="keyword">type</span>=<span class="type">int</span>, default=<span class="number">0</span>)</span><br><span class="line">    y = attrib(<span class="keyword">type</span>=<span class="type">int</span>, default=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> Line(<span class="keyword">object</span>):</span><br><span class="line">    <span class="type">name</span> = attrib()</span><br><span class="line">    points = attrib(<span class="keyword">type</span>=typing.List[<span class="type">Point</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    points = [<span class="type">Point</span>(i, i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>)]</span><br><span class="line">    print(points)</span><br><span class="line">    <span class="type">line</span> = Line(<span class="type">name</span>=<span class="string">'line1'</span>, points=points)</span><br><span class="line">    print(<span class="type">line</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们定义了 Point 类代表离散点，随后定义了线，其拥有 points 属性是 Point 组成的列表。在初始化的时候我们声明了五个点，然后用这五个点组成的列表声明了一条线，逻辑没什么问题。 运行结果：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[Point(<span class="attribute">x</span>=0, <span class="attribute">y</span>=0), Point(<span class="attribute">x</span>=1, <span class="attribute">y</span>=1), Point(<span class="attribute">x</span>=2, <span class="attribute">y</span>=2), Point(<span class="attribute">x</span>=3, <span class="attribute">y</span>=3), Point(<span class="attribute">x</span>=4, <span class="attribute">y</span>=4)]</span><br><span class="line">Line(<span class="attribute">name</span>=<span class="string">'line1'</span>, points=[Point(<span class="attribute">x</span>=0, <span class="attribute">y</span>=0), Point(<span class="attribute">x</span>=1, <span class="attribute">y</span>=1), Point(<span class="attribute">x</span>=2, <span class="attribute">y</span>=2), Point(<span class="attribute">x</span>=3, <span class="attribute">y</span>=3), Point(<span class="attribute">x</span>=4, <span class="attribute">y</span>=4)])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到这里我们得到了一个嵌套类型的 Line 对象，其值是 Point 类型组成的列表。 以上便是一些属性的定义，把握好这些属性的定义，我们就可以非常方便地定义一个类了。</p>
                  <h2 id="序列转换"><a href="#序列转换" class="headerlink" title="序列转换"></a>序列转换</h2>
                  <p>在很多情况下，我们经常会遇到 JSON 等字符串序列和对象互相转换的需求，尤其是在写 REST API、数据库交互的时候。 attrs 库的存在让我们可以非常方便地定义 Python 类，但是它对于序列字符串的转换功能还是比较薄弱的，cattrs 这个库就是用来弥补这个缺陷的，下面我们再来看看 cattrs 这个库。 cattrs 导入的时候名字也不太一样，叫做 cattr，它里面提供了两个主要的方法，叫做 structure 和 unstructure，两个方法是相反的，对于类的序列化和反序列化支持非常好。</p>
                  <h3 id="基本转换"><a href="#基本转换" class="headerlink" title="基本转换"></a>基本转换</h3>
                  <p>首先我们来看看基本的转换方法的用法，看一个基本的转换实例：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> attr <span class="keyword">import</span> attrs, attrib</span><br><span class="line"><span class="keyword">from</span> cattr <span class="keyword">import</span> unstructure, structure</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Point</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">x</span> = <span class="symbol">attrib</span>(<span class="symbol">type</span>=<span class="symbol">int, <span class="symbol">default</span></span>=<span class="symbol">0</span>)</span><br><span class="line">    <span class="symbol">y</span> = <span class="symbol">attrib</span>(<span class="symbol">type</span>=<span class="symbol">int, <span class="symbol">default</span></span>=<span class="symbol">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="symbol">if</span> <span class="symbol">__name__</span> == '<span class="symbol">__main__</span>':</span><br><span class="line">    <span class="symbol">point</span> = <span class="symbol">Point</span>(<span class="symbol">x</span>=<span class="symbol">1, <span class="symbol">y</span></span>=<span class="symbol">2</span>)</span><br><span class="line">    <span class="symbol">json</span> = <span class="symbol">unstructure</span>(<span class="symbol">point</span>)</span><br><span class="line">    <span class="symbol">print</span>('<span class="symbol">json:</span>', <span class="symbol">json</span>)</span><br><span class="line">    <span class="symbol">obj</span> = <span class="symbol">structure</span>(<span class="symbol">json, <span class="symbol">Point</span></span>)</span><br><span class="line">    <span class="symbol">print</span>('<span class="symbol">obj:</span>', <span class="symbol">obj</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们定义了一个 Point 对象，然后调用 unstructure 方法即可直接转换为 JSON 字符串。如果我们再想把它转回来，那就需要调用 structure 方法，这样就成功转回了一个 Point 对象。 看下运行结果：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">json: &#123;<span class="string">'x'</span>: 1, <span class="string">'y'</span>: 2&#125;</span><br><span class="line">obj: Point(<span class="attribute">x</span>=1, <span class="attribute">y</span>=2)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然这种基本的来回转用的多了就轻车熟路了。</p>
                  <h3 id="多类型转换"><a href="#多类型转换" class="headerlink" title="多类型转换"></a>多类型转换</h3>
                  <p>另外 structure 也支持一些其他的类型转换，看下实例：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">\&gt;&gt;&gt; cattr.structure(<span class="number">1</span>, str)</span><br><span class="line"><span class="string">'1'</span></span><br><span class="line">&gt;&gt;&gt; cattr.structure(<span class="string">"1"</span>, <span class="built_in">float</span>)</span><br><span class="line"><span class="number">1.0</span></span><br><span class="line">&gt;&gt;&gt; cattr.structure([<span class="number">1.0</span>, <span class="number">2</span>, <span class="string">"3"</span>], Tuple[<span class="built_in">int</span>, <span class="built_in">int</span>, <span class="built_in">int</span>])</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">&gt;&gt;&gt; cattr.structure((<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>), MutableSequence[<span class="built_in">int</span>])</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">&gt;&gt;&gt; cattr.structure((<span class="number">1</span>, None, <span class="number">3</span>), List[Optional[str]])</span><br><span class="line">[<span class="string">'1'</span>, None, <span class="string">'3'</span>]</span><br><span class="line">&gt;&gt;&gt; cattr.structure([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], Set)</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">&gt;&gt;&gt; cattr.structure([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]], Set[FrozenSet[str]])</span><br><span class="line">&#123;frozenset(&#123;<span class="string">'4'</span>, <span class="string">'3'</span>&#125;), frozenset(&#123;<span class="string">'1'</span>, <span class="string">'2'</span>&#125;)&#125;</span><br><span class="line">&gt;&gt;&gt; cattr.structure(OrderedDict([(<span class="number">1</span>, <span class="number">2</span>), (<span class="number">3</span>, <span class="number">4</span>)]), Dict)</span><br><span class="line">&#123;<span class="number">1</span>: <span class="number">2</span>, <span class="number">3</span>: <span class="number">4</span>&#125;</span><br><span class="line">&gt;&gt;&gt; cattr.structure([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], Tuple[<span class="built_in">int</span>, str, <span class="built_in">float</span>])</span><br><span class="line">(<span class="number">1</span>, <span class="string">'2'</span>, <span class="number">3.0</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里面用到了 Tuple、MutableSequence、Optional、Set 等类，都属于 typing 这个模块，后面我会写内容详细介绍这个库的用法。 不过总的来说，大部分情况下，JSON 和对象的互转是用的最多的。</p>
                  <h3 id="属性处理"><a href="#属性处理" class="headerlink" title="属性处理"></a>属性处理</h3>
                  <p>上面的例子都是理想情况下使用的，但在实际情况下，很容易遇到 JSON 和对象不对应的情况，比如 JSON 多个字段，或者对象多个字段。 我们先看看下面的例子：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> attr <span class="keyword">import</span> attrs, attrib</span><br><span class="line"><span class="keyword">from</span> cattr <span class="keyword">import</span> structure</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Point</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">x</span> = <span class="symbol">attrib</span>(<span class="symbol">type</span>=<span class="symbol">int, <span class="symbol">default</span></span>=<span class="symbol">0</span>)</span><br><span class="line">    <span class="symbol">y</span> = <span class="symbol">attrib</span>(<span class="symbol">type</span>=<span class="symbol">int, <span class="symbol">default</span></span>=<span class="symbol">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="symbol">json</span> = &#123;<span class="string">'x'</span>: <span class="number">1</span>, <span class="string">'y'</span>: <span class="number">2</span>, <span class="string">'z'</span>: <span class="number">3</span>&#125;</span><br><span class="line">print(structure(json, Point))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里，JSON 多了一个字段 z，而 Point 类只有 x、y 两个字段，那么直接执行 structure 会出现什么情况呢？</p>
                  <figure class="highlight avrasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">TypeError:</span> __init__() got an unexpected keyword argument <span class="string">'z'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>不出所料，报错了。意思是多了一个参数，这个参数并没有被定义。 这时候一般的解决方法的直接忽略这个参数，可以重写一下 structure 方法，定义如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def drop<span class="constructor">_nonattrs(<span class="params">d</span>, <span class="params">type</span>)</span>:</span><br><span class="line">    <span class="keyword">if</span> not isinstance(d, dict): return d</span><br><span class="line">    attrs_attrs = getattr(<span class="keyword">type</span>, '__attrs_attrs__', None)</span><br><span class="line">    <span class="keyword">if</span> attrs_attrs is None:</span><br><span class="line">        raise <span class="constructor">ValueError(<span class="params">f</span>'<span class="params">type</span> &#123;<span class="params">type</span>&#125; <span class="params">is</span> <span class="params">not</span> <span class="params">an</span> <span class="params">attrs</span> <span class="params">class</span>')</span></span><br><span class="line">    attrs: Set<span class="literal">[<span class="identifier">str</span>]</span> = &#123;attr.name for attr <span class="keyword">in</span> attrs_attrs&#125;</span><br><span class="line">    return &#123;key: <span class="keyword">val</span> for key, <span class="keyword">val</span> <span class="keyword">in</span> d.items<span class="literal">()</span> <span class="keyword">if</span> key <span class="keyword">in</span> attrs&#125;</span><br><span class="line"></span><br><span class="line">def structure(d, <span class="keyword">type</span>):</span><br><span class="line">    return cattr.structure(drop<span class="constructor">_nonattrs(<span class="params">d</span>, <span class="params">type</span>)</span>, <span class="keyword">type</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里定义了一个 drop_nonattrs 方法，用于从 JSON 里面删除对象里面不存在的属性，然后调用新的 structure 方法即可，写法如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Set</span><br><span class="line"><span class="keyword">from</span> attr <span class="keyword">import</span> attrs, attrib</span><br><span class="line"><span class="keyword">import</span> cattr</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Point</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">x</span> = <span class="symbol">attrib</span>(<span class="symbol">type</span>=<span class="symbol">int, <span class="symbol">default</span></span>=<span class="symbol">0</span>)</span><br><span class="line">    <span class="symbol">y</span> = <span class="symbol">attrib</span>(<span class="symbol">type</span>=<span class="symbol">int, <span class="symbol">default</span></span>=<span class="symbol">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="symbol">def</span> <span class="symbol">drop_nonattrs</span>(<span class="symbol">d, <span class="symbol">type</span></span>):</span><br><span class="line">    <span class="symbol">if</span> <span class="symbol">not</span> <span class="symbol">isinstance</span>(<span class="symbol">d, <span class="symbol">dict</span></span>): <span class="symbol">return</span> <span class="symbol">d</span></span><br><span class="line">    <span class="symbol">attrs_attrs</span> = <span class="symbol">getattr</span>(<span class="symbol">type, </span>'<span class="symbol">__attrs_attrs__</span>', <span class="symbol">None</span>)</span><br><span class="line">    <span class="symbol">if</span> <span class="symbol">attrs_attrs</span> <span class="symbol">is</span> <span class="symbol">None:</span></span><br><span class="line">        <span class="symbol">raise</span> <span class="symbol">ValueError</span>(<span class="symbol">f</span>'<span class="symbol">type</span> &#123;type&#125; <span class="keyword">is</span> <span class="keyword">not</span> an attrs <span class="keyword">class</span>')</span><br><span class="line">    <span class="symbol">attrs: <span class="symbol">Set</span></span>[<span class="symbol">str</span>] = &#123;attr.name <span class="keyword">for</span> attr <span class="keyword">in</span> attrs_attrs&#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;key: val <span class="keyword">for</span> key, val <span class="keyword">in</span> d.items() <span class="keyword">if</span> key <span class="keyword">in</span> attrs&#125;</span><br><span class="line"></span><br><span class="line">def structure(d, type):</span><br><span class="line">    <span class="keyword">return</span> cattr.structure(drop_nonattrs(d, type), type)</span><br><span class="line"></span><br><span class="line">json = &#123;<span class="string">'x'</span>: <span class="number">1</span>, <span class="string">'y'</span>: <span class="number">2</span>, <span class="string">'z'</span>: <span class="number">3</span>&#125;</span><br><span class="line">print(structure(json, Point))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就可以避免 JSON 字段冗余导致的转换问题了。 另外还有一个常见的问题，那就是数据对象转换，比如对于时间来说，在对象里面声明我们一般会声明为 datetime 类型，但在序列化的时候却需要序列化为字符串。 所以，对于一些特殊类型的属性，我们往往需要进行特殊处理，这时候就需要我们针对某种特定的类型定义特定的 hook 处理方法，这里就需要用到 register_unstructure_hook 和 register_structure_hook 方法了。 下面这个例子是时间 datetime 转换的时候进行的处理：</p>
                  <figure class="highlight haskell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="title">from</span> attr <span class="keyword">import</span> attrs, attrib</span><br><span class="line"><span class="keyword">import</span> cattr</span><br><span class="line"></span><br><span class="line"><span class="type">TIME_FORMAT</span> = '%<span class="type">Y</span>-%m-%dT%<span class="type">H</span>:%<span class="type">M</span>:%<span class="type">S</span>.%fZ'</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">Event</span>(<span class="title">object</span>):</span></span><br><span class="line"><span class="class">    happened_at = attrib(<span class="title">type</span>=<span class="title">datetime</span>.<span class="title">datetime</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">cattr.register_unstructure_hook(<span class="title">datetime</span>.<span class="title">datetime</span>, <span class="title">lambda</span> <span class="title">dt</span>: <span class="title">dt</span>.<span class="title">strftime</span>(<span class="type">TIME_FORMAT</span>))</span></span><br><span class="line"><span class="class">cattr.register_structure_hook(<span class="title">datetime</span>.<span class="title">datetime</span>,</span></span><br><span class="line"><span class="class">                              <span class="title">lambda</span> <span class="title">string</span>, <span class="title">_</span>: <span class="title">datetime</span>.<span class="title">datetime</span>.<span class="title">strptime</span>(<span class="title">string</span>, <span class="type">TIME_FORMAT</span>))</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">event = <span class="type">Event</span>(<span class="title">happened_at</span>=<span class="title">datetime</span>.<span class="title">datetime</span>(2019, 6, 1))</span></span><br><span class="line"><span class="class">print('<span class="title">event</span>:', <span class="title">event</span>)</span></span><br><span class="line"><span class="class">json = cattr.unstructure(<span class="title">event</span>)</span></span><br><span class="line"><span class="class">print('<span class="title">json</span>:', <span class="title">json</span>)</span></span><br><span class="line"><span class="class">event = cattr.structure(<span class="title">json</span>, <span class="type">Event</span>)</span></span><br><span class="line"><span class="class">print('<span class="type">Event</span>:', <span class="title">event</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们对 datetime 这个类型注册了两个 hook，当序列化的时候，就调用 strftime 方法转回字符串，当反序列化的时候，就调用 strptime 将其转回 datetime 类型。 看下运行结果：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">event:</span> <span class="string">Event(happened_at=datetime.datetime(2019,</span> <span class="number">6</span><span class="string">,</span> <span class="number">1</span><span class="string">,</span> <span class="number">0</span><span class="string">,</span> <span class="number">0</span><span class="string">))</span></span><br><span class="line"><span class="attr">json:</span> <span class="string">&#123;'happened_at':</span> <span class="string">'2019-06-01T00:00:00.000000Z'</span><span class="string">&#125;</span></span><br><span class="line"><span class="attr">Event:</span> <span class="string">Event(happened_at=datetime.datetime(2019,</span> <span class="number">6</span><span class="string">,</span> <span class="number">1</span><span class="string">,</span> <span class="number">0</span><span class="string">,</span> <span class="number">0</span><span class="string">))</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样对于一些特殊类型的属性处理也得心应手了。</p>
                  <h3 id="嵌套处理"><a href="#嵌套处理" class="headerlink" title="嵌套处理"></a>嵌套处理</h3>
                  <p>最后我们再来看看嵌套类型的处理，比如类里面有个属性是另一个类的类型，如果遇到这种嵌套类的话，怎样类转转换呢？我们用一个实例感受下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> attr <span class="keyword">import</span> attrs, attrib</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"><span class="keyword">from</span> cattr <span class="keyword">import</span> structure, unstructure</span><br><span class="line"></span><br><span class="line">@attrs</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Point</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">x</span> = <span class="symbol">attrib</span>(<span class="symbol">type</span>=<span class="symbol">int, <span class="symbol">default</span></span>=<span class="symbol">0</span>)</span><br><span class="line">    <span class="symbol">y</span> = <span class="symbol">attrib</span>(<span class="symbol">type</span>=<span class="symbol">int, <span class="symbol">default</span></span>=<span class="symbol">0</span>)</span><br><span class="line"></span><br><span class="line">@<span class="symbol">attrs</span></span><br><span class="line"><span class="symbol">class</span> <span class="symbol">Color</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">r</span> = <span class="symbol">attrib</span>(<span class="symbol">default</span>=<span class="symbol">0</span>)</span><br><span class="line">    <span class="symbol">g</span> = <span class="symbol">attrib</span>(<span class="symbol">default</span>=<span class="symbol">0</span>)</span><br><span class="line">    <span class="symbol">b</span> = <span class="symbol">attrib</span>(<span class="symbol">default</span>=<span class="symbol">0</span>)</span><br><span class="line"></span><br><span class="line">@<span class="symbol">attrs</span></span><br><span class="line"><span class="symbol">class</span> <span class="symbol">Line</span>(<span class="symbol">object</span>):</span><br><span class="line">    <span class="symbol">color</span> = <span class="symbol">attrib</span>(<span class="symbol">type</span>=<span class="symbol">Color</span>)</span><br><span class="line">    <span class="symbol">points</span> = <span class="symbol">attrib</span>(<span class="symbol">type</span>=<span class="symbol">List</span>[<span class="symbol">Point</span>])</span><br><span class="line"></span><br><span class="line"><span class="symbol">if</span> <span class="symbol">__name__</span> == '<span class="symbol">__main__</span>':</span><br><span class="line">    <span class="symbol">line</span> = <span class="symbol">Line</span>(<span class="symbol">color</span>=<span class="symbol">Color</span>(), <span class="symbol">points</span>=[<span class="symbol">Point</span>(<span class="symbol">i, <span class="symbol">i</span></span>) <span class="symbol">for</span> <span class="symbol">i</span> <span class="symbol">in</span> <span class="symbol">range</span>(<span class="symbol">5</span>)])</span><br><span class="line">    <span class="symbol">print</span>('<span class="symbol">Object:</span>', <span class="symbol">line</span>)</span><br><span class="line">    <span class="symbol">json</span> = <span class="symbol">unstructure</span>(<span class="symbol">line</span>)</span><br><span class="line">    <span class="symbol">print</span>('<span class="symbol">JSON:</span>', <span class="symbol">json</span>)</span><br><span class="line">    <span class="symbol">line</span> = <span class="symbol">structure</span>(<span class="symbol">json, <span class="symbol">Line</span></span>)</span><br><span class="line">    <span class="symbol">print</span>('<span class="symbol">Object:</span>', <span class="symbol">line</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们定义了两个 Class，一个是 Point，一个是 Color，然后定义了 Line 对象，其属性类型一个是 Color 类型，一个是 Point 类型组成的列表，下面我们进行序列化和反序列化操作，转成 JSON 然后再由 JSON 转回来，运行结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Object: Line(<span class="attribute">color</span>=Color(r=0, <span class="attribute">g</span>=0, <span class="attribute">b</span>=0), points=[Point(<span class="attribute">x</span>=0, <span class="attribute">y</span>=0), Point(<span class="attribute">x</span>=1, <span class="attribute">y</span>=1), Point(<span class="attribute">x</span>=2, <span class="attribute">y</span>=2), Point(<span class="attribute">x</span>=3, <span class="attribute">y</span>=3), Point(<span class="attribute">x</span>=4, <span class="attribute">y</span>=4)])</span><br><span class="line">JSON: &#123;<span class="string">'color'</span>: &#123;<span class="string">'r'</span>: 0, <span class="string">'g'</span>: 0, <span class="string">'b'</span>: 0&#125;, <span class="string">'points'</span>: [&#123;<span class="string">'x'</span>: 0, <span class="string">'y'</span>: 0&#125;, &#123;<span class="string">'x'</span>: 1, <span class="string">'y'</span>: 1&#125;, &#123;<span class="string">'x'</span>: 2, <span class="string">'y'</span>: 2&#125;, &#123;<span class="string">'x'</span>: 3, <span class="string">'y'</span>: 3&#125;, &#123;<span class="string">'x'</span>: 4, <span class="string">'y'</span>: 4&#125;]&#125;</span><br><span class="line">Object: Line(<span class="attribute">color</span>=Color(r=0, <span class="attribute">g</span>=0, <span class="attribute">b</span>=0), points=[Point(<span class="attribute">x</span>=0, <span class="attribute">y</span>=0), Point(<span class="attribute">x</span>=1, <span class="attribute">y</span>=1), Point(<span class="attribute">x</span>=2, <span class="attribute">y</span>=2), Point(<span class="attribute">x</span>=3, <span class="attribute">y</span>=3), Point(<span class="attribute">x</span>=4, <span class="attribute">y</span>=4)])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，我们非常方便地将对象转化为了 JSON 对象，然后也非常方便地转回了对象。 这样我们就成功实现了嵌套对象的序列化和反序列化，所有问题成功解决！</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>本节介绍了利用 attrs 和 cattrs 两个库实现 Python 面向对象编程的实践，有了它们两个的加持，Python 面向对象编程不再是难事。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-06-18 17:21:02" itemprop="dateCreated datePublished" datetime="2019-06-18T17:21:02+08:00">2019-06-18</time>
                </span>
                <span id="/6552.html" class="post-meta-item leancloud_visitors" data-flag-title="Python 使用 attrs 和 cattrs 实现面向对象编程" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>18k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>16 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6607.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6607.html" class="post-title-link" itemprop="url">代码整洁之道-编写 Pythonic 代码</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>很多新手在开始学一门新的语言的时候，往往会忽视一些不应该忽视的细节，比如变量命名和函数命名以及注释等一些内容的规范性，久而久之养成了一种习惯。对此呢，我特意收集了一些适合所有学习 Python 的人，代码整洁之道。</p>
                  <h3 id="写出-Pythonic-代码"><a href="#写出-Pythonic-代码" class="headerlink" title="写出 Pythonic 代码"></a><strong>写出 Pythonic 代码</strong></h3>
                  <p>谈到规范首先想到就是 Python 有名的 PEP8 代码规范文档，它定义了编写 Pythonic 代码的最佳实践。可以在 <span class="exturl" data-url="aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy93d3cucHl0aG9uLm9yZy9kZXYvcGVwcy9wZXAtMDAwOC8=">https://www.python.org/dev/peps/pep-0008/<i class="fa fa-external-link-alt"></i></span> 上查看。但是真正去仔细研究学习这些规范的朋友并不是很多，对此呢这篇文章摘选一些比较常用的代码整洁和规范的技巧和方法，下面让我们一起来学习吧！</p>
                  <h3 id="命名"><a href="#命名" class="headerlink" title="命名"></a><strong>命名</strong></h3>
                  <p>所有的编程语言都有变量、函数、类等的命名约定，以美之称的 Python 当然更建议使用命名约定。 接下来就针对类、函数、方法等等内容进行学习。</p>
                  <h3 id="变量和函数"><a href="#变量和函数" class="headerlink" title="变量和函数"></a><strong>变量和函数</strong></h3>
                  <p>使用小写字母命名函数和变量，并用下划线分隔单词，提高代码可读性。</p>
                  <h3 id="变量的声明"><a href="#变量的声明" class="headerlink" title="变量的声明"></a><strong>变量的声明</strong></h3>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">names</span> = <span class="string">"Python"</span> <span class="comment">#变量名 </span></span><br><span class="line"><span class="attr">namejob_title</span> = <span class="string">"Software Engineer"</span> <span class="comment">#带有下划线的变量名</span></span><br><span class="line"><span class="attr">populated_countries_list</span> = []  <span class="comment">#带有下划线的变量名</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>还应该考虑在代码中使用非 Python 内置方法名，如果使用 Python 中内置方法名请使用一个或两个下划线()。</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">_books</span> = &#123;&#125;<span class="comment"># 变量名私有化</span></span><br><span class="line"><span class="attr">__dict</span> = []<span class="comment"># 防止python内置库中的名称混淆</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那如何选择是用<em>还是__呢？ 如果不希望外部类访问该变量，应该使用一个下划线（</em>）作为类的内部变量的前缀。如果要定义的私有变量名称是 Python 中的关键字如 dict 就要使用(__)。</p>
                  <h3 id="函数的声明"><a href="#函数的声明" class="headerlink" title="函数的声明"></a><strong>函数的声明</strong></h3>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span><span class="params">()</span>:</span> </span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate_tax_data</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>函数的声明和变量一样也是通过小写字母和单下划线进行连接。 当然对于函数私有化也是和声明变量类似。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_data</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">pass</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>函数的开头使用单下划线，将其进行私有化。对于使用 Pyton 中的关键字来进行命名的函数 要使用双下划线。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__path</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>除了遵循这些命名规则之外，使用清晰易懂的变量名和很重要。</p>
                  <h3 id="函数名规范"><a href="#函数名规范" class="headerlink" title="函数名规范"></a><strong>函数名规范</strong></h3>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># Wrong Way</span></span><br><span class="line">def get_user_info(id):</span><br><span class="line">   db = get_db_connection()</span><br><span class="line">  <span class="built_in"> user </span>= execute_query_for_user(id)</span><br><span class="line">   return user</span><br><span class="line"></span><br><span class="line"><span class="comment"># Right way</span></span><br><span class="line">def get_user_by(user_id):</span><br><span class="line">    db = get_db_connection()</span><br><span class="line">   <span class="built_in"> user </span>= execute_user_query(user_id) </span><br><span class="line">    return user</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里，第二个函数 get_user_by 确保使用相同的参数来传递变量，从而为函数提供正确的上下文。 第一个函数 get_user_info 就不怎么不明确了，因为参数 id 意味着什么这里我们不能确定，它是用户 ID，还是用户付款ID或任何其他 ID？ 这种代码可能会对使用你的API的其他开发人员造成混淆。为了解决这个问题，我在第二个函数中更改了两个东西; 我更改了函数名称以及传递的参数名称，这使代码可读性更高。 作为开发人员，你有责任在命名变量和函数时仔细考虑，要写让人能够清晰易懂的代码。 当然也方便自己以后去维护。</p>
                  <h3 id="类的命名规范"><a href="#类的命名规范" class="headerlink" title="类的命名规范"></a><strong>类的命名规范</strong></h3>
                  <p>类的名称应该像大多数其他语言一样使用驼峰大小写。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">class</span> <span class="symbol">UserInformation:</span></span><br><span class="line">     <span class="symbol">def</span> <span class="symbol">get_user</span>(<span class="symbol">id</span>):</span><br><span class="line">          <span class="symbol">db</span> = <span class="symbol">get_db_connection</span>()</span><br><span class="line">          <span class="symbol">user</span> = <span class="symbol">execute_query_for_user</span>(<span class="symbol">id</span>)</span><br><span class="line">          <span class="symbol">return</span> <span class="symbol">user</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="常量的命名规范"><a href="#常量的命名规范" class="headerlink" title="常量的命名规范"></a><strong>常量的命名规范</strong></h3>
                  <p>通常应该用大写字母定义常量名称。</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">TOTAL</span> = <span class="number">56</span></span><br><span class="line"><span class="attr">TIMOUT</span> = <span class="number">6</span></span><br><span class="line"><span class="attr">MAX_OVERFLOW</span> = <span class="number">7</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="函数和方法的参数"><a href="#函数和方法的参数" class="headerlink" title="函数和方法的参数"></a><strong>函数和方法的参数</strong></h3>
                  <p>函数和方法的参数命名应遵循与变量和方法名称相同的规则。因为类方法将self作为第一个关键字参数。所以在函数中就不要使用 self 作为关键字作为参数，以免造成混淆 .</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def calculate_tax(amount, yearly_tax):</span><br><span class="line">    passs</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Player:</span></span><br><span class="line">    <span class="symbol">def</span> <span class="symbol">get_total_score</span>(<span class="symbol">self, <span class="symbol">player_name</span></span>):</span><br><span class="line">         <span class="symbol">pass</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>关于命名大概就强调这些，下面让我们看看表达式和语句中需要的问题。</p>
                  <h3 id="代码中的表达式和语句"><a href="#代码中的表达式和语句" class="headerlink" title="代码中的表达式和语句"></a><strong>代码中的表达式和语句</strong></h3>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">users = [</span><br><span class="line">    &#123;<span class="string">"first_name"</span>:<span class="string">"Helen"</span>, <span class="string">"age"</span>:39&#125;,</span><br><span class="line">    &#123;<span class="string">"first_name"</span>:<span class="string">"Buck"</span>, <span class="string">"age"</span>:10&#125;,</span><br><span class="line">    &#123;<span class="string">"first_name"</span>:<span class="string">"anni"</span>, <span class="string">"age"</span>:9&#125;</span><br><span class="line">]</span><br><span class="line">users = sorted(users, <span class="attribute">key</span>=lambda user: user[<span class="string">"first_name"</span>].lower())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这段代码有什么问题? 乍一看并不容易理解这段代码，尤其是对于新开发人员来说，因为 lambdas 的语法很古怪，所以不容易理解。虽然这里使用 lambda 可以节省行，然而，这并不能保证代码的正确性和可读性。同时这段代码无法解决字典缺少键出现异常的问题。 让我们使用函数重写此代码，使代码更具可读性和正确性; 该函数将判断异常情况，编写起来要简单得多。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">users = [</span><br><span class="line">    &#123;<span class="string">"first_name"</span>:<span class="string">"Helen"</span>, <span class="string">"age"</span>:<span class="number">39</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"first_name"</span>:<span class="string">"Buck"</span>, <span class="string">"age"</span>:<span class="number">10</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"name"</span>:<span class="string">"anni"</span>, <span class="string">"age"</span>:<span class="number">9</span>&#125;</span><br><span class="line">]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_user_name</span><span class="params">(users)</span>:</span></span><br><span class="line">    <span class="string">"""Get name of the user in lower case"""</span></span><br><span class="line">    <span class="keyword">return</span> users[<span class="string">"first_name"</span>].lower()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_sorted_dictionary</span><span class="params">(users)</span>:</span></span><br><span class="line">    <span class="string">"""Sort the nested dictionary"""</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isinstance(users, dict):</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"Not a correct dictionary"</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> len(users):</span><br><span class="line">       <span class="keyword">raise</span> ValueError(<span class="string">"Empty dictionary"</span>)</span><br><span class="line">    users_by_name = sorted(users, key=get_user_name)</span><br><span class="line">    <span class="keyword">return</span> users_by_name</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如您所见，此代码检查了所有可能的意外值，并且比起以前的单行代码更具可读性。 单行代码虽然看起来很酷节省了行，但是会给代码添加很多复杂性。 但是这并不意味着单行代码就不好 这里提出的一点是，如果你的单行代码使代码变得更难阅读，那么就请避免使用它，记住写代码不是为了炫酷的，尤其在项目组中。 让我们再考虑一个例子，你试图读取 CSV 文件并计算 CSV 文件处理的行数。下面的代码展示使代码可读的重要性，以及命名如何在使代码可读中发挥重要作用。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"employee.csv"</span>, mode=<span class="string">"r"</span>) <span class="keyword">as</span> csv_file:</span><br><span class="line">    csv_reader = csv.DictReader(csv_file)</span><br><span class="line">    line_count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> csv_reader:</span><br><span class="line">        <span class="keyword">if</span> line_count == <span class="number">0</span>:</span><br><span class="line">            print(<span class="string">f'Column names are <span class="subst">&#123;<span class="string">", "</span>.join(row)&#125;</span>'</span>)</span><br><span class="line">            line_count += <span class="number">1</span></span><br><span class="line">            print(<span class="string">f'\\t<span class="subst">&#123;row[<span class="string">"name"</span>]&#125;</span> salary: <span class="subst">&#123;row[<span class="string">"salary"</span>]&#125;</span>'</span></span><br><span class="line">            <span class="string">f'and was born in <span class="subst">&#123;row[<span class="string">"birthday month"</span>]&#125;</span>.'</span>)</span><br><span class="line">        line_count += <span class="number">1</span></span><br><span class="line">    print(<span class="string">f'Processed <span class="subst">&#123;line_count&#125;</span> lines.'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>将代码分解为函数有助于使复杂的代码变的易于阅读和调试。 这里的代码在 with 语句中执行多项操作。为了提高可读性，您可以将带有 process salary 的代码从 CSV 文件中提取到另一个函数中，以降低出错的可能性。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"employee.csv"</span>, mode=<span class="string">"r"</span>) <span class="keyword">as</span> csv_file:</span><br><span class="line">    csv_reader = csv.DictReader(csv_file)</span><br><span class="line">    line_count = <span class="number">0</span></span><br><span class="line">    process_salary(csv_reader)    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_salary</span><span class="params">(csv_reader)</span>:</span></span><br><span class="line"><span class="string">"""Process salary of user from csv file."""</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> csv_reader:</span><br><span class="line">            <span class="keyword">if</span> line_count == <span class="number">0</span>:</span><br><span class="line">                print(<span class="string">f'Column names are <span class="subst">&#123;<span class="string">", "</span>.join(row)&#125;</span>'</span>)</span><br><span class="line">                line_count += <span class="number">1</span></span><br><span class="line">                print(<span class="string">f'\\t<span class="subst">&#123;row[<span class="string">"name"</span>]&#125;</span> salary: <span class="subst">&#123;row[<span class="string">"salary"</span>]&#125;</span>'</span></span><br><span class="line">                <span class="string">f'and was born in <span class="subst">&#123;row[<span class="string">"birthday month"</span>]&#125;</span>.'</span>)</span><br><span class="line">            line_count += <span class="number">1</span></span><br><span class="line">        print(<span class="string">f'Processed <span class="subst">&#123;line_count&#125;</span> lines.'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>代码是不是变得容易理解了不少呢。 在这里，创建了一个帮助函数，而不是在with语句中编写所有内容。这使读者清楚地了解了函数的实际作用。如果想处理一个特定的异常或者想从CSV文件中读取更多的数据，可以进一步分解这个函数，以遵循单一职责原则，一个函数一做一件事。这个很重要</p>
                  <h3 id="return语句的类型尽量一致"><a href="#return语句的类型尽量一致" class="headerlink" title="return语句的类型尽量一致"></a><strong>return语句的类型尽量一致</strong></h3>
                  <p>如果希望函数返回一个值，请确保该函数的所有执行路径都返回该值。但是，如果期望函数只是在不返回值的情况下执行操作，则 Python 会隐式返回 None 作为函数的默认值。 先看一个错误示范</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate_interest</span><span class="params">(principle, time rate)</span></span>:    </span><br><span class="line">     <span class="keyword">if</span> principle &gt; <span class="number">0</span><span class="symbol">:</span></span><br><span class="line">         <span class="keyword">return</span> (principle * time * rate) / <span class="number">100</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate_interest</span><span class="params">(principle, time rate)</span></span>:    </span><br><span class="line">    <span class="keyword">if</span> principle &lt; <span class="number">0</span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span>    </span><br><span class="line">    <span class="keyword">return</span> (principle * time * rate) / <span class="number">100</span>ChaPTER <span class="number">1</span>  PyThonIC ThInkIng</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>正确的示范应该是下面这样</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate_interest</span><span class="params">(principle, time rate)</span>:</span>    </span><br><span class="line">     <span class="keyword">if</span> principle &gt; <span class="number">0</span>:</span><br><span class="line">         <span class="keyword">return</span> (principle * time * rate) / <span class="number">100</span></span><br><span class="line">     <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate_interest</span><span class="params">(principle, time rate)</span>:</span>    </span><br><span class="line">    <span class="keyword">if</span> principle &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>    </span><br><span class="line">    <span class="keyword">return</span> (principle * time * rate) / <span class="number">100</span>ChaPTER <span class="number">1</span>  PyThonIC ThInkIng</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>还是那句话写易读的代码，代码多写点没关系，可读性很重要。</p>
                  <h3 id="使用-isinstance-方法而不是-type-进行比较"><a href="#使用-isinstance-方法而不是-type-进行比较" class="headerlink" title="使用 isinstance() 方法而不是 type() 进行比较"></a><strong>使用 isinstance() 方法而不是 type() 进行比较</strong></h3>
                  <p>当比较两个对象类型时，请考虑使用 isinstance() 而不是 type，因为 isinstance() 判断一个对象是否为另一个对象的子类是 true。考虑这样一个场景：如果传递的数据结构是dict 的子类，比如 orderdict。type() 对于特定类型的数据结构将失败;然而，isinstance() 可以将其识别出它是 dict 的子类。 错误示范</p>
                  <figure class="highlight elm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="title">user_ages</span> = &#123;<span class="string">"Larry"</span>: <span class="number">35</span>, <span class="string">"Jon"</span>: <span class="number">89</span>, <span class="string">"Imli"</span>: <span class="number">12</span>&#125;</span><br><span class="line"><span class="keyword">type</span>(user_ages) == dict:</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>正确选择</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">user_ages</span> <span class="string">=</span> <span class="string">&#123;"Larry":</span> <span class="number">35</span><span class="string">,</span> <span class="attr">"Jon":</span> <span class="number">89</span><span class="string">,</span> <span class="attr">"Imli":</span> <span class="number">12</span><span class="string">&#125;</span></span><br><span class="line"><span class="string">if</span> <span class="string">isinstance(user_ages,</span> <span class="string">dict):</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="比较布尔值"><a href="#比较布尔值" class="headerlink" title="比较布尔值"></a><strong>比较布尔值</strong></h3>
                  <p>在Python中有多种方法可以比较布尔值。 错误示范</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">if</span> is_empty = <span class="literal">False</span></span><br><span class="line"><span class="keyword">if</span> is_empty == <span class="literal">False</span>:</span><br><span class="line"><span class="keyword">if</span> is_empty <span class="keyword">is</span> <span class="literal">False</span>:</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>正确示范</p>
                  <figure class="highlight ceylon">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">is</span><span class="number">_</span>empty = False</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">is</span><span class="number">_</span>empty</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="使用文档字符串"><a href="#使用文档字符串" class="headerlink" title="使用文档字符串"></a><strong>使用文档字符串</strong></h3>
                  <p>Docstrings可以在 Python 中声明代码的功能的。通常在方法，类和模块的开头使用。 docstring是该对象的<strong>doc</strong>特殊属性。 Python 官方语言建议使用“”三重双引号“”来编写文档字符串。 你可以在 PEP8 官方文档中找到这些实践。 下面让我们简要介绍一下在 Python 代码中编写 docstrings 的一些最佳实践 。</p>
                  <h3 id="方法中使用docstring"><a href="#方法中使用docstring" class="headerlink" title="方法中使用docstring"></a><strong>方法中使用docstring</strong></h3>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_prime_number</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""Get list of prime numbers between 1 to 100."""</span><span class="string">"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>关于docstring的格式的写法，目前存在多种风格，但是这几种风格都有一些统一的标准。</p>
                  <ul>
                    <li>即使字符串符合一行，也会使用三重引号。当你想要扩展时，这种注释非常有用。‘</li>
                    <li>三重引号中的字符串前后不应有任何空行</li>
                    <li>使用句点（.）结束docstring中的语句 类似地，可以应用 Python 多行 docstring 规则来编写多行 docstring。在多行上编写文档字符串是用更具描述性的方式记录代码的一种方法。你可以利用 Python 多行文档字符串在 Python 代码中编写描述性文档字符串，而不是在每一行上编写注释。 <strong>多行的docstring</strong></li>
                  </ul>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call_weather_api</span><span class="params">(url, location)</span>:</span></span><br><span class="line">    <span class="string">"""Get the weather of specific location.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Calling weather api to check for weather by using weather api and </span></span><br><span class="line"><span class="string">    location. Make sure you provide city name only, country and county </span></span><br><span class="line"><span class="string">    names won't be accepted and will throw exception if not found the </span></span><br><span class="line"><span class="string">    city name.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param url:URL of the api to get weather.</span></span><br><span class="line"><span class="string">    :type url: str</span></span><br><span class="line"><span class="string">    :param location:Location of the city to get the weather.</span></span><br><span class="line"><span class="string">    :type location: str</span></span><br><span class="line"><span class="string">    :return: Give the weather information of given location.</span></span><br><span class="line"><span class="string">    :rtype: str"""</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>说一下上面代码的注意点</p>
                  <ul>
                    <li>第一行是函数或类的简要描述</li>
                    <li>每一行语句的末尾有一个句号</li>
                    <li>文档字符串中的简要描述和摘要之间有一行空白</li>
                  </ul>
                  <p>如果使用 Python3.6 可以使用类型注解对上面的docstring以及参数的声明进行修改。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call_weather_api</span><span class="params">(url: str, location: str)</span> -&gt; str:</span></span><br><span class="line">    <span class="string">"""Get the weather of specific location.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Calling weather api to check for weather by using weather api and </span></span><br><span class="line"><span class="string">    location. Make sure you provide city name only, country and county </span></span><br><span class="line"><span class="string">    names won't be accepted and will throw exception if not found the </span></span><br><span class="line"><span class="string">    city name.</span></span><br><span class="line"><span class="string">    """</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>怎么样是不是简洁了不少，如果使用 Python 代码中的类型注解，则不需要再编写参数信息。 关于类型注解(type hint)的具体用法可以参考我之前写的<span class="exturl" data-url="aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHAlM0EvL21wLndlaXhpbi5xcS5jb20vcyUzRl9fYml6JTNETXpVME5EUTJPVGt6TnclM0QlM0QlMjZtaWQlM0QyMjQ3NDg0MjU4JTI2aWR4JTNEMSUyNnNuJTNEYjEzZGI4NGRhZDhlY2NhZWM5Y2Q0YWY2MThlODEyZTQlMjZjaGtzbSUzRGZiN2FlNWJjY2MwZDZjYWE4ZTE0NWU5ZmQyMmQwMzk1ZTY4ZDYxODY3MmViYmZlOTk3OTQ5MjZjMGI5ZTc4Mjk3NGZiMTYzMjFlMzIlMjZzY2VuZSUzRDIxJTIzd2VjaGF0X3JlZGlyZWN0">http://mp.weixin.qq.com/s?__biz=MzU0NDQ2OTkzNw==&amp;mid=2247484258&amp;idx=1&amp;sn=b13db84dad8eccaec9cd4af618e812e4&amp;chksm=fb7ae5bccc0d6caa8e145e9fd22d0395e68d618672ebbfe99794926c0b9e782974fb16321e32&amp;scene=21#wechat_redirect<i class="fa fa-external-link-alt"></i></span></p>
                  <h3 id="模块级别的docstring"><a href="#模块级别的docstring" class="headerlink" title="模块级别的docstring"></a><strong>模块级别的docstring</strong></h3>
                  <p>一般在文件的顶部放置一个模块级的 docstring 来简要描述模块的使用。 这些注释应该放在在导包之前，模块文档字符串应该表明模块的使用方法和功能。 如果觉得在使用模块之前客户端需要明确地知道方法或类，你还可以简要地指定特定方法或类。</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">"""This module contains all of the network related requests. </span><br><span class="line">This module will <span class="keyword">check</span> <span class="keyword">for</span> <span class="keyword">all</span> the <span class="keyword">exceptions</span> <span class="keyword">while</span> making the network </span><br><span class="line">calls <span class="keyword">and</span> <span class="keyword">raise</span> <span class="keyword">exceptions</span> <span class="keyword">for</span> <span class="keyword">any</span> <span class="literal">unknown</span> exception.</span><br><span class="line">Make sure that <span class="keyword">when</span> you <span class="keyword">use</span> this <span class="keyword">module</span>,</span><br><span class="line">you handle these <span class="keyword">exceptions</span> <span class="keyword">in</span> <span class="keyword">client</span> code <span class="keyword">as</span>:</span><br><span class="line">NetworkError <span class="keyword">exception</span> <span class="keyword">for</span> network calls.</span><br><span class="line">NetworkNotFound <span class="keyword">exception</span> <span class="keyword">if</span> network <span class="keyword">not</span> found.</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">import urllib3</span></span><br><span class="line"><span class="string">import json</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在为模块编写文档字符串时，应考虑执行以下操作：</p>
                  <ul>
                    <li>对当前模块写一个简要的说明</li>
                    <li>如果想指定某些对读者有用的模块，如上面的代码，还可以添加异常信息，但是注意不要太详细。</li>
                  </ul>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">NetworkError exception <span class="keyword">for</span><span class="built_in"> network </span>calls.</span><br><span class="line">NetworkNotFound exception <span class="keyword">if</span><span class="built_in"> network </span><span class="keyword">not</span> found.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>将模块的docstring看作是提供关于模块的描述性信息的一种方法，而不需要详细讨论每个函数或类具体操作方法。 <strong>类级别的docstring</strong> 类docstring主要用于简要描述类的使用及其总体目标。 让我们看一些示例，看看如何编写类文档字符串 <strong>单行类docstring</strong></li>
                  </ul>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">   <span class="string">"""This class handle actions performed by a student."""</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">      <span class="keyword">pass</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个类有一个一行的 docstring，它简要地讨论了学生类。如前所述，遵守了所以一行docstring 的编码规范。</p>
                  <h3 id="多行类docstring"><a href="#多行类docstring" class="headerlink" title="多行类docstring"></a><strong>多行类docstring</strong></h3>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    <span class="string">"""Student class information.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This class handle actions performed by a student.</span></span><br><span class="line"><span class="string">    This class provides information about student full name, age, </span></span><br><span class="line"><span class="string">    roll-number and other information.</span></span><br><span class="line"><span class="string">    Usage:</span></span><br><span class="line"><span class="string">        import student</span></span><br><span class="line"><span class="string">        student = student.Student()</span></span><br><span class="line"><span class="string">        student.get_name()</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; 678998</span></span><br><span class="line"><span class="string">   """</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">       <span class="keyword">pass</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个类 docstring 是多行的; 我们写了很多关于 Student 类的用法以及如何使用它。</p>
                  <h3 id="函数的docstring"><a href="#函数的docstring" class="headerlink" title="函数的docstring"></a><strong>函数的docstring</strong></h3>
                  <p>函数文档字符串可以写在函数之后，也可以写在函数的顶部。</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def is_prime_number(number):</span><br><span class="line">    """<span class="keyword">Check</span> <span class="keyword">for</span> prime number.</span><br><span class="line"></span><br><span class="line">    <span class="keyword">Check</span> the given <span class="built_in">number</span> <span class="keyword">is</span> prime <span class="built_in">number</span> </span><br><span class="line">    <span class="keyword">or</span> <span class="keyword">not</span> <span class="keyword">by</span> checking against <span class="keyword">all</span> the numbers </span><br><span class="line">    <span class="keyword">less</span> the <span class="keyword">square</span> root <span class="keyword">of</span> given number.</span><br><span class="line"></span><br><span class="line">    :param <span class="built_in">number</span>:Given <span class="built_in">number</span> <span class="keyword">to</span> <span class="keyword">check</span> <span class="keyword">for</span> prime</span><br><span class="line">    :<span class="keyword">type</span> <span class="built_in">number</span>: <span class="built_in">int</span></span><br><span class="line">    :<span class="keyword">return</span>: <span class="literal">True</span> <span class="keyword">if</span> <span class="built_in">number</span> <span class="keyword">is</span> prime otherwise False.</span><br><span class="line">    :rtype: <span class="built_in">boolean</span></span><br><span class="line">    <span class="string">"""</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果我们使用类型注解对其进一步优化。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_prime_number</span><span class="params">(number: int)</span>-&gt;bool:</span></span><br><span class="line">    <span class="string">"""Check for prime number.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Check the given number is prime number </span></span><br><span class="line"><span class="string">    or not by checking against all the numbers </span></span><br><span class="line"><span class="string">    less the square root of given number.</span></span><br><span class="line"><span class="string">    """</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a><strong>结语</strong></h3>
                  <p>当然关于 Python 中的规范还有很多很多，建议大家参考 Python 之禅和 Pep8 对代码进行优化，养成编写 Pythonic 代码的良好习惯。 [caption id=”attachment_6600” align=”alignnone” width=”258”]<img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/06/qrcode_for_gh_fedbc9cddff8_258.jpg" alt=""> 扫码关注[/caption] 更多精彩内容关注微信公众号:python学习开发</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/陈祥安" class="author" itemprop="url" rel="index">陈祥安</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-06-13 15:00:05" itemprop="dateCreated datePublished" datetime="2019-06-13T15:00:05+08:00">2019-06-13</time>
                </span>
                <span id="/6607.html" class="post-meta-item leancloud_visitors" data-flag-title="代码整洁之道-编写 Pythonic 代码" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>8.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>8 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6598.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6598.html" class="post-title-link" itemprop="url">Python3 中使用 Pathlib 模块进行文件操作</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在本教程中，你将了解如何使用 pathlib 模块操作目录和文件的名称。 学习如何读取和写入文件，拼接路径和操作底层文件系统的新方法，以及如何列出文件并迭代它们的一些示例。 大多人处理文件用的最多的还是 os 模快吧，比如下面这样的操作</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">&gt;&gt;</span>&gt; path.rsplit(<span class="string">'\\'</span>, maxsplit=<span class="number">1</span>)[<span class="number">0</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或者写出下面这样长长的代码</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&gt;&gt;&gt; <span class="built_in">os</span>.<span class="built_in">path</span>.isfile(<span class="built_in">os</span>.<span class="built_in">path</span>.join(<span class="built_in">os</span>.<span class="built_in">path</span>.expanduser(<span class="string">'~'</span>), <span class="string">'realpython.txt'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>使用 pathlib 模块，可以使代码使用优雅，可读和 Pythonic 代码重写上面的两个示例，如：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">&gt;&gt;</span>&gt; path.parent</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; (pathlib.Path.home() / <span class="string">'realpython.txt'</span>).is_file()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Python-文件路径处理问题"><a href="#Python-文件路径处理问题" class="headerlink" title="Python 文件路径处理问题"></a><strong>Python 文件路径处理问题</strong></h3>
                  <p>由于许多不同的原因，使用文件和与文件系统交互很重要。 最简单的情况可能只涉及读取或写入文件，但有时候会有更复杂的任务。 也许你需要列出给定类型的目录中的所有文件，查找给定文件的父目录，或者创建一个尚不存在的唯一文件名。 一般情况，Python 使用常规文本字符串表示文件路径。 一般在使用 os,glob 和 shutil 等库的时候会使用到路径拼接的操作，使用os模块拼接起来显得略显复杂，以下示例仅需要三个 import 语句来将所有文本文件移动到归档目录：</p>
                  <figure class="highlight haxe">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file_name <span class="keyword">in</span> glob.glob(<span class="string">'*.txt'</span>):<span class="type"></span></span><br><span class="line"><span class="type">    new_path </span>= os.path.join(<span class="string">'archive'</span>, file_name)</span><br><span class="line">    shutil.move(file_name, <span class="keyword">new</span><span class="type">_path</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>使用常规的字符串去拼接路径是可以的，但是由于不同的操作系统使用的分隔符不同，这样就容易出现问题，所以一般我们使用最多的还是使用 os.path.join()。 Python 3.4 中引入了 pathlib 模块（PEP 428）再一次的优化了路径的拼接。使用 pathlib 库的 Path 方法，可以将一个普通的字符串转换为 pathlib.Path 对象类型的路径。 早期，其他软件包仍然使用字符串作为文件路径，但从 Python 3.6 开始，pathlib 模块在整个标准库中得到支持，部分原因是由于增加了文件系统路径协议。 如果你坚持使用传统的 Python，那么 Python 2 也有一个可用的向后移植。 ok，说了那么多下面让我们看看 pathlib 如何在实践中发挥作用。</p>
                  <h3 id="创建路径"><a href="#创建路径" class="headerlink" title="创建路径"></a><strong>创建路径</strong></h3>
                  <p>这里我们首先要知道两个用法，先看代码:</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> <span class="type">Path</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>你真正需要知道的是 pathlib.Path 类。 创建路径有几种不同的方式。 首先，有类方法，如 .cwd（当前工作目录）和 .home（用户的主目录）：</p>
                  <figure class="highlight elm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="title">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="title">now_path</span> = <span class="type">Path</span>.cwd()</span><br><span class="line"><span class="title">home_path</span> = <span class="type">Path</span>.home()</span><br><span class="line"></span><br><span class="line"><span class="title">print</span>(<span class="string">"当前工作目录"</span>,now_path,<span class="keyword">type</span>(now_path))</span><br><span class="line"><span class="title">print</span>(<span class="string">"home目录"</span>,home_path,<span class="keyword">type</span>(home_path))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出内容</p>
                  <figure class="highlight gradle">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">当前工作目录 <span class="regexp">/Users/</span>chennan<span class="regexp">/pythonproject/</span>demo &lt;<span class="keyword">class</span> <span class="string">'pathlib.PosixPath'</span>&gt;</span><br><span class="line">home目录 <span class="regexp">/Users/</span>chennan &lt;<span class="keyword">class</span> <span class="string">'pathlib.PosixPath'</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现路径格式为 pathlib.PosixPath 这是在 unix 系统下的显示。在不同的系统上显示的格式也是不一样，在 windows 系统会显示为 WindowsPath。但是不管什么显示类型，都不影响后面的操作。 前面我们提到过可以通过把字符串类型的路径，转换为 Pathlib.Path 类型的路径，经过测试发现在 Python3.4 以后很多模块以及支持该格式的路径。不用转为成字符串使用了。比起 os.path.join 拼接路径的方式, pathlib 使用起来更加的方便,使用示例如下:</p>
                  <figure class="highlight elm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line"><span class="type">DIR_PATH</span> = pathlib.<span class="type">Path</span>(<span class="string">"/Users/chennan/CDM"</span>)</span><br><span class="line"><span class="title">print</span>(<span class="type">DIR_PATH</span>,<span class="keyword">type</span>(<span class="type">DIR_PATH</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出内容:</p>
                  <figure class="highlight ceylon">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">/Users/chennan/CDM &lt;<span class="keyword">class</span> <span class="string">'pathlib.PosixPath'</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过 “/“ 我们就可以对路径进行拼接了，怎么样是不是很方便呢。</p>
                  <h3 id="读文件和写文件"><a href="#读文件和写文件" class="headerlink" title="读文件和写文件"></a><strong>读文件和写文件</strong></h3>
                  <p>在我们使用 open 来操作文件读写操作的时候,不仅可以使用字符串格式的路径，对于 pathlib 生成的路径完全可以直接使用:</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">path = pathlib.Path.cwd() / <span class="string">'test.md'</span></span><br><span class="line">with <span class="keyword">open</span>(path, <span class="keyword">mode</span>=<span class="string">'r'</span>) <span class="keyword">as</span> fid:</span><br><span class="line">    headers = [<span class="built_in">line</span>.strip() <span class="keyword">for</span> <span class="built_in">line</span> in fid <span class="keyword">if</span> <span class="built_in">line</span>.startswith(<span class="string">'#'</span>)]</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'\n'</span>.<span class="keyword">join</span>(headers))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或者在 pathlib 的基础使用 open,我们推荐使用下面的方式</p>
                  <figure class="highlight haskell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line"><span class="type">DIR_PATH</span> = pathlib.<span class="type">Path</span>(<span class="string">"/Users/chennan/CDM"</span>) / <span class="string">"2000"</span> / <span class="string">"hehe.txt"</span></span><br><span class="line"><span class="title">with</span> <span class="type">DIR_PATH</span>.open(<span class="string">"r"</span>) <span class="keyword">as</span> fs:</span><br><span class="line">     <span class="class"><span class="keyword">data</span> = fs.read() </span></span><br><span class="line"><span class="title">print</span>(<span class="class"><span class="keyword">data</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样写的好处就是 open 里面我们不需要再去传入路径了，直接指定文件读写模式即可。实际上这里的 open 方法，底层也是调用了 os.open 的方法。使用哪种方式看个人的喜好。 pathlib 还提供几种文件的读写方式: 可以不用再使用 with open 的形式即可以进行读写。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">.read<span class="constructor">_text()</span>: 找到对应的路径然后打开文件，读成str格式。等同<span class="keyword">open</span>操作文件的<span class="string">"r"</span>格式。</span><br><span class="line">.read<span class="constructor">_bytes()</span>: 读取字节流的方式。等同<span class="keyword">open</span>操作文件的<span class="string">"rb"</span>格式。</span><br><span class="line">.write<span class="constructor">_text()</span>: 文件的写的操作，等同<span class="keyword">open</span>操作文件的<span class="string">"w"</span>格式。</span><br><span class="line">.write<span class="constructor">_bytes()</span>: 文件的写的操作，等同<span class="keyword">open</span>操作文件的<span class="string">"wb"</span>格式。</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>使用 resolve 可以通过传入文件名，来返回文件的完整路径，使用方式如下</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pathlib</span><br><span class="line">py_path =pathlib.Path(<span class="string">"superdemo.py"</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(py_path.resolve()</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="regexp">/Users/</span>chennan<span class="regexp">/pythonproject/</span>demo<span class="regexp">/superdemo.py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>需要注意的是 “superdemo.py” 文件要和我当前的程序文件在同一级目录。</p>
                  <h3 id="选择路径的不同组成部分"><a href="#选择路径的不同组成部分" class="headerlink" title="选择路径的不同组成部分"></a><strong>选择路径的不同组成部分</strong></h3>
                  <p>pathlib 还提供了很多路径操作的属性，这些属性可以选择路径的不用部位，如 <strong>.name</strong>: 可以获取文件的名字，包含拓展名。 <strong>.parent</strong>: 返回上级文件夹的名字 <strong>.stem</strong>: 获取文件名不包含拓展名 <strong>.suffix</strong>: 获取文件的拓展名 <strong>.anchor</strong>: 类似盘符的一个东西,</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pathlib</span><br><span class="line"></span><br><span class="line">now_path = pathlib<span class="selector-class">.Path</span>.cwd() / <span class="string">"demo.txt"</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">"name"</span>,now_path.name)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">"stem"</span>,now_path.stem)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">"suffix"</span>,now_path.suffix)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">"parent"</span>,now_path.parent)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">"anchor"</span>,now_path.anchor)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出内容如下</p>
                  <figure class="highlight pf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">name demo.txt</span><br><span class="line">stem demo</span><br><span class="line">suffix .txt</span><br><span class="line">parent /Users/chennan/pythonproject/demo</span><br><span class="line"><span class="built_in">anchor</span> /</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="移动和删除文件"><a href="#移动和删除文件" class="headerlink" title="移动和删除文件"></a><strong>移动和删除文件</strong></h3>
                  <p>当然 pathlib 还可以支持文件其他操作，像移动，更新，甚至删除文件，但是使用这些方法的时候要小心因为，使用过程不用有任何的错误提示即使文件不存在也不会出现等待的情况。 使用 replace 方法可以移动文件，如果文件存在则会覆盖。为避免文件可能被覆盖，最简单的方法是在替换之前测试目标是否存在。</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line"></span><br><span class="line">destination = pathlib.Path.cwd() / "target" </span><br><span class="line">source = pathlib.Path.cwd() / "demo.txt"</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> destination.<span class="keyword">exists</span>():</span><br><span class="line">    source.replace(destination)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但是上面的方法存在问题就是，在多个进程多 destination 进行的操作的时候就会现问题，可以使用下面的方法避免这个问题。也就是说上面的方法适合单个文件的操作。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pathlib</span><br><span class="line"></span><br><span class="line">destination = pathlib.<span class="module-access"><span class="module"><span class="identifier">Path</span>.</span></span>cwd<span class="literal">()</span><span class="operator"> / </span><span class="string">"target"</span> </span><br><span class="line">source = pathlib.<span class="module-access"><span class="module"><span class="identifier">Path</span>.</span></span>cwd<span class="literal">()</span><span class="operator"> / </span><span class="string">"demo.txt"</span></span><br><span class="line"><span class="keyword">with</span> destination.<span class="keyword">open</span>(mode='xb') <span class="keyword">as</span> fid: </span><br><span class="line">    #xb表示文件不存在才操作</span><br><span class="line">    fid.write(source.read<span class="constructor">_bytes()</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当 destination文件存在的时候上面的代码就会出现 FileExistsError 异常。 从技术上讲，这会复制一个文件。 要执行移动，只需在复制完成后删除源即可。 使用 with_name 和 with.shuffix 可以修改文件名字或者后缀。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pathlib</span><br><span class="line">source = pathlib.<span class="module-access"><span class="module"><span class="identifier">Path</span>.</span></span>cwd<span class="literal">()</span><span class="operator"> / </span><span class="string">"demo.py"</span></span><br><span class="line">source.replace(source.<span class="keyword">with</span><span class="constructor">_suffix(<span class="string">".txt"</span>)</span>) #修改后缀并移动文件，即重命名</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以使用 .rmdir() 和 .unlink() 来删除文件。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pathlib</span><br><span class="line"></span><br><span class="line">destination = pathlib.<span class="module-access"><span class="module"><span class="identifier">Path</span>.</span></span>cwd<span class="literal">()</span><span class="operator"> / </span><span class="string">"target"</span> </span><br><span class="line">source = pathlib.<span class="module-access"><span class="module"><span class="identifier">Path</span>.</span></span>cwd<span class="literal">()</span><span class="operator"> / </span><span class="string">"demo.txt"</span></span><br><span class="line">source.unlink<span class="literal">()</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="几个-pathlib-的使用例子"><a href="#几个-pathlib-的使用例子" class="headerlink" title="几个 pathlib 的使用例子"></a><strong>几个 pathlib 的使用例子</strong></h3>
                  <h3 id="统计文件个数"><a href="#统计文件个数" class="headerlink" title="统计文件个数"></a><strong>统计文件个数</strong></h3>
                  <p>我们可以使用.iterdir方法获取当前文件下的所以文件.</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pathlib</span><br><span class="line">from collections import Counter</span><br><span class="line">now_path = pathlib<span class="selector-class">.Path</span>.cwd()</span><br><span class="line">gen = (<span class="selector-tag">i</span><span class="selector-class">.suffix</span> <span class="keyword">for</span> <span class="selector-tag">i</span> <span class="keyword">in</span> now_path.iterdir())</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(Counter(gen)</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出内容</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">Counter</span><span class="params">(&#123;<span class="string">'.py'</span>: <span class="number">16</span>, <span class="string">''</span>: <span class="number">11</span>, <span class="string">'.txt'</span>: <span class="number">1</span>, <span class="string">'.png'</span>: <span class="number">1</span>, <span class="string">'.csv'</span>: <span class="number">1</span>&#125;)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过配合使用 collections 模块的 Counter 方法，我们获取了当文件夹下文件类型情况。 前面我们说过 glob 模块点这里了解【<span class="exturl" data-url="aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy93d3cuY25ibG9ncy5jb20vYy14LWEvcC85MjYxODMyLmh0bWw=">https://www.cnblogs.com/c-x-a/p/9261832.html<i class="fa fa-external-link-alt"></i></span>】，同样的 pathlib 也有 glob 方法和 rglob 方法，不同的是 glob 模块里的 glob 方法结果是列表形式的，iglob 是生成器类型，在这里 pathlib 的 glob 模块返回的是生成器类型，然后 pathlib 还有一个支持递归操作的 rglob 方法。 下面的这个操作我通过使用 glob 方法，设定规则进行文件的匹配。</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pathlib</span><br><span class="line">from  collections import Counter</span><br><span class="line">gen =(<span class="name">p</span>.suffix for p in pathlib.Path.cwd().glob('*.py'))</span><br><span class="line">print(<span class="name">Counter</span>(<span class="name">gen</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="展示目录树"><a href="#展示目录树" class="headerlink" title="展示目录树"></a><strong>展示目录树</strong></h3>
                  <p>下一个示例定义了一个函数 tree()，该函数的作用是打印一个表示文件层次结构的可视树，该树以一个给定目录为根。因为想列出其子目录，所以我们要使用 .rglob() 方法：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line"><span class="keyword">from</span>  collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tree</span><span class="params">(directory)</span>:</span></span><br><span class="line">    print(<span class="string">f'+ <span class="subst">&#123;directory&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">for</span> path <span class="keyword">in</span> sorted(directory.rglob(<span class="string">'*'</span>)):</span><br><span class="line">        depth = len(path.relative_to(directory).parts)</span><br><span class="line">        spacer = <span class="string">'    '</span> * depth</span><br><span class="line">        print(<span class="string">f'<span class="subst">&#123;spacer&#125;</span>+ <span class="subst">&#123;path.name&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">now_path = pathlib.Path.cwd()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    tree(now_path)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中 relative_to 的方法的作用是返回 path 相对于 directory 的路径。 parts 方法可以返回路径的各部分。例如</p>
                  <figure class="highlight coffeescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line">now_path = pathlib.Path.cwd()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="built_in">print</span>(now_path.parts)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>返回</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="symbol">'/</span>', <span class="symbol">'Users</span>', <span class="symbol">'chennan</span>', <span class="symbol">'pythonproject</span>', <span class="symbol">'demo</span>')</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="获取文件最后一次修改时间"><a href="#获取文件最后一次修改时间" class="headerlink" title="获取文件最后一次修改时间"></a><strong>获取文件最后一次修改时间</strong></h3>
                  <p>iterdir(),.glob()和.rglob()方法非常适合于生成器表达式和列表理解。 使用stat()方法可以获取文件的一些基本信息，使用.stat().st_mtime可以获取文件最后一次修改的信息</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line">now_path = pathlib.Path.cwd()</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="type">time</span>, file_path = max((f.stat().st_mtime, f) <span class="keyword">for</span> f <span class="keyword">in</span> now_path.iterdir())</span><br><span class="line">print(datetime.fromtimestamp(<span class="type">time</span>), file_path)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>甚至可以使用类似的表达式获取上次修改的文件内容</p>
                  <figure class="highlight swift">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line">from datetime <span class="keyword">import</span> datetime</span><br><span class="line">now_path =pathlib.<span class="type">Path</span>.cwd()</span><br><span class="line">result = <span class="built_in">max</span>((f.stat().st_mtime, f) <span class="keyword">for</span> f <span class="keyword">in</span> now_path.iterdir())[<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(result.read_text())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>.stat().st_mtime 会返回文件的时间戳，可以使用 datetime 或者 time 模块对时间格式进行进一步转换。</p>
                  <h3 id="其他内容"><a href="#其他内容" class="headerlink" title="其他内容"></a><strong>其他内容</strong></h3>
                  <h3 id="关于-pathlib-Path-格式路径转换为字符串类型"><a href="#关于-pathlib-Path-格式路径转换为字符串类型" class="headerlink" title="关于 pathlib.Path 格式路径转换为字符串类型"></a><strong>关于 pathlib.Path 格式路径转换为字符串类型</strong></h3>
                  <p>因为通过 pathlib 模块操作生成的路径，不能直接应用字符串的一些操作，所以需要转换成字符串，虽然可以使用 str() 函数进行转换，但是安全性不高，建议使用 os.fspath() 方法，因为如果路径格式非法的，可以抛出一个异常。str()就不能做到这一点。</p>
                  <h3 id="拼接符号”-“背后的秘密"><a href="#拼接符号”-“背后的秘密" class="headerlink" title="拼接符号”/“背后的秘密"></a><strong>拼接符号”/“背后的秘密</strong></h3>
                  <p>/ 运算符由 <strong>truediv</strong> 方法定义。 实际上，如果你看一下 pathlib 的源代码，你会看到类似的东西。</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PurePath</span>(<span class="title">object</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__truediv__</span><span class="params">(<span class="keyword">self</span>, key)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>._make_child((key,))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a><strong>后记</strong></h3>
                  <p>从 Python 3.4 开始，pathlib 已在标准库中提供。 使用 pathlib，文件路径可以由适当的 Path 对象表示，而不是像以前一样用纯字符串表示。 这些对象使代码处理文件路径：</p>
                  <ul>
                    <li>更容易阅读，特别是可以使用“/”将路径连接在一起</li>
                    <li>更强大，直接在对象上提供最必要的方法和属性</li>
                    <li>在操作系统中更加一致，因为Path对象隐藏了不同系统的特性</li>
                  </ul>
                  <p>在本教程中，你已经了解了如何创建 Path 对象、读取和写入文件、操作路径和底层文件系统，以及如何遍历多个文件路径等一系列实例。 最后，建议下去自己多加练习，我对文章中的代码都进行了验证，不会出现运行错误的情况。 ————————————————————————————————————————————— 原文: <span class="exturl" data-url="aHR0cHM6Ly9yZWFscHl0aG9uLmNvbS9weXRob24tcGF0aGxpYi8=">https://realpython.com/python-pathlib/<i class="fa fa-external-link-alt"></i></span> 译者: 陈祥安 [gallery ids=”6600”] 更多精彩内容，请关注微信公众号: python学习开发。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/陈祥安" class="author" itemprop="url" rel="index">陈祥安</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-06-13 14:48:34" itemprop="dateCreated datePublished" datetime="2019-06-13T14:48:34+08:00">2019-06-13</time>
                </span>
                <span id="/6598.html" class="post-meta-item leancloud_visitors" data-flag-title="Python3 中使用 Pathlib 模块进行文件操作" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6533.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> JavaScript <i class="label-arrow"></i>
                  </a>
                  <a href="/6533.html" class="post-title-link" itemprop="url">中英文排版空格问题解决方案</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>想写这篇文章很久了，也想做这件事很久了，我个人感觉自己是有强迫症的，所以一直有什么事让我看着不太舒服就想把它纠正过来。 文字，也不例外。 现在大家看各种新闻啊、文章啊，几乎每篇文章都会有点数字和英文的吧，比如就拿 Python 来说，看下面两句话：</p>
                  <ul>
                    <li>卧槽Python真牛逼啊排名第1了。</li>
                    <li>卧槽 Python 真牛逼啊排名第 1 了。</li>
                  </ul>
                  <p>Python 是不是第一先不说，就看看上面两句话的排版，哪个看起来更舒服？说实话我是真觉得第一句话太别扭了。因为我们大部分的文本编辑器和浏览器是没有对中文和外文的混排做排版优化的，所以如果写的时候如果二者之间不加个空格，二者就会紧紧贴在一起，然后就变成了上面第一句的样子。 当然如果你觉得第一句的排版更好看，好吧，那么本文后面的内容其实可以不必看了。OK，如果你觉得第二个好看，那不妨接着看下去哈。</p>
                  <h2 id="出发点"><a href="#出发点" class="headerlink" title="出发点"></a>出发点</h2>
                  <p>首先有一点需要明确的是，中英文排版的美学是在于 Readability，易读性。而为了易读性，中英文之间是需要留有”间距”的，注意这里是间距，不是说的”空格”。”空格”会造成间距，但是间距不一定非得需要”空格”。 好，所以，其实我们只需要留有适当的间距，就会显得美观易读，这个间距大约是一个半角空格的距离。 好明确了这一点，我们只要能留有间距，不一定非得加空格。 现在很多专业的排版软件，比如 Adobe InDesign、Microsoft Word 对中英文混排支持非常好，他们会有这么一个功能：可以设置中文西文之间留适当的间距。 所以，如果如果我们使用了这些软件，本身就可以做到 Readability，这就够了。 但是，为什么还会说空格的问题呢？这是因为现在绝大多数软件，不管是文本编辑器还是网页，都没有这个机制。 几乎所有的文本编辑器和浏览器中，只要我们中文和英文连续输入，它们之间是不会出现间距的，就像文章开头所示的样例中的第一句话，显得很别扭。但比如 Adobe InDesign、Microsoft Word、IE 浏览器会有这方面的支持。 所以，怎么解决？手动加空格。 因此，总结下：</p>
                  <ul>
                    <li>间距要有，但不一定是空格。</li>
                    <li>部分软件能自动呈现间距，那就不必加空格。</li>
                    <li>绝大多数软件不能自动呈现间距，那就需要手动加空格。</li>
                  </ul>
                  <p>所以，作为强迫症的我，一定是会为了这个间距而去敲下一个空格的。 <strong>「有研究显示，打字的时候不喜欢在中文和英文之间加空格的人，感情路都走得很辛苦，有七成的比例会在 34 岁的时候跟自己不爱的人结婚，而其余三成的人最后只能把遗产留给自己的猫。毕竟爱情跟书写都需要适时地留白。与大家共勉之。」</strong> <img src="https://qiniu.cuiqingcai.com/2019-05-07-165210.jpg" alt="盘古之白"> 所以，求求你加个空格吧（逃。</p>
                  <h2 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h2>
                  <p>好，下面就说到规范的问题了，到底什么时候应该加空格什么时候不加，这也是有讲究的。下面的内容摘自 GitHub 上的一个中英文混排规范，网址为：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL216bG9naW4vY2hpbmVzZS1jb3B5d3JpdGluZy1ndWlkZWxpbmVz">https://github.com/mzlogin/chinese-copywriting-guidelines<i class="fa fa-external-link-alt"></i></span>，下面转述一下。</p>
                  <h3 id="1-中英文之间需要增加空格"><a href="#1-中英文之间需要增加空格" class="headerlink" title="1. 中英文之间需要增加空格"></a>1. 中英文之间需要增加空格</h3>
                  <p>中英文之间是需要添加空格的，不论是普通英文还是引用的英文，下面给个示例： 正确：</p>
                  <ul>
                    <li>在 LeanCloud 上，数据存储是围绕 <code>AVObject</code> 进行的。</li>
                  </ul>
                  <p>错误：</p>
                  <ul>
                    <li>在LeanCloud上，数据存储是围绕<code>AVObject</code>进行的。</li>
                    <li>在 LeanCloud上，数据存储是围绕<code>AVObject</code> 进行的。</li>
                  </ul>
                  <p>完整的正确用法：</p>
                  <ul>
                    <li>在 LeanCloud 上，数据存储是围绕 <code>AVObject</code> 进行的。每个 <code>AVObject</code> 都包含了与 JSON 兼容的 key-value 对应的数据。数据是 schema-free 的，你不需要在每个 <code>AVObject</code> 上提前指定存在哪些键，只要直接设定对应的 key-value 即可。</li>
                  </ul>
                  <p>但有例外，比如「豆瓣FM」等产品名词，按照官方所定义的格式书写。 再比如，我的公众号为「进击的Coder」，那么这里面就不要加空格，按照其本身的形式书写即可。</p>
                  <h3 id="中文与数字之间需要增加空格"><a href="#中文与数字之间需要增加空格" class="headerlink" title="中文与数字之间需要增加空格"></a>中文与数字之间需要增加空格</h3>
                  <p>中文和数字之间也是需要的，下面给个示例： 正确：</p>
                  <ul>
                    <li>今天出去买菜花了 5000 元。</li>
                  </ul>
                  <p>错误：</p>
                  <ul>
                    <li>今天出去买菜花了 5000元。</li>
                    <li>今天出去买菜花了5000元。</li>
                  </ul>
                  <h3 id="数字与单位之间无需增加空格"><a href="#数字与单位之间无需增加空格" class="headerlink" title="数字与单位之间无需增加空格"></a>数字与单位之间无需增加空格</h3>
                  <p>但是数字和单位之间不需要再加额外的空格了，下面给个 正确：</p>
                  <ul>
                    <li>我家的光纤入户宽带有 10Gbps，SSD 一共有 10TB。</li>
                  </ul>
                  <p>错误：</p>
                  <ul>
                    <li>我家的光纤入户宽带有 10 Gbps，SSD 一共有 20 TB。</li>
                  </ul>
                  <p>另外，度／百分比与数字之间不需要增加空格： 正确：</p>
                  <ul>
                    <li>今天是 233° 的高温。</li>
                    <li>新 MacBook Pro 有 15% 的 CPU 性能提升。</li>
                  </ul>
                  <p>错误：</p>
                  <ul>
                    <li>今天是 233 ° 的高温。</li>
                    <li>新 MacBook Pro 有 15 % 的 CPU 性能提升。</li>
                  </ul>
                  <h3 id="全角标点与其他字符之间不加空格"><a href="#全角标点与其他字符之间不加空格" class="headerlink" title="全角标点与其他字符之间不加空格"></a>全角标点与其他字符之间不加空格</h3>
                  <p>标点是分全角和半角的，全角标点一般是在中文状态下输出来的，比如 <code>，</code>、<code>。</code>、<code>！</code>，半角标点一般是在英文状态下输出来的，比如 <code>,</code>、<code>.</code>、<code>!</code>，两个看起来不一样吧？所以，如果是中文标点，即全角标点，那不需要加空格。 正确：</p>
                  <ul>
                    <li>刚刚买了一部 iPhone，好开心！</li>
                  </ul>
                  <p>错误：</p>
                  <ul>
                    <li>刚刚买了一部 iPhone ，好开心！</li>
                  </ul>
                  <p>嗯，基本就是以上的几个规范，只要明白了这些规范，中英文混排就 OK 了！</p>
                  <h2 id="网页"><a href="#网页" class="headerlink" title="网页"></a>网页</h2>
                  <p>有人说，我就是不想打空格，在网页中，我能像 Microsoft Word 一样不打空格而直接显示间距吗？ 也就是说，我能不能设置一个 CSS 样式，就能使得中英文之间自动留有间距呢？ 其实，只有 IE 有这样的支持。这个 CSS 样式叫做 <code>\-ms-text-autospace</code> ，可以在这里了解下：<span class="exturl" data-url="aHR0cHM6Ly9tc2RuLm1pY3Jvc29mdC5jb20vbGlicmFyeS9tczUzMTE2NCh2PXZzLjg1">https://msdn.microsoft.com/library/ms531164(v=vs.85).aspx<i class="fa fa-external-link-alt"></i></span>.aspx)。 但是很遗憾的是，几乎所有其他的浏览器都不支持这个，Chrome、Firefox 统统都不支持这个特性。放弃吧。 <img src="https://qiniu.cuiqingcai.com/2019-05-07-165207.png" alt="image-20190507220822252"> 这里提供一些手动的解决方案，比如使用 JavaScript 添加标记，然后 CSS 控制标记的间距，解决方案可以参考：<span class="exturl" data-url="aHR0cDovL21hc3Rlcm1heS5naXRodWIuaW8vdGV4dC1hdXRvc3BhY2UuanMv">http://mastermay.github.io/text-autospace.js/<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="编辑器"><a href="#编辑器" class="headerlink" title="编辑器"></a>编辑器</h2>
                  <p>那么有编辑器支持这个吗？有，Microsoft Word，用它我们不用加空格，会自动给我们加好间距。 有人说，我平时不想用 Word，我就想用 Markdown，有编辑器吗？有，叫做 MarkEditor，它的 2.0 Pro 版本可以在打字的时候自动给我们添加空格。注意，这里是自动添加空格，不是自动留间距，是用空格的方式实现了间距。但是这个只能在你一个个打字的时候自动添加空格，如果把一个不带空格的话粘贴进去是不行的。另外 MarkEditor 解锁这个功能需要付费，所以我个人感觉其实不太划算的。 所以，平时还是自己手动加空格吧，经济实惠方便。 其他的编辑器如有好用的欢迎大家推荐哈。</p>
                  <h2 id="类库"><a href="#类库" class="headerlink" title="类库"></a>类库</h2>
                  <p>好吧，看到现在，你是不是现在都想把自己的中英文笔记加上空格了？难道要手调吗？不需要。 有现成的工具了，名字叫做 pangu，它支持各种语言，另外还有浏览器插件可以用，列表如下：</p>
                  <h3 id="浏览器插件"><a href="#浏览器插件" class="headerlink" title="浏览器插件"></a>浏览器插件</h3>
                  <ul>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9jaHJvbWUuZ29vZ2xlLmNvbS93ZWJzdG9yZS9kZXRhaWwvcGFwaGNmZGZmam5iY2drb2tpaGNkamxpaWhpY21icGQ=">Google Chrome<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3ZpbnRhL3Bhbmd1LmpzL2Jsb2IvbWFzdGVyL2Jyb3dzZXJfZXh0ZW5zaW9ucy9maXJlZm94L3BhcmFub2lkLWF1dG8tc3BhY2luZy51c2VyLmpz">Mozilla Firefox<i class="fa fa-external-link-alt"></i></span></li>
                  </ul>
                  <h3 id="开发工具包"><a href="#开发工具包" class="headerlink" title="开发工具包"></a>开发工具包</h3>
                  <ul>
                    <li>Official supports:<ul>
                        <li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3ZpbnRhL3Bhbmd1">pangu.go<i class="fa fa-external-link-alt"></i></span> (Go)</li>
                        <li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3ZpbnRhL3Bhbmd1LmphdmE=">pangu.java<i class="fa fa-external-link-alt"></i></span> (Java)</li>
                        <li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3ZpbnRhL3Bhbmd1Lmpz">pangu.js<i class="fa fa-external-link-alt"></i></span> (JavaScript)</li>
                        <li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3ZpbnRhL3Bhbmd1LnB5">pangu.py<i class="fa fa-external-link-alt"></i></span> (Python)</li>
                        <li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3ZpbnRhL3Bhbmd1LnNwYWNl">pangu.space<i class="fa fa-external-link-alt"></i></span> (Web API)</li>
                      </ul>
                    </li>
                    <li>Community supports:<ul>
                        <li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NvbGRuZXcvcGFuZ3UuY2xq">pangu.clj<i class="fa fa-external-link-alt"></i></span> (Clojure)</li>
                        <li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1NlbW9uQ2F0L3Bhbmd1LmRhcnQ=">pangu.dart<i class="fa fa-external-link-alt"></i></span> (Dart)</li>
                        <li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NhdGFza2EvcGFuZ3UuZXg=">pangu.ex<i class="fa fa-external-link-alt"></i></span> (Elixir)</li>
                        <li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0NlZS9wYW5ndS5vYmplY3RpdmUtYw==">pangu.objective-c<i class="fa fa-external-link-alt"></i></span> (Objective-C)</li>
                        <li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0t1bnIvcGFuZ3UucGhw">pangu.php<i class="fa fa-external-link-alt"></i></span> (PHP)</li>
                        <li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RsYWNrdHkvcGFuZ3UucmI=">pangu.rb<i class="fa fa-external-link-alt"></i></span> (Ruby)</li>
                        <li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FpcnQvcGFuZ3UucnM=">pangu.rs<i class="fa fa-external-link-alt"></i></span> (Rust)</li>
                        <li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1gxNDBZdS9wYW5ndS5Td2lmdA==">pangu.swift<i class="fa fa-external-link-alt"></i></span> (Swift)</li>
                      </ul>
                    </li>
                  </ul>
                  <p>比如 Python 的话，就可以使用 pangu.py 这个包，GitHub 地址为：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3ZpbnRhL3Bhbmd1LnB577yM5a6J6KOF5pa55byP5aaC5LiL">https://github.com/vinta/pangu.py，安装方式如下<i class="fa fa-external-link-alt"></i></span>：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> -U pangu</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这么用就好了：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pangu</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(pangu.spacing_text(<span class="string">'當你凝視著bug，bug也凝視著你'</span>)</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">當你凝視著 <span class="keyword">bug，bug </span>也凝視著你</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>嗯，它自动给我们添加好了空格，非常不错。 不过这有点费劲，有简单一点的工具吗？ 有，我为此专门做了一个网页，功能很简单。 在左侧输入源文本，右侧就会显示添加空格之后的文本，页面如下： <img src="https://qiniu.cuiqingcai.com/2019-05-07-165203.png" alt="image-20190507222427295"> 这个是我用 Vue.js 开发的，实际上就是用了 pangu.js 这个库实现的，原理非常简单，主要目的就是为了方便空格排版。 另外这个网站我也部署了一下，叫做：<span class="exturl" data-url="aHR0cDovL3NwYWNlLmN1aXFpbmdjYWkuY29tLw==">http://space.cuiqingcai.com/<i class="fa fa-external-link-alt"></i></span>，大家以后也可以直接访问使用，以后我有想调整的文本，直接就用它了。 如果大家想获取源码，可以在公众号「进击的Coder」回复”空格”。 希望对大家有所帮助。 最后，为了世界的美好与和平，加个空格吧！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-05-08 00:53:14" itemprop="dateCreated datePublished" datetime="2019-05-08T00:53:14+08:00">2019-05-08</time>
                </span>
                <span id="/6533.html" class="post-meta-item leancloud_visitors" data-flag-title="中英文排版空格问题解决方案" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6519.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6519.html" class="post-title-link" itemprop="url">Python 中拼音库 PyPinyin 的用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>最近碰到了一个问题，项目中很多文件都是接手过来的中文命名的一些素材，结果在部署的时候文件名全都乱码了，导致项目无法正常运行。 后来请教了一位大佬怎么解决文件名乱码的问题，他说这个需要正面解决吗？不需要，把文件名全部改掉，文件名永远不要用中文，永远不要。 我想他这么说的话，一定也是凭经验得出来的。 这里也友情提示大家，项目里面文件永远不要用中文，永远不要！ 好，那不用中文用啥？平时来看，一般我们都会用英文来命名，一般也不会出现中文，比如 resource, controller, result, view, spider 等等，所以绝大多数情况下，是不会出现什么问题的。但是也有个别的情况，比如一些素材、资源文件可能的中文命名的，那么这时候该咋办呢？ 首先像，因为是中文资源文件，我们要改成非中文命名的，无非两种，一种是英文，一种是拼音。 如果改英文，当然可以翻译、我们想翻译的话，逐个人工翻译成本太高，机器翻译的话，翻译完可能有些文不对题了，而且我们自己也不知道一些奇怪的资源英语应该叫什么，所以到时候真的找起来都找不到了。 所以第二种解决方案，那就是拼音了。中文转拼音，很自然，而且一个字就对应一串拼音，而且也非常容易从拼音看懂是什么意思，所以这确实是一个不错的方案。 那么问题就来了，怎样把一批中文文件转拼音命名呢？下面就让我们来了解 Python 的一个库 PyPinyin 吧！</p>
                  <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2>
                  <p>Python 中提供了汉字转拼音的库，名字叫做 PyPinyin，可以用于汉字注音、排序、检索等等场合，是基于 hotto/pinyin 这个库开发的，一些站点链接如下：</p>
                  <ul>
                    <li>GitHub: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21vemlsbGF6Zy9weXRob24tcGlueWlu">https://github.com/mozillazg/python-pinyin<i class="fa fa-external-link-alt"></i></span></li>
                    <li>文档：<span class="exturl" data-url="aHR0cHM6Ly9weXBpbnlpbi5yZWFkdGhlZG9jcy5pby96aF9DTi9tYXN0ZXIv">https://pypinyin.readthedocs.io/zh_CN/master/<i class="fa fa-external-link-alt"></i></span></li>
                    <li>PyPi：<span class="exturl" data-url="aHR0cHM6Ly9weXBpLm9yZy9wcm9qZWN0L3B5cGlueWluLw==">https://pypi.org/project/pypinyin/<i class="fa fa-external-link-alt"></i></span></li>
                  </ul>
                  <p>它有这么几个特性：</p>
                  <ul>
                    <li>根据词组智能匹配最正确的拼音。</li>
                    <li>支持多音字。</li>
                    <li>简单的繁体支持, 注音支持。</li>
                    <li>支持多种不同拼音/注音风格。</li>
                  </ul>
                  <p>是不是等不及了呢？那就让我们来了解一下它的用法吧！</p>
                  <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2>
                  <p>首先就是这个库的安装了，通过 pip 安装即可：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> pypinyin</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装完成之后导入一下这个库，如果不报错，那就说明安装成功了。</p>
                  <figure class="highlight elm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">\&gt;&gt;&gt; <span class="keyword">import</span> pypinyin</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，接下来我们看下它的具体功能。</p>
                  <h2 id="基本拼音"><a href="#基本拼音" class="headerlink" title="基本拼音"></a>基本拼音</h2>
                  <p>首先我们进行一下基本的拼音转换，方法非常简单，直接调用 pinyin 方法即可：</p>
                  <figure class="highlight coffeescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pypinyin <span class="keyword">import</span> pinyin</span><br><span class="line"><span class="built_in">print</span>(pinyin(<span class="string">'中心'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[['zhōng'], ['xīn']]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到结果会是一个二维的列表，每个元素都另外成了一个列表，其中包含了每个字的读音。 那么如果这个词是多音字咋办呢？比如 “朝阳”，它有两个读音，我们拿来试下：</p>
                  <figure class="highlight coffeescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pypinyin <span class="keyword">import</span> pinyin</span><br><span class="line"><span class="built_in">print</span>(pinyin(<span class="string">'朝阳'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[['zhāo'], ['yáng']]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好吧，它只给出来了一个读音，但是如果我们想要另外一种读音咋办呢？ 其实很简单，只需添加 heteronym 参数并设置为 True 就好了，我们试下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pypinyin import pinyin</span><br><span class="line"><span class="builtin-name">print</span>(pinyin(<span class="string">'朝阳'</span>, <span class="attribute">heteronym</span>=<span class="literal">True</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[[<span class="symbol">'zhāo</span>', <span class="symbol">'cháo</span>'], [<span class="symbol">'yáng</span>']]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>OK 了，这下子就显示出来了两个读音了，而且我们也明白了结果为什么是一个二维列表，因为里面的一维的结果可能是多个，比如多音字的情况就是这样。 但这个多少解析起来有点麻烦，很多情况下我们是不需要管多音字的，我们只是用它来转换一下名字而已，而处理上面的二维数组又比较麻烦。 所以有没有一个方法直接给我们一个一维列表呢？有！ 我们可以使用 lazy_pinyin 这个方法来生成，尝试一下：</p>
                  <figure class="highlight coffeescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pypinyin <span class="keyword">import</span> lazy_pinyin</span><br><span class="line"><span class="built_in">print</span>(lazy_pinyin(<span class="string">'聪明的小兔子'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'cong</span>', <span class="symbol">'ming</span>', <span class="symbol">'de</span>', <span class="symbol">'xiao</span>', <span class="symbol">'tu</span>', <span class="symbol">'zi</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时候观察到得到的是一个列表，并且不再包含音调了。 这里我们就有一个疑问了，为啥 pinyin 方法返回的结果默认是带音调的，而 lazy_pinyin 是不带的，这里面就涉及到一个风格转换的问题了。</p>
                  <h2 id="风格转换"><a href="#风格转换" class="headerlink" title="风格转换"></a>风格转换</h2>
                  <p>我们可以对结果进行一些风格转换，比如不带声调风格、标准声调风格、声调在拼音之后、声调在韵母之后、注音风格等等，比如我们想要声调放在拼音后面，可以这么来实现：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pypinyin import lazy_pinyin, Style</span><br><span class="line"></span><br><span class="line">style = Style.TONE3</span><br><span class="line"><span class="builtin-name">print</span>(lazy_pinyin(<span class="string">'聪明的小兔子'</span>, <span class="attribute">style</span>=style))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'cong1</span>', <span class="symbol">'ming2</span>', <span class="symbol">'de</span>', <span class="symbol">'xiao3</span>', <span class="symbol">'tu4</span>', <span class="symbol">'zi</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到运行结果每个拼音后面就多了一个声调，这就是其中的一个风格，叫做 TONE3，其实还有很多风格，下面是我从源码里面找出来的定义：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#: 普通风格，不带声调。如： 中国 -&gt; ``zhong guo``</span></span><br><span class="line"><span class="attr">NORMAL</span> = <span class="number">0</span></span><br><span class="line"><span class="comment">#: 标准声调风格，拼音声调在韵母第一个字母上（默认风格）。如： 中国 -&gt; ``zhōng guó``</span></span><br><span class="line"><span class="attr">TONE</span> = <span class="number">1</span></span><br><span class="line"><span class="comment">#: 声调风格2，即拼音声调在各个韵母之后，用数字 [1-4] 进行表示。如： 中国 -&gt; ``zho1ng guo2``</span></span><br><span class="line"><span class="attr">TONE2</span> = <span class="number">2</span></span><br><span class="line"><span class="comment">#: 声调风格3，即拼音声调在各个拼音之后，用数字 [1-4] 进行表示。如： 中国 -&gt; ``zhong1 guo2``</span></span><br><span class="line"><span class="attr">TONE3</span> = <span class="number">8</span></span><br><span class="line"><span class="comment">#: 声母风格，只返回各个拼音的声母部分（注：有的拼音没有声母，详见 `#27`_）。如： 中国 -&gt; ``zh g``</span></span><br><span class="line"><span class="attr">INITIALS</span> = <span class="number">3</span></span><br><span class="line"><span class="comment">#: 首字母风格，只返回拼音的首字母部分。如： 中国 -&gt; ``z g``</span></span><br><span class="line"><span class="attr">FIRST_LETTER</span> = <span class="number">4</span></span><br><span class="line"><span class="comment">#: 韵母风格，只返回各个拼音的韵母部分，不带声调。如： 中国 -&gt; ``ong uo``</span></span><br><span class="line"><span class="attr">FINALS</span> = <span class="number">5</span></span><br><span class="line"><span class="comment">#: 标准韵母风格，带声调，声调在韵母第一个字母上。如：中国 -&gt; ``ōng uó``</span></span><br><span class="line"><span class="attr">FINALS_TONE</span> = <span class="number">6</span></span><br><span class="line"><span class="comment">#: 韵母风格2，带声调，声调在各个韵母之后，用数字 [1-4] 进行表示。如： 中国 -&gt; ``o1ng uo2``</span></span><br><span class="line"><span class="attr">FINALS_TONE2</span> = <span class="number">7</span></span><br><span class="line"><span class="comment">#: 韵母风格3，带声调，声调在各个拼音之后，用数字 [1-4] 进行表示。如： 中国 -&gt; ``ong1 uo2``</span></span><br><span class="line"><span class="attr">FINALS_TONE3</span> = <span class="number">9</span></span><br><span class="line"><span class="comment">#: 注音风格，带声调，阴平（第一声）不标。如： 中国 -&gt; ``ㄓㄨㄥ ㄍㄨㄛˊ``</span></span><br><span class="line"><span class="attr">BOPOMOFO</span> = <span class="number">10</span></span><br><span class="line"><span class="comment">#: 注音风格，仅首字母。如： 中国 -&gt; ``ㄓ ㄍ``</span></span><br><span class="line"><span class="attr">BOPOMOFO_FIRST</span> = <span class="number">11</span></span><br><span class="line"><span class="comment">#: 汉语拼音与俄语字母对照风格，声调在各个拼音之后，用数字 [1-4] 进行表示。如： 中国 -&gt; ``чжун1 го2``</span></span><br><span class="line"><span class="attr">CYRILLIC</span> = <span class="number">12</span></span><br><span class="line"><span class="comment">#: 汉语拼音与俄语字母对照风格，仅首字母。如： 中国 -&gt; ``ч г``</span></span><br><span class="line"><span class="attr">CYRILLIC_FIRST</span> = <span class="number">13</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>有了这些，我们就可以轻松地实现风格转换了。 好，再回到原来的问题，为什么 pinyin 的方法默认带声调，而 lazy_pinyin 方法不带声调，答案就是：它们二者使用的默认风格不同，我们看下它的函数定义就知道了： pinyin 方法的定义如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def pinyin(hans, <span class="attribute">style</span>=Style.TONE, <span class="attribute">heteronym</span>=<span class="literal">False</span>, <span class="attribute">errors</span>=<span class="string">'default'</span>, <span class="attribute">strict</span>=<span class="literal">True</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>lazy_pinyin 方法的定义如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def lazy_pinyin(hans, <span class="attribute">style</span>=Style.NORMAL, <span class="attribute">errors</span>=<span class="string">'default'</span>, <span class="attribute">strict</span>=<span class="literal">True</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这下懂了吧，因为 pinyin 方法默认使用了 TONE 的风格，而 lazy_pinyin 方法默认使用了 NORMAL 的风格，所以就导致二者返回风格不同了。 好了，有了这两个函数的定义，我们再来研究下其他的参数，比如定义里面的 errors 和 strict 参数又怎么用呢？</p>
                  <h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2>
                  <p>在这里我们先做一个测试，比如我们传入无法转拼音的字，比如：</p>
                  <figure class="highlight coffeescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pypinyin <span class="keyword">import</span> lazy_pinyin</span><br><span class="line"><span class="built_in">print</span>(lazy_pinyin(<span class="string">'你好☆☆，我是xxx'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中包含了星号两个，还有标点一个，另外还包含了一个 xxx 英文字符，结果会是什么呢？</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'ni</span>', <span class="symbol">'hao</span>', <span class="symbol">'☆☆，</span>', <span class="symbol">'wo</span>', <span class="symbol">'shi</span>', <span class="symbol">'xxx</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到结果中星号和英文字符都作为一个整体并原模原样返回了。 那么这种特殊字符可以单独进行处理吗？当然可以，这里就用到刚才提到的 errors 参数了。 errors 参数是有几种模式的：</p>
                  <ul>
                    <li>default：默认行为，不处理，原木原样返回</li>
                    <li>ignore：忽略字符，直接抛掉</li>
                    <li>replace：直接替换为去掉 <code>u</code> 的 unicode 编码</li>
                    <li>callable 对象：当传入一个可调用的对象的时候，则可以自定义处理方式。</li>
                  </ul>
                  <p>下面是 errors 这个参数的源码实现逻辑：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_handle_nopinyin_char</span><span class="params">(chars, errors=<span class="string">'default'</span>)</span>:</span></span><br><span class="line">    <span class="string">"""处理没有拼音的字符"""</span></span><br><span class="line">    <span class="keyword">if</span> callable_check(errors):</span><br><span class="line">        <span class="keyword">return</span> errors(chars)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> errors == <span class="string">'default'</span>:</span><br><span class="line">        <span class="keyword">return</span> chars</span><br><span class="line">    <span class="keyword">elif</span> errors == <span class="string">'ignore'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">elif</span> errors == <span class="string">'replace'</span>:</span><br><span class="line">        <span class="keyword">if</span> len(chars) &gt; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span>.join(text_type(<span class="string">'%x'</span> % ord(x)) <span class="keyword">for</span> x <span class="keyword">in</span> chars)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> text_type(<span class="string">'%x'</span> % ord(chars))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当处理没有拼音的字符的时候，errors 的不同参数会有不同的处理结果，更详细的逻辑可以翻看源码。 好了，下面我们来尝试一下，比如我们想将不能转拼音的字符去掉，则可以这么设置：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pypinyin import lazy_pinyin</span><br><span class="line"><span class="builtin-name">print</span>(lazy_pinyin(<span class="string">'你好☆☆，我是xxx'</span>, <span class="attribute">errors</span>=<span class="string">'ignore'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'ni</span>', <span class="symbol">'hao</span>', <span class="symbol">'wo</span>', <span class="symbol">'shi</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果我们想要自定义处理，比如把 <code>☆</code> 转化为 <code>※</code>，则可以这么设置：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">print(<span class="keyword">lazy</span><span class="constructor">_pinyin('你好☆☆，我是<span class="params">xxx</span>', <span class="params">errors</span>=<span class="params">lambda</span> <span class="params">item</span>: ''.<span class="params">join</span>(['※' <span class="params">if</span> <span class="params">c</span> <span class="operator">==</span> '☆' <span class="params">else</span> <span class="params">c</span> <span class="params">for</span> <span class="params">c</span> <span class="params">in</span> <span class="params">item</span>])</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'ni</span>', <span class="symbol">'hao</span>', <span class="symbol">'※※，</span>', <span class="symbol">'wo</span>', <span class="symbol">'shi</span>', <span class="symbol">'xxx</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如上便是一些相关异常处理的操作，我们可以随心所欲地处理自己想处理的字符了。</p>
                  <h2 id="严格模式"><a href="#严格模式" class="headerlink" title="严格模式"></a>严格模式</h2>
                  <p>最后再看下 strict 模式，这个参数用于控制处理声母和韵母时是否严格遵循 <span class="exturl" data-url="aHR0cDovL3d3dy5tb2UuZWR1LmNuL3M3OC9BMTkveXhzX2xlZnQvbW9lXzgxMC9zMjMwLzE5NTgwMi90MTk1ODAyMDFfMTg2MDAwLmh0bWw=">《汉语拼音方案》<i class="fa fa-external-link-alt"></i></span> 标准。 下面的一些说明来源于官方文档： 当 strict 参数为 True 时根据 <span class="exturl" data-url="aHR0cDovL3d3dy5tb2UuZWR1LmNuL3M3OC9BMTkveXhzX2xlZnQvbW9lXzgxMC9zMjMwLzE5NTgwMi90MTk1ODAyMDFfMTg2MDAwLmh0bWw=">《汉语拼音方案》<i class="fa fa-external-link-alt"></i></span> 的如下规则处理声母、在韵母相关风格下还原正确的韵母：</p>
                  <ul>
                    <li>21 个声母： <code>b p m f d t n l g k h j q x zh ch sh r z c s</code> （<strong>y, w 不是声母</strong>）</li>
                    <li>i行的韵母，前面没有声母的时候，写成yi(衣)，ya(呀)，ye(耶)，yao(腰)，you(忧)，yan(烟)， yin(因)，yang(央)，ying(英)，yong(雍)。（<strong>y 不是声母</strong>）</li>
                    <li>u行的韵母，前面没有声母的时候，写成wu(乌)，wa(蛙)，wo(窝)，wai(歪)，wei(威)，wan(弯)， wen(温)，wang(汪)，weng(翁)。（<strong>w 不是声母</strong>）</li>
                    <li>ü行的韵母，前面没有声母的时候，写成yu(迂)，yue(约)，yuan(冤)，yun(晕)；ü上两点省略。 （<strong>韵母相关风格下还原正确的韵母 ü</strong>）</li>
                    <li>ü行的韵跟声母j，q，x拼的时候，写成ju(居)，qu(区)，xu(虚)，ü上两点也省略； 但是跟声母n，l拼的时候，仍然写成nü(女)，lü(吕)。（<strong>韵母相关风格下还原正确的韵母 ü</strong>）</li>
                    <li>iou，uei，uen前面加声母的时候，写成iu，ui，un。例如niu(牛)，gui(归)，lun(论)。 （<strong>韵母相关风格下还原正确的韵母 iou，uei，uen</strong>）</li>
                  </ul>
                  <p>当 strict 为 False 时就是不遵守上面的规则来处理声母和韵母， 比如：<code>y</code>, <code>w</code> 会被当做声母，yu(迂) 的韵母就是一般认为的 <code>u</code> 等。 具体差异可以查看源码中 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21vemlsbGF6Zy9weXRob24tcGlueWluL2Jsb2IvbWFzdGVyL3Rlc3RzL3Rlc3Rfc3RhbmRhcmQucHk=">tests/test_standard.py<i class="fa fa-external-link-alt"></i></span> 中的对比结果测试用例。</p>
                  <h2 id="自定义拼音"><a href="#自定义拼音" class="headerlink" title="自定义拼音"></a>自定义拼音</h2>
                  <p>如果对库返回的结果不满意，我们还可以自定义自己的拼音库，这里用到的方法就有 load_single_dict 和 load_phrases_dict 方法了。 比如刚才我们看到 “朝阳” 两个字的发音默认返回的是 zhao yang，我们想默认返回 chao yang，那可以这么做：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from pypinyin import lazy_pinyin, load_phrases_dict</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(lazy_pinyin(<span class="string">'朝阳'</span>)</span></span>)</span><br><span class="line">personalized_dict = &#123;</span><br><span class="line">    <span class="string">'朝阳'</span>: [[<span class="string">'cháo'</span>], [<span class="string">'yáng'</span>]]</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">load_phrases_dict</span><span class="params">(personalized_dict)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(lazy_pinyin(<span class="string">'朝阳'</span>)</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们自定义了一个词典，然后使用 load_phrases_dict 方法设置了一下就可以了。 运行结果：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'zhao</span>', <span class="symbol">'yang</span>']</span><br><span class="line">[<span class="symbol">'chao</span>', <span class="symbol">'yang</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就可以完成自定义的设置了。 在一些项目里面我们可以自定义很多拼音库，然后加载就可以了。 另外我们还可以注册样式实现自定义，比如将某个拼音前面加上 Emoji 表情，样例：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pypinyin.style <span class="keyword">import</span> register</span><br><span class="line"><span class="keyword">from</span> pypinyin <span class="keyword">import</span> lazy_pinyin</span><br><span class="line"></span><br><span class="line"><span class="meta">@register('kiss')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kiss</span><span class="params">(pinyin, **kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> pinyin == <span class="string">'me'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'?<span class="subst">&#123;pinyin&#125;</span>'</span></span><br><span class="line">    <span class="keyword">return</span> pinyin</span><br><span class="line"></span><br><span class="line">print(lazy_pinyin(<span class="string">'么么哒'</span>, style=<span class="string">'kiss'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'?me</span>', <span class="symbol">'?me</span>', <span class="symbol">'dá</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们调用 register 方法注册了一个样式 style，然后转换的时候指定即可，通过观察运行结果我们可以发现，这样我们就可以将 me 字的拼音前面加上 ? 这个 Emoji 表情了。 以上就是 PyPinyin 这个库的基本用法，更多的用法建议大家看看源码或者看 API 文档：<span class="exturl" data-url="aHR0cHM6Ly9weXBpbnlpbi5yZWFkdGhlZG9jcy5pby96aF9DTi9tYXN0ZXIvYXBpLmh0bWw=">https://pypinyin.readthedocs.io/zh_CN/master/api.html<i class="fa fa-external-link-alt"></i></span>。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-04-04 17:06:50" itemprop="dateCreated datePublished" datetime="2019-04-04T17:06:50+08:00">2019-04-04</time>
                </span>
                <span id="/6519.html" class="post-meta-item leancloud_visitors" data-flag-title="Python 中拼音库 PyPinyin 的用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6511.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 个人随笔 <i class="label-arrow"></i>
                  </a>
                  <a href="/6511.html" class="post-title-link" itemprop="url">从学校迈入职场</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>正式入职微软，提交了第一个 PR 之后，我坐在椅子上思考人生。终于我也变成了一名正式的企业员工，变成了一名正式的踏入社会的职业人士，从此我的学生生涯也算是画上了一个句号，不，更确切的说应该是画上了一个引号。 和同事租了房子，生活条件算是还不错，有了属于自己的房间，有了专属自己的衣柜、书橱、办公桌，想要的硬件、软件、日常用品想配就配，算是应有尽有了。首先日常生活上最大的感受就是自己的生活条件变得更好、更自由，不再像学校一样有各种限制了，虽然日常花销变多了，但总体上来说我更喜欢现在的生活环境。</p>
                  <h2 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h2>
                  <p>先回想一下自己的学生生活吧，初高中就不说了，就天天上课为了高考，后来在大学基本上就是三点一线，宿舍——食堂——教室/实验室，然后读研，研究生模式也差不多，宿舍——食堂——实验室/公司。</p>
                  <h3 id="编程入门"><a href="#编程入门" class="headerlink" title="编程入门"></a>编程入门</h3>
                  <p>我大学的时候选的就是计算机科学与技术这个专业，当时学校开的第一门入门课就是 Java，当时可以说是对编程一窍不通，什么 print？打印机吗？控制台是什么？控制谁？什么面向对象？我对象在哪里？都是些什么玩意。就这样，随着老师的课堂洗脑和一些并不怎么感兴趣的编程作业，我慢慢理解了原来 print 是这么个玩意，对象原来不是那个对象，就慢慢对编程建立了一个概念。插句话，其实我感觉编程的一些概念和思维还是很重要的，有人说编程学不会，可能就是脑中没有形成一个比较清晰的概念，想清楚它能做到什么，怎样从用双手解决一件事的思维转换成用编程解决一件事的思维。 扯远了，但那时候仅仅 Java 是一门课而已，虽然最后考试考得还不错，但是还是不是很懂它能为我带来些什么东西。后来大学就开了一个叫做课程设计的课，意思就是说让自己动手编程实现一个可以操作的项目。我们当时学校要求的就是实现一个黑白棋在线对战系统，当时可把我为难坏了。后来了解到了这里面还挺复杂的，又得编写界面又得搞一些算法，还得搞一个在线 WebSocket 通信，当时可以说是毫无思路，然后就去网上搜一些 Java 的教程，当时是搜到了马士兵的 Java 课就顺着看了起来，可以说马士兵是我的 Java 最重要的启蒙老师了，慢慢地把一些原理和基础学会了之后就有了基本的编程思路了，开始上手编，做界面，做服务器等等。另外还有一些小插曲，有的界面还得抠图，当时为了打造一个完美的棋盘效果还学了 PS 来花了一个木质棋盘和黑白棋子，估计得花了好几个月的时间终于做出来了一个像样点的系统，虽然现在源码已经找不到了，但真的说这个课程设计真的让我理解了编程的一些思维和理念以及它能为我带来些什么，我能够用它做到什么，脑中的一些概念变得更加清晰了，收获非常大。 后来学校开了数据结构和算法的一些课，慢慢地我又对一些基础的算法和 C++ 的一些编程语言有了一定的了解。再后来就是一些基础专业课了，比如操作系统，计算机组成原理，计算机网络等等，总体来说其实我没太感觉出具体有多大作用，但你要假设我没学过，我可能有很多东西都不知其理。人就是这样，有些东西在拥有的时候觉不出有什么好的，但一旦没有才会有明显的感觉。</p>
                  <h3 id="加实验室"><a href="#加实验室" class="headerlink" title="加实验室"></a>加实验室</h3>
                  <p>好吧又扯远了，然后就可以说迈入了我人生中一个比较重要的点了，那就是加入学校的一个实验室。之前许多东西我和室友自己瞎倒腾，比如当时进行版本控制的话，就是自己手动压缩一下，命名项目的时候添加一个版本号并用下划线分割，后来进了实验室才知道还有 Git 这么牛逼的东西，于是乎就跟着学习了 Git，了解了 GitHub，觉得整个代码世界都光明了。当时我加入的是后台组，一开始是从 PHP 开始学起的，从原生的 PHP，到普通的 CodeIgniter 框架，到高级的 Laravel 框架，当时写的时候主要用是 MVC 模式，所以前端的东西也难免需要用到的，所以那会儿又学习了前端的一些知识，慢慢地就变成了 Web 前后端通吃，自己也可以逐渐完成一些大型项目的开发工作。当时还自己开通了博客来记录自己学习的一些经验，然后跟着实验室一起接外包做外包，做了不下十个门户及商业网站的开发。</p>
                  <h3 id="学习爬虫"><a href="#学习爬虫" class="headerlink" title="学习爬虫"></a>学习爬虫</h3>
                  <p>再往后可能就是临近大学毕业的时候了，那会儿实验室的一位学长写了一些爬虫的入门文章，当时也跟着学了起来，边学边记录，学的整理的一些知识点都放在了自己的博客上。后来又探索了一些新的爬取方案，也一并整理到博客上了，形成了一个入门到进阶的一套简易版教程，后来随着写的越来越多，来看的人也越来越多了，后来访问量也逐渐上来了，现在的话日均访问量可以达到 15000+。 再往后可能就差不多大学毕业了，当时由于是保研到北航的，所以就提前来到了北京开始了研究生的预备工作，也节省了不少时间。那会儿就有充足的时间来做自己的事情，比如学习一些网络课程，继续做一些关于爬虫的研究工作。当时随着我的博客访问量越来越大，图灵便联系我看能不能写一本关于爬虫的书，当时想的一个是可以把自己学习的知识好好整理一下，还可以作为自己的一部个人作品出版出来，的确是一件非常不错的事情，所以当时就答应下来了。不得不说写书的过程是非常艰辛的，舍去了好多平时的休息时间，同时还发现了自己的很多不足的地方去查漏补缺，最终也不得不延期了好几个月才交上稿。后来又审校了非常久的时间，到去年五月份才出版出来，定名字叫《Python3网络爬虫开发实战》。不过后来的销量还算不错，现在已经重印了 10 次，50000 本了。现在还在继续撰写第二版中，把一些过期的案例和知识点更新，再把一些新的技术加进去。</p>
                  <h3 id="研究生生活"><a href="#研究生生活" class="headerlink" title="研究生生活"></a>研究生生活</h3>
                  <p>OK，当然研究生阶段也不是都写书了。研究生阶段其实一开始是比较迷茫的，其实当时并不知道自己毕业之后要做什么方面的工作以及想去哪里。最初读的时候是选了网络安全的方向，做一些 Web 渗透方面的研究，后来觉得研究得差不多了，就又转了自然语言处理的方向，从吴恩达的机器学习开始学起，然后了解了深度学习的一些模型，又了解了自然语言处理的一些知识。与此同时，我也在微软这边当实习生，从最初的爬虫、 Platform 再到 Science NLP 研究，慢慢地也认识了一些大佬，和他们一起交流的确让我学习到了不少。 由于我在微软这边实习时间不短，所以当时也参加了实习生转正的面试。微软整个的面试流程还是很规范和严格的，包括多面技术面，另外每一面的要求也都不低的。首先最基础的要求就是算法，给你几道题目，来白纸上把这道题的代码写出来，面试官会非常注重边界处理和细节把握，如果要写不出来，基本上也离凉凉不远了。接下来还有一些基本的公式推导，比如如果要面试机器学习算法工程师的话，可能会让手写推导 SVM、LR 等算法。另外还有一些系统设计题，来看看你的思维和架构是不是能达到要求。最后我记得还有一些智力题，看看反应得快不快。再往后的面试也是谈谈自己对行业的一些理解和看法，谈得还是比较深入的。总之考察得非常综合，当时准备面试的期间真的是无比焦虑，感觉人心惶惶的，当时在疯狂地刷题，复习各种算法推导，准备了也差不多有一两个月。最后得知 Offer 的那一刻，一块石头终于落地了。最后我也如愿入职了微软小冰，今年三月刚刚入职，也希望能为小冰带来更多的贡献，也希望大家可以多多关注微软小冰。 其实我已经在微软这边实习了一年多的时间了，平时很多时间也都呆在公司里，自己也算提前一步迈入职场了，经过我个人实习的体验和感受，同时也结合自己平时的了解，总结出来了一些经验。当然这仅仅是我个人的一些看法，仁者见仁智者见智，在这里仅仅做一些经验总结和分享，总结一些从学生迈入职场之后，我会注重的一些地方。如果对你有些启发，那是再好不过了。</p>
                  <h2 id="工作相关"><a href="#工作相关" class="headerlink" title="工作相关"></a>工作相关</h2>
                  <p>首先就是工作相关的一些东西了，由学生到工作，我个人觉得还是有一些需要调整的地方的，下面稍微这里说一下。</p>
                  <h3 id="转换思维"><a href="#转换思维" class="headerlink" title="转换思维"></a>转换思维</h3>
                  <p>学生到职场的转换，第一个重要的就是转变自己看待事情的思维。迈入职场，就别再有一种”我是学生“、”我刚刚毕业“ 这样的想法，在职场里别人才不管我们是不是刚毕业的学生，他们看的基本上都是我们能不能完成工作或者配合他们完成工作。 另外也别总有一种”努力必有回报“这样的思维。学生时代，可能一道题解不出来，一个项目做不出来，努努力很大程度上还是可以能解的。但是到了职场，这个很不一样，很多事情并不是一定存在因果这样的线性关系的。比如说某个项目你辛辛苦苦做了很久，可能就因为领导不想要这个功能而直接砍掉了。比如说你辛辛苦苦写了稿子，可能因为和某个评阅人的想法不一致而被直接拒掉了。想开点，有时候就是这么操蛋。 还有一个就是别把一件事想的太简单，在工作中，其实很多事上牵扯的东西是很多的。学生的一件事可能就是一件事，一道题可能就是一套题。工作中一件事可能不仅仅是一件事，它所关系到的东西要复杂的多。我们可能会考虑到对公司、对领导、对同事、对绩效、对家人的很多事情，多考虑考虑。 总之，思维的转换是第一步，别再像之前当学生的时候一样了。</p>
                  <h3 id="靠真本事"><a href="#靠真本事" class="headerlink" title="靠真本事"></a>靠真本事</h3>
                  <p>首先得考虑清楚啊，公司把我们招来是为了让我们来发挥价值的。 而我们的价值在哪里发挥？当然是体现在工作成果中。那成果哪里来的？那当然是把自己的能力转化过来的。 不同职位有不同的要求，首先确保的是要利用自己的能力把本职工作做好。当然我是做技术的，我所专注的就是技术这个领域了，技术能力是必不可少的，当然做这份工作需要的其实也不仅仅是技术能力，还有一些非表面意义上的能力，如学习探索能力、沟通合作能力等等。 而这些吧，归根结底还是要靠自己的真本事的。别想着投机取巧，别想着耍点小聪明，虽然一时方便了，但是长远来看，吃亏的还是自己。 当然这例子很多，比如明明不是自己做的，却要为了某些目的非要伪装自己，被看穿之后，不少人其实是看破不说破的，慢慢地自己就会知道后果了。比如为了某些目标，背地里各种跟领导各种小恩小惠等，其实领导基本不会 Care 你这种小聪明，甚至还觉得这个人有点靠不住，自己的受信任度也会大打折扣，另外自己不会感到心虚吗？ 最好的办法是什么，其实就是把该做完的工作保质保量完成，靠自己的真本事，实打实做好要求的每一件事就好了，领导看重的就是这个。</p>
                  <h3 id="利益为先"><a href="#利益为先" class="headerlink" title="利益为先"></a>利益为先</h3>
                  <p>职场上面啊，你说人情，当然也是会有的，但是更多的人关注的其实是工作本身以及自己的利益。这和学校的差距还是很大的。比如你要是个学生的话，有些人可能觉得你的身份而稍微谅解一下，而踏入社会之后，基本就不会了。 比如你要跟某个人交流和合作，就别总是寒暄以此来套近乎，不是说这个一点用都没有，多少可能还是有点用的，如果你有价值，靠这个可能能快速拉近他与你的距离。但很多情况下，这个的效果可能真的作用不大。 到了职场，大家都很忙的，比如找人谈事情，稍微介绍几句，开口直接谈正事、谈利益就好了。如果不能为对方提供有价值的信息，或者提供的价值并不是对方想要的，对方会觉得比较浪费时间。这种时候就别掺杂什么别的什么交情之类的东西了，虽说我认为成年人只看利益不够准确，但基本上是没错的。 比如跟人谈个合作的时候，讲清楚两点，第一是我们能提供什么价值和服务，第二是他能得到什么利益。当然第二点有的情况下是不需要说的，因为我们本身提供的价值就是给对方的利益，对方觉得值，自然会跟我们合作的。其中也不乏一些沟通的小技巧，还需要在这个过程中慢慢摸索。</p>
                  <h3 id="保持交流"><a href="#保持交流" class="headerlink" title="保持交流"></a>保持交流</h3>
                  <p>领导给了一个要求，如果有疑问，要多问多交流，别偏离了方向，别是自作主张。 之前的时候，我接到了一个任务，了解了基本的需求时候就开始开工干。在做的过程中其实有不少不确定的地方，但是当时我也不知道是不好意思还是什么原因，就没有跟领导交流，按照自己的想法做了出来。最后演示的时候，领导说你怎么做成这样了？我本意不是这样的，你有疑问怎么不跟我讨论呢？ 我就意识到了，这其实也可以多少印证”选择比努力更重要“，方向性或方案性的东西是很重要的。 所以，遇到什么不确定的点，要多多沟通交流。当然这并不是说突然想到了某个点就去找对方讨论，把自己的疑问以及可能解决方案和结果梳理清楚再好好交流一下，效果一定好上太多。</p>
                  <h3 id="工作日志"><a href="#工作日志" class="headerlink" title="工作日志"></a>工作日志</h3>
                  <p>做好工作日志，时间长了，会发现这个非常有用，它的有用不仅仅是体现在它仅仅是做了总结，它也会潜移默化地影响我们自己。 比如每天可以找个时间简单记录一下自己今天做了什么事情，收获了什么，还需要做什么。这个记录的过程就是一个思考的过程，它会让我们反思自己的一些不足和需要做的更好的地方，会变成一种激励的。 另外工作日志，等某天你打开的时候，会发现成就感满满，同时写什么总计和汇报也就不用愁了。</p>
                  <h2 id="个人相关"><a href="#个人相关" class="headerlink" title="个人相关"></a>个人相关</h2>
                  <p>刚才所说的挺多都是和工作相关的，另外还有一些和个人相关的我觉得也应该好好注意下。</p>
                  <h3 id="迈出第一步"><a href="#迈出第一步" class="headerlink" title="迈出第一步"></a>迈出第一步</h3>
                  <p>我曾经尝试过很多坚持每天做点什么的事情，发现有的挺难坚持下来的，一而再再而三地累积，就变得越来越多，后来整个坚持的事情就失败了，这就是拖延症的一种现象。 拖延症应该很多人都会有，当然我也是。我平时分析拖延症的一个很大的原因就是迈不出第一步，进而一件事就搁置了。就比如说要去健身房，我觉得最难的就是出家门；比如说要每天刷一道算法题，最难的可能就是打开LeetCode界面。不知道你们什么意见，我至少是这么认为的。 因此，迈出第一步非常重要，迈出了第一步，可以说就成功了一半。</p>
                  <h3 id="言多必失"><a href="#言多必失" class="headerlink" title="言多必失"></a>言多必失</h3>
                  <p>的确是，言多必失，这话没毛病。 可能我们仅仅是刚入职的新人，很多情况下不该说的就别说。你永远也不知道你说了某些话之后，你在别人耳中会变成什么样的版本。另外如果我们突然说错了什么话，被人揪住了把柄，那可是很难的。所以，一些场景中，我们一些没必要说的就不要去说，不知道该说不该说的也不要说。 另外我个人比较反感的是明一套暗一套。我们不可能让所有人都认同我们自己，不认同我们的，他们表现出来，我们道不同不相为谋。认同我们的支持我们的，我们可以与他们成为朋友。但表面上显得非常友好，然而在背地里面却说坏话，这是非常令人反感的。</p>
                  <h3 id="终身学习"><a href="#终身学习" class="headerlink" title="终身学习"></a>终身学习</h3>
                  <p>虽然表面上看学生生涯结束了，但实际上迈入职场恰恰是一个新的开始，其实人与人之间的差距就是因为工作后的这些年逐渐拉开的，所以不论什么时候都不能放弃学习。 当然迈入职场以后，学习的一些侧重点可能就不太一样了。工作后学习的第一肯定是能用在岗位之上的专业知识，我们所掌握的知识一定至少要能够让我们顺利地专业地完成自己的任务。其次可以扩宽一下知识面，比如可以关注下经济、理财、交际等知识。 总之还是一句话，学习到的本事是别人所偷不走的，做一个终身学习者。</p>
                  <h3 id="做好记录"><a href="#做好记录" class="headerlink" title="做好记录"></a>做好记录</h3>
                  <p>很多事情是确实很有必要记录下来的。首先不瞒说，随着事情的增多，工作的忙碌，我发现比原来更加”忘事“了。后来我看了一篇报道，说其实并不是脑子记忆力下降了多少，而是集中的注意力变得更少了。 一件事如果注意力分配得少了，自然很多事情就不容易被我们记住。想想确实是这样的，现在我每天都把自己的计划安排得满满当当，现在连拿出时间好好读一本书的时间都不多了，因此就别提那些日常小事了。那咋办？随手记录下来，比如记到手机的备忘录或者自己的 TodoList 软件里面，然后再进一步安排如何执行就好。 当然记录并不仅仅局限于这个记录下来平时的闪念，平时的一些工作总结、学习笔记也可以时刻记录下来。我有记录学习笔记的习惯，当然肯定也有的时候有一些内容没有及时记录下来。过了一段时间，我发现唯一记得的就是自己曾经整理过笔记甚至发表博客的那些内容，没写过的或者没发过的基本都忘干净了。 记录，成为更好的自己。</p>
                  <h3 id="作息调整"><a href="#作息调整" class="headerlink" title="作息调整"></a>作息调整</h3>
                  <p>良好的作息还是非常有必要的。现在肯定非常多的朋友会倾向于熬夜，十二点之后才睡。我之前实习的时候，比这个更狠，经常一两点钟睡觉，睡到将近中午，就直接吃中午饭得了，然后一上午就没有了，当时就有一种半天已经被我浪费的感觉，会有一种负罪感。 后来我开始逐步调整我的作息，尽量早睡早起，从之前的九点多慢慢地调整到八点，甚至是七点多，醒来之后整理一些东西，开始全新的一天，整体的体验确实是比之前睡到中午好太多了。另外我个人也参加了一个早起打卡活动，现在已经坚持每天打卡将近一个月了，基本上也养成了早起的习惯。 另外工作之后，下班的时间也可以好好利用起来，比如晚上稍微拉伸一下，睡前记得喝水等等，由于我平时也每天对着电脑，所以也需要定期地起来活动一下。我把它们设置到滴答清单里面，每天都有软件的定时提醒，到了时间就做，一天天坚持下来。总体来说，感觉也比之前好多了。 所以从现在起，拿起笔好好规划下自己的目标和平时的作息吧。 另外可能大家听说过，某个老板每天只睡五个多小时，晚上工作到很晚才走，早上一大早就在了。我当时也比较好奇这到底是怎么做到的？难道有什么特殊的睡眠技巧？经过我的一阵搜罗，结果是，没有。BOSS 们并没有我们这么忙，可能早上开完会，我们去干活了，而人家去补觉了。所以，保证充足的睡眠还是很有必要的。</p>
                  <h3 id="合理分配时间"><a href="#合理分配时间" class="headerlink" title="合理分配时间"></a>合理分配时间</h3>
                  <p>从学生到工作，其实就相当于我们的事情又多了一部分，工作日大部分为工作时间，非工作日则大部分是自己的时间。另外工作之后，相比学生时代来说，事情可能也会变得更多更繁琐。那么如何合理分配自己的时间呢？ 我这边采用了目前比较流行的四象限时间管理法，他就是把处理的事按“重要”和“紧急”两个维度划分，并对应到四种待处理状态中，分别叫做”重要不紧急“，”重要紧急“，”不重要紧急“，”不重要不紧急“四个类别。 通常来说，我们需要马上执行“急事”，确保它们不会延期。但长远来看，我们最好将重心放在“要事”上。可能有一些紧急的小事，它确实是不重要的，但我们能比较快的做完，然后把它勾掉，所以现在很多人可能更加优先处理的是紧急的事情而不是重要事情，最后紧急的事情做完了，剩下重要的事情没做完，所以要么加班熬夜，要么就延期。回想起来，其实这是很得不偿失的，忙活了一天，重要的事情还是没完成。 所以，我们需要尽量减少”不重要紧急“事件的忙碌，尽早处理”重要不紧急“的事情，合理分配时间，去做对我们而言重要的事情，才是四象限理论的核心。 我自己使用了滴答清单这款软件，之前使用的是 Todoist，这两款软件都非常不错，但是由于滴答清单多了番茄时钟的功能，我就改用了滴答清单，我利用它建立了四个智能清单，分别叫做”重要不紧急“，”重要紧急“，”不重要紧急“，”不重要不紧急“，然后建立筛选条件，软件就会根据任务的优先级和到期日期自动更新。然后就可以每天查看、处理并调整任务——做完的事情及时打勾，有变更的事情及时移动，可以遵循这样的一些准则：</p>
                  <ul>
                    <li>优先执行重要且紧急的事件</li>
                    <li>尽量提前规划重要不紧急事件，在它们变得紧急前就完成</li>
                    <li>如果可以的话，试着将不重要但紧急的事情交由他人处理，或者学会对别人的请求说 Sorry</li>
                    <li>需要控制去做不重要不紧急事件的时间，不要过度放松</li>
                  </ul>
                  <p>有了这几条原则，我们就可以很好的分配我们的时间了，如果大家觉得有用的话也可以试一下。 以上就是我的成长历程以及我所想到的一些需要调整和坚持的一些做法，如果能为大家带来一些帮助，那就再好不过了。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-03-25 02:35:33" itemprop="dateCreated datePublished" datetime="2019-03-25T02:35:33+08:00">2019-03-25</time>
                </span>
                <span id="/6511.html" class="post-meta-item leancloud_visitors" data-flag-title="从学校迈入职场" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6509.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/6509.html" class="post-title-link" itemprop="url">如何使用 SSH 控制连接 Windows 服务器</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>入职微软之后，这边大多数是使用 Windows 进行开发的，比如我的台式机是 Windows 的，还有一部分服务器是 Windows 的，当然 Linux 是也非常多。 很多情况下我是使用自己的 Mac 笔记本来远程连接我的 Windows 机器来开发的。比如如果我在工位上，我会用我的 Mac 连接两块显示屏，然后一种一块用来远程桌面连接我的 Windows 开发机，这样另外一块屏幕和 Mac 自带的屏幕就用来看文档或者使用 Teams 通讯等等。如果我回家了，我家里也是有两块屏，开上 VPN，照样用一块屏使用远程桌面，另外一块屏幕和 Mac 自带屏幕就可以做其他事情了。 这样就解决了一个问题：我的 Windows 基本上都是仅用作开发的，一块屏幕就开着一个 Visual Studio，其他的操作都会在 Mac 进行，比如查文档，发消息等等。这样我下班之后照样使用远程连接的方式来操作，和在公司就是一样的。这样就避免了一些软件的来回登录，比如如果我上班只用公司机器，下班了之后换了 Mac 还得切 Teams、切微信、切浏览器等等，还是很麻烦的，而且上班期间 Mac 就闲置了也不好。所以我就采取了这样的开发方案。</p>
                  <h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2>
                  <p>有了这个情景，就引入了一个问题。开了一个远程桌面之后，我几乎一个屏幕都是被 Visual Studio 占据的，而远程桌面貌似只能开一个屏幕？如果我要再开一个终端窗口的话，那可能屏幕就不太够用了，或者它就得覆盖我的全屏 Visual Stuido。 另外我平时 Mac 终端软件都是使用 SSH 的，基本都是用来连 Linux 的，Windows 一般都是开远程桌面。但命令行这个情形的确让我头疼，让我感到不够爽，因为毕竟远程桌面之后，Windows 里面的操作都得挤在一个桌面里面操作了。当然可能能设置多个桌面，如果可以的话，麻烦大家告知一下谢谢。 所以解决的痛点在于：我要把一些操作尽量从 Windows 里面分离出来，例如终端软件，我能否在远程桌面外面操作，能否使用 SSH 来控制我的 Windows 机器。 好，有需求才有动力，说干就干。</p>
                  <h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2>
                  <p>查了一下，Windows 上其实也是有 SSH 服务器的，只不过默认是没有装的，这里只需要安装一个 OpenSSH 服务器就好了。 Win10 的话，就在设置里面可以安装，从开始菜单打开“设置”，然后选择应用和功能，这里就有一个“管理可选功能”的选项。 <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1g17uv5tf19j30xb0puwm9.jpg" alt="image-20190319093941643"> 点击之后便可以看到一个可选功能，选择 OpenSSH 服务器即可，一般情况下是没有安装的。如果没有安装的话它会提示一个安装按钮，这里我已经安装好了，就提示了一个卸载按钮。 <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1g17uwoakpij30x70pv0u6.jpg" alt="image-20190319094113033"> OK，有了它，直接点击安装即可完成 OpenSSH 服务器的安装。 当然如果你是想批量部署 Windows 服务器的话，当然是推荐使用 PowerShell 来自动化部署了。 首先需要用管理员身份启动 PowerShell，使用如下命令看一下，要确保 OpenSSH 可用于安装：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Get</span>-WindowsCapability -Online | ? <span class="type">Name</span> -<span class="keyword">like</span> <span class="string">'OpenSSH*'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出应该是类似的结果：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">Name</span>  : <span class="selector-tag">OpenSSH</span><span class="selector-class">.Client</span>~~~~0<span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.0</span></span><br><span class="line"><span class="selector-tag">State</span> : <span class="selector-tag">NotPresent</span></span><br><span class="line"><span class="selector-tag">Name</span>  : <span class="selector-tag">OpenSSH</span><span class="selector-class">.Server</span>~~~~0<span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.0</span></span><br><span class="line"><span class="selector-tag">State</span> : <span class="selector-tag">NotPresent</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后使用 PowerShell 安装服务器即可：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">Add-WindowsCapability</span> <span class="selector-tag">-Online</span> <span class="selector-tag">-Name</span> <span class="selector-tag">OpenSSH</span><span class="selector-class">.Server</span>~~~~0<span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出结果类似：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">Path          :</span></span><br><span class="line"><span class="attr">Online        :</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">RestartNeeded :</span> <span class="literal">False</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样也可以完成 OpenSSH 的安装。 安装完成之后，就需要进行一些初始化配置了，还是以管理员身份，使用 PowerShell 执行即可。 首先需要开启 SSHD 服务：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="literal">Start</span>-Service sshd</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后设置服务的自动启动：</p>
                  <figure class="highlight delphi">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Set</span>-Service -<span class="keyword">Name</span> sshd -StartupType <span class="string">'Automatic'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后确认一下防火墙是否是放开的：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Get</span>-NetFirewallRule -<span class="type">Name</span> *ssh*</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果是放开的，那么结果会提示 <code>OpenSSH-Server-In-TCP</code>这个状态是 enabled。 好了，完成如上操作之后我们就可以使用 SSH 来连接我们的 Windows 服务器了。</p>
                  <h2 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h2>
                  <p>连接非常简单了，用户名密码就是 Windows 的用户名和密码，使用 IP 地址链接即可。 比如我的 Windows 开发机的局域网 IP 为：10.172.134.88，那么就可以使用如下命令完成链接：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ssh <span class="symbol">user@</span><span class="number">10.172</span><span class="number">.134</span><span class="number">.88</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后输入密码，就连接成功了，和 Linux 的是一样的。 另外我自己现在 Mac 常用的 SSH 客户端工具有 Termius，可以多终端同步使用，非常方便，这里我只需要添加我的 Windows 机器就好了，如图所示： <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1g17vz64duxj30zk0m8gn6.jpg" alt="image-20190319101812208"> OK，以后就可以非常轻松地用 SSH 连接我的 Windows 服务器了，爽歪歪，上面的需求也成功解决。 以上便是使用 SSH 来连接 Windows 服务器的方法，如果大家有需求可以试试。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-03-25 02:33:31" itemprop="dateCreated datePublished" datetime="2019-03-25T02:33:31+08:00">2019-03-25</time>
                </span>
                <span id="/6509.html" class="post-meta-item leancloud_visitors" data-flag-title="如何使用 SSH 控制连接 Windows 服务器" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6462.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6462.html" class="post-title-link" itemprop="url">程序猿的情人节怎么过？</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>都说程序猿是一类不解风情的生物，“赚的多，花的少，死的早”已经成为了程序猿的标志，“眼镜、格子衫、垢面蓬头、拖鞋裤衩”已然也成了程序猿的代表形象，“代码、游戏、老湿”也已经快要成了程序猿的生命。 但！有的时候，比如情人节，我们就可以发挥我们的特长了，我们程序猿也可以有自己的浪漫！ 不过这个第一步是，你得有一个女朋友（哦哦，是不是可以不用往下看了？ 那么有了第一步之后，下面我们应该怎么办呢？ 下面介绍一个比较实用的可以送给女朋友的礼物（这其实也是我今天送给女朋友的礼物嘿嘿。 首先想想，作为程序猿，我们的专长是什么？废话，当然是代码。 有了代码，还需要送口红吗？还需要送包包吗？还需要送鲜花吗？废话，都有了代码了，这些当然就….还是要送的。万一写的代码你女朋友看不懂那岂不是死翘翘了。 好那送完了口红或包包或鲜花之后，确保已经平安无事了，我们就可以再发挥我们的光和热了（听起来咋这么奇怪呢？ 进入正题，那我们可以利用代码做点什么呢？想想可以做文章的地方有什么，你们的纪念日，你们曾经做过的事情，你们在一起的时间，这些都是属于你们的独一无二的，我们可以想方设法把它们和代码联系起来。 那怎么发给女朋友看呢？做个 App、小程序、网页什么的都是可以的吧，其中网页可能是做起来最快最方便的了，然后配上一个专属域名，简直美滋滋。 好，那一想，基本方向就确定了，直接开干，接下来就描述一下我准备这个礼物的历程吧。 对于我来说，我就计划做一个网页，同时用代码的形式把和女朋友在一起的时间呈现出来，通过网页的动效来呈现我们在一起的时间，另外还计划把我们之间的故事用代码关联表示出来。 本来我打算是从零开始手撸一个的，但是一些组件比如动画特效，还有一些倒计时的组件是相对比较难做的，于是我就在 GitHub 上逛了一下，看了几个示例，找到了一个和我理想作品差不多的项目，然后在它的基础上做了一些改动，就成了最终的效果。 主要功能如下：</p>
                  <ul>
                    <li>第一是通过代码来表述出来和女朋友之间的故事。由于我和女朋友是因为 Python 认识的，而且我们两个平时都会写一些 Python，所以我决定用 Python 来写出我们之间的故事，加上 Python 的注释来辅助描述每一行代码的意义。</li>
                    <li>第二是通过代码来呈现我和女朋友在一起的时间。这里就用上了一些动画特效和秒数计时方案，实时地呈现出来我和女朋友在一起已经有多久了。</li>
                  </ul>
                  <p>最终完成之后的效果是这样子的： <img src="https://ws2.sinaimg.cn/large/006tKfTcly1g062do1uo8j31al0u0axr.jpg" alt="预览图"> 然后由于我自己有一个域名，叫做 cuiqingcai.com，然后我就把它设置了二级域名解析，二级域名名称就叫做 love，域名最终就是 love.cuiqingcai.com。 最终的效果大家可以扫码或者复制链接查看一下最终的效果：<span class="exturl" data-url="aHR0cDovL2xvdmUuY3VpcWluZ2NhaS5jb20v77yM5LqM57u056CB5aaC5LiL77ya">http://love.cuiqingcai.com/，二维码如下：<i class="fa fa-external-link-alt"></i></span> <img src="https://ws1.sinaimg.cn/large/006tKfTcly1g064wqfgqvj30ea0eadg5.jpg" alt="二维码"> 感觉还可以吧？如果你也想送这样的礼物的话，可以根据我现有的代码来进行修改，我已经将源码放到 GitHub 了，地址为：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dlcm1leS9WYWxlbnRpbmVzRGF577yM5aSn5a625Y+v5Lul5L+u5pS55rqQ56CB77yM5oqK5a6D5Y+Y5oiQ5bGe5LqO5L2g5ZKM5L2g5aWz5pyL5Y+L55qE5LiT5bGe6aG16Z2i77yM54S25ZCO6YCB57uZ5aWz5pyL5Y+L44CC">https://github.com/Germey/ValentinesDay，大家可以修改源码，把它变成属于你和你女朋友的专属页面，然后送给女朋友。<i class="fa fa-external-link-alt"></i></span> 下面说一些关键的技术和需要修改的点。</p>
                  <h2 id="代码动画"><a href="#代码动画" class="headerlink" title="代码动画"></a>代码动画</h2>
                  <p>打开页面之后，我们可以看到页面的代码是一个字一个字敲出来的，这实际上是利用了一个定时器来实现的。 首先我们可以预定义好所有的文本，然后动画播放的时候，首先把所有的文本隐藏，然后每隔几十毫秒读取一个字符，然后将其呈现出来。由于文本本身就是换行的，所以在呈现的时候就会一行一行地像打字机一样呈现出来。 另外为了模拟打字的效果，在呈现的时候可以在最后的字符后面添加一个下划线符号，模拟打字的效果。 其关键的实现代码如下：</p>
                  <figure class="highlight clojure">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="name">function</span> (<span class="name">a</span>) &#123;</span><br><span class="line">    a.fn.typewriter = function () &#123;</span><br><span class="line">        this.each(<span class="name">function</span> () &#123;</span><br><span class="line">            var d = a(<span class="name">this</span>), c = d.html(), b = <span class="number">0</span><span class="comment">;</span></span><br><span class="line">            d.html(<span class="string">""</span>)<span class="comment">;</span></span><br><span class="line">            var e = setInterval(<span class="name">function</span> () &#123;</span><br><span class="line">                var f = c.substr(<span class="name">b</span>, <span class="number">1</span>)<span class="comment">;</span></span><br><span class="line">                if (<span class="name">f</span> == <span class="string">"&lt;"</span>) &#123;</span><br><span class="line">                    b = c.indexOf(<span class="string">"&gt;"</span>, b) + <span class="number">1</span></span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    b++</span><br><span class="line">                &#125;</span><br><span class="line">                d.html(<span class="name">c.substring</span>(<span class="number">0</span>, b) + (<span class="name">b</span> &amp; <span class="number">1</span> ? <span class="string">"_"</span> : <span class="string">""</span>))<span class="comment">;</span></span><br><span class="line">                if (<span class="name">b</span> &gt;= c.length) &#123;</span><br><span class="line">                    clearInterval(<span class="name">e</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="number">75</span>)</span><br><span class="line">        &#125;)<span class="comment">;</span></span><br><span class="line">        return this</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="name">jQuery</span>)<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里可以看到，首先获取了页面代码区域的内容，然后通过 DOM 操作将代码先清空，然后利用 setInterval 方法设置一个定时器，定时间隔 75 毫秒，也就是说 75 毫秒循环调用一次。每调用一次，就会从原来的字符上多取一个字符，然后尾部拼接一个下划线就好了。</p>
                  <h2 id="代码内容"><a href="#代码内容" class="headerlink" title="代码内容"></a>代码内容</h2>
                  <p>接下来就是代码内容了，这里面要想好怎样把一些关键时间来表示出来。比如和女朋友怎样认识的，后来什么时间在一起的，一起做过什么事情，将来有什么计划和打算，都可以来描述出来，另外编程语言可以选择你喜欢的语言，然后配以一定的注释来描述代码所代表的含义。 我和女朋友是在 PyCon 认识的，也算是因为 Python 结缘，然后平时我们都会写一些 Python，所以我就选用 Python 作为编程语言了。 然后我又加上了我们认识的时间、在一起的时间、一起做过的事情，然后再配以一段代码来表达自己的想法，其中的一些灵感也是我看了一些案例想出来的，在表述过程中我使用了面向对象的思维声明了两个对象，一个代表我，一个代表我女朋友，然后一起做过的事情就可以通过对象调用方法的形式来表述出来了，另外一些动作和标志可以通过自定义方法或者代码的参数来表示出来，其中每一行代码的动作我都配以一条 Python 的注释来完成，注释当然是用英文，一些话我还用了翻译软件一句句查的。 然后最后我用了一段 Python 代码来表达了自己的感情，内容如下：</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># You are the greatest love of my life.</span></span><br><span class="line"><span class="attr">while</span> <span class="string">True:</span></span><br><span class="line">    <span class="attr">if</span> <span class="string">u.with(i):</span></span><br><span class="line">        <span class="attr">you</span> = <span class="string">everything</span></span><br><span class="line">    <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">        <span class="attr">everything</span> = <span class="string">u</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个代码的含义叫做“无论天涯海角，你都是我的一切。“，一个 while True 循环代表了永久。 这些代码其实都是在 HTML 代码中预定义好的，其中注释需要用 span 标签配以 comments 的 class 来修饰，缩进需要用 span 标签配以 placeholder 的 class 来修饰，例如：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"comments"</span>&gt;</span># You are the greatest love of my life.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">while <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"keyword"</span>&gt;</span>True<span class="tag">&lt;/<span class="name">span</span>&gt;</span>:<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"keyword"</span>&gt;</span>if<span class="tag">&lt;/<span class="name">span</span>&gt;</span> u.with(i):<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>you = everything<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"keyword"</span>&gt;</span>else<span class="tag">&lt;/<span class="name">span</span>&gt;</span>:<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>everything = u<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里不同的格式用 span 的不同 class 来标识，空格缩进一个 placeholder 是两个空格，comments 代表注释格式，关键词使用 keyword 来标识。如果你需要自定义自己的内容，通过控制这些内容穿插写入就好了。</p>
                  <h2 id="纪念日计时"><a href="#纪念日计时" class="headerlink" title="纪念日计时"></a>纪念日计时</h2>
                  <p>关于纪念日，这个实现起来其实挺简单的，就是首先定义好你们的纪念日，然后获取当前系统时间，然后计算秒数差值，然后将其转化为天数、小时数即可，关键核心代码实现如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timeElapse</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> e = <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">var</span> f = (<span class="built_in">Date</span>.parse(e) - <span class="built_in">Date</span>.parse(c)) / <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">var</span> g = <span class="built_in">Math</span>.floor(f / (<span class="number">3600</span> * <span class="number">24</span>));</span><br><span class="line">    f = f % (<span class="number">3600</span> * <span class="number">24</span>);</span><br><span class="line">    <span class="keyword">var</span> b = <span class="built_in">Math</span>.floor(f / <span class="number">3600</span>);</span><br><span class="line">    <span class="keyword">if</span> (b &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        b = <span class="string">"0"</span> + b</span><br><span class="line">    &#125;</span><br><span class="line">    f = f % <span class="number">3600</span>;</span><br><span class="line">    <span class="keyword">var</span> d = <span class="built_in">Math</span>.floor(f / <span class="number">60</span>);</span><br><span class="line">    <span class="keyword">if</span> (d &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        d = <span class="string">"0"</span> + d</span><br><span class="line">    &#125;</span><br><span class="line">    f = f % <span class="number">60</span>;</span><br><span class="line">    <span class="keyword">if</span> (f &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        f = <span class="string">"0"</span> + f</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外它也是通过一个定时器来实现的时间刷新，每隔 500 毫秒调用一次：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">setInterval(<span class="name">function</span> () &#123;</span><br><span class="line">    timeElapse(<span class="name">together</span>)<span class="comment">;</span></span><br><span class="line">&#125;, <span class="number">500</span>)<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="动画心形"><a href="#动画心形" class="headerlink" title="动画心形"></a>动画心形</h2>
                  <p>动画心形，其实这个实现起来是很巧妙的。这里在画的时候实际上是利用了贝塞尔曲线来绘制一个心形，同时在在画的过程中还加了花开的效果，花开的效果使用了随机数和随机颜色生成。 其中动画画心形的核心代码如下：</p>
                  <figure class="highlight kotlin">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Petal.prototype = &#123;</span><br><span class="line">    draw: function () &#123;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="keyword">this</span>.bloom.garden.ctx;</span><br><span class="line">        <span class="keyword">var</span> e, d, c, b;</span><br><span class="line">        e = new Vector(<span class="number">0</span>, <span class="keyword">this</span>.r).rotate(Garden.degrad(<span class="keyword">this</span>.startAngle));</span><br><span class="line">        d = e.clone().rotate(Garden.degrad(<span class="keyword">this</span>.angle));</span><br><span class="line">        c = e.clone().mult(<span class="keyword">this</span>.stretchA);</span><br><span class="line">        b = d.clone().mult(<span class="keyword">this</span>.stretchB);</span><br><span class="line">        a.strokeStyle = <span class="keyword">this</span>.bloom.c;</span><br><span class="line">        a.beginPath();</span><br><span class="line">        a.moveTo(e.x, e.y);</span><br><span class="line">        a.bezierCurveTo(c.x, c.y, b.x, b.y, d.x, d.y);</span><br><span class="line">        a.stroke()</span><br><span class="line">    &#125;, render: function () &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.r &lt;= <span class="keyword">this</span>.bloom.r) &#123;</span><br><span class="line">            <span class="keyword">this</span>.r += <span class="keyword">this</span>.growFactor;</span><br><span class="line">            <span class="keyword">this</span>.draw()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.isfinished = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里最关键的一个部分就是 bezierCurveTo，这里传入的是绘制贝塞尔曲线的参数坐标，那这些坐标怎么生成的呢，这里是利用了数学上的一个桃心线方程，如图所示： <img src="https://ws3.sinaimg.cn/large/006tKfTcly1g06493zp47j30x30u0h2f.jpg" alt="贝塞尔曲线"> 其中心形线的解析方程为： <script type="math/tex">x = 16(sint)^3 \\ y = 13cost-5cos2t-2cos3t-cos4t</script> 这个公式代表了绘制坐标点的 x、y 的解析方程，用代码表示出来就是：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">function</span> get<span class="constructor">HeartPoint(<span class="params">c</span>)</span> &#123;</span><br><span class="line">    var b = c<span class="operator"> / </span>Math.PI;</span><br><span class="line">    var a = <span class="number">19.5</span><span class="operator"> * </span>(<span class="number">16</span><span class="operator"> * </span><span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>pow(<span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>sin(b), <span class="number">3</span>));</span><br><span class="line">    var d = -<span class="number">20</span><span class="operator"> * </span>(<span class="number">13</span><span class="operator"> * </span><span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>cos(b) - <span class="number">5</span><span class="operator"> * </span><span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>cos(<span class="number">2</span><span class="operator"> * </span>b) - <span class="number">2</span><span class="operator"> * </span><span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>cos(<span class="number">3</span><span class="operator"> * </span>b) - <span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>cos(<span class="number">4</span><span class="operator"> * </span>b));</span><br><span class="line">    return <span class="keyword">new</span> <span class="constructor">Array(<span class="params">offsetX</span> + <span class="params">a</span>, <span class="params">offsetY</span> + <span class="params">d</span>)</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里是生产了心形线方程的 x、y 坐标，然后再以此绘制出带有动画效果的心形。 最终呈现的效果就是现在你看到的样子。 不过这些在改代码的时候实际上不用关心，只需要修改你们在一起的时间就好了，就是代码中的这一行：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">together.setFullYear(<span class="number">2018</span>, <span class="number">10</span>, <span class="number">5</span>);</span><br><span class="line">together.setHours(<span class="number">15</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里修改你们在一起的时间和小时就可以了，然后页面就会自动更新你们在一起多久了，并动态呈现出来了。</p>
                  <h2 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h2>
                  <p>对于域名解析，这个建议大家可以申请一个域名，比如我的域名就是 cuiqingcai.com，我可以设置一个二级域名解析，叫做 love.cuiqingcai.com。 如果没有域名的话可以现买一个，比如阿里云、腾讯云购买，然后设置解析即可。 如果没有域名，也可以使用一些虚拟云服务器，他们会帮你设置二级域名，当然也可以使用 GitHub Pages，甚至你使用 IP 地址来访问也是没问题的。</p>
                  <h2 id="项目代码"><a href="#项目代码" class="headerlink" title="项目代码"></a>项目代码</h2>
                  <p>项目的代码我都放在了：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dlcm1leS9WYWxlbnRpbmVzRGF577yM5aSn5a625Y+v5Lul6Ieq6KGM5L+u5pS55oiQ5oOz6KaB55qE5qC35a2Q6YCB57uZ5aWz5pyL5Y+L77yM5Y+q6IO95biu5L2g5Yiw6L+Z6YeM5ZWm44CC">https://github.com/Germey/ValentinesDay，大家可以自行修改成想要的样子送给女朋友，只能帮你到这里啦。<i class="fa fa-external-link-alt"></i></span> 嘿嘿，这就是我今天送给女朋友的礼物，女朋友收到了开心得不得了，开心。</p>
                  <h2 id="我的礼物"><a href="#我的礼物" class="headerlink" title="我的礼物"></a>我的礼物</h2>
                  <p>其实我今天也收到了女朋友送的特殊的礼物，可以说她确实花了不少心思啊，她送了我什么呢？令我没想到的是，她居然刚申请了一个微店，然后她微店上架了好多商品，我看到时候惊呆了，店铺如图所示： <img src="https://ws2.sinaimg.cn/large/006tKfTcly1g064lc6433j30u01hck6t.jpg" alt="image-20190214182451019"> 里面上架了什么商品？洗水果服务？做饭刷碗服务？捏肩膀服务？还有自动哄老婆机？我惊了。 她把商品发给我，我好奇问她这是干嘛的。 她说：要获得我的洗水果服务，捏肩膀服务，只需要在我的小店里购买使用就好了（作掐腰状）！还有自动哄老婆机，你要惹我生气了，只需要购买一个自动哄老婆机，我就会不生气了！嘿嘿合不合算？ <img src="https://ws4.sinaimg.cn/large/006tKfTcly1g0652dxmglj30cg0ck0zf.jpg" alt=""> 我说：多少钱？999！这么贵的吗！ 她说：当然不是啦，亲亲我们店里有活动的，使用优惠券满 999 减 998 呢，您是我的 VIP 唯一专属客户，我会给您发优惠券的呀，使用优惠券只需要一块钱就可以购买了。购买之后，您每次使用一张，我就可以给您洗水果、捏肩膀了！这个情人节的话呢，我要送亲亲 10 张！可省着点话，不能累到店长我啊！ 哦哦，卧槽真牛逼啊！于是乎我就快快乐乐领取到了十张优惠券购买了女朋友的这些服务，等着时不时用一张，享受一下帝王级的待遇，美滋滋！哈哈~ 最后，祝大家情人节快乐！幸福！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-02-21 09:50:13" itemprop="dateCreated datePublished" datetime="2019-02-21T09:50:13+08:00">2019-02-21</time>
                </span>
                <span id="/6462.html" class="post-meta-item leancloud_visitors" data-flag-title="程序猿的情人节怎么过？" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>5.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6457.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/6457.html" class="post-title-link" itemprop="url">分享一套 MacBook 高效开发工具</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>作为一名程序员，能够利用好工具提高开发和工作效率是非常重要的。我个人使用的都是苹果系列产品，电脑为 MacBook Pro 15 寸，手机 iPhone 7P，另外还有一个 iPad Pro 和一副 Apple Watch。我一直觉得 Mac 是非常适合做程序开发的，它既有比较不错的页面，也有类 Unix 的操作系统，使得日常使用和程序开发都极其便利，另外由于苹果本身自有的 iCloud 机制，使用 Mac、iPhone、iPad 跨平台开发和工作也变得十分便利。</p>
                  <p>近期我又对自己的一些工具进行了整理，弃用了一些工具，新启用了一些工具。目的也只有一个，就是提高自己的工作和开发效率，让生活变得更美好。如果你也在用 Mac 开发，或者你也有使用 iPad、iPhone，下面我所总结的个人的一些工具或许能给你带来帮助。</p>
                  <h2 id="快速导航"><a href="#快速导航" class="headerlink" title="快速导航"></a>快速导航</h2>
                  <p>这是 Mac 上的一个工具，要说到提高效率，首推 Alfred，可以说是 Mac 必备软件，利用它我们可以快速地进行各种操作，大幅提高工作效率，如快速打开某个软件、快速打开某个链接、快速搜索某个文档，快速定位某个文件，快速查看本机 IP，快速定义某个色值，几乎我们能想到的都能对接实现。</p>
                  <p>其实 Mac 本身已经自带了软件搜索还有 Spotlight，但是其功能还是远远比不上 Alfred，有了它，所有的快捷操作几乎都能实现。</p>
                  <p>这些快速功能是怎么实现的呢？实际上是 Alfred 对接了很多 Workflow，我们可以使用 Workflow 方便地进行功能扩展，一些比较优秀的 Workflow 已经有人专门做过整理了，可以参见：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3plbm9yb2NoYS9hbGZyZWQtd29ya2Zsb3dz">https://github.com/zenorocha/alfred-workflows<i class="fa fa-external-link-alt"></i></span>，大家可以安装自己所需要的 Workflow，大大提高效率。</p>
                  <h2 id="复制粘贴"><a href="#复制粘贴" class="headerlink" title="复制粘贴"></a>复制粘贴</h2>
                  <p>Mac 上默认只有一个粘贴板，当我们新复制了一段文字之后，如果我们想再找寻之前复制的历史记录就找不到了，这其实是很反人类的。</p>
                  <p>好在 Paste 这款软件帮我们解决了这个问题，它可以保存我们粘贴板的历史记录，等需要粘贴某个内容的时候只需要呼出 Paste 历史粘贴板，然后选择某个特定的内容粘贴就好了，另外它还支持文本格式调整粘贴板分类和搜索，还可以支持快速便捷粘贴。有了它，再也不用担心粘贴板丢失了！</p>
                  <p>另外使用 Mac 和 iPhone、iPad 之间也可以相互之间复制粘贴，可以在一台 Apple 设备上拷贝文本、图像、照片和视频，然后在另一台 Apple 设备上粘贴该内容。例如，可以拷贝在 Mac 上浏览网页时发现的食谱，然后将其粘贴到附近 iPhone 上“备忘录”中的购物清单。这是在 macOS Sierra 版本之后出来的功能，若要使用需要确保 Mac 的版本是 Sierra 及以后。若要使用，几个设备必须满足“连续互通”系统要求。它们还必须在“系统偏好设置”（在 Mac 上）和“设置”（在 iOS 设备上）中打开 Wi-Fi、蓝牙和 Handoff，另外必须在所有设备上使用同一 Apple ID登录 iCloud。</p>
                  <p>具体的操作流程可以参见苹果的官网说明：<span class="exturl" data-url="aHR0cHM6Ly9zdXBwb3J0LmFwcGxlLmNvbS9rYi9QSDI1MTY4">https://support.apple.com/kb/PH25168<i class="fa fa-external-link-alt"></i></span>，有了这个功能，日常的一些操作便可以直接同步了，甚至不再需要 AirDrop，更不需要微信和邮件。</p>
                  <h2 id="时间管理"><a href="#时间管理" class="headerlink" title="时间管理"></a>时间管理</h2>
                  <p>现在这个时候，时间比什么都重要，每个人的时间都是公平的，如果我们能够合理规划好自己的时间和工作，这就跨出了成功的一步。</p>
                  <p>我曾经尝试用手写的方式来记录自己的一些任务，但总感觉它有一些并不方便的地方。比如某时某刻突然想起来，想要添加一件事情或者完成了一件事情，或者想要修改截止时间，或者想要划分优先级，其实都不怎么方便。最好的方式还是通过一些专用的时间管理软件来分配分配和管理自己的时间。</p>
                  <p>我曾经使用过非常多款时间管理工具，最终我选择的是 Todoist，这个是我感觉体验非常不错的一款。这个软件里面基本的任务添加与勾划功能当然必不可少，它也支持优先级管理，分类管理，时间设置，另外还有几个我觉得非常加分的几个点，比如：</p>
                  <ul>
                    <li>
                      <p>添加时间时可以直接通过一句话来添加，比如”每隔两天晚上九点运动”，它会自动识别并设置为循环任务，并能在相应的时刻提醒你。</p>
                    </li>
                    <li>
                      <p>支持全部平台，不论是网页还是 Windows、Mac、Android、iPhone、iPad、Apple Watch、Chrome、Firefox，你能想到的平台，应有尽有。</p>
                    </li>
                    <li>
                      <p>它还支持事件同步，可以在 Mac 或者 iPhone 的日历中添加 Todoist 的同步，这样你所有的事情都会被定时同步到日历软件中，这样日历中就既包含了节日、生日等信息，又可以把每天我们需要做的事同步进来，日程信息一目了然。这样你就可以把日历变成一个提醒器，设置什么时候提醒就好了，现在我就在用 Mac 或者 iPhone 上的日历来提醒我什么时间该做什么事情了。</p>
                    </li>
                    <li>
                      <p>它还支持多人写作，就类似于 Worktile、Teambition、Trello，我曾经使用这款软件完成了多个项目的任务分配和多人协作开发，还是非常方便的。</p>
                    </li>
                    <li>
                      <p>另外它还支持过期智能重新安排任务，比如有一些任务没有完成，它还可以根据优先级来重新进行时间规划和安排，同时也有任务评分和目标评价机制，来反映我们任务完成情况。</p>
                    </li>
                  </ul>
                  <p>另外关于时间管理还有一个非常重要的四象限法则，大家也可以了解一下。有了这个法则，大家可以合理安排优先级，合理分配每个任务的时间。有关于我的时间管理经验我后面还会详细写一篇相关的文章，介绍一下我平时会怎样进行时间规划和学习的。</p>
                  <p>另外我还尝试过番茄土豆这个软件，这个软件的缺点在于整体的功能还比较简陋，而且不能和我已有的 Todo List 进行同步。好处就是可以自己设置番茄，保持专注工作。但目前我尚未发现满意的产品，如有还希望大家可以留言推荐一下，谢谢。</p>
                  <h2 id="笔记记录"><a href="#笔记记录" class="headerlink" title="笔记记录"></a>笔记记录</h2>
                  <p>在学习的时候来进行记录是非常非常重要的，强烈建议一边学习一边把所做所想记录下来，最后做一下整理成文。一方面方便查阅，另一方面加深印象和理解。</p>
                  <p>Markdown 想必大家都已经很耳熟了，现在我写文章或者笔记几乎全都用 Markdown 来写，现在很多云笔记也慢慢逐步支持 Markdown 的语法了，我的博客后台也自己配置了 Markdown 的支持。不过也有某些平台尚未支持 Markdown，比如知乎，忍不住吐槽一句，知乎的编辑器实在用得是心累，当然可以使用插件来解决，也当然也有所好，我就不再说什么了。不过我还是强烈推荐 Markdown 来进行写作和记录的，用过之后你可能就不再想用 Word 了。</p>
                  <p>言归正传，既然谈到笔记和写作。我的笔记本是 Mac，之前几乎所有的笔记，包括写书，都几乎是在 Mac 上完成的，但是确实有的时候是不方便的。比如 Mac 不在身边或者想用 iPhone 或者 iPad 来写点东西的时候，一个需要解决的问题就是云同步问题。有了云同步，我们如果在电脑上写了一部分内容，接着切换了另一台台式机，或者切换了手机的时候，照样能够接着在原来的基础上写，非常方便。</p>
                  <p>这时候可能就有小伙伴推荐有道云笔记、印象笔记等软件，它们支持 Markdown，但这并不是它们的主打支持方向，对 Makrdown 的支持当然没有一些专业的 Makrdown 编辑工具专业。对我个人而言，我不想因为它们自带了云同步而抛弃了纯粹的 Makrdown 写作环境，我只想要一个纯粹的 Makrdown 写作环境，而不想引入比如有道云里面的普通笔记、签到等冗余的功能，也不想看到里面的广告推荐等内容。所以对于云同步，我使用了另外的解决方案。对于写作软件，我也摸索出了自己的一套方案。</p>
                  <p>对于电脑端的 Markdown 写作软件，推荐两款，一款是 Typora，另一款是 MarkEditor。</p>
                  <p>对于 Makrdown 编辑器来说，我觉得有几个比较重要的点：</p>
                  <ul>
                    <li>
                      <p>不能纯写 Makrdown，要实时地能够看到自己写完 Makrdown 之后最终呈现的效果是怎样的。</p>
                    </li>
                    <li>
                      <p>插入图片要方便，很多编辑器需要先将图片挪到某个文件夹下或者上传图片才可以插入图片，这是很不友好的，如果能够直接通过复制粘贴的形式插入图片，甚至能够自动将图片上传到云端，那就再好不过了。</p>
                    </li>
                    <li>
                      <p>能够打开一整个 Makrdown 文件夹，左侧显示文件列表，右侧进行写作编辑，不能仅仅支持一个 Markdown 文件的编辑。</p>
                    </li>
                    <li>
                      <p>如果需要用到公司，那么编辑器需要对 Markdown 公式支持比较好。</p>
                    </li>
                  </ul>
                  <p>以上介绍的这两款软件都可以做到。</p>
                  <ul>
                    <li>
                      <p>Typora 是免费的，更加轻量级，而且支持即写即得，界面支持和公式支持都比较好，图片的话可以结合 iPic 软件直接上传到图床，同时也可以直接将复制的图片直接粘贴到编辑器中，非常友好，目前我正在使用。</p>
                    </li>
                    <li>
                      <p>MarkEditor 是收费的，功能更为丰富，支持左右分栏模式、阅读模式等，它也支持直接复制和粘贴图片，另外还有强大的导出功能，还可以直接将文件发布为一个网站等等，也十分推荐。</p>
                    </li>
                  </ul>
                  <p>不过目前由于 Typora 更轻量级，并且能和 iPic 而且功能配合使用，粘贴后的图片可以点击直接上传到云端，非常方便，我目前已经由 MarkEditor 切换到 Typora 了。</p>
                  <p>写作界面如下：</p>
                  <p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1g0508a70joj31jw0u0au6.jpg" alt=""></p>
                  <p>如图这是打开了一个文件夹，这个文件夹里面有好多 Makrdown 文件，都是我在研究和学习过程中所写的笔记。</p>
                  <p>然后需要解决的就是云同步问题，云同步其实使用网盘就足够了。由于我使用 Mac，所以我选用了 iCloud，开了 200G 的空间，足够了。这样我所记录的内容能够秒级同步到 iCloud Drive 中，这样我再使用 iPhone、iPad 就可以直接看到最新的内容了。当然还有一些推荐的，比如 OneDrive、谷歌云等多种云盘同步工具，哪个方便用哪个。Mac 和 iPhone 的好处就是已经内置了 iCloud Drive，所以不用再去在各个终端上配置了。</p>
                  <p>接下来就是在其他的电脑以及 iPhone、iPad 上进行写作的解决方案了。由于我的文件都已经存放在了 iCloud Drive，所以就需要一款 Makrdown 编辑软件可以直接读写 iCloud Drive 里面的内容，同时界面还要友好，功能完善一点。在这里我最终选择了 Markdown Pro，它的功能简洁但是又比较完善，打开之后直接选取 iCloud Drive 里面的 Makrdown 文件即可开始编辑，并且它是左右分栏的，即左侧编辑，右侧预览，非常方便简洁，另外它对公式的支持也很好，下图是我在 iPad 上对本文进行编辑的效果预览图。</p>
                  <p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1g055n71vrvj31400u0npd.jpg" alt=""></p>
                  <p>对于图片的插入，在 iPhone 和 iPad 上我借助了另外一个工具，叫做 SM.MS，这个软件可以直接选取图片，然后上传到云端，点击复制即可得到链接和 Makrdown 图片链接，所以插图也不是什么问题了。</p>
                  <p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1g0578rt4s6j30u01hcnpd.jpg" alt=""></p>
                  <p>如图所示，上传照片之后，便会出现各种各样的图片链接形式，有纯链接、HTML、Markdown 等等，直接点击复制按钮即可复制，然后粘贴到文档中。</p>
                  <p>另外如果你用了 Windows 的话，只要下载一个 iCloud 云盘软件即可同步。如果使用的是其他的云盘软件，也只需要配置一下就好了。</p>
                  <p>有了这套，我们就可以实现随时随地写笔记，Mac、iPhone、iPad 无缝切换。</p>
                  <h2 id="思维导图"><a href="#思维导图" class="headerlink" title="思维导图"></a>思维导图</h2>
                  <p>很多时候我们在构思方案或者流程的时候需要对思维做梳理，或者在列方案呈现的时候也需要分门别类地进行呈现。这时候大多数情况下就需要用到一个工具，思维导图。</p>
                  <p>思维导图工具我个人使用的是 MindNode，在 Mac 上用它可以通过各种快捷键快速的增删思维导图节点，另外界面也非常绚丽多彩。</p>
                  <p>对于思维导图软件来说，我也希望能全平台同步，其实 MindNode 也有对应的移动端软件，同样是 MindNode，二者可以通过 iCloud Drive 进行同步，同样可以做到无缝衔接。</p>
                  <p>另外还有很多朋友也在用 XMind，功能同样很强大，大家也可以试试。</p>
                  <h2 id="远程控制"><a href="#远程控制" class="headerlink" title="远程控制"></a>远程控制</h2>
                  <p>我们经常会和各种服务器打交道，例如我们经常使用 SSH 来远程连接某台 Linux 服务器，原生 Terminal 是支持 SSH 的，但你会发现原生带的这个太难用了。可能很多小伙伴使用 iTerm，不得不说这确实是个神器，大大方便了远程管理流程。但我在这里还要推荐一个我经常使用的 SSH Shell，没错，它的名字就是 SSH Shell，它的页面操作简洁，同时管理和记录远程主机十分方便，另外还支持秘钥管理、自动重连、自定义主题等等功能，个人用起来十分顺手，强烈推荐！</p>
                  <p>当然除了电脑，当我们出去在外的时候，紧急情况也可能需要使用 SSH 来连接和管理我们的服务器，所以我也在 iPhone 和 iPad 上装了远程管理软件，叫做 Termius，同样功能十分强大，快捷操作十分便捷，有免费的试用期限，我觉得非常好用就订购了，推荐给大家。</p>
                  <p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1g057v8tli7j30u01hc46y.jpg" alt=""></p>
                  <h2 id="代码记录"><a href="#代码记录" class="headerlink" title="代码记录"></a>代码记录</h2>
                  <p>作为一名程序员，我们会经常写或者使用一些关键代码。</p>
                  <p>比如有一天我写了一些方法，这些方法可以完成非常重要的功能，后面的项目也会经常遇到，那么怎么办呢？很多情况下我们想把它保存起来，放到某个收藏夹里面备用，等到用的时候重新把它复制出来。或者有一些繁琐的命令，我实在是记不住，或许我们也想把它记录下来。</p>
                  <p>很多情况下，我们可能简单地使用文本文件，但并不方便同步和查找。或者云笔记保存下来，但这些并不是专门用来保存代码的。更高级一点，我们会联想到使用 GitHub Gists，但每次记录的这个流程也比较麻烦。</p>
                  <p>这里推荐一个专门用来记录代码片段的软件，叫做 SnippetsLab，适用于 Mac 系统，可以专门用来管理代码片段，还支持多种代码格式。比如我就将代码按照编程语言划分，划分为 Python、JavaScript 等等，分文件夹存储，有不错的代码就随手贴过来，另外它也支持搜索，管理代码非常方便。如果某一天想查某个代码了，直接打开它一搜就有了，可以大大提高开发效率。</p>
                  <p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1g0579amrgyj31f70u0dq4.jpg" alt=""></p>
                  <p>以上就暂且总结这么多，其实还有不少好用的用具，后面再一一为大家总结分享。</p>
                  <p>另外再问下大家，你们买 iPad 了吗？是不是觉得比较鸡肋，或者平时都用不上，那这样就没有发挥 iPad 的最大效用，如果利用好了，它可以进一步方便我们的生活，后面我也会专门写一下 iPad 方面的一些用途。</p>
                  <p>由于水平和见识有限，如果大家有更好的软件或者方案推荐，欢迎大家留言！也希望我的一些方案对大家有所帮助，谢谢！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-02-21 09:19:30" itemprop="dateCreated datePublished" datetime="2019-02-21T09:19:30+08:00">2019-02-21</time>
                </span>
                <span id="/6457.html" class="post-meta-item leancloud_visitors" data-flag-title="分享一套 MacBook 高效开发工具" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>5.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6454.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6454.html" class="post-title-link" itemprop="url">还在一个个写规则？来了解下爬虫的智能化解析吧！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>爬虫是做什么的？是帮助我们来快速获取有效信息的。然而做过爬虫的人都知道，解析是个麻烦事。 比如一篇新闻吧，链接是这个：<span class="exturl" data-url="aHR0cHM6Ly9uZXdzLmlmZW5nLmNvbS9jLzdrUWNRRzJwZVdV77yM6aG16Z2i6aKE6KeI5Zu+5aaC5LiL77ya">https://news.ifeng.com/c/7kQcQG2peWU，页面预览图如下：<i class="fa fa-external-link-alt"></i></span> <img src="https://ws2.sinaimg.cn/large/006tKfTcly1g0cwc0n5u9j30w10no4ho.jpg" alt="预览图"> 我们需要从页面中提取出标题、发布人、发布时间、发布内容、图片等内容。一般情况下我们需要怎么办？写规则。 那么规则都有什么呢？怼正则，怼 CSS 选择器，怼 XPath。我们需要对标题、发布时间、来源等内容做规则匹配，更有甚者再需要正则表达式来辅助一下。我们可能就需要用 re、BeautifulSoup、pyquery 等库来实现内容的提取和解析。 但如果我们有成千上万个不同样式的页面怎么办呢？它们来自成千上万个站点，难道我们还需要对他们一一写规则来匹配吗？这得要多大的工作量啊。另外这些万一弄不好还会解析有问题。比如正则表达式在某些情况下匹配不了了，CSS、XPath 选择器选错位了也会出现问题。 想必大家可能见过现在的浏览器有阅读模式，比如我们把这个页面用 Safari 浏览器打开，然后开启阅读模式，看看什么效果： <img src="https://ws4.sinaimg.cn/large/006tKfTcly1g0cwgg60joj30mg0odwtt.jpg" alt="Safari预览"> 页面一下子变得非常清爽，只保留了标题和需要读的内容。原先页面多余的导航栏、侧栏、评论等等的统统都被去除了。它怎么做到的？难道是有人在里面写好规则了？那当然不可能的事。其实，这里面就用到了智能化解析了。 那么本篇文章，我们就来了解一下页面的智能化解析的相关知识。</p>
                  <h2 id="智能化解析"><a href="#智能化解析" class="headerlink" title="智能化解析"></a>智能化解析</h2>
                  <p>所谓爬虫的智能化解析，顾名思义就是不再需要我们针对某一些页面来专门写提取规则了，我们可以利用一些算法来计算出来页面特定元素的位置和提取路径。比如一个页面中的一篇文章，我们可以通过算法计算出来，它的标题应该是什么，正文应该是哪部分区域，发布时间是什么等等。 其实智能化解析是非常难的一项任务，比如说你给人看一个网页的一篇文章，人可以迅速找到这篇文章的标题是什么，发布时间是什么，正文是哪一块，或者哪一块是广告位，哪一块是导航栏。但给机器来识别的话，它面临的是什么？仅仅是一系列的 HTML 代码而已。那究竟机器是怎么做到智能化提取的呢？其实这里面融合了多方面的信息。</p>
                  <ul>
                    <li>比如标题。一般它的字号是比较大的，而且长度不长，位置一般都在页面上方，而且大部分情况下它应该和 title 标签里的内容是一致的。</li>
                    <li>比如正文。它的内容一般是最多的，而且会包含多个段落 p 或者图片 img 标签，另外它的宽度一般可能会占用到页面的三分之二区域，并且密度（字数除以标签数量）会比较大。</li>
                    <li>比如时间。不同语言的页面可能不同，但时间的格式是有限的，如 2019-02-20 或者 2019/02/20 等等，也有的可能是美式的记法，顺序不同，这些也有特定的模式可以识别。</li>
                    <li>比如广告。它的标签一般可能会带有 ads 这样的字样，另外大多数可能会处于文章底部、页面侧栏，并可能包含一些特定的外链内容。</li>
                  </ul>
                  <p>另外还有一些特点就不再一一赘述了，这其中包含了区块位置、区块大小、区块标签、区块内容、区块疏密度等等多种特征，另外很多情况下还需要借助于视觉的特征，所以说这里面其实结合了算法计算、视觉处理、自然语言处理等各个方面的内容。如果能把这些特征综合运用起来，再经过大量的数据训练，是可以得到一个非常不错的效果的。</p>
                  <h2 id="业界进展"><a href="#业界进展" class="headerlink" title="业界进展"></a>业界进展</h2>
                  <p>未来的话，页面也会越来越多，页面的渲染方式也会发生很大的变化，爬虫也会越来越难做，智能化爬虫也将会变得越来越重要。 目前工业界，其实已经有落地的算法应用了。经过我的一番调研，目前发现有这么几种算法或者服务对页面的智能化解析做的比较好：</p>
                  <ul>
                    <li>Diffbot，国外的一家专门来做智能化解析服务的公司，<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGlmZmJvdC5jb20=">https://www.diffbot.com<i class="fa fa-external-link-alt"></i></span></li>
                    <li>Boilerpipe，Java 语言编写的一个页面解析算法，<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2tvaGxzY2h1dHRlci9ib2lsZXJwaXBl">https://github.com/kohlschutter/boilerpipe<i class="fa fa-external-link-alt"></i></span></li>
                    <li>Embedly，提供页面解析服务的公司，<span class="exturl" data-url="aHR0cHM6Ly9lbWJlZC5seS9leHRyYWN0">https://embed.ly/extract<i class="fa fa-external-link-alt"></i></span></li>
                    <li>Readability，是一个页面解析算法，但现在官方的服务已经关闭了，<span class="exturl" data-url="aHR0cHM6Ly93d3cucmVhZGFiaWxpdHkuY29tLw==">https://www.readability.com/<i class="fa fa-external-link-alt"></i></span></li>
                    <li>Mercury，Readability 的替代品，<span class="exturl" data-url="aHR0cHM6Ly9tZXJjdXJ5LnBvc3RsaWdodC5jb20v">https://mercury.postlight.com/<i class="fa fa-external-link-alt"></i></span></li>
                    <li>Goose，Java 语音编写的页面解析算法，<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dyYXZpdHlMYWJzL2dvb3Nl">https://github.com/GravityLabs/goose<i class="fa fa-external-link-alt"></i></span></li>
                  </ul>
                  <p>那么这几种算法或者服务到底哪些好呢，Driffbot 官方曾做过一个对比评测，使用 Google 新闻的一些文章，使用不同的算法依次摘出其中的标题和文本，然后与真实标注的内容进行比较，比较的指标就是文字的准确率和召回率，以及根据二者计算出的 F1 分数。 其结果对比如下：</p>
                  <p>Service/Software</p>
                  <p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGlmZmJvdC5jb20vYmVuZWZpdHMvY29tcGFyaXNvbi8jZGVmaW5pdGlvbnM=">Precision<i class="fa fa-external-link-alt"></i></span></p>
                  <p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGlmZmJvdC5jb20vYmVuZWZpdHMvY29tcGFyaXNvbi8jZGVmaW5pdGlvbnM=">Recall<i class="fa fa-external-link-alt"></i></span></p>
                  <p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGlmZmJvdC5jb20vYmVuZWZpdHMvY29tcGFyaXNvbi8jZGVmaW5pdGlvbnM=">F1-Score<i class="fa fa-external-link-alt"></i></span></p>
                  <p><strong>Diffbot</strong></p>
                  <p>0.968</p>
                  <p>0.978</p>
                  <p>0.971</p>
                  <p><span class="exturl" data-url="aHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9ib2lsZXJwaXBlLw==">Boilerpipe<i class="fa fa-external-link-alt"></i></span></p>
                  <p>0.893</p>
                  <p>0.924</p>
                  <p>0.893</p>
                  <p><span class="exturl" data-url="aHR0cHM6Ly93d3cucmVhZGFiaWxpdHkuY29tLw==">Readability<i class="fa fa-external-link-alt"></i></span></p>
                  <p>0.819</p>
                  <p>0.911</p>
                  <p>0.854</p>
                  <p><span class="exturl" data-url="aHR0cDovL3d3dy5hbGNoZW15YXBpLmNvbS8=">AlchemyAPI<i class="fa fa-external-link-alt"></i></span></p>
                  <p>0.876</p>
                  <p>0.892</p>
                  <p>0.850</p>
                  <p><span class="exturl" data-url="aHR0cDovL2VtYmVkLmx5Lw==">Embedly<i class="fa fa-external-link-alt"></i></span></p>
                  <p>0.786</p>
                  <p>0.880</p>
                  <p>0.822</p>
                  <p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dyYXZpdHlMYWJzL2dvb3Nl">Goose<i class="fa fa-external-link-alt"></i></span></p>
                  <p>0.498</p>
                  <p>0.815</p>
                  <p>0.608</p>
                  <p>经过对比我们可以发现，Diffbot 的准确率和召回率都独占鳌头，其中的 F1 值达到了 0.97，可以说准确率非常高了。另外接下来比较厉害的就是 Boilerpipe 和 Readability，Goose 的表现则非常差，F1 跟其他的算法差了一大截。下面是几个算法的 F1 分数对比情况： <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1g0d4cv31noj30yw0kstaa.jpg" alt="F1分数对比"> 有人可能好奇为什么 Diffbot 这么厉害？我也查询了一番。Diffbot 自 2010 年以来就致力于提取 Web 页面数据，并提供许多 API 来自动解析各种页面。其中他们的算法依赖于自然语言技术、机器学习、计算机视觉、标记检查等多种算法，并且所有的页面都会考虑到当前页面的样式以及可视化布局，另外还会分析其中包含的图像内容、CSS 甚至 Ajax 请求。另外在计算一个区块的置信度时还考虑到了和其他区块的关联关系，基于周围的标记来计算每个区块的置信度。 总之，Diffbot 也是一直致力于这一方面的服务，整个 Diffbot 就是页面解析起家的，现在也一直专注于页面解析服务，准确率高也就不足为怪了。 但它们的算法开源了吗？很遗憾，并没有，而且我也没有找到相关的论文介绍它们自己的具体算法。 所以，如果想实现这么好的效果，那就使用它们家的服务就好了。 接下来的内容，我们就来说说如何使用 Diffbot 来进行页面的智能解析。另外还有 Readability 算法也非常值得研究，我会写专门的文章来介绍 Readability 及其与 Python 的对接使用。</p>
                  <h2 id="Diffbot-页面解析"><a href="#Diffbot-页面解析" class="headerlink" title="Diffbot 页面解析"></a>Diffbot 页面解析</h2>
                  <p>首先我们需要注册一个账号，它有 15 天的免费试用，注册之后会获得一个 Developer Token，这就是使用 Diffbot 接口服务的凭证。 接下来切换到它的测试页面中，链接为：<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGlmZmJvdC5jb20vZGV2L2hvbWUv77yM5oiR5Lus5p2l5rWL6K+V5LiA5LiL5a6D55qE6Kej5p6Q5pWI5p6c5Yiw5bqV5piv5oCO5qC355qE44CC">https://www.diffbot.com/dev/home/，我们来测试一下它的解析效果到底是怎样的。<i class="fa fa-external-link-alt"></i></span> 这里我们选择的测试页面就是上文所述的页面，链接为：<span class="exturl" data-url="aHR0cHM6Ly9uZXdzLmlmZW5nLmNvbS9jLzdrUWNRRzJwZVdV77yMQVBJ">https://news.ifeng.com/c/7kQcQG2peWU，API<i class="fa fa-external-link-alt"></i></span> 类型选择 Article API，然后点击 Test Drive 按钮，接下来它就会出现当前页面的解析结果： <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1g0d4u30pjij30v70lhq57.jpg" alt="结果"> 这时候我们可以看到，它帮我们提取出来了标题、发布时间、发布机构、发布机构链接、正文内容等等各种结果。而且目前来看都十分正确，时间也自动识别之后做了转码，是一个标准的时间格式。 接下来我们继续下滑，查看还有什么其他的字段，这里我们还可以看到有 html 字段，它和 text 不同的是，它包含了文章内容的真实 HTML 代码，因此图片也会包含在里面，如图所示： <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1g0d4wnlzbhj30uv0k3490.jpg" alt="结果"> 另外最后面还有 images 字段，他以列表形式返回了文章套图及每一张图的链接，另外还有文章的站点名称、页面所用语言等等结果，如图所示： <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1g0d4yai8qqj30uf0l0q7v.jpg" alt="结果"> 当然我们也可以选择 JSON 格式的返回结果，其内容会更加丰富，例如图片还返回了其宽度、高度、图片描述等等内容，另外还有各种其他的结果如面包屑导航等等结果，如图所示： <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1g0d500i671j30tn0fx0ue.jpg" alt="结果"> 经过手工核对，发现其返回的结果都是完全正确的，准确率相当之高！ 所以说，如果你对准确率要求没有那么非常非常严苛的情况下，使用 Diffbot 的服务可以帮助我们快速地提取页面中所需的结果，省去了我们绝大多数的手工劳动，可以说是非常赞了。 但是，我们也不能总在网页上这么试吧。其实 Diffbot 也提供了官方的 API 文档，让我们来一探究竟。</p>
                  <h2 id="Diffbot-API"><a href="#Diffbot-API" class="headerlink" title="Diffbot API"></a>Diffbot API</h2>
                  <p>Driffbot 提供了多种 API，如 Analyze API、Article API、Disscussion API 等。 下面我们以 Article API 为例来说明一下它的用法，其官方文档地址为：<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGlmZmJvdC5jb20vZGV2L2RvY3MvYXJ0aWNsZS/vvIxBUEk=">https://www.diffbot.com/dev/docs/article/，API<i class="fa fa-external-link-alt"></i></span> 调用地址为：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">https:<span class="regexp">//</span>api.diffbot.com<span class="regexp">/v3/</span>article</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们可以用 GET 方式来进行请求，其中的 Token 和 URL 都可以以参数形式传递给这个 API，其必备的参数有：</p>
                  <ul>
                    <li>token：即 Developer Token</li>
                    <li>url：即要解析的 URL 链接</li>
                  </ul>
                  <p>另外它还有几个可选参数：</p>
                  <ul>
                    <li>fields：用来指定返回哪些字段，默认已经有了一些固定字段，这个参数可以指定还可以额外返回哪些可选字段</li>
                    <li>paging：如果是多页文章的话，如果将这个参数设置为 false 则可以禁止多页内容拼接</li>
                    <li>maxTags：可以设置返回的 Tag 最大数量，默认是 10 个</li>
                    <li>tagConfidence：设置置信度的阈值，超过这个值的 Tag 才会被返回，默认是 0.5</li>
                    <li>discussion：如果将这个参数设置为 false，那么就不会解析评论内容</li>
                    <li>timeout：在解析的时候等待的最长时间，默认是 30 秒</li>
                    <li>callback：为 JSONP 类型的请求而设计的回调</li>
                  </ul>
                  <p>这里大家可能关注的就是 fields 字段了，在这里我专门做了一下梳理，首先是一些固定字段：</p>
                  <ul>
                    <li>type：文本的类型，这里就是 article 了</li>
                    <li>title：文章的标题</li>
                    <li>text：文章的纯文本内容，如果是分段内容，那么其中会以换行符来分隔</li>
                    <li>html：提取结果的 HTML 内容</li>
                    <li>date：文章的发布时间，其格式为 RFC 1123</li>
                    <li>estimatedDate：如果日期时间不太明确，会返回一个预估的时间，如果文章超过两天或者没有发布日期，那么这个字段就不会返回</li>
                    <li>author：作者</li>
                    <li>authorUrl：作者的链接</li>
                    <li>discussion：评论内容，和 Disscussion API 返回结果一样</li>
                    <li>humanLanguage：语言类型，如英文还是中文等</li>
                    <li>numPages：如果文章是多页的，这个参数会控制最大的翻页拼接数目</li>
                    <li>nextPages：如果文章是多页的，这个参数可以指定文章后续链接</li>
                    <li>siteName：站点名称</li>
                    <li>publisherRegion：文章发布地区</li>
                    <li>publisherCountry：文章发布国家</li>
                    <li>pageUrl：文章链接</li>
                    <li>resolvedPageUrl：如果文章是从 pageUrl 重定向过来的，则返回此内容</li>
                    <li>tags：文章的标签或者文章包含的实体，根据自然语言处理技术和 DBpedia 计算生成，是一个列表，里面又包含了子字段：<ul>
                        <li>label：标签名</li>
                        <li>count：标签出现的次数</li>
                        <li>score：标签置信度</li>
                        <li>rdfTypes：如果实体可以由多个资源表示，那么则返回相关的 URL</li>
                        <li>type：类型</li>
                        <li>uri：Diffbot Knowledge Graph 中的实体链接</li>
                      </ul>
                    </li>
                    <li>images：文章中包含的图片</li>
                    <li>videos：文章中包含的视频</li>
                    <li>breadcrumb：面包屑导航信息</li>
                    <li>diffbotUri：Diffbot 内部的 URL 链接</li>
                  </ul>
                  <p>以上的预定字段就是如果可以返回那就会返回的字段，是不能定制化配置的，另外我们还可以通过 fields 参数来指定扩展如下可选字段：</p>
                  <ul>
                    <li>quotes：引用信息</li>
                    <li>sentiment：文章的情感值，-1 到 1 之间</li>
                    <li>links：所有超链接的顶级链接</li>
                    <li>querystring：请求的参数列表</li>
                  </ul>
                  <p>好，以上便是这个 API 的用法，大家可以申请之后使用这个 API 来做智能化解析了。 下面我们用一个实例来看一下这个 API 的用法，代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests, json</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://api.diffbot.com/v3/article'</span></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">'token'</span>: <span class="string">'77b41f6fbb24496d5113d528306528fa'</span>,</span><br><span class="line">    <span class="string">'url'</span>: <span class="string">'https://news.ifeng.com/c/7kQcQG2peWU'</span>,</span><br><span class="line">    <span class="string">'fields'</span>: <span class="string">'meta'</span> </span><br><span class="line">&#125;</span><br><span class="line">response = requests.<span class="builtin-name">get</span>(url, <span class="attribute">params</span>=params)</span><br><span class="line"><span class="builtin-name">print</span>(json.dumps(response.json(), <span class="attribute">indent</span>=2, <span class="attribute">ensure_ascii</span>=<span class="literal">False</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先定义了 API 的链接，然后指定了 params 参数，即 GET 请求参数。 参数中包含了必选的 token、url 字段，也设置了可选的 fields 字段，其中 fields 为可选的扩展字段 meta 标签。 我们来看下运行结果，结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"request"</span>: &#123;</span><br><span class="line">    <span class="attr">"pageUrl"</span>: <span class="string">"https://news.ifeng.com/c/7kQcQG2peWU"</span>,</span><br><span class="line">    <span class="attr">"api"</span>: <span class="string">"article"</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: <span class="string">"sentiment, meta"</span>,</span><br><span class="line">    <span class="attr">"version"</span>: <span class="number">3</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"objects"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"date"</span>: <span class="string">"Wed, 20 Feb 2019 02:26:00 GMT"</span>,</span><br><span class="line">      <span class="attr">"images"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"naturalHeight"</span>: <span class="number">460</span>,</span><br><span class="line">          <span class="attr">"width"</span>: <span class="number">640</span>,</span><br><span class="line">          <span class="attr">"diffbotUri"</span>: <span class="string">"image|3|-1139316034"</span>,</span><br><span class="line">          <span class="attr">"url"</span>: <span class="string">"http://e0.ifengimg.com/02/2019/0219/1731DC8A29EB2219C7F2773CF9CF319B3503D0A1_size382_w690_h460.png"</span>,</span><br><span class="line">          <span class="attr">"naturalWidth"</span>: <span class="number">690</span>,</span><br><span class="line">          <span class="attr">"primary"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"height"</span>: <span class="number">426</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"author"</span>: <span class="string">"中国新闻网"</span>,</span><br><span class="line">      <span class="attr">"estimatedDate"</span>: <span class="string">"Wed, 20 Feb 2019 06:47:52 GMT"</span>,</span><br><span class="line">      <span class="attr">"diffbotUri"</span>: <span class="string">"article|3|1591137208"</span>,</span><br><span class="line">      <span class="attr">"siteName"</span>: <span class="string">"ifeng.com"</span>,</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"article"</span>,</span><br><span class="line">      <span class="attr">"title"</span>: <span class="string">"故宫，你低调点！故宫：不，实力已不允许我继续低调"</span>,</span><br><span class="line">      <span class="attr">"breadcrumb"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"link"</span>: <span class="string">"https://news.ifeng.com/"</span>,</span><br><span class="line">          <span class="attr">"name"</span>: <span class="string">"资讯"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"link"</span>: <span class="string">"https://news.ifeng.com/shanklist/3-35197-/"</span>,</span><br><span class="line">          <span class="attr">"name"</span>: <span class="string">"大陆"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"humanLanguage"</span>: <span class="string">"zh"</span>,</span><br><span class="line">      <span class="attr">"meta"</span>: &#123;</span><br><span class="line">        <span class="attr">"og"</span>: &#123;</span><br><span class="line">          <span class="attr">"og:time "</span>: <span class="string">"2019-02-20 02:26:00"</span>,</span><br><span class="line">          <span class="attr">"og:image"</span>: <span class="string">"https://e0.ifengimg.com/02/2019/0219/1731DC8A29EB2219C7F2773CF9CF319B3503D0A1_size382_w690_h460.png"</span>,</span><br><span class="line">          <span class="attr">"og:category "</span>: <span class="string">"凤凰资讯"</span>,</span><br><span class="line">          <span class="attr">"og: webtype"</span>: <span class="string">"news"</span>,</span><br><span class="line">          <span class="attr">"og:title"</span>: <span class="string">"故宫，你低调点！故宫：不，实力已不允许我继续低调"</span>,</span><br><span class="line">          <span class="attr">"og:url"</span>: <span class="string">"https://news.ifeng.com/c/7kQcQG2peWU"</span>,</span><br><span class="line">          <span class="attr">"og:description"</span>: <span class="string">"　　“我的名字叫紫禁城，快要600岁了，这上元的夜啊，总是让我沉醉，这么久了却从未停止。” 　　“重"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"referrer"</span>: <span class="string">"always"</span>,</span><br><span class="line">        <span class="attr">"description"</span>: <span class="string">"　　“我的名字叫紫禁城，快要600岁了，这上元的夜啊，总是让我沉醉，这么久了却从未停止。” 　　“重"</span>,</span><br><span class="line">        <span class="attr">"keywords"</span>: <span class="string">"故宫 紫禁城 故宫博物院 灯光 元宵节 博物馆 一票难求 元之 中新社 午门 杜洋 藏品 文化 皇帝 清明上河图 元宵 千里江山图卷 中英北京条约 中法北京条约 天津条约"</span>,</span><br><span class="line">        <span class="attr">"title"</span>: <span class="string">"故宫，你低调点！故宫：不，实力已不允许我继续低调_凤凰资讯"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"authorUrl"</span>: <span class="string">"https://feng.ifeng.com/author/308904"</span>,</span><br><span class="line">      <span class="attr">"pageUrl"</span>: <span class="string">"https://news.ifeng.com/c/7kQcQG2peWU"</span>,</span><br><span class="line">      <span class="attr">"html"</span>: <span class="string">"&lt;p&gt;“我的名字叫紫禁城，快要600岁了，这上元的夜啊，总是让我沉醉，这么久了却从未停止。...&lt;/blockquote&gt; &lt;/blockquote&gt;"</span>,</span><br><span class="line">      <span class="attr">"text"</span>: <span class="string">"“我的名字叫紫禁城，快要600岁了，这上元的夜啊，总是让我沉醉，这么久了却从未停止。”\\n“..."</span>,</span><br><span class="line">      <span class="attr">"authors"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"name"</span>: <span class="string">"中国新闻网"</span>,</span><br><span class="line">          <span class="attr">"link"</span>: <span class="string">"https://feng.ifeng.com/author/308904"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可见其返回了如上的内容，是一个完整的 JSON 格式，其中包含了标题、正文、发布时间等等各种内容。 可见，不需要我们配置任何提取规则，我们就可以完成页面的分析和抓取，得来全不费功夫。</p>
                  <h2 id="Diffbot-SDK"><a href="#Diffbot-SDK" class="headerlink" title="Diffbot SDK"></a>Diffbot SDK</h2>
                  <p>另外 Diffbot 还提供了几乎所有语言的 SDK 支持，我们也可以使用 SDK 来实现如上功能，链接为：<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGlmZmJvdC5jb20vZGV2L2RvY3MvbGlicmFyaWVzL++8jOWmguaenOWkp+WutuS9v+eUqA==">https://www.diffbot.com/dev/docs/libraries/，如果大家使用<i class="fa fa-external-link-alt"></i></span> Python 的话，可以直接使用 Python 的 SDK 即可，Python 的 SDK 链接为：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RpZmZib3QvZGlmZmJvdC1weXRob24tY2xpZW5044CC">https://github.com/diffbot/diffbot-python-client。<i class="fa fa-external-link-alt"></i></span> 这个库并没有发布到 PyPi，需要自己下载并导入使用，另外这个库是使用 Python 2 写的，其实本质上就是调用了 requests 库，如果大家感兴趣的话可以看一下。 下面是一个调用示例：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span><span class="built_in"> client </span>import DiffbotClient,DiffbotCrawl</span><br><span class="line"></span><br><span class="line">diffbot = DiffbotClient()</span><br><span class="line">token = <span class="string">'your_token'</span></span><br><span class="line">url = <span class="string">'http://shichuan.github.io/javascript-patterns/'</span></span><br><span class="line">api = <span class="string">'article'</span></span><br><span class="line">response = diffbot.request(url, token, api)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过这行代码我们就可以通过调用 Article API 来分析我们想要的 URL 链接了，返回结果是类似的。 具体的用法大家直接看下它的源码注释就一目了然了，还是很清楚的。 好，以上便是对智能化提取页面原理的基本介绍以及对 Diffbot 的用法的讲解，后面我会继续介绍其他的智能化解析方法以及一些相关实战，希望大家可以多多关注。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-02-21 09:17:06" itemprop="dateCreated datePublished" datetime="2019-02-21T09:17:06+08:00">2019-02-21</time>
                </span>
                <span id="/6454.html" class="post-meta-item leancloud_visitors" data-flag-title="还在一个个写规则？来了解下爬虫的智能化解析吧！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6431.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6431.html" class="post-title-link" itemprop="url">今天，我终于弄懂了字体反爬是个啥玩意！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="大家好，我是四毛，欢迎关注我的公众号。"><a href="#大家好，我是四毛，欢迎关注我的公众号。" class="headerlink" title="大家好，我是四毛，欢迎关注我的公众号。"></a>大家好，我是四毛，欢迎关注我的公众号。</h1>
                  <h1 id="有什么想要交流的可以在后台第一时间私我。"><a href="#有什么想要交流的可以在后台第一时间私我。" class="headerlink" title="有什么想要交流的可以在后台第一时间私我。"></a>有什么想要交流的可以在后台第一时间私我。</h1>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""></p>
                  <h2 id="今天的文章内容主要是关于字体反爬。"><a href="#今天的文章内容主要是关于字体反爬。" class="headerlink" title="今天的文章内容主要是关于字体反爬。"></a>今天的文章内容主要是关于字体反爬。</h2>
                  <p>目前已知的几个字体反爬的网站是猫眼，汽车之家，天眼查，起点中文网等等。 以前也看过这方面的文章，今天跟个老哥在交流的时候，终于实操了一把，弄懂了字体反爬是个啥玩意。下面听我慢慢道来。</p>
                  <h3 id="本文用到的第三方库"><a href="#本文用到的第三方库" class="headerlink" title="本文用到的第三方库"></a><strong>本文用到的第三方库</strong></h3>
                  <blockquote>
                    <p><strong>fontTools</strong></p>
                  </blockquote>
                  <h2 id="1、目标网站"><a href="#1、目标网站" class="headerlink" title="1、目标网站"></a><strong>1、目标网站</strong></h2>
                  <blockquote>
                    <p><strong>url = “<span class="exturl" data-url="aHR0cHM6Ly9zdS41OC5jb20vcXp0ZWNoLw==">https://su.58.com/qztech/<i class="fa fa-external-link-alt"></i></span>“</strong></p>
                  </blockquote>
                  <h2 id="2、反爬虫机制"><a href="#2、反爬虫机制" class="headerlink" title="2、反爬虫机制"></a><strong>2、反爬虫机制</strong></h2>
                  <p>网页上看见的 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/1.png" alt=""> 后台源代码里面的 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/2.png" alt=""> 从上面可以看出，生这个字变成了乱码，请大家特别注意箭头所指的数字。 </p>
                  <h2 id="3、解决"><a href="#3、解决" class="headerlink" title="3、解决"></a><strong>3、解决</strong></h2>
                  <h3 id="1、确定反爬方法"><a href="#1、确定反爬方法" class="headerlink" title="1、确定反爬方法"></a><strong>1、确定反爬方法</strong></h3>
                  <p>在看了别人的解析文章之后，确定采取的是<strong>字体反爬机制</strong>，即网站定义了字体文件，然后进行相应的查找替换，在前端看起来，是没有任何差异的。其实从审查元素的也是可以看到的： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/4.png" alt=""> 和大众点评的反爬差不多，都是通过css搞得。</p>
                  <h3 id="2、寻找字体文件"><a href="#2、寻找字体文件" class="headerlink" title="2、寻找字体文件"></a><strong>2、寻找字体文件</strong></h3>
                  <p>以上面方框里的”<strong>customfont</strong>“为关键词搜了一下，发现就在源代码里面： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/3.png" alt=""> 而且还有base64，直接进行解密，但是解密出来的其实是乱码，这个时候其实要做的很简单，把解密后的内容保存为<strong>.ttf</strong>格式即可。</p>
                  <blockquote>
                    <p><strong>ttf文件</strong>： <em>.ttf是字体文件格式。TTF(TrueTypeFont)是Apple公司和Microsoft公司共同推出的字体文件格式,随着windows的流行,已经变成最常用的一种字体文件表示方式。 <em>*@font-face</em></em> 是CSS3中的一个模块，主要是实现将自定义的Web字体嵌入到指定网页中去。</p>
                  </blockquote>
                  <p>因为我们要对字体进行研究，所以必须将它打开，这里我是用的是<strong>FontCreator</strong>，打开以后是这个样子（其实很多字，在这里为了看的清楚，所以只截了下面的图）： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/5.png" alt=""> 很明显，每个字可以看到字形和字形编码。 观察现在箭头指的地方和前面箭头指的地方的数字是不是一样啊，没错，就是通过这种方法进行映射的。 所以我们现在的思路似乎就是在源代码里找到箭头指的数字，然后再来字体里找到后替换就行了。 恭喜你，如果你也是这么想的，那你就掉坑里了。 因为每次访问，字体字形是不变的，但字符的编码确是变化的。因此，我们需要根据每次访问，<strong>动态解析字体文件</strong>。 字体1： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/5.png" alt=""> 字体2： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/8.png" alt=""> 所以想通过写死的方式也是行不通的。 这个时候我们就要对字体文件进行更深一步的研究了。 <strong>3、研究字体文件</strong> 刚刚的.ttf文件我们是看不到内部的东西的，所以这个时候我们要对字体文件进行转换格式，将其转换为xml格式，然后来查看： 具体操作如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from fontTools.ttLib import TTFont</span><br><span class="line">font_1 = <span class="constructor">TTFont('58_font_1.<span class="params">ttf</span>')</span></span><br><span class="line">font_base.save<span class="constructor">XML('<span class="params">font_1</span>.<span class="params">xml</span>')</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>xml的格式如下： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/9-1.png" alt=""> <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/10.png" alt=""> 文件很长，我只截取了一部分。 <strong>仔细的观察一下，你会发现~这俩下面的x,y,on值都是一毛一样的。所以我们的思路就是以一个已知的字体文件为基本，然后将获取到的新的字体文件的每个文字对应的x,y,on值进行比较，如果相同，那么说明新的文字对就 可以在基础字体那里找到对应的文字，有点绕，下面举个小例子。</strong> <strong>假设: “我” 在基本字体中的名为uni1，对应的x=1,y=1,n=1新的字体文件中，一个名为uni2对应的x，y, n分别于上面的相等，那么这个时候就可以确定uni2 对应的文字为”我”。</strong> <strong>查资料的时候，发现在特殊情况下，有时候两个字体中的文字对应的x,y不相等，但是差距都是在某一个阈值之内，处理方法差不多，只不过上面是相等，这种情况下就是要比较一下。</strong> 其实，如果你用画图工具按照上面的x与y值把点给连起来，你会发现，就是汉字的字形~ 所以，到此总结一下：</p>
                  <blockquote>
                    <p><strong>一、将某次请求获取到的字体文件保存到本地[基本字体]；</strong> <strong>二、用软件打开后，人工的找出每一个数字对应的编码[</strong> <strong>一定要保证顺序的正确，要不然会出事]；</strong> <strong>三、我们以后访问网页时，需要保存新字体文件；</strong> <strong>四、用Fonttools库对基本字体与新字体进行处理，找</strong> <strong>到新的字体与基本字体之间的映射；</strong> <strong>五、替换；</strong></p>
                  </blockquote>
                  <h2 id="4、上代码"><a href="#4、上代码" class="headerlink" title="4、上代码"></a><strong>4、上代码</strong></h2>
                  <p>微信里上代码真的太丑了， 还是算了吧，微信后台关键词“<strong>字体加密</strong>” 即可获取github地址。 看一下成果 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/11.png" alt=""> </p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h2>
                  <p>其实这个流程最大的问题就是我们人工录入的基本字体的字典数据有可能是会发生变化的，这就导致我们后面还要手动去改。 现在，如果你已经看懂了本文，那么还不快去其他几个网站试试？ 如果有任何问题，欢迎交流。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/四毛" class="author" itemprop="url" rel="index">四毛</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-02-20 21:22:24" itemprop="dateCreated datePublished" datetime="2019-02-20T21:22:24+08:00">2019-02-20</time>
                </span>
                <span id="/6431.html" class="post-meta-item leancloud_visitors" data-flag-title="今天，我终于弄懂了字体反爬是个啥玩意！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6408.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6408.html" class="post-title-link" itemprop="url">第一次见到这种反爬虫。咋办？盘它。</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="大家好，我是四毛，欢迎大家关注我的公众号。"><a href="#大家好，我是四毛，欢迎大家关注我的公众号。" class="headerlink" title="大家好，我是四毛，欢迎大家关注我的公众号。"></a>大家好，我是四毛，欢迎大家关注我的公众号。</h1>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""> 今天在工作中，碰到了第一次碰见的反爬虫机制，感觉很有意思，在这里记录一下，希望对大家有帮助。</p>
                  <h2 id="今天用到的库："><a href="#今天用到的库：" class="headerlink" title="今天用到的库："></a><strong>今天用到的库</strong>：</h2>
                  <blockquote>
                    <p>requests [请求] lzstring [解压数据] pyexecjs [执行JS]</p>
                  </blockquote>
                  <p> 简单粗暴，直接上网站部分源代码，因为这个网站应该不太希望别人来爬，所以就不上网站了。为什么这么说，因为刚开始请求的时候，老是给我返回GO TO HELL ，哈哈。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2016/12/兔子.gif" alt=""> 这个网站点击鼠标右键审查元素，查看网页源代码是无法用的，但是这个好像只能防住小白啊，<strong>简单的按F12审查元素，CTRL+u 直接查看源代码（谷歌浏览器）</strong>。 这次的目的主要是为了获取下面的链接（重度打码）</p>
                  <blockquote>
                    <p>xxxxxxxxxxx/<strong>xxxxx-003-a5f7xxxxxx</strong>?cid=xxxxx&amp;xxx=<strong>siOE_q4XxBtwdoXqD0xxxx</strong></p>
                  </blockquote>
                  <p>其中，红色加粗的就是我们要找的变量了。</p>
                  <h2 id="一、观察与抓包"><a href="#一、观察与抓包" class="headerlink" title="一、观察与抓包"></a>一、观察与抓包</h2>
                  <p><strong>首先</strong>，我观察到了网页源代码中的一部分js代码：</p>
                  <blockquote>
                    <p>type=”text/javascript”&gt;window<a href="function(p,a,c,k,e,d">“\x65\x76\x61\x6c”</a>{e=function(c){return(c<a?"":e(parseInt(c /a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!’’.replace(/^/,String)){while(c—)d[e(c)]=k[c]||e(c);k=[function(e){return d[e]}];e=function(){return’\\w+’};c=1;};while(c—)if(k[c])p=p.replace(new RegExp(‘\\b’+e(c)+’\\b’,’g’),k[c]);return p;}(‘29.2a({“2c”:1k,”26”:”21”,”22”:”1k.24”,”2o”:2n,”2s”:”2r”,”2l”:[“0-2f-2e.3.2”,”0-2j-2i.3.2”,”0-1r-1L.3.2”,”0-1r-1K.3.2”,”0-1e-1X.3.2”,”0-1e-1Q.3.2”,”0-1x-1W.3.2”,”0-1x-1M.3.2”,”0-1B-33.3.2”,”0-1B-36.3.2”,”0-1F-30.3.2”,”0-1F-2U.3.2”,”0-1g-2Y.3.2”,”0-1g-3e.3.2”,”0-1q-3i.3.2”,”0-1q-38.3.2”,”0-1o-37.3.2”,”0-1o-3a.3.2”,”0-1s-2B.3.2”,”0-1s-2E.3.2”,”0-1i-2v.3.2”,”0-1i-2y.3.2”,”0-1G-2P.3.2”,”0-1G-2S.3.2”,”0-1E-2R.3.2”,”0-1E-2H.3.2”,”0-1I-2L.3.2”,”0-1I-2J.3.2”,”0-t-2K.3.2”,”0-t-2G.3.2”,”0-p-2I.3.2”,”0-p-2M.3.2”,”0-o-2Q.3.2”,”0-o-2N.3.2”,”0-u-2O.3.2”,”0-u-2w.3.2”,”0-D-2x.3.2”,”0-D-2t.3.2”,”0-z-2u.3.2”,”0-z-2z.3.2”,”0-y-2D.3.2”,”0-y-2F.3.2”,”0-7-2A.3.2”,”0-7-2C.3.2”,”0-5-2T.3.2”,”0-5-3b.3.2”,”0-4-3c.3.2”,”0-4-39.3.2”,”0-g-3d.3.2”,”0-g-3h.3.2”,”0-i-3j.3.2”,”0-i-3f.3.2”,”0-b-3g.3.2”,”0-b-2X.3.2”,”0-d-2Z.3.2”,”0-d-2V.3.2”,”0-11-2W.3.2”,”0-11-34.3.2”,”0-13-35.3.2”,”0-13-31.3.2”,”0-10-32.3.2”,”0-10-1J.3.2”,”0-15-1O.3.2”,”0-15-1P.3.2”,”0-1d-1R.3.2”,……………………………………,’M4UxFsAsB9odxAIwA7WQOwObQAwCYBWXPAFlwHYBmY6ncousuvYgDlwDZ38BOT8zn3wcKARmICKOXK1qsmrFjlHdRAnKxEb1rBqK2ih5dSSbkteJXnEbpGm+SF47HLZSEElBOwRsEmlOqU3AS0JHYkWiRKJAwkYTYkQiQmIQwcShy0HDaUSpQuDJQ2HAG0BEFFWgTVQhw+3JRMOEw8Shq4PK……………………………………..GHXTzLjxjzN5CziB+3ODSAhicwuCyeBJ3YJD+eKhEi83fHm76PmK3Y/htPJFzw8LzOCqKTMcXGHr7Jm/nlPtuSUfPBAA===’<a href="&#39;\\x7c&#39;">‘\x73\x70\x6c\x69\x63’</a>,0,{})) &lt;/script&gt;</p>
                  </blockquote>
                  <p>为了节省篇幅，我把一些替换成…….了。如果你对这些数据的解压有兴趣，请后台联系我。 我第一眼看见时，做了2件事： 1、把[\x65\x76\x61\x6c]，[ \x73\x70\x6c\x69\x63]，[\x7c]分别解码，解码出的结果为eval和splic，| ； <strong>注：</strong>其实这里看到eval时就应该想到可以试试直接用pyexecjs执行后面的那段js匿名函数，但是当时确实啥都没有想起来，很惭愧，后来复盘时才发现这一点。虽然执行了也会报错。 2、把那一长串的字母试着用base64解码了，但是解不出来； <strong>然后，</strong>就只能再去其他js文件里找了，也找到了js代码，打了断点，但是看着还是很烦，于是这个时候我就没有在js上面死抠。 <strong>接着</strong>，我调转了方向，在GITHUB，Google运用了我祖传的高级搜索技巧，Finally，终于可以盘它了。</p>
                  <h2 id="二、解密"><a href="#二、解密" class="headerlink" title="二、解密"></a>二、解密</h2>
                  <p>下面开始解密： 1、<strong>数据解压</strong> 包含A===的字符串到底时啥呢，其实<strong>这个是js的一种数据的压缩方式</strong>，知道了这种方式你就可以立即破解这种反爬虫机制了，反正我以前是不知道的，第一次见到，学习了。 在这里，lzstring闪亮登场，运用这个库，执行下面的代码：</p>
                  <blockquote>
                    <p>lzstring.LZString().decompressFromBase64(string)</p>
                  </blockquote>
                  <p>这样就可以把上面的那串字符给解码了，解出来的数据像下面这样：</p>
                  <blockquote>
                    <p><strong>webp|png|025|024|073</strong></p>
                  </blockquote>
                  <p>没错，数据解压就是这么的简单； 2、<strong>看懂JS</strong> 我们在上面解码出来了一个splic和一个[ | ]，再看看我们上面解压出来的数据，是不是很有感觉；但是，查了好一会资料，也没有发现js里面有这个方法，可能是在别的地方定义了；在我找到的资料里面，那个作者是直接用了split，最后的结果是对的，走逻辑上也说得过去，不知道为什么这么设置成splic，还希望有大神可以指教； 3、<strong>执行JS</strong> 所以，到这里就很明显了，把解码以后以及解压以后的数据在替换会原js数据中，我们前面解码出来的eval就有用了，我找到的资料里面作者使用node做的，我没有安装node环境，所以我就直接用了pyexecjs.eval直接执行了，结果也正确； 4、<strong>梳理流程</strong>： 匹配长字符串==&gt;lzstring解压+解码后的字段==&gt;拼凑成新的js代码==&gt;pyexecjs执行==&gt;出结果 5、<strong>部分代码</strong> 执行的主要步骤和结果</p>
                  <blockquote>
                    <p>execjs.eval(res)</p>
                  </blockquote>
                  <p>没错，就是这么简单，res就是替换后的js，然后就可以直接出来我们上面网址中需要的两个字段了。 截个图吧 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/01/2.png" alt=""> <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/01/3.png" alt=""> </p>
                  <h2 id="三、结语"><a href="#三、结语" class="headerlink" title="三、结语"></a>三、结语</h2>
                  <p>到这里，今天的文章就结束了，总结一下就是<strong>知道了一种JS数据的压缩方式，并且学习了解压的方式，JS的执行，同时写代码的时候**</strong>多观察，多想，多试**。 如果觉得还不错，欢迎动动手指关注我。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/四毛" class="author" itemprop="url" rel="index">四毛</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-01-26 18:49:29" itemprop="dateCreated datePublished" datetime="2019-01-26T18:49:29+08:00">2019-01-26</time>
                </span>
                <span id="/6408.html" class="post-meta-item leancloud_visitors" data-flag-title="第一次见到这种反爬虫。咋办？盘它。" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6341.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6341.html" class="post-title-link" itemprop="url">大众点评还不会爬？跟着我，我教你。</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="大家好，我是四毛，好久没有写东西了，欢迎大家关注我的公众号。"><a href="#大家好，我是四毛，好久没有写东西了，欢迎大家关注我的公众号。" class="headerlink" title="大家好，我是四毛，好久没有写东西了，欢迎大家关注我的公众号。"></a>大家好，我是四毛，好久没有写东西了，欢迎大家关注我的公众号。</h1>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""> 今天的文章是关于如何使用requests来爬取大众点评的数据。 看完本文，你可以：</p>
                  <blockquote>
                    <p>1、了解大众点评的CSS反爬虫机制 2、破解反爬虫机制 3、使用requests即可正确获取到评论数，平均价格，服务，味道，环境数据，评论文本数据；</p>
                  </blockquote>
                  <p> 如果你想跟我继续交流的话，欢迎加我的个人微信，二维码在最后。 <strong>如果你想获取更多的代码，请关注我的公众号，并发送 “大众点评”即可。</strong> 同时，代码我并<strong>没有做太多的优化，因为没有大量的代理，爬不了太多的内容。</strong> <strong>这里只是跟大家分享一下处理的流程。欢迎来公众号留言探讨。</strong> </p>
                  <h1 id="正文开始。"><a href="#正文开始。" class="headerlink" title="正文开始。"></a><strong>正文开始。</strong></h1>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2016/12/兔子.gif" alt=""></p>
                  <h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2>
                  <p>在工作生活中，发现越来越多的人对大众点评的数据感兴趣，而大众点评的反爬又是比较严格的。采取的策略差不多是宁可错杀一万，也不放过一个。有的时候正常浏览都会跳出验证码。 另外，在PC端的展示数据是通过CSS来控制的，从网页上看不出来太大的区别，但是用普通的脚本取获取时，会发现数据是获取不到的，具体的源代码是下面这样的： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/微信截图_20181205192407.png" alt=""> 然，在搜资料的时候，你会发现，很多教程都是用的selenium之类的方法，效率太低，没有啥技术含量。 所以，这篇文章的面向的对象就是PC端的大众点评；目标是解决这种反爬虫措施，使用requests获取到干净正确的数据； 跟着我，绝不会让你失望。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/HGXSM1O5KGB_QWQDIC.gif" alt=""></p>
                  <h2 id="2-正文开始"><a href="#2-正文开始" class="headerlink" title="2.正文开始"></a>2.正文开始</h2>
                  <p>相信搞过大众点评网站的同学都应该知道上面的这种是一个css反爬的方法，具体的解析操作，即将开始。</p>
                  <h4 id="找到藏着秘密的css"><a href="#找到藏着秘密的css" class="headerlink" title="找到藏着秘密的css"></a>找到藏着秘密的css</h4>
                  <p>当我们的鼠标在上面框框内的span上面点击时，会发现右边部分会相应的发生变化： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/微信截图_20181205193028.png" alt=""> 这张图片<strong>很重要，很重要，很重要</strong>，我们要的值，几乎都从这里匹配出来。 这里我们看到了“<strong>vxt20</strong>”这个变量对应的两个像素值，<strong>前面的是控制用哪个数字，后面的是控制用哪一段的数字集合</strong>，先记下，后面要用，同时这里的值应该是6； 这里其实就是整个破解流程最关键的一步了。在这里我们看到了一个链接。 瞎猫当死耗子吧，点进去看看。 <span class="exturl" data-url="aHR0cHM6Ly9zM3BsdXMubWVpdHVhbi5uZXQvdjEvbXNzXzBhMDZhNDcxZjk1MTRmYzc5Yzk4MWI1NDY2ZjU2YjkxL3N2Z3RleHRjc3MvZjU1NmMwNTU5MTYxODMyYTRjNjE5MmUwOTdkYjNkYzIuc3Zn">https://s3plus.meituan.net/v1/mss_0a06a471f9514fc79c981b5466f56b91/svgtextcss/f556c0559161832a4c6192e097db3dc2.svg<i class="fa fa-external-link-alt"></i></span> 你会发现，返回的是一些数字，我一开始是不知道这是啥玩意的，看过一些大神的解析才知道，其实这里就是我们看到的数字的来源，也就是整个破解的源头，知道了这些数字的含义，也就可以直接破解了整个反爬的流程。 现在直接看源代码： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/微信截图_20181205193754.png" alt=""> 可以看到这里面的几个关键数字：font-size：字体大小；还有几个y的值，我到后面才知道原来这个y是个阈值，起的是个控制的作用。 所以，这一反爬的原理就是：</p>
                  <blockquote>
                    <p>获取属性值与偏移量和阈值映射，然后从svg文件中找到真数据。</p>
                  </blockquote>
                  <p>现在我们就要用到上面的像素值了。</p>
                  <blockquote>
                    <p>1.把所有的值取绝对值； 2.用后面的值来选择用哪个段的数字，这里的值是103，所以使用第三个段的数字集合； 3.因为每个字体是12个像素，所以用163/12=13.58，约等于14，那么我们数一下第14个数字是啥，没错，是6，和预期一样。你可以多试验几次。</p>
                  </blockquote>
                  <p>以上，就是整个破解的逻辑过程。 画个流程图，装个逼： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/跨职能流程图（水平）.png" alt=""></p>
                  <h2 id="3-Show-Code"><a href="#3-Show-Code" class="headerlink" title="3.Show Code"></a>3.Show Code</h2>
                  <p>下面开始晒代码，俗话说得好，天下代码一大抄。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2017/02/QQ图片20170205084843.jpg" alt="">这里对主要的步骤代码进行解释， <strong>如果你想获取更多的代码，请关注我的公众号，并发送 “大众点评”即可。</strong>。 <strong>1.获取css_url及span对应的TAG值；</strong></p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_tag</span><span class="params">(_list, offset=<span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="comment"># 从第一个开始查</span></span><br><span class="line">    _new_list = [data[<span class="number">0</span>:offset] <span class="keyword">for</span> data <span class="keyword">in</span> _list]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(set(_new_list)) == <span class="number">1</span>:</span><br><span class="line">        <span class="comment"># 如果set后只有一个值，说明全部重复，这个时候就把offset加1</span></span><br><span class="line">        offset += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> get_tag(_list, offset)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        _return_data = [data[<span class="number">0</span>:offset - <span class="number">1</span>] <span class="keyword">for</span> data <span class="keyword">in</span> _list][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _return_data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_css_and_tag</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    :param url: 待爬链接</span></span><br><span class="line"><span class="string">    :return: css链接，该span对应的tag</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    find_css_url = re.search(<span class="string">r'href="([^"]+svgtextcss[^"]+)"'</span>, content, re.M)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> find_css_url:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">"cannot find css_url ,check"</span>)</span><br><span class="line">    css_url = find_css_url.group(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    css_url = <span class="string">"https:"</span> + css_url</span><br><span class="line">    <span class="comment"># 这个网页上不同的字段是由不同的css段来进行控制的，所以要找到这个评论数据对应的tag，在这里返回的值为vx；而在获取评论数据时，tag就是fu-;</span></span><br><span class="line">    <span class="comment"># 具体可以观察上面截图的3个span对应的属性值，相等的最长部分为vx</span></span><br><span class="line">    class_tag = re.findall(<span class="string">"&lt;b class=\"(.*?)\"&gt;&lt;/b&gt;"</span>, content)</span><br><span class="line">    _tag = get_tag(class_tag)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> css_url, _tag</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><strong>2.获取属性与像素值的对应关系</strong></p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_css_and_px_dict</span><span class="params">(css_url)</span>:</span></span><br><span class="line">    con = requests.get(css_url, headers=headers).content.decode(<span class="string">"utf-8"</span>)</span><br><span class="line">    find_datas = re.findall(<span class="string">r'(\.[a-zA-Z0-9-]+)\&#123;background:(\-\d+\.\d+)px (\-\d+\.\d+)px'</span>, con)</span><br><span class="line">    css_name_and_px = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> find_datas:</span><br><span class="line">        <span class="comment"># 属性对应的值</span></span><br><span class="line">        span_class_attr_name= data[<span class="number">0</span>][<span class="number">1</span>:]</span><br><span class="line">        <span class="comment"># 偏移量</span></span><br><span class="line">        offset = data[<span class="number">1</span>]</span><br><span class="line">        <span class="comment"># 阈值</span></span><br><span class="line">        position = data[<span class="number">2</span>]</span><br><span class="line">        css_name_and_px[span_class_attr_name] = [offset, position]</span><br><span class="line">    <span class="keyword">return</span> css_name_and_px</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p> <strong>3.获取svg文件的url</strong></p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_svg_threshold_and_int_dict</span><span class="params">(css_url, _tag)</span>:</span></span><br><span class="line">    con = requests.get(css_url, headers=headers).content.decode(<span class="string">"utf-8"</span>)</span><br><span class="line">    index_and_word_dict = &#123;&#125;</span><br><span class="line">    <span class="comment"># 根据tag值匹配到相应的svg的网址</span></span><br><span class="line"></span><br><span class="line">    find_svg_url = re.search(<span class="string">r'span[class\^="%s"].*?background\-image: url\((.*?)\);'</span> % _tag, con)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> find_svg_url:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">"cannot find svg file, check"</span>)</span><br><span class="line">    svg_url = find_svg_url.group(<span class="number">1</span>)</span><br><span class="line">    svg_url = <span class="string">"https:"</span> + svg_url</span><br><span class="line">    svg_content = requests.get(svg_url, headers=headers).content</span><br><span class="line">    root = H.document_fromstring(svg_content)</span><br><span class="line">    datas = root.xpath(<span class="string">"//text"</span>)</span><br><span class="line">    <span class="comment"># 把阈值和对应的数字集合放入一个字典中</span></span><br><span class="line">    last = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> index, data <span class="keyword">in</span> enumerate(datas):</span><br><span class="line">        y = int(data.xpath(<span class="string">'@y'</span>)[<span class="number">0</span>])</span><br><span class="line">        int_data = data.xpath(<span class="string">'text()'</span>)[<span class="number">0</span>]</span><br><span class="line">        index_and_word_dict[int_data] = range(last, y+<span class="number">1</span>)</span><br><span class="line">        last = y</span><br><span class="line">    <span class="keyword">return</span> index_and_word_dict</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p> <strong>4. 获取最终的值</strong></p>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def get_data(url ):</span><br><span class="line">    <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">    :param page_url: 待获取url</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    <span class="attr">con</span> = requests.get(url, <span class="attr">headers=headers).content.decode("utf-8")</span></span><br><span class="line">    <span class="comment"># 获取css url，及tag</span></span><br><span class="line">    css_url, <span class="attr">_tag</span> = get_css(con)</span><br><span class="line">    <span class="comment"># 获取css对应名与像素的映射</span></span><br><span class="line">    <span class="attr">css_and_px_dict</span> = get_css_and_px_dict(css_url)</span><br><span class="line">    <span class="comment"># 获取svg的阈值与数字集合的映射</span></span><br><span class="line">    <span class="attr">svg_threshold_and_int_dict</span> = get_svg_threshold_and_int_dict(css_url, _tag)</span><br><span class="line"></span><br><span class="line">    <span class="attr">doc</span> = etree.HTML(con)</span><br><span class="line">    <span class="attr">shops</span> = doc.xpath('//div[@<span class="attr">id="shop-all-list"]/ul/li')</span></span><br><span class="line">    for shop <span class="keyword">in</span> shops:</span><br><span class="line">        <span class="comment"># 店名</span></span><br><span class="line">        <span class="attr">name</span> = shop.xpath('.//div[@<span class="attr">class="tit"]/a')[0].attrib["title"]</span></span><br><span class="line">        print name</span><br><span class="line">        <span class="attr">comment_num</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">comment_and_price_datas</span> = shop.xpath('.//div[@<span class="attr">class="comment"]')</span></span><br><span class="line">        for comment_and_price_data <span class="keyword">in</span> comment_and_price_datas:</span><br><span class="line">            <span class="attr">_comment_data</span> = comment_and_price_data.xpath('a[@<span class="attr">class="review-num"]/b/node()')</span></span><br><span class="line">            <span class="comment"># 遍历每一个node，这里node的类型不同，分别有etree._ElementStringResult(字符)，etree._Element（元素），etree._ElementUnicodeResult（字符）</span></span><br><span class="line">            for _node <span class="keyword">in</span> _comment_data:</span><br><span class="line">                <span class="comment"># 如果是字符，则直接取出</span></span><br><span class="line">                <span class="keyword">if</span> isinstance(_node, etree._ElementStringResult):</span><br><span class="line">                    <span class="attr">comment_num</span> = comment_num * <span class="number">10</span> + int(_node)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># 如果是span类型，则要去找数据</span></span><br><span class="line">                    <span class="comment"># span class的attr</span></span><br><span class="line">                    <span class="attr">span_class_attr_name</span> = _node.attrib[<span class="string">"class"</span>]</span><br><span class="line">                    <span class="comment"># 偏移量，以及所处的段</span></span><br><span class="line">                    offset, <span class="attr">position</span> = css_and_px_dict[span_class_attr_name]</span><br><span class="line">                    <span class="attr">index</span> = abs(int(float(offset) ))</span><br><span class="line">                    <span class="attr">position</span> = abs(int(float(position)))</span><br><span class="line">                    <span class="comment"># 判断</span></span><br><span class="line">                    for key, value <span class="keyword">in</span> svg_threshold_and_int_dict.iteritems():</span><br><span class="line">                        <span class="keyword">if</span> position <span class="keyword">in</span> value:</span><br><span class="line">                            <span class="attr">threshold</span> = int(math.ceil(index/<span class="number">12</span>))</span><br><span class="line">                            <span class="attr">number</span> = int(key[threshold])</span><br><span class="line">                            <span class="attr">comment_num</span> = comment_num * <span class="number">10</span> + number</span><br><span class="line">            print comment_num</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="4-结果展示"><a href="#4-结果展示" class="headerlink" title="4.结果展示"></a>4.结果展示</h2>
                  <h3 id="评论条数数据"><a href="#评论条数数据" class="headerlink" title="评论条数数据"></a>评论条数数据</h3>
                  <p>其实，其他的我都写好了，就不贴了 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/微信截图_20181205205030.png" alt=""> <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/微信截图_20181205205218.png" alt=""> </p>
                  <h3 id="评论具体数据"><a href="#评论具体数据" class="headerlink" title="评论具体数据"></a>评论具体数据</h3>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/微信截图_20181205211804.png" alt=""> <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/微信截图_20181205211954.png" alt=""> </p>
                  <h2 id="5-结语"><a href="#5-结语" class="headerlink" title="5.结语"></a>5.结语</h2>
                  <p>以上就是大众点评Css反爬破解的全部步骤和部分代码。 <strong>如果你想获取更多的代码，请关注我的公众号，并发送 “大众点评”即可。</strong> <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/四毛" class="author" itemprop="url" rel="index">四毛</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-01-24 14:07:53" itemprop="dateCreated datePublished" datetime="2019-01-24T14:07:53+08:00">2019-01-24</time>
                </span>
                <span id="/6341.html" class="post-meta-item leancloud_visitors" data-flag-title="大众点评还不会爬？跟着我，我教你。" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6401.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 个人日记 <i class="label-arrow"></i>
                  </a>
                  <a href="/6401.html" class="post-title-link" itemprop="url">2018 年终总结：成就不算少，进步不算多</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>最近一段时间没有更新原创文章了，主要是因为最近整个在忙硕士毕业的各种事情，毕业答辩完了以后休假了一小段时间，整个十二月就这么过去了。 转眼已经 2019 年了，其实去年我并没有写年终总结，现在到头来还是蛮后悔的，说实话总结其实还是蛮有必要的，现在就趁着这个时间来对自己的 2018 做一下总结，并立一下 2019 的一些 Flag，再等到 2020 年翻出来打脸吧。 世界上最了解自己的人当然是自己，一句话总结我的 2018 可以说是： <strong>成就不算少，进步不算多</strong> 的一年。为什么成就不算少呢？因为今年可能发生的事相比我之前几年，自己取得了一些从未有的成就，或者完成了一些比较重要的事情。下面就先总结一下自己取得的一些成就吧： <strong>1. 2018 年中出版了自己人生中第一本书籍作品《Python3网络爬虫开发实战》，半年多时间现在已经累计印刷九次，共计 45000 册，上市初长期处在京东科技新书榜第一位的位置，豆瓣评分 9.2。</strong> <strong>2. 2018 年 1 月 20 日正式开始运营自己的个人公众号“进击的Coder”，发布了两百多篇文章，其中大约一半为原创，粉丝现在是 25000 多人。</strong> <strong>3. 发布了自己开发的一款分布式网络爬虫管理框架 Gerapy，可以完成爬虫项目的配置、部署、管理、监控等功能，目前 GitHub 上 Star 数目将近 1000。</strong> <strong>4. 在 GitHub 上创建和贡献了近 100 个项目，目前个人 Followers 达到 3000 人，收获 Star 数目在 2000 左右。</strong> <strong>5. 开始从事机器学习、深度学习方向的研究和开发，并发布了自己开发的一套深度学习脚手架 ModelZoo，并不断对接各种模型，持续完善中。</strong> <strong>6. 比较顺利地完成秋招，并最终拿到了微软的 Offer，达成理想的结果。</strong> <strong>7. 完成了多次大型公开演讲并结识了许多优秀的业界大佬。</strong> <strong>8. 顺利地完成了毕业论文和毕业答辩，成功取得北航硕士学位。</strong> <strong>9. 凭借自己赚得人生第二桶金，实现收入翻番。</strong> <strong>10. Last but not least，她。</strong> 当然还有一些其他的就不再一一列举了。这些可能有的跟一些大佬比起来可能真的是小巫见大巫，不过对我来说，这些成就我总体还是比较满意的。 在这些成就里，有些是真的改变我人生轨迹的事情，有些可能只是我人生路顺理成章踏过去的事情，有的可能只是昙花一现几年后毫无价值的东西。但拿掉其中一个，不管是看似有用或者没用的，也可能会产生意想不到的影响，他们确实是我真实经历过，并出现在我生命旅途中的一部分。 本来把成就一个个地展开来说，但后来想想没这个必要。昨日取得的成就就让它过去吧，不要念过去，把更多的精力着眼在未来吧。重要的在于，我在这一年里收获了多少，这些收获的东西能够为我未来的成长带来多少价值。以及另外重要的是，对过去的反思，我还有哪些做的不好的地方，我需要在未来做怎样的调整。 所以为什么说进步不算多呢？虽然自己达成了某些目标，但我真的没怎么感觉到自己相比去年年初的自己有特别大的成长，或许一切都是潜移默化的，或许真的把我现在放回到 2018年初，和现在的自己相比，我才会感觉到差别，但现在自己仿佛真的感觉自己本身和之前没有太多不同。但总的来说，我还有非常多需要反思和改进的地方。 下面再好好反思下自己吧，我总觉得自己的这一年，自己的有些方面做得不够好，总体体现在这么几个方面吧： <strong>1. 拖延症</strong>。还是觉得自己的拖延症太严重，执行力还不够好。有些事总是会拖个好几天才完成，没太有恒心。或者有的时候这件事到了要做的时间，却又不想做。之前也会有，但是感觉今年犯的很严重。其实我挺佩服那些持之以恒的人的，自制力和执行力真的很重要。 <strong>2. 记录少</strong>。挺多自己觉得会的东西，由于懒或者忙，没有记下来，其实还是因为懒。到头来发现真正学会的其实仅仅就是自己记录的部分，因为当时没做记录的，又忘得一干二净了。所以我总体感觉，今年输出的文章并不多。 <strong>3. 白忙活</strong>。这一年来，其实回想起来，感觉做的无用功是很多了。许多事情感觉做完了之后，真正的价值并不大，所以这个真的需要我来好好权衡。 4. <strong>虎头蛇尾</strong>。由于自己的很多事情安排的满满当当，所以有的项目可能就容易被搁置了，导致有一些项目做得虎头蛇尾，草草收场，想想还是很可惜的，但有时候就是缺乏那重新捡起来的一步动力，这个必须得改。 <strong>5. 时间规划</strong>。我使用 Todoist 已经好多年了，感谢它帮我完成了大部分的时间规划，但有些时候发现还是有些不够好。我多少还会有一些小事优先，大事拖延的倾向，但总体来说已经把握得还算可以了，还得继续加油。 <strong>6. 缺乏锻炼</strong>。平时事情安排的挺多，有时候也懒得去健身房锻炼，唯一锻炼的时间就是睡前的几分钟了，但是效果不大。可能偶尔一时兴起会去几次健身房，但是还是难以坚持下来。虽然还没感觉到身体有啥不适，但也得加强锻炼了。 所以总体感觉下来，感觉到自己做的不够好的地方还有很多，或许真的要改正对我来说真的挺难，但我也要尽力去做的更好。 这一年中，领悟或贯彻的一些理念也不少，其实太多太多，在这里也不能一一列举了，这里就把现在想到的一些说一下吧： <strong>1. 做一件事前，想想这件事的意义和成本有多大，别把时间浪费在无意义的事情上面。</strong> <strong>2. 记录和总结真的很重要。别以为自己当时记住了，等回过头来，你有时候会发现自己的收获就是你所记录的那一部分，没有记录的你想也想不起来了。</strong> <strong>3. 如果自己没本事，认识很多牛人，没什么太大意义，重要的还是自己要牛逼，多投资自己。自己牛逼了，别人就都会看到你了。</strong> <strong>4. 成年人、社会人的世界，有太多大家都已经默认的规矩，自己要去懂，没几个人会教你。</strong> <strong>5. 钱，不能保证能买到所有东西，但是它的确可以提供便利或者免去不必要的麻烦。它是可以增加幸福感的。</strong> <strong>6. 如果想要赚钱，最好不要选和时间或精力成正比的事情，多考虑复利。</strong> <strong>7. 如果一件东西，花了钱，买到的又不是达到自己预期的，这是双亏。如果买到的是自己所满意或喜欢的的，这就是值的。</strong> <strong>8. 选择比努力很重要，眼界比本事更重要。</strong> <strong>9. 所有的一切，如果有能力，就不要将就，可能一时由于自己的能力还无法改变，但一定不要丢了改变下去的动力。</strong> <strong>10. 如果一件事是自己不喜欢的但是非要做，那就用最短的时间去完成。</strong> <strong>11. 健康第一。</strong> 还有很多，就暂且写这些吧。这是我现阶段所领悟到的一些东西，也是我成长路上的一种认知转变过程吧。也可能再过几年我就不会这么想了。不过现阶段我会秉承这些理念继续前行。 最后就立几个 2019 年的 Flag 吧（等明年翻出来打脸： <strong>1. 踏入社会和职场的第一年，好好工作，把握好节奏。</strong> <strong>2. 完成《Python3网络爬虫开发实战（第二版）》以及现在初步规划的另外的两部作品（名称尚未完全确定暂不透露。</strong> <strong>3. 微信公众号读者粉丝在 2019 年底达到 10 万。</strong> <strong>4. 自己的 Gerapy、ModelZoo 两个项目持续运营维护，力求完善。</strong> <strong>5. 坚持记录，持续输出（内容规划了挺多），达到自己内心中设定的基本目标。</strong> <strong>6. 2019 年年收入比 2018 年继续翻番。</strong> <strong>7. 结识更多的人，扩展更广的人脉。</strong> <strong>8. Last but not least，和她好好地在一起，过我们的向往的生活，做喜欢的事情。</strong> 好啦，感谢大家一直以来的支持！新的一年，继续努力！愿我们都成为更好的自己！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-01-06 00:31:48" itemprop="dateCreated datePublished" datetime="2019-01-06T00:31:48+08:00">2019-01-06</time>
                </span>
                <span id="/6401.html" class="post-meta-item leancloud_visitors" data-flag-title="2018 年终总结：成就不算少，进步不算多" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6378.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Linux <i class="label-arrow"></i>
                  </a>
                  <a href="/6378.html" class="post-title-link" itemprop="url">小白学爬虫之代理(公有云)</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/HGXSM1O5KGB_QWQDIC.gif" alt=""> Hello 各位小伙伴 雷门吼！</p>
                  <h2 id="在教程之前首先申明！此教程适合土豪不缺钱的玩家"><a href="#在教程之前首先申明！此教程适合土豪不缺钱的玩家" class="headerlink" title="在教程之前首先申明！此教程适合土豪不缺钱的玩家"></a><strong>在教程之前首先申明！此教程适合土豪不缺钱的玩家</strong></h2>
                  <p>潜水了许久了，今天来更新点东西~ 今天说点啥呢？ 那就是<strong>代理</strong>！！ 代理在爬虫界的重要作用相信各位应该清楚吧！毕竟绝大部分反爬可以靠<strong>代理</strong>解决；不能被代理解决的也得要<strong>代理</strong>配合解决。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/03/FCADE87DD50A4DE0DCB39A3FA5F4A5C0-1.jpg" alt=""> 市面上各种代理也是琳琅满目的说··· 相信大家最喜欢用的之一应该就是 <strong>某布云。</strong> 根据官网的显示他他家的代理是这个样子的：</p>
                  <ul>
                    <li><strong>无须切换 IP，每一个请求一个随机 IP。</strong></li>
                  </ul>
                  <p>哇！感觉很爽的样子今天我们就来实现一个类似的代理！ 其实 So Easy！ 我们需要借助 <strong>公有云</strong> 来实现。 下面我以 AWS 举例(其它公有云操作类似，唯一的区别的就是：各个服务的名字不同而已) </p>
                  <ol>
                    <li>首先我们需要需要使用EC2来建立一个代理（Google Could 叫 GCE）<ol>
                        <li>安装Squid（当然你可以使用其它的代理）<ol>
                            <li>无认证安装参考这儿(<a href="https://cuiqingcai.com/3443.html">点我</a>)设置代理服务器那一段</li>
                            <li>MySQL认证安装(<span class="exturl" data-url="aHR0cHM6Ly93d3cudGhzaGVlcC5jb20vcG9zdC9zcXVpZCtteXNxbCVFOCVBRSVBNCVFOCVBRiU4MS8=">点我<i class="fa fa-external-link-alt"></i></span>)</li>
                            <li><strong>Note: 请注意检查！！！务必设置Ipv4转发</strong></li>
                          </ol>
                        </li>
                      </ol>
                    </li>
                    <li>安装完成之后我们制作启动模板（毕竟一个EC2 一个IP 你总不能安装很多很多台吧！会死人的）<ol>
                        <li>注意设置你的安全组！正常情况下 入站规则只应该有你需要的端口（squid使用的端口一定要放心！嫌麻烦的小伙伴儿 可以进出都放行全部流量！）出站则是全部流量！</li>
                        <li>启动EC2的时候选择安全组<strong>一定要看清是否是设置过放行的规则</strong>！ 不要选错了！</li>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/ec2.png" alt=""></li>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/制作启动镜像01.jpg" alt=""></li>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/制作启动镜像02.png" alt=""></li>
                        <li>好了现在就可以批量启动了！<img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/从模板启动实例.png" alt=""></li>
                        <li>实例数量就是需要<strong>同时</strong>有多少个IP就启动多少个了。<img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/从模板启动实例01.png" alt=""></li>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/启动结果.png" alt=""></li>
                      </ol>
                    </li>
                    <li>设置前端负载均衡（提供一个固定地址，这个地址负责随机将请求转发到后端代理服务器上）<ol>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/负载均衡器01.png" alt=""></li>
                        <li>必须使用TCP四层负载！原因为啥大家自己百度一哈<img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/负载均衡器02.png" alt=""></li>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/负载均衡器03.png" alt=""></li>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/负载均衡器04.png" alt=""></li>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/负载均衡器05.png" alt=""></li>
                        <li>等待负载均衡器启动完成！</li>
                        <li>启动完成后获取负载地址<img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/代理地址.png" alt=""></li>
                      </ol>
                    </li>
                    <li>下面来测试一下效果！<ol>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/测试IP.png" alt=""></li>
                      </ol>
                    </li>
                  </ol>
                  <p>以上完毕！你可以不停的重启Ec2实例！你就有百万IP池啦！！（前提是你有钱啊） 下面是重启Ec2的示例：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> boto3</span><br><span class="line"><span class="keyword">from</span> boto3 <span class="keyword">import</span> setup_default_session</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">setup_default_session(aws_access_key_id=<span class="string">'XXXXXX'</span>,</span><br><span class="line">                      aws_secret_access_key=<span class="string">'XXXXXX'</span>,</span><br><span class="line">                      region_name=<span class="string">'区域'</span>)</span><br><span class="line"></span><br><span class="line">ec2 = boto3.client(<span class="string">'ec2'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_public_ip_address</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取IP和实例ID</span></span><br><span class="line"><span class="string">    :return: &#123;实例ID: ip&#125;</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    response = ec2.describe_instances()</span><br><span class="line">    reservations = response.get(<span class="string">'Reservations'</span>)</span><br><span class="line">    instances = [i.get(<span class="string">'Instances'</span>)[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> reservations]</span><br><span class="line">    instance_id_public_ip_address = &#123;i.get(<span class="string">'InstanceId'</span>): i.get(<span class="string">'PublicIpAddress'</span>) <span class="keyword">for</span> i <span class="keyword">in</span> instances&#125;</span><br><span class="line">    <span class="keyword">return</span> instance_id_public_ip_address</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reboot_ec2</span><span class="params">(ip)</span>:</span></span><br><span class="line">    <span class="string">"""重启实例</span></span><br><span class="line"><span class="string">    :param ip: </span></span><br><span class="line"><span class="string">    :return: </span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    instance_id_public_ip_address = get_public_ip_address()</span><br><span class="line">    instance_id = instance_id_public_ip_address.get(ip)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ec2.reboot_instances(InstanceIds=[instance_id], DryRun=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">except</span> ClientError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'DryRunOperation'</span> <span class="keyword">not</span> <span class="keyword">in</span> str(e):</span><br><span class="line">            print(<span class="string">"You don't have permission to reboot instances."</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = ec2.reboot_instances(InstanceIds=[instance_id], DryRun=<span class="literal">False</span>)</span><br><span class="line">        print(<span class="string">'Success'</span>, response)</span><br><span class="line">    <span class="keyword">except</span> ClientError <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">'Error'</span>, e)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/哎哟卧槽" class="author" itemprop="url" rel="index">哎哟卧槽</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-12-26 15:59:15" itemprop="dateCreated datePublished" datetime="2018-12-26T15:59:15+08:00">2018-12-26</time>
                </span>
                <span id="/6378.html" class="post-meta-item leancloud_visitors" data-flag-title="小白学爬虫之代理(公有云)" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5094.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5094.html" class="post-title-link" itemprop="url">爬虫代理哪家强？十大付费代理详细对比评测出炉！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
                  <p>随着大数据时代的到来，爬虫已经成了获取数据的必不可少的方式，做过爬虫的想必都深有体会，爬取的时候莫名其妙 IP 就被网站封掉了，毕竟各大网站也不想自己的数据被轻易地爬走。 对于爬虫来说，为了解决封禁 IP 的问题，一个有效的方式就是使用代理，使用代理之后可以让爬虫伪装自己的真实 IP，如果使用大量的随机的代理进行爬取，那么网站就不知道是我们的爬虫一直在爬取了，这样就有效地解决了反爬的问题。 那么问题来了，使用什么代理好呢？这里指的代理一般是 HTTP 代理，主要用于数据爬取。现在打开搜索引擎一搜 HTTP 代理，免费的、付费的太多太多品牌，我们该如何选择呢？看完这一篇文章，想必你心中就有了答案。 对于免费代理，其实想都不用想了，可用率能超过 10% 就已经是谢天谢地了。真正靠谱的代理还是需要花钱买的，那这么多家到底哪家可用率高？哪家响应速度快？哪家比较稳定？哪家性价比比较高？为此，我对市面上比较流行的多家付费代理针对可用率、爬取速度、爬取稳定性、价格、安全性、请求限制等做了详细的评测，让我们来一起看一下到底哪家更强！</p>
                  <h2 id="测评范围"><a href="#测评范围" class="headerlink" title="测评范围"></a>测评范围</h2>
                  <h3 id="免费代理"><a href="#免费代理" class="headerlink" title="免费代理"></a>免费代理</h3>
                  <p>在这里我主要测试的是付费代理，免费代理可用率太低，几乎不会超过 10%，但为了作为对比，我选取了西刺免费代理进行了测试。</p>
                  <h3 id="付费代理"><a href="#付费代理" class="headerlink" title="付费代理"></a>付费代理</h3>
                  <p>付费代理我选取了站大爷、芝麻 HTTP 代理、太阳 HTTP 代理、讯代理、快代理、蘑菇代理、阿布云代理、全网代理、云代理、大象代理、多贝云进行了对比评测，购买了他们的各个不同级别的套餐使用同样的网络环境进行了测评，详情如下：</p>
                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>代理商家</th>
                          <th>套餐类型</th>
                          <th>官方网站</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>芝麻 HTTP 代理</td>
                          <td>默认版</td>
                          <td><span class="exturl" data-url="aHR0cDovL2guemhpbWFydWFuamlhbi5jb20v">http://h.zhimaruanjian.com<i class="fa fa-external-link-alt"></i></span></td>
                        </tr>
                        <tr>
                          <td>阿布云代理</td>
                          <td>专业版</td>
                          <td><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWJ1eXVuLmNvbS8=">https://www.abuyun.com<i class="fa fa-external-link-alt"></i></span></td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>动态版</td>
                          <td></td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>经典版</td>
                          <td></td>
                        </tr>
                        <tr>
                          <td>大象代理</td>
                          <td>个人版</td>
                          <td><span class="exturl" data-url="aHR0cDovL3d3dy5kYXhpYW5nZGFpbGkuY29tLw==">http://www.daxiangdaili.com<i class="fa fa-external-link-alt"></i></span></td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>专业版</td>
                          <td></td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>企业版</td>
                          <td></td>
                        </tr>
                        <tr>
                          <td>全网代理</td>
                          <td>普通版</td>
                          <td><span class="exturl" data-url="aHR0cDovL3d3dy5nb3ViYW5qaWEuY29tLw==">http://www.goubanjia.com<i class="fa fa-external-link-alt"></i></span></td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>动态版</td>
                          <td></td>
                        </tr>
                        <tr>
                          <td>快代理</td>
                          <td>开放代理</td>
                          <td><span class="exturl" data-url="aHR0cHM6Ly93d3cua3VhaWRhaWxpLmNvbS8=">https://www.kuaidaili.com<i class="fa fa-external-link-alt"></i></span></td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>私密代理</td>
                          <td></td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>独享代理</td>
                          <td></td>
                        </tr>
                        <tr>
                          <td>蘑菇代理</td>
                          <td>默认版</td>
                          <td><span class="exturl" data-url="aHR0cDovL3d3dy5tb2d1bWlhby5jb20v">http://www.mogumiao.com<i class="fa fa-external-link-alt"></i></span></td>
                        </tr>
                        <tr>
                          <td>太阳 HTTP 代理</td>
                          <td>默认版</td>
                          <td><span class="exturl" data-url="aHR0cDovL2h0dHAudGFpeWFuZ3J1YW5qaWFuLmNvbS8=">http://http.taiyangruanjian.com<i class="fa fa-external-link-alt"></i></span></td>
                        </tr>
                        <tr>
                          <td>讯代理</td>
                          <td>优质代理</td>
                          <td><span class="exturl" data-url="aHR0cDovL3d3dy54ZGFpbGkuY24v">http://www.xdaili.cn<i class="fa fa-external-link-alt"></i></span></td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>混播代理</td>
                          <td></td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>独享代理</td>
                          <td></td>
                        </tr>
                        <tr>
                          <td>云代理</td>
                          <td>VIP 套餐</td>
                          <td><span class="exturl" data-url="aHR0cDovL3d3dy5pcDMzNjYubmV0Lw==">http://www.ip3366.net<i class="fa fa-external-link-alt"></i></span></td>
                        </tr>
                        <tr>
                          <td>站大爷代理</td>
                          <td>普通代理</td>
                          <td><span class="exturl" data-url="aHR0cDovL2lwLnpkYXllLmNvbS8=">http://ip.zdaye.com<i class="fa fa-external-link-alt"></i></span></td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>短效优质代理</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <p>注：其中蘑菇代理、太阳 HTTP 代理、芝麻 HTTP 代理的默认版表示此网站只有这一种代理，不同套餐仅是时长区别，代理质量没有差别。 嗯，我把上面的套餐全部买了一遍，以供下面的评测使用。</p>
                  <h2 id="测评目标"><a href="#测评目标" class="headerlink" title="测评目标"></a>测评目标</h2>
                  <p>本次测评主要分析代理的可用率、响应速度、稳定性、价格、安全性、使用频率等因素，下面我们来一一进行说明。</p>
                  <h3 id="可用率"><a href="#可用率" class="headerlink" title="可用率"></a>可用率</h3>
                  <p>可用率就是提取的这些代理中可以正常使用的比率。假如我们无法使用这个代理请求某个网站或者访问超时，那么就代表这个代理不可用，在这里我的测试样本大小为 500，即提取 500 个代理，看看里面可用的比率多少。</p>
                  <h3 id="响应速度"><a href="#响应速度" class="headerlink" title="响应速度"></a>响应速度</h3>
                  <p>响应速度可以用耗费时间来衡量，即计算使用这个代理请求网站一直到得到响应所耗费的时间。时间越短，证明代理的响应速度越快，这里同样是 500 个样本，计算时只对正常可用的代理做统计，计算耗费时间的平均值。</p>
                  <h3 id="稳定性"><a href="#稳定性" class="headerlink" title="稳定性"></a>稳定性</h3>
                  <p>由于爬虫时我们需要使用大量代理，如果一个代理响应速度特别快，很快就能得到响应，而下一次请求使用的代理响应速度特别慢，等了三十秒才得到响应，那势必会影响爬取效率，所以我们需要看下商家提供的这些代理稳定性怎样，总不能这一个特别快，下一个又慢的不行。所以这里我们需要统计一下耗费时间的方差，方差越大，证明稳定性越差。</p>
                  <h3 id="价格"><a href="#价格" class="headerlink" title="价格"></a>价格</h3>
                  <p>价格，这个当然是需要考虑的内容，如果一个代理不论是响应速度还是稳定性都特别不错，但是价格非常非常高，这也是不可接受的。</p>
                  <h3 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h3>
                  <p>这的确也是需要考虑的因素，比如一旦不小心把代理提取的 API 泄露出去了，别人就肆意使用我们的 API 提取代理使用，而一直耗费的是我们的套餐。另外一旦别人通过某些手段获取了我们的代理列表，而这些代理是没有安全验证的，这也会导致别人偷偷使用我们的代理。在生产环境上，这方面尤其需要注意。</p>
                  <h3 id="使用频率"><a href="#使用频率" class="headerlink" title="使用频率"></a>使用频率</h3>
                  <p>有些代理套餐在 API 调用提取代理时有频率限制，有的代理套餐则会限制请求频率，这些因素都会或多或少影响爬虫的效率，这部分因素我们也需要考虑进来。</p>
                  <h2 id="测评标准"><a href="#测评标准" class="headerlink" title="测评标准"></a>测评标准</h2>
                  <p>要做标准的测评，那就必须在标准的测评环境下进行，且尽可能排除一些杂项的干扰，如网络波动、传输延迟等一系列的影响。</p>
                  <h3 id="主机选取"><a href="#主机选取" class="headerlink" title="主机选取"></a>主机选取</h3>
                  <p>由于我的个人笔记本是使用 WiFi 上网的，所以可能会有网络波动，而且实际带宽其实并不太好把控，因此它并不适合来做标准评测使用。评测需要在一个网络稳定的条件下进行，而且多个代理的评测环境必须相同，在此我选择了一台腾讯云主机作为测试，主机配置如下：</p>
                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>参数名</th>
                          <th>参数值</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>操作系统</td>
                          <td>Ubuntu 16.04.1 LTS (GNU/Linux 4.4.0-53-generic x86_64)</td>
                        </tr>
                        <tr>
                          <td>带宽</td>
                          <td>5 Mbps</td>
                        </tr>
                        <tr>
                          <td>核心数</td>
                          <td>2</td>
                        </tr>
                        <tr>
                          <td>内存</td>
                          <td>4GB</td>
                        </tr>
                        <tr>
                          <td>Python 版本</td>
                          <td>3.5.2</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <p>这样我们就可以保证一个标准统一的测试环境了。</p>
                  <h3 id="现取现测"><a href="#现取现测" class="headerlink" title="现取现测"></a>现取现测</h3>
                  <p>另外在评测时还需要遵循一个原则，那就是现取现测，即取一个测一个。现在很多付费代理网站都提供了 API 接口，我们可以一次性提取多个代理，但是这样会导致一个问题，每个代理在提取出来的时候，商家是会尽量保证它的可用性的，但过一段时间，这个代理可能就不好用了，所以假如我们一次性提取出来了 100 个代理，但是这 100 个代理并没有同时参与测试，后面的代理就会经历一个的等待期，过一段时间再测这些代理的话，肯定会影响后半部分代理的有效性，所以这里我们将提取的数量统一设置成 1，即请求一次接口获取一个代理，然后立即进行测试，这样可以保证测试的公平性，排除了不同代理有效期的干扰。</p>
                  <h3 id="时间计算"><a href="#时间计算" class="headerlink" title="时间计算"></a>时间计算</h3>
                  <p>由于我们有一项是测试代理的响应速度，所以我们需要计算程序请求之前和得到响应之后的时间差，这里我们使用的测试 Python 库是 requests，所以我们就计算发起请求和得到响应之间的时间差即可，时间计算方法如下所示：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">start_time = <span class="built_in">time</span>.<span class="built_in">time</span>()</span><br><span class="line">requests.<span class="keyword">get</span>(test_url, <span class="keyword">timeout</span>=<span class="keyword">timeout</span>, proxies=proxies)</span><br><span class="line">end_time = <span class="built_in">time</span>.<span class="built_in">time</span>()</span><br><span class="line">used_time = end_time - start_time</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 used_time 就是使用代理请求的耗时，这样测试的就仅仅是发起请求到得到响应的时间。</p>
                  <h3 id="测试链接"><a href="#测试链接" class="headerlink" title="测试链接"></a>测试链接</h3>
                  <p>测试时我们也需要使用一个稳定的且没有反爬虫的链接，这样可以排除服务器的干扰，这里我们使用百度来作为测试目标。</p>
                  <h3 id="超时限制"><a href="#超时限制" class="headerlink" title="超时限制"></a>超时限制</h3>
                  <p>在测试时免不了的会遇到代理请求超时的问题，所以这里我们也需要统一一个超时时间，这里设置为 60 秒，如果使用代理请求百度，60 秒还没有得到响应，那就视为该代理无效。</p>
                  <h3 id="测试数量"><a href="#测试数量" class="headerlink" title="测试数量"></a>测试数量</h3>
                  <p>要做测评，那么样本不能太小，如只有十几次测试是不能轻易下结论的，这里我选取了一个适中的测评数量 500，即每个套餐获取 500 个代理进行测试。</p>
                  <h2 id="测评过程"><a href="#测评过程" class="headerlink" title="测评过程"></a>测评过程</h2>
                  <p>嗯，测评过程这边主要说一下测评的代码逻辑，首先测的时候是取一个测一个的，所以这里定义了一个 test_proxy() 方法：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">test_url = <span class="string">'https://www.baidu.com/'</span></span><br><span class="line">timeout = 60</span><br><span class="line"></span><br><span class="line">def test_proxy(proxy):</span><br><span class="line">    try:</span><br><span class="line">        proxies = &#123;</span><br><span class="line">            <span class="string">'https'</span>: <span class="string">'http://'</span> + proxy</span><br><span class="line">        &#125;</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        requests.<span class="builtin-name">get</span>(test_url, <span class="attribute">timeout</span>=timeout, <span class="attribute">proxies</span>=proxies)</span><br><span class="line">        end_time = time.time()</span><br><span class="line">        used_time = end_time - start_time</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">'Proxy Valid'</span>, <span class="string">'Used Time:'</span>, used_time)</span><br><span class="line">        return <span class="literal">True</span>, used_time</span><br><span class="line">    except (ProxyError, ConnectTimeout, SSLError, ReadTimeout, ConnectionError):</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">'Proxy Invalid:'</span>, proxy)</span><br><span class="line">        return <span class="literal">False</span>, None</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里需要传入一个参数 proxy，代表一个代理，即 IP 加端口组成的代理，然后这里使用了 requests 的 proxies 参数传递给 get() 方法。对于代理无效的检测，这里判断了 | ProxyError, ConnectTimeout, SSLError, ReadTimeout, ConnectionError 这几种异常，如果发生了这些异常统统视为代理无效，返回错误。如果在 timeout 60 秒内得到了响应，那么就计算其耗费时间并返回。 在主程序里，就是获取 API 然后统计结果了，代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">max = 500</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'Testing'</span>)</span><br><span class="line">    used_time_list = []</span><br><span class="line">    valid_count = 0</span><br><span class="line">    total_count = 0</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        flag, result = get_page(api_url)</span><br><span class="line">        <span class="keyword">if</span> flag:</span><br><span class="line">           <span class="built_in"> proxy </span>= result.strip()</span><br><span class="line">            <span class="keyword">if</span> is_proxy(proxy):</span><br><span class="line">                total_count += 1</span><br><span class="line">                <span class="builtin-name">print</span>(<span class="string">'Testing proxy'</span>, proxy)</span><br><span class="line">                test_flag, test_result = test_proxy(<span class="attribute">proxy</span>=proxy)</span><br><span class="line">                <span class="keyword">if</span> test_flag:</span><br><span class="line">                    valid_count += 1</span><br><span class="line">                    used_time_list.append(test_result)</span><br><span class="line">                stats_result(used_time_list, valid_count, total_count)</span><br><span class="line">        time.sleep(wait)</span><br><span class="line">        <span class="keyword">if</span> total_count == max:</span><br><span class="line">            break</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里加了一些判断，如 is_proxy() 方法判断了获取的是不是符合有效的代理规则，即判断它是不是 IP 加端口的形式，这样可以排除 API 返回一些错误信息的干扰。另外这里设置了 total_count 和 valid_count 变量，只有符合代理规则的代理参与了测试，这样才算一次有效测试，total_count 加一，如果测试可用，那么 valid_count 加一并记录耗费时间。最后调用了 stats_results 方法进行了统计：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stats_result</span><span class="params">(used_time_list, valid_count, total_count)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> used_time_list <span class="keyword">or</span> <span class="keyword">not</span> total_count:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    used_time_array = np.asarray(used_time_list, np.float32)</span><br><span class="line">    print(<span class="string">'Total Count:'</span>, total_count,</span><br><span class="line">          <span class="string">'Valid Count:'</span>, valid_count,</span><br><span class="line">          <span class="string">'Valid Percent: %.2f%%'</span> % (valid_count * <span class="number">100.0</span> / total_count),</span><br><span class="line">          <span class="string">'Used Time Mean:'</span>, used_time_array.mean(),</span><br><span class="line">          <span class="string">'Used Time Var'</span>, used_time_array.var())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里使用了 Numpy 来统计了耗费时间的均值和方差，分别反映代理的响应速度和稳定性。 嗯，就这样，利用这个方法我对各个不同的代理套餐逐一进行了测试。</p>
                  <h2 id="测评结果"><a href="#测评结果" class="headerlink" title="测评结果"></a>测评结果</h2>
                  <p>经过测评，初步得到如下统计结果：</p>
                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>代理商家</th>
                          <th>套餐类型</th>
                          <th>测试次数</th>
                          <th>有效次数</th>
                          <th>可用率</th>
                          <th>响应时间均值</th>
                          <th>响应时间方差</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>芝麻 HTTP 代理</td>
                          <td>默认版</td>
                          <td>500</td>
                          <td>495</td>
                          <td>99.00%</td>
                          <td>0.916853</td>
                          <td>1.331989</td>
                        </tr>
                        <tr>
                          <td>阿布云代理</td>
                          <td>专业版</td>
                          <td>500</td>
                          <td>452</td>
                          <td>90.40%</td>
                          <td>0.68770707</td>
                          <td>1.1477163</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>动态版</td>
                          <td>500</td>
                          <td>494</td>
                          <td>98.80%</td>
                          <td>1.83994</td>
                          <td>6.0491614</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>经典版</td>
                          <td>500</td>
                          <td>499</td>
                          <td>99.80%</td>
                          <td>0.49301904</td>
                          <td>0.25724468</td>
                        </tr>
                        <tr>
                          <td>大象代理</td>
                          <td>个人版</td>
                          <td>500</td>
                          <td>238</td>
                          <td>47.60%</td>
                          <td>5.340489</td>
                          <td>78.56444</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>专业版</td>
                          <td>500</td>
                          <td>284</td>
                          <td>56.80%</td>
                          <td>6.87078</td>
                          <td>105.7984</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>企业版</td>
                          <td>500</td>
                          <td>259</td>
                          <td>51.80%</td>
                          <td>6.3081837</td>
                          <td>121.08402</td>
                        </tr>
                        <tr>
                          <td>全网代理</td>
                          <td>普通版</td>
                          <td>500</td>
                          <td>220</td>
                          <td>44.00%</td>
                          <td>5.584057</td>
                          <td>47.442596</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>动态版</td>
                          <td>500</td>
                          <td>485</td>
                          <td>97.00%</td>
                          <td>2.776973</td>
                          <td>17.568045</td>
                        </tr>
                        <tr>
                          <td>快代理</td>
                          <td>开放代理</td>
                          <td>500</td>
                          <td>178</td>
                          <td>35.60%</td>
                          <td>16.636587</td>
                          <td>221.69661</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>私密代理</td>
                          <td>500</td>
                          <td>495</td>
                          <td>99.00%</td>
                          <td>1.2044522</td>
                          <td>3.72582</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>独享代理</td>
                          <td>500</td>
                          <td>497</td>
                          <td>99.40%</td>
                          <td>0.5435687</td>
                          <td>2.27832</td>
                        </tr>
                        <tr>
                          <td>蘑菇代理</td>
                          <td>默认版</td>
                          <td>500</td>
                          <td>497</td>
                          <td>99.40%</td>
                          <td>1.0985725</td>
                          <td>9.532586</td>
                        </tr>
                        <tr>
                          <td>太阳 HTTP 代理</td>
                          <td>默认版</td>
                          <td>500</td>
                          <td>400</td>
                          <td>80.00%</td>
                          <td>1.2522483</td>
                          <td>12.662229</td>
                        </tr>
                        <tr>
                          <td>讯代理</td>
                          <td>优质代理</td>
                          <td>500</td>
                          <td>495</td>
                          <td>99.00%</td>
                          <td>1.0512681</td>
                          <td>6.4247565</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>混播代理</td>
                          <td>500</td>
                          <td>494</td>
                          <td>98.80%</td>
                          <td>1.0664985</td>
                          <td>6.451699</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>独享代理</td>
                          <td>500</td>
                          <td>500</td>
                          <td>100%</td>
                          <td>0.7056521</td>
                          <td>0.35416448</td>
                        </tr>
                        <tr>
                          <td>云代理</td>
                          <td>VIP 套餐</td>
                          <td>500</td>
                          <td>489</td>
                          <td>97.80%</td>
                          <td>3.4216988</td>
                          <td>38.120296</td>
                        </tr>
                        <tr>
                          <td>站大爷代理</td>
                          <td>普通代理</td>
                          <td>500</td>
                          <td>92</td>
                          <td>18.40%</td>
                          <td>5.067193</td>
                          <td>66.12128</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>短效优质代理</td>
                          <td>500</td>
                          <td>488</td>
                          <td>97.60%</td>
                          <td>1.5625348</td>
                          <td>8.121197</td>
                        </tr>
                        <tr>
                          <td>西刺代理</td>
                          <td>免费</td>
                          <td>500</td>
                          <td>31</td>
                          <td>6.2%</td>
                          <td>9.712833</td>
                          <td>95.09569</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <p>注：</p>
                  <ul>
                    <li><strong>表中的响应时间方差越大，代表稳定性越低。</strong></li>
                    <li><strong>阿布云代理经典版方差较小是因为它是长时间锁定了同一个 IP，因此极其稳定，但每秒最大请求默认 5 次。</strong></li>
                    <li><strong>多贝云代理套餐一二方差较小是因为它是长时间锁定了同一个 IP，因此极其稳定，但每秒最大请求默认 20 次。</strong></li>
                  </ul>
                  <h2 id="测评分析"><a href="#测评分析" class="headerlink" title="测评分析"></a>测评分析</h2>
                  <p>下面我们将从各个方面分析一下各个套餐的优劣。</p>
                  <h3 id="可用率-1"><a href="#可用率-1" class="headerlink" title="可用率"></a>可用率</h3>
                  <p>通过可用率统计，我们可以发现可用率较高的代理套餐有：</p>
                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>级别</th>
                          <th>套餐</th>
                          <th>描述</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>第一梯队</td>
                          <td>讯代理独享代理、阿布云代理经典版、快代理私密代理、蘑菇代理、芝麻 HTTP 代理、快代理独享代理、讯代理优质代理</td>
                          <td>可用率 99% 以上</td>
                        </tr>
                        <tr>
                          <td>第二梯队</td>
                          <td>阿布云代理动态版、讯代理混播代理、云代理、站大爷短效优质代理、全网代理动态版、阿布云代理专业版</td>
                          <td>可用率 99% 以下，90% 以上</td>
                        </tr>
                        <tr>
                          <td>第三梯队</td>
                          <td>太阳 HTTP 代理、大象代理专业版、大象代理企业版</td>
                          <td>可用率 90% 以下，50% 以上</td>
                        </tr>
                        <tr>
                          <td>第四梯队</td>
                          <td>大象代理个人版、全网代理普通版、快代理开放代理</td>
                          <td>可用率 50% 以下，20% 以上</td>
                        </tr>
                        <tr>
                          <td>第五梯队</td>
                          <td>站大爷普通代理、西刺代理</td>
                          <td>可用率 20% 以下</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <h3 id="响应速度-1"><a href="#响应速度-1" class="headerlink" title="响应速度"></a>响应速度</h3>
                  <p>通过平均响应速度判别，我们可以发现响应速度较快的代理套餐有：</p>
                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>级别</th>
                          <th>套餐</th>
                          <th>描述</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>第一梯队</td>
                          <td>阿布云代理经典版、阿布云代理专业版、快代理私密代理、讯代理独享代理、芝麻 HTTP 代理</td>
                          <td>响应时间 1s 以内</td>
                        </tr>
                        <tr>
                          <td>第二梯队</td>
                          <td>讯代理优质代理、快代理独享代理、讯代理混播代理、蘑菇代理、太阳代理、站大爷短效优质代理、阿布云代理动态版</td>
                          <td>响应时间 1s 以上，2s 以内</td>
                        </tr>
                        <tr>
                          <td>第三梯队</td>
                          <td>全网代理动态版、云代理</td>
                          <td>响应时间 2s 以上，5s 以内</td>
                        </tr>
                        <tr>
                          <td>第四梯队</td>
                          <td>站大爷普通代理、大象代理个人版、全网代理普通版、大象代理企业版、大象代理专业版、西刺代理</td>
                          <td>响应时间 5s 以上，10s 以内</td>
                        </tr>
                        <tr>
                          <td>第五梯队</td>
                          <td>快代理开放代理</td>
                          <td>响应时间 10s 以上</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <h3 id="稳定性-1"><a href="#稳定性-1" class="headerlink" title="稳定性"></a>稳定性</h3>
                  <p>通过平均响应速度方差分析，我们可以发现稳定性较高的代理套餐有：</p>
                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>级别</th>
                          <th>套餐</th>
                          <th>描述</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>第一梯队</td>
                          <td>阿布云代理经典版、讯代理独享代理、快代理私密代理、阿布云代理专业版、芝麻 HTTP 代理</td>
                          <td>方差 3 以内</td>
                        </tr>
                        <tr>
                          <td>第二梯队</td>
                          <td>快代理独享代理、阿布云代理动态版、讯代理优质代理、讯代理混播代理、站大爷短效优质代理、蘑菇代理</td>
                          <td>方差 10 以内，3 以上</td>
                        </tr>
                        <tr>
                          <td>第三梯队</td>
                          <td>太阳HTTP代理、全网代理动态版、云代理、全网代理普通版、站大爷普通代理、大象代理个人版、西刺代理</td>
                          <td>方差 100 以内，10 以上</td>
                        </tr>
                        <tr>
                          <td>第四梯队</td>
                          <td>大象代理专业版、大象代理企业版、快代理开放代理</td>
                          <td>方差 100 以上</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <h3 id="价格-1"><a href="#价格-1" class="headerlink" title="价格"></a>价格</h3>
                  <p>我们可以看一下各个套餐的价格：</p>
                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>代理商家</th>
                          <th>套餐类型</th>
                          <th>价格描述</th>
                          <th>价格 URL</th>
                          <th>备注</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>芝麻 HTTP 代理</td>
                          <td>默认版</td>
                          <td>￥98/周 ￥360/月</td>
                          <td><span class="exturl" data-url="aHR0cDovL2guemhpbWFydWFuamlhbi5jb20vbmV3cmVjaGFyZ2Uv">http://h.zhimaruanjian.com/newrecharge/<i class="fa fa-external-link-alt"></i></span></td>
                          <td>另有包量套餐、长效 IP 套餐可选购，定期有优惠活动，可领免费 IP，可免费试用</td>
                        </tr>
                        <tr>
                          <td>阿布云代理</td>
                          <td>专业版</td>
                          <td>￥1/时 ￥16/天 ￥108/周 ￥429/月</td>
                          <td><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWJ1eXVuLmNvbS8=">https://www.abuyun.com/<i class="fa fa-external-link-alt"></i></span></td>
                          <td>每秒请求只有5个，多加每秒请求1个需要 1￥0.5/月，￥90 /年</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>动态版</td>
                          <td>￥1/时 ￥16/天 ￥108/周 ￥429/月</td>
                          <td></td>
                          <td></td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>经典版</td>
                          <td>￥1/时 ￥16/天 ￥108/周 ￥429/月</td>
                          <td></td>
                          <td></td>
                        </tr>
                        <tr>
                          <td>大象代理</td>
                          <td>个人版</td>
                          <td>￥9/天 ￥98/月</td>
                          <td><span class="exturl" data-url="aHR0cDovL3d3dy5kYXhpYW5nZGFpbGkuY29tLw==">http://www.daxiangdaili.com/<i class="fa fa-external-link-alt"></i></span></td>
                          <td>好评可送时长</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>专业版</td>
                          <td>￥19/天 ￥198/月</td>
                          <td></td>
                          <td></td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>企业版</td>
                          <td>￥49/天 ￥498/月</td>
                          <td></td>
                          <td></td>
                        </tr>
                        <tr>
                          <td>全网代理</td>
                          <td>普通版</td>
                          <td>￥9/天 ￥35/周 ￥93/月 ￥500/年</td>
                          <td><span class="exturl" data-url="aHR0cDovL3d3dy5nb3ViYW5qaWEuY29tL2J1eS9oaWdoLnNodG1s">http://www.goubanjia.com/buy/high.shtml<i class="fa fa-external-link-alt"></i></span></td>
                          <td></td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>动态版</td>
                          <td>￥10/天 ￥160/月 ￥1250/年</td>
                          <td><span class="exturl" data-url="aHR0cDovL3d3dy5nb3ViYW5qaWEuY29tL2J1eS9keW5hbWljLnNodG1s">http://www.goubanjia.com/buy/dynamic.shtml<i class="fa fa-external-link-alt"></i></span></td>
                          <td></td>
                        </tr>
                        <tr>
                          <td>快代理</td>
                          <td>开放代理</td>
                          <td>￥20/天 ￥60/周 ￥200/月 ￥2000/年</td>
                          <td><span class="exturl" data-url="aHR0cHM6Ly93d3cua3VhaWRhaWxpLmNvbS9wcmljaW5n">https://www.kuaidaili.com/pricing<i class="fa fa-external-link-alt"></i></span></td>
                          <td>有普通、VIP、SVIP、专业版可选</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>独享代理</td>
                          <td>￥8/天 ￥32/周 ￥80/月</td>
                          <td></td>
                          <td></td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>私密代理</td>
                          <td>￥48/天 ￥240/周 ￥720/月</td>
                          <td></td>
                          <td></td>
                        </tr>
                        <tr>
                          <td>蘑菇代理</td>
                          <td>默认版</td>
                          <td>￥6/天 ￥169/月 ￥1699/年</td>
                          <td><span class="exturl" data-url="aHR0cDovL3d3dy5tb2d1bWlhby5jb20vYnV5">http://www.mogumiao.com/buy<i class="fa fa-external-link-alt"></i></span></td>
                          <td>另有包量套餐可选购，可免费试用</td>
                        </tr>
                        <tr>
                          <td>太阳 HTTP 代理</td>
                          <td>默认版</td>
                          <td>￥60/周 ￥198/月 ￥498/季 ￥1590/年</td>
                          <td><span class="exturl" data-url="aHR0cDovL2h0dHAudGFpeWFuZ3J1YW5qaWFuLmNvbS9uZXdyZWNoYXJnZS8=">http://http.taiyangruanjian.com/newrecharge/<i class="fa fa-external-link-alt"></i></span></td>
                          <td>另有保量套餐可选购，可领免费 IP，可免费试用</td>
                        </tr>
                        <tr>
                          <td>讯代理</td>
                          <td>优质代理</td>
                          <td>￥9/天 ￥210/月 ￥2100/年</td>
                          <td><span class="exturl" data-url="aHR0cDovL3d3dy54ZGFpbGkuY24vYnV5cHJveHk=">http://www.xdaili.cn/buyproxy<i class="fa fa-external-link-alt"></i></span></td>
                          <td>可免费试用</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>混播代理</td>
                          <td>￥29/天 ￥729/月 ￥6999/年</td>
                          <td></td>
                          <td></td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>独享代理</td>
                          <td>￥9/天 ￥210/月 ￥2100/年</td>
                          <td></td>
                          <td></td>
                        </tr>
                        <tr>
                          <td>云代理</td>
                          <td>VIP 套餐</td>
                          <td>￥10/天 ￥120/月 ￥599/年</td>
                          <td><span class="exturl" data-url="aHR0cDovL3d3dy5pcDMzNjYubmV0L3ByaWNpbmcv">http://www.ip3366.net/pricing/<i class="fa fa-external-link-alt"></i></span></td>
                          <td>另有普通套餐可选</td>
                        </tr>
                        <tr>
                          <td>站大爷代理</td>
                          <td>普通代理</td>
                          <td>￥8/天 ￥80/月 ￥720/年</td>
                          <td><span class="exturl" data-url="aHR0cDovL2lwLnpkYXllLmNvbS9idXkuaHRtbA==">http://ip.zdaye.com/buy.html<i class="fa fa-external-link-alt"></i></span></td>
                          <td>另有私密代理可选</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>短效优质代理</td>
                          <td>￥17/天 ￥475/月 ￥4569/年</td>
                          <td><span class="exturl" data-url="aHR0cDovL2lwLnpkYXllLmNvbS9TaG9ydFByb3h5Lmh0bWw=">http://ip.zdaye.com/ShortProxy.html<i class="fa fa-external-link-alt"></i></span></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <h3 id="安全性-1"><a href="#安全性-1" class="headerlink" title="安全性"></a>安全性</h3>
                  <p>对于安全性，此处主要考虑提取 API 是否有访问验证，使用代理时是否有访问验证，即可以通过设置白名单来控制哪些可以使用。 其中只有芝麻 HTTP 代理、太阳 HTTP 代理默认使用了白名单限制，即只有将使用 IP 添加到白名单才可以使用，可以有效控制使用权限。 另外阿布云代理提供了隧道代理验证，只有成功配置了用户名和密码才可以正常使用。 所以在此归纳如下：</p>
                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>级别</th>
                          <th>套餐</th>
                          <th>描述</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>第一梯队</td>
                          <td>快代理、芝麻 HTTP 代理、太阳 HTTP 代理、阿布云代理、多贝云代理</td>
                          <td>默认使用了白名单控制或隧道代理验证</td>
                        </tr>
                        <tr>
                          <td>第二梯队</td>
                          <td>其他</td>
                          <td>可直接使用</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <h3 id="调取频率"><a href="#调取频率" class="headerlink" title="调取频率"></a>调取频率</h3>
                  <p>不同的接口具有不同的 API 调用频率限制，归纳如下：</p>
                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>代理商家</th>
                          <th>套餐类型</th>
                          <th>调取频率限制</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>芝麻 HTTP 代理</td>
                          <td>默认版</td>
                          <td>1秒</td>
                        </tr>
                        <tr>
                          <td>阿布云代理</td>
                          <td>专业版</td>
                          <td>无需获取</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>动态版</td>
                          <td>无需获取</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>经典版</td>
                          <td>无需获取</td>
                        </tr>
                        <tr>
                          <td>大象代理</td>
                          <td>个人版</td>
                          <td>1秒</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>专业版</td>
                          <td>1秒</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>企业版</td>
                          <td>无限制</td>
                        </tr>
                        <tr>
                          <td>全网代理</td>
                          <td>普通版</td>
                          <td>无限制</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>动态版</td>
                          <td>100毫秒</td>
                        </tr>
                        <tr>
                          <td>快代理</td>
                          <td>开放代理</td>
                          <td>200毫秒</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>独享代理</td>
                          <td>100毫秒</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>私密代理</td>
                          <td>100毫秒</td>
                        </tr>
                        <tr>
                          <td>蘑菇代理</td>
                          <td>默认版</td>
                          <td>5秒</td>
                        </tr>
                        <tr>
                          <td>太阳 HTTP 代理</td>
                          <td>默认版</td>
                          <td>1秒</td>
                        </tr>
                        <tr>
                          <td>讯代理</td>
                          <td>优质代理</td>
                          <td>5秒</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>混播代理</td>
                          <td>10秒</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>独享代理</td>
                          <td>15秒</td>
                        </tr>
                        <tr>
                          <td>云代理</td>
                          <td>VIP 套餐</td>
                          <td>无限制</td>
                        </tr>
                        <tr>
                          <td>站大爷代理</td>
                          <td>普通代理</td>
                          <td>3秒</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>短效优质代理</td>
                          <td>10秒</td>
                        </tr>
                        <tr>
                          <td>西刺代理</td>
                          <td>免费</td>
                          <td>无限制</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <p>在此可以简单总结如下：</p>
                  <p>级别</p>
                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>级别</th>
                          <th>套餐</th>
                          <th>描述</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>第一梯队</td>
                          <td>云代理、全网代理普通版、大象代理企业版、西刺代理、阿布云（调取无限制，请求默认最大 1 秒 5 请求）</td>
                          <td>无限制</td>
                        </tr>
                        <tr>
                          <td>第二梯队</td>
                          <td>全网代理动态版、快代理（所有套餐）</td>
                          <td>小于 1s</td>
                        </tr>
                        <tr>
                          <td>第三梯队</td>
                          <td>大象代理个人版、大象代理专业版、芝麻 HTTP 代理、太阳 HTTP 代理、站大爷普通代理、蘑菇代理、讯代理优质代理</td>
                          <td>1s – 5s</td>
                        </tr>
                        <tr>
                          <td>第四梯队</td>
                          <td>讯代理混播代理、讯代理独享代理、站大爷短效优质代理</td>
                          <td>大于 5s</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <h3 id="特色功能"><a href="#特色功能" class="headerlink" title="特色功能"></a>特色功能</h3>
                  <p>除了常规的测试之外，我这边还选取了某些套餐的与众不同之处进行说明，这些特点有的算是缺点，有的算是优点，现列举如下：</p>
                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>代理</th>
                          <th>描述</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>阿布云代理 多贝云代理 快代理</td>
                          <td>使用隧道技术实现，代理不能直接拿到，必须配置访问认证，默认 1 秒只能支持 5/20 个请求，如需更多需要付费。</td>
                        </tr>
                        <tr>
                          <td>讯代理</td>
                          <td>独享代理拨号时间略长，可用主机少，容易出现拨号失败现象，单个代理有效时长可控。</td>
                        </tr>
                        <tr>
                          <td>芝麻 HTTP 代理、快代理</td>
                          <td>必须要设置白名单才可以使用，后台可控，使用 API 提取代理不扣费，使用时才扣费。</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <h2 id="测评综合"><a href="#测评综合" class="headerlink" title="测评综合"></a>测评综合</h2>
                  <p>分项了解了各个代理套餐的可用率、响应速度、稳定性、性价比、安全性等内容之后，最后做一下总结：</p>
                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>代理商家</th>
                          <th>套餐类型</th>
                          <th>可用率</th>
                          <th>可用率评价</th>
                          <th>响应时间均值</th>
                          <th>响应速度评价</th>
                          <th>响应时间方差</th>
                          <th>稳定性</th>
                          <th>包月价格</th>
                          <th>价格评价</th>
                          <th>安全性</th>
                          <th>访问频率限制</th>
                          <th>调取频率限制</th>
                          <th>推荐指数</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>芝麻 HTTP 代理</td>
                          <td>默认版</td>
                          <td>99%</td>
                          <td>极高</td>
                          <td>0.916853</td>
                          <td>极快</td>
                          <td>1.331989</td>
                          <td>极好</td>
                          <td>360</td>
                          <td>较高</td>
                          <td>高</td>
                          <td>无</td>
                          <td>1 秒</td>
                          <td>★★★★★</td>
                        </tr>
                        <tr>
                          <td>阿布云代理</td>
                          <td>专业版</td>
                          <td>90.4%</td>
                          <td>高</td>
                          <td>0.68770707</td>
                          <td>极快</td>
                          <td>1.1477163</td>
                          <td>极好</td>
                          <td>429</td>
                          <td>高</td>
                          <td>高</td>
                          <td>有</td>
                          <td>无需获取</td>
                          <td>★★★☆</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>动态版</td>
                          <td>98.8%</td>
                          <td>高</td>
                          <td>1.83994</td>
                          <td>快</td>
                          <td>6.0491614</td>
                          <td>好</td>
                          <td>429</td>
                          <td>高</td>
                          <td>高</td>
                          <td>有</td>
                          <td>无需获取</td>
                          <td>★★★★</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>经典版</td>
                          <td>99.8%</td>
                          <td>极高</td>
                          <td>0.49301904</td>
                          <td>极快</td>
                          <td>0.25724468</td>
                          <td>极好</td>
                          <td>429</td>
                          <td>高</td>
                          <td>高</td>
                          <td>有</td>
                          <td>无需获取</td>
                          <td>★★★★</td>
                        </tr>
                        <tr>
                          <td>大象代理</td>
                          <td>个人版</td>
                          <td>47.6%</td>
                          <td>低</td>
                          <td>5.340489</td>
                          <td>慢</td>
                          <td>78.56444</td>
                          <td>一般</td>
                          <td>98</td>
                          <td>低</td>
                          <td>低</td>
                          <td>无</td>
                          <td>1 秒</td>
                          <td>★★</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>专业版</td>
                          <td>56.8%</td>
                          <td>一般</td>
                          <td>6.87078</td>
                          <td>慢</td>
                          <td>105.7984</td>
                          <td>差</td>
                          <td>198</td>
                          <td>较低</td>
                          <td>低</td>
                          <td>无</td>
                          <td>1 秒</td>
                          <td>★☆</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>企业版</td>
                          <td>51.8%</td>
                          <td>一般</td>
                          <td>6.3081837</td>
                          <td>慢</td>
                          <td>121.08402</td>
                          <td>差</td>
                          <td>498</td>
                          <td>高</td>
                          <td>低</td>
                          <td>无</td>
                          <td>无限制</td>
                          <td>★</td>
                        </tr>
                        <tr>
                          <td>全网代理</td>
                          <td>普通版</td>
                          <td>44%</td>
                          <td>低</td>
                          <td>5.584057</td>
                          <td>慢</td>
                          <td>47.442596</td>
                          <td>一般</td>
                          <td>93</td>
                          <td>低</td>
                          <td>低</td>
                          <td>无</td>
                          <td>无限制</td>
                          <td>★★</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>动态版</td>
                          <td>97%</td>
                          <td>高</td>
                          <td>2.776973</td>
                          <td>一般</td>
                          <td>17.568045</td>
                          <td>一般</td>
                          <td>160</td>
                          <td>较低</td>
                          <td>低</td>
                          <td>无</td>
                          <td>100毫秒</td>
                          <td>★★★</td>
                        </tr>
                        <tr>
                          <td>快代理</td>
                          <td>开放代理</td>
                          <td>35.6%</td>
                          <td>一般</td>
                          <td>16.636587</td>
                          <td>极慢</td>
                          <td>221.69661</td>
                          <td>差</td>
                          <td>200</td>
                          <td>中</td>
                          <td>高</td>
                          <td>无</td>
                          <td>200毫秒</td>
                          <td>★</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>独享代理</td>
                          <td>99.00%</td>
                          <td>极高</td>
                          <td>1.2044522</td>
                          <td>快</td>
                          <td>3.72582</td>
                          <td>好</td>
                          <td>64</td>
                          <td>低</td>
                          <td>高</td>
                          <td>无</td>
                          <td>100毫秒</td>
                          <td>★★★★★</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>私密代理</td>
                          <td>99.40%</td>
                          <td>极高</td>
                          <td>0.5435687</td>
                          <td>极快</td>
                          <td>2.27832</td>
                          <td>好</td>
                          <td>720</td>
                          <td>高</td>
                          <td>高</td>
                          <td>无</td>
                          <td>100毫秒</td>
                          <td>★★★★☆</td>
                        </tr>
                        <tr>
                          <td>蘑菇代理</td>
                          <td>默认版</td>
                          <td>99.4%</td>
                          <td>极高</td>
                          <td>1.0985725</td>
                          <td>快</td>
                          <td>9.532586</td>
                          <td>好</td>
                          <td>169</td>
                          <td>较低</td>
                          <td>低</td>
                          <td>无</td>
                          <td>5秒</td>
                          <td>★★★★☆</td>
                        </tr>
                        <tr>
                          <td>太阳 HTTP 代理</td>
                          <td>默认版</td>
                          <td>80%</td>
                          <td>一般</td>
                          <td>1.2522483</td>
                          <td>快</td>
                          <td>12.662229</td>
                          <td>一般</td>
                          <td>198</td>
                          <td>较低</td>
                          <td>高</td>
                          <td>无</td>
                          <td>1秒</td>
                          <td>★★★★</td>
                        </tr>
                        <tr>
                          <td>讯代理</td>
                          <td>优质代理</td>
                          <td>99%</td>
                          <td>极高</td>
                          <td>1.0512681</td>
                          <td>快</td>
                          <td>6.4247565</td>
                          <td>好</td>
                          <td>210</td>
                          <td>中</td>
                          <td>低</td>
                          <td>无</td>
                          <td>5秒</td>
                          <td>★★★★☆</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>混播代理</td>
                          <td>98.8%</td>
                          <td>高</td>
                          <td>1.0664985</td>
                          <td>快</td>
                          <td>6.451699</td>
                          <td>好</td>
                          <td>729</td>
                          <td>高</td>
                          <td>低</td>
                          <td>无</td>
                          <td>10秒</td>
                          <td>★★★☆</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>独享代理</td>
                          <td>100%</td>
                          <td>极高</td>
                          <td>0.7056521</td>
                          <td>极快</td>
                          <td>0.35416448</td>
                          <td>极好</td>
                          <td>210</td>
                          <td>中</td>
                          <td>低</td>
                          <td>无</td>
                          <td>15秒</td>
                          <td>★★★★☆</td>
                        </tr>
                        <tr>
                          <td>云代理</td>
                          <td>VIP 套餐</td>
                          <td>97.8%</td>
                          <td>高</td>
                          <td>3.4216988</td>
                          <td>一般</td>
                          <td>38.120296</td>
                          <td>一般</td>
                          <td>120</td>
                          <td>较低</td>
                          <td>低</td>
                          <td>无</td>
                          <td>无限制</td>
                          <td>★★★☆</td>
                        </tr>
                        <tr>
                          <td>站大爷代理</td>
                          <td>普通代理</td>
                          <td>18.4%</td>
                          <td>极低</td>
                          <td>5.067193</td>
                          <td>慢</td>
                          <td>66.12128</td>
                          <td>一般</td>
                          <td>80</td>
                          <td>低</td>
                          <td>低</td>
                          <td>无</td>
                          <td>3秒</td>
                          <td>★☆</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>短效优质代理</td>
                          <td>97.6%</td>
                          <td>高</td>
                          <td>1.5625348</td>
                          <td>快</td>
                          <td>8.121197</td>
                          <td>好</td>
                          <td>475</td>
                          <td>高</td>
                          <td>低</td>
                          <td>无</td>
                          <td>10秒</td>
                          <td>★★★☆</td>
                        </tr>
                        <tr>
                          <td>西刺代理</td>
                          <td>免费</td>
                          <td>6.2%</td>
                          <td>极低</td>
                          <td>9.712833</td>
                          <td>慢</td>
                          <td>95.09569</td>
                          <td>一般</td>
                          <td>0</td>
                          <td>免费</td>
                          <td>低</td>
                          <td>无</td>
                          <td>无限制</td>
                          <td>★</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <p>所以在综合来看比较推荐的有：芝麻代理、快代理、讯代理、阿布云、多贝云代理，详细的对比结果可以参照表格。 以上便是各家代理的详细对比测评情况，希望此文能够在大家选购代理的时候有所帮助。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-10-04 02:31:43" itemprop="dateCreated datePublished" datetime="2018-10-04T02:31:43+08:00">2018-10-04</time>
                </span>
                <span id="/5094.html" class="post-meta-item leancloud_visitors" data-flag-title="爬虫代理哪家强？十大付费代理详细对比评测出炉！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>9.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>9 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6289.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6289.html" class="post-title-link" itemprop="url">破解网站登录加密--RSA</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="大家好，我是四毛，下面的是我的公众号，欢迎关注。"><a href="#大家好，我是四毛，下面的是我的公众号，欢迎关注。" class="headerlink" title="大家好，我是四毛，下面的是我的公众号，欢迎关注。"></a>大家好，我是四毛，下面的是我的公众号，欢迎关注。</h1>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""> </p>
                  <h2 id="今天的内容主要讲的是破解一个网站的rsa加密，当然肯定不是破解这个算法，而是找到加密的参数，正确模拟这个算法即可。"><a href="#今天的内容主要讲的是破解一个网站的rsa加密，当然肯定不是破解这个算法，而是找到加密的参数，正确模拟这个算法即可。" class="headerlink" title="今天的内容主要讲的是破解一个网站的rsa加密，当然肯定不是破解这个算法，而是找到加密的参数，正确模拟这个算法即可。"></a><strong>今天的内容主要讲的是破解一个网站的rsa加密，当然肯定不是破解这个算法，而是找到加密的参数，正确模拟这个算法即可。</strong></h2>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2017/02/QQ图片20170205084843.jpg" alt=""></p>
                  <h2 id="1-什么是rsa算法"><a href="#1-什么是rsa算法" class="headerlink" title="1. 什么是rsa算法"></a>1. 什么是rsa算法</h2>
                  <p>下面的资料摘抄自阮一峰老师的文章， <span class="exturl" data-url="aHR0cDovL3d3dy5ydWFueWlmZW5nLmNvbS9ibG9nLzIwMTMvMDYvcnNhX2FsZ29yaXRobV9wYXJ0X29uZS5odG1s">点这里了解更多<i class="fa fa-external-link-alt"></i></span> 1976年，两位美国计算机学家Whitfield Diffie 和 Martin Hellman，提出了一种崭新构思，可以在不直接传递密钥的情况下，完成解密。这被称为<span class="exturl" data-url="aHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9EaWZmaWUlRTIlODAlOTNIZWxsbWFuX2tleV9leGNoYW5nZQ==">“Diffie-Hellman密钥交换算法”<i class="fa fa-external-link-alt"></i></span>。这个算法启发了其他科学家。人们认识到，加密和解密可以使用不同的规则，只要这两种规则之间存在某种对应关系即可，这样就避免了直接传递密钥。 这种新的加密模式被称为”非对称加密算法”。</p>
                  <blockquote>
                    <p>（1）乙方生成两把密钥（公钥和私钥）。公钥是公开的，任何人都可以获得，私钥则是保密的。 （2）甲方获取乙方的公钥，然后用它对信息加密。 （3）乙方得到加密后的信息，用私钥解密。</p>
                  </blockquote>
                  <p>如果公钥加密的信息只有私钥解得开，那么只要私钥不泄漏，通信就是安全的。</p>
                  <h2 id="2-研究目标"><a href="#2-研究目标" class="headerlink" title="2. 研究目标"></a>2. 研究目标</h2>
                  <p>从我要研究的网站来说，就是根据参数得到正确的公钥，加密以后返回给服务器，让服务器使用私钥可以解密出正确的数据即可。 同时，本文不会将具体的网站说出来，只是给大家提供一个解决问题的思路。</p>
                  <h2 id="3-开始"><a href="#3-开始" class="headerlink" title="3. 开始"></a>3. 开始</h2>
                  <h3 id="3-1-抓包找参数"><a href="#3-1-抓包找参数" class="headerlink" title="3.1 抓包找参数"></a>3.1 抓包找参数</h3>
                  <p>首先，打开某个网站的登录页面，输入用户名，密码，验证码之类的参数， 抓包看到了下面这个页面： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/09/Selection_191.png" alt=""> 我实际输入的值全是1, 然后都被加密了， 没办法，只能去找加密的方法了。 经过一番搜索过后，才发现，原来加密的算法就在源代码里面，这里截个图： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/09/Selection_192.png" alt=""> <strong>从这里就可以看到具体的算法名以及相关的参数了，你会说，这是什么算法我都不知道啊？搜啊，用关键词搜一下就能知道了。</strong> 同时，是不是觉得这个网站好傻逼，这不太简单了吗？ 肯定不是！！！ 这么简单，说明此处也是必有玄机！！！ 至于什么玄机，到后面说，都是泪。 </p>
                  <h3 id="3-2-分析加密流程"><a href="#3-2-分析加密流程" class="headerlink" title="3.2 分析加密流程"></a>3.2 分析加密流程</h3>
                  <p>首先， 我们知道了公钥以后，解析这个公钥，就可以得到相关的参数，给大家找了示例代码</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># /usr/bin/python</span></span><br><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">import</span> <span class="string">base64</span></span><br><span class="line"></span><br><span class="line"><span class="attr">def</span> <span class="string">str2key(s):</span></span><br><span class="line"><span class="comment">    # 对字符串解码</span></span><br><span class="line">    <span class="attr">b_str</span> = <span class="string">base64.b64decode(s)</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">if</span> <span class="string">len(b_str) &lt; 162:</span></span><br><span class="line">        <span class="attr">return</span> <span class="string">False</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">hex_str</span> = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    # 按位转换成16进制</span></span><br><span class="line">    <span class="attr">for</span> <span class="string">x in b_str:</span></span><br><span class="line">        <span class="attr">h</span> = <span class="string">hex(ord(x))[2:]</span></span><br><span class="line">        <span class="attr">h</span> = <span class="string">h.rjust(2, '0')</span></span><br><span class="line">        <span class="attr">hex_str</span> <span class="string">+= h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    # 找到模数和指数的开头结束位置</span></span><br><span class="line">    <span class="attr">m_start</span> = <span class="string">29 * 2</span></span><br><span class="line">    <span class="attr">e_start</span> = <span class="string">159 * 2</span></span><br><span class="line">    <span class="attr">m_len</span> = <span class="string">128 * 2</span></span><br><span class="line">    <span class="attr">e_len</span> = <span class="string">3 * 2</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">modulus</span> = <span class="string">hex_str[m_start:m_start + m_len]</span></span><br><span class="line">    <span class="attr">exponent</span> = <span class="string">hex_str[e_start:e_start + e_len]</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">return</span> <span class="string">modulus,exponent</span></span><br><span class="line"></span><br><span class="line"><span class="attr">if</span> <span class="string">__name__ == "__main__":</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">pubkey</span> = <span class="string">"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDC7kw8r6tq43pwApYvkJ5laljaN9BZb21TAIfT/vexbobzH7Q8SUdP5uDPXEBKzOjx2L28y7Xs1d9v3tdPfKI2LR7PAzWBmDMn8riHrDDNpUpJnlAGUqJG9ooPn8j7YNpcxCa1iybOlc2kEhmJn5uwoanQq+CA6agNkqly2H4j6wIDAQAB"</span></span><br><span class="line">    <span class="attr">key</span> = <span class="string">str2key(pubkey)</span></span><br><span class="line">    <span class="attr">print</span> <span class="string">key</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>相应的输出</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">('c2ee4c3cafab6ae37a<span class="number">700296</span>2f909e656a58da37d<span class="number">0596</span>f6d<span class="number">530087</span>d3fef7b16e86f31fb43c<span class="number">4947</span>4fe6e0cf5c404acce8f1d8bdbccbb5ecd5df6fded74f7ca<span class="number">2362</span>d1ecf<span class="number">033581983327</span>f2b887ac30cda54a499e<span class="number">500652</span>a246f68a0f9fc8fb60da5cc426b58b26ce95cda<span class="number">41219899</span>f9bb0a1a9d0abe080e9a80d92a972d87e23eb', </span><br><span class="line">'<span class="number">010001</span>')</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>从代码中可以看出，解析了公钥之后得到了两个值，一个就是010001，和我们在网站源代码里面找到的值是一样的。所以，源代码里面的参数我们应该就是可以直接使用的，是不是有种找到组织的赶脚。 接下来，利用下面的代码，来对数据进行加密</p>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">import</span> rsa</span><br><span class="line"><span class="built_in">import</span> binascii</span><br><span class="line">def en_test():</span><br><span class="line">    <span class="attr">param_1</span> = <span class="string">"010001"</span></span><br><span class="line">    <span class="comment"># 某次我找到的</span></span><br><span class="line">    <span class="attr">param_2</span> = <span class="string">"955120AB9334B7CD52FCDB422DBF564AFD46DEBDC706F33502BBFAD9DD216A22E4D5012CB70F28473B46FB7190D08C31B4B8E76B5112ACE1C5552408961530B1C932DEEA8FC38A9A624AD22073F56F02BF453DD2C1FEA0164106D6B099CC9E5EC88C356FC164FCA47C766DD565D3D11048D27F2DD4221A0B26AB59BD7D09841F"</span></span><br><span class="line">    <span class="attr">message</span> = 'nihao'</span><br><span class="line">    <span class="attr">modulus</span> = int(param_2, <span class="number">16</span>)</span><br><span class="line">    <span class="attr">exponent</span> = int(param_1, <span class="number">16</span>)</span><br><span class="line">    <span class="attr">rsa_pubkey</span> = rsa.PublicKey(modulus, exponent)</span><br><span class="line">    <span class="attr">crypto</span> = rsa.encrypt(message, rsa_pubkey)</span><br><span class="line">    <span class="attr">data</span> = binascii.b2a_hex(crypto)</span><br><span class="line"></span><br><span class="line">    print data</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="attr">__name__</span> == '__main__':</span><br><span class="line">    en_test()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但是当我这样做完，进行模拟登录，还以为自己很牛逼的时候，服务器却给我返回了这样的结果， 目瞪狗呆啊：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="attr">"Status"</span>:<span class="literal">false</span>,<span class="attr">"ResultValue"</span>:<span class="string">""</span>,<span class="attr">"StatusCode"</span>:<span class="string">"REFRESH"</span>,<span class="attr">"StatusMessage"</span>:<span class="string">"请尝试重新登录"</span>,<span class="attr">"RecordCount"</span>:<span class="number">0</span>,<span class="attr">"Data"</span>:<span class="literal">null</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2017/09/00602RHagw1f7yyuxxeucj305i05i744.jpg" alt=""> 可以看到信息提示要刷新，但是当时是百思不得其解，为毛线要刷新？ 困惑了一会之后，我再次从头走了一遍流程，这下我才发现，原来源代码里面的那个长长的数据是会改变的，直到这个时候，我才意识到为什么要我刷新。。。。。。 服务器啊，你就不能直接说参数错误吗？刷新你大爷啊。 果然，我还是太年轻啊。</p>
                  <h1 id="果然，天上掉下的绝不是馅饼，绝逼是个陷阱。"><a href="#果然，天上掉下的绝不是馅饼，绝逼是个陷阱。" class="headerlink" title="果然，天上掉下的绝不是馅饼，绝逼是个陷阱。"></a>果然，天上掉下的绝不是馅饼，绝逼是个陷阱。</h1>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/03/你特么在逗我？.jpeg" alt=""> 知道这个坑以后就好办了，用个正则匹配一下就行了，而结果也是对的：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="attr">"Status"</span>:<span class="literal">true</span>,<span class="attr">"ResultValue"</span>:<span class="string">""</span>,<span class="attr">"StatusCode"</span>:<span class="string">"OK"</span>,<span class="attr">"StatusMessage"</span>:<span class="string">"成功"</span>,<span class="attr">"RecordCount"</span>:<span class="number">0</span>,<span class="attr">"Data"</span>:&#123;<span class="attr">"LoginUrl"</span>:<span class="string">"/System/Welcome"</span>&#125;&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h4 id="4-总结"><a href="#4-总结" class="headerlink" title="4 总结"></a>4 总结</h4>
                  <p>到这里这篇文章就结束了，这个案例相对于来说很简单，而且为了保护网站的隐私，所以没办法展开说。 有些网站的加密方式是很变态的，比如网易云音乐，知晓常见的加密方法，就可以处理大部分的情况了。 其实，网易云音乐并不是一定要加密， 有想知道非加密的方法的，可以关注我，私聊我。有点敏感，就不写文章了。 反正，我爬了1000W+的网易云音乐都是不加密的～～ 如果你有类似的问题待解决或者想了解的更清楚的细节的，欢迎关注我的公众号以后，后台私我一下。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/四毛" class="author" itemprop="url" rel="index">四毛</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-09-14 13:43:33" itemprop="dateCreated datePublished" datetime="2018-09-14T13:43:33+08:00">2018-09-14</time>
                </span>
                <span id="/6289.html" class="post-meta-item leancloud_visitors" data-flag-title="破解网站登录加密--RSA" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6284.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Linux <i class="label-arrow"></i>
                  </a>
                  <a href="/6284.html" class="post-title-link" itemprop="url">详解 Linux 下的用户管理、用户组管理和权限管理</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>最近和几个朋友开发项目，期间使用了一台服务器跑模型，这台服务器是多人公用的，很多人都在上面有自己的账号，互不干涉内政，一切看起来十分井然有序。近期，这个服务器上刚挂载了一块新硬盘，是一位朋友使用 root 账号挂载的，然后将磁盘映射到某个文件夹下。然而挂载好了之后发现使用普通账号没有权限在文件夹下操作，无法创建文件，于是他干脆就直接把文件夹权限改成 777 了。我心想，这还了得，改成 777 了，其他人在里面乱改咋办？会出人命的！所以，我就这件事详细梳理了一下 Linux 下的用户、用户组、文件权限等基本知识，看完这些，以后不要动不动就把文件夹改成 777 权限了。</p>
                  <h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2>
                  <p>首选我们梳理一下 Linux 下的用户、用户组、文件权限等基本知识，然后后面通过一个案例来实际演示一下权限设置的一些操作。 首先 Linux 系统中，是有用户和用户组的概念的，用户就是身份的象征，我们必须以某一个用户身份来操作一个系统，实际上这就对应着我们登录系统时的账号。而用户组就是一些用户的集合，我们可以通过用户组来划分和统一管理某些用户。 比如我要在微信发一条朋友圈，我只想给我的亲人们看，难道我发的时候还要一个个去勾选所有的人？这未免太麻烦了。为了解决这问题，微信里面就有了标签的概念，我们可以提前给好友以标签的方式分类，发的时候直接勾选某个标签就好了，简单高效。实际上这就是用户组的概念，我们可以将某些人进行分组和归类，到时候只需要指定类别或组别就可以了，而不用一个个人去对号入座，从而节省了大量时间。 在 Linux 中，一个用户是可以属于多个组的，一个组也是可以包含多个用户的，下面我以一台 Ubuntu Linux 为例来演示一下相关的命令和操作。</p>
                  <h3 id="用户和用户组"><a href="#用户和用户组" class="headerlink" title="用户和用户组"></a>用户和用户组</h3>
                  <p>首先查看所有用户，命令如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">cut -d<span class="string">':'</span> -f <span class="number">1</span> <span class="regexp">/etc/</span>passwd</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">root</span></span><br><span class="line"><span class="symbol">daemon</span></span><br><span class="line"><span class="keyword">bin</span></span><br><span class="line"><span class="keyword">sys</span></span><br><span class="line"><span class="keyword">...</span></span><br><span class="line"><span class="keyword">ubuntu</span></span><br><span class="line"><span class="keyword">mysql</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里一行就是一个用户名，由于太多，部分就省略了，实际上这个命令就是从密码文件中把用户名单独列出来了。 然后查看所有用户组，命令也是类似的：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">cut -d<span class="string">':'</span> -f <span class="number">1</span> <span class="regexp">/etc/g</span>roup</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">root</span></span><br><span class="line"><span class="symbol">daemon</span></span><br><span class="line"><span class="keyword">bin</span></span><br><span class="line"><span class="keyword">sys</span></span><br><span class="line"><span class="keyword">...</span></span><br><span class="line"><span class="keyword">ubuntu</span></span><br><span class="line"><span class="keyword">mysql</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果基本是类似的，因为每个用户在被创建的时候都会自动创建一个同名的组作为其默认的用户组。 这里我是使用 ubuntu 这个账号来登录的，下面我来看下 ubuntu 这个账号是属于哪些组。 查看一个用户所属组的命令格式如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">gorups <span class="tag">&lt;<span class="name">username</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里就是 groups 命令加上用户名就能查看该用户名所属的组了，如果不加用户名的话就默认是当前用户。 例如查看 ubuntu 这个用户所属于的组，命令如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">groups ubuntu</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ubuntu : <span class="type">ubuntu</span> adm cdrom sudo dip plugdev lxd lpadmin sambashare</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>还不少，这个用户被分配到了很多组下，比如同名的组 ubuntu，还有 sudo 组，另外还有一些其他的组。 其中 sudo 组比较特殊，如果被分到了这个组里面就代表该账号拥有 root 权限，可以使用 sudo 命令。 了解了怎样查看用户所属的组，我们也应该反过来了解如何查看一个用户组里面包含哪些用户啊。 查看某个用户组下所有用户命令如下：</p>
                  <figure class="highlight sqf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">members</span> &lt;<span class="built_in">group</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>不过这个命令不是自带的，需要额外安装 members 包，命令如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install members</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>例如查看 sudo 用户组下的所有用户，即拥有 root 权限的用户：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">members sudo</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">ubuntu hadoop</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到拥有 root 权限的用户有两个，ubuntu 和 hadoop，当然不同的机器结果肯定是不一样的。 接下来介绍一个比较有用的命令，就是 id 命令，它可以用来查看用户的所属组别，格式如下：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">id</span> &lt;username&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>例如查看 ubuntu 用户的信息，就是这样：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">id</span> ubuntu</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">uid=<span class="number">500</span>(ubuntu) gid=<span class="number">500</span>(ubuntu) groups=<span class="number">500</span>(ubuntu),<span class="number">4</span>(adm),<span class="number">24</span>(cdrom),<span class="number">27</span>(sudo),<span class="number">30</span>(dip),<span class="number">46</span>(plugdev),<span class="number">110</span>(lxd),<span class="number">115</span>(lpadmin),<span class="number">116</span>(sambashare)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里有一个 gid，作为主工作组，后面还有个 groups，它列出了用户所在的所有组。主工作组只有一个，而后者的数量则不限。可以看到用户组的结果和使用 groups 命令看到的结果是一致的。 接下来我们再来了解一下如何创建一个用户和怎样为用户分配组别。 添加一个用户命令格式如下：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">sudo</span> <span class="keyword">adduser </span>&lt;username&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>比如我要添加一个用户 cqc，命令就可以这么写：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">sudo</span> <span class="keyword">adduser </span>cqc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里使用的命令前面都带有 sudo，因为毕竟是系统级别的操作。 添加一个组的命令格式如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo groupadd <span class="tag">&lt;<span class="name">group</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>格式是类似的，后面跟一个组的名称就可以了，例如我要为我的实验室创建一个用户组，那么就可以使用如下命令：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo groupadd lab</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>创建完了用户和组，那得把它们关联起来吧，关联的意思就是把某个用户加入到某个组里面，命令格式如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo adduser <span class="tag">&lt;<span class="name">username</span>&gt;</span> <span class="tag">&lt;<span class="name">group</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或者使用 usermod 命令：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo usermod -G <span class="tag">&lt;<span class="name">group</span>&gt;</span> <span class="tag">&lt;<span class="name">username</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果要添加多个组的话，可以通过 -a 选项指定多个名称：</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo usermod -aG &lt;group1,group2,group3..&gt; &lt;username&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>例如我要将 cqc 用户添加到 sudo 用户组中，命令就是：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">sudo</span> <span class="keyword">adduser </span>cqc sudo</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo usermod -G sudo cqc</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就为用户和用户组做好关联了。</p>
                  <h3 id="文件权限管理"><a href="#文件权限管理" class="headerlink" title="文件权限管理"></a>文件权限管理</h3>
                  <p>了解了这些之后，我们再来了解一下文件权限的相关知识，下面我们先随便找一个目录，查看一下文件的列表。 列出某个目录下文件详细信息的命令如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">ll</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或者使用：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">ls -l</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>比如我这里列出了 /etc/nginx 目录下的文件列表：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">total <span class="number">80</span></span><br><span class="line">drwxr-xr-x   <span class="number">7</span> root root  <span class="number">4096</span> Jun <span class="number">21</span> <span class="number">22</span>:<span class="number">16</span> ./</span><br><span class="line">drwxr-xr-x <span class="number">103</span> root root  <span class="number">4096</span> Sep  <span class="number">4</span> <span class="number">18</span>:<span class="number">04</span> ../</span><br><span class="line">drwxr-xr-x   <span class="number">2</span> root root  <span class="number">4096</span> Jul <span class="number">12</span>  <span class="number">2017</span> conf.d/</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root  <span class="number">1077</span> Feb <span class="number">12</span>  <span class="number">2017</span> fastcgi.conf</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root  <span class="number">1007</span> Feb <span class="number">12</span>  <span class="number">2017</span> fastcgi_params</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root  <span class="number">2837</span> Feb <span class="number">12</span>  <span class="number">2017</span> koi-utf</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root  <span class="number">2223</span> Feb <span class="number">12</span>  <span class="number">2017</span> koi-win</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root  <span class="number">3957</span> Feb <span class="number">12</span>  <span class="number">2017</span> mime.types</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root  <span class="number">1505</span> Jun <span class="number">21</span> <span class="number">20</span>:<span class="number">24</span> nginx.conf</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root <span class="number">12288</span> Jun <span class="number">21</span> <span class="number">20</span>:<span class="number">44</span> .nginx.conf.swp</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root   <span class="number">180</span> Feb <span class="number">12</span>  <span class="number">2017</span> proxy_params</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root   <span class="number">636</span> Feb <span class="number">12</span>  <span class="number">2017</span> scgi_params</span><br><span class="line">drwxr-xr-x   <span class="number">2</span> root root  <span class="number">4096</span> Jun <span class="number">21</span> <span class="number">22</span>:<span class="number">42</span> sites-available/</span><br><span class="line">drwxr-xr-x   <span class="number">2</span> root root  <span class="number">4096</span> Jun <span class="number">21</span> <span class="number">19</span>:<span class="number">08</span> sites-enabled/</span><br><span class="line">drwxr-xr-x   <span class="number">2</span> root root  <span class="number">4096</span> Jun <span class="number">21</span> <span class="number">19</span>:<span class="number">08</span> snippets/</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root   <span class="number">664</span> Feb <span class="number">12</span>  <span class="number">2017</span> uwsgi_params</span><br><span class="line">drwxr-xr-x   <span class="number">2</span> root root  <span class="number">4096</span> Jun <span class="number">22</span> <span class="number">02</span>:<span class="number">44</span> vhosts/</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root  <span class="number">3071</span> Feb <span class="number">12</span>  <span class="number">2017</span> win-utf</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们注意到了每一行都是一个文件或文件夹的信息，一共包括七列：</p>
                  <ul>
                    <li>第一列是文件的权限信息</li>
                    <li>第二列表示该文件夹连接的文件数</li>
                    <li>第三列表示文件所属用户</li>
                    <li>第四列表示文件所属用户组</li>
                    <li>第五列表示文件大小（字节）</li>
                    <li>第六列表示最后修改日期</li>
                    <li>第七列表示文件名</li>
                  </ul>
                  <p>其中第一列的文件权限信息是非常重要的，它由十个字符组成：</p>
                  <ul>
                    <li>第一个字符代表文件的类型，有三种，- 代表这是一个文件，d 代表这是一个文件夹，l 代表这是一个链接。</li>
                    <li>第 2-4 个字符代表文件所有者对该文件的权限，r 就是读，w 就是写，x 就是执行，如果是文件夹的话，执行就意味着查看文件夹下的内容，例如 rw- 就代表文件所有者可以对该文件进行读取和写入。</li>
                    <li>第 5-7 个字符代表文件所属组对该文件的权限，含义是一样的，如 r-x 就代表该文件所属组内的所有用户对该文件有读取和执行的权限。</li>
                    <li>第 8-10 个字符代表是其他用户对该文件的权限，含义也是一样的，如 r— 就代表非所有者，非用户组的用户只拥有对该文件的读取权限。</li>
                  </ul>
                  <p>我们可以使用 chmod 命令来改变文件或目录的权限，有这么几种用法。 一种是数字权限命名，rwx 对应一个二进制数字，如 101 就代表拥有读取和执行的权限，而转为十进制的话，r 就代表 4，w 就代表 2，x 就代表 1，然后三个数字加起来就和二进制数字对应起来了。如 7=4+2+1，这就对应着 rwx；5=4+1，这就对应着 r-x。所以，相应地 777 就代表了 rwxrwxrwx，即所有者、所属用户组、其他用户对该文件都拥有读取、写入、执行的权限，这是相当危险的！ 赋予权限的命令如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod <span class="tag">&lt;<span class="name">permission</span>&gt;</span> <span class="tag">&lt;<span class="name">file</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>例如我要为一个 file.txt 赋予 777 权限，就写成：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod <span class="number">777</span> file.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外我们也可以使用代号来赋予权限，代号有 u、g、o、a 四中，分别代表所有者权限，用户组权限，其他用户权限和所有用户权限，这些代号后面通过 + 和 - 符号来控制权限的添加和移除，再后面跟上权限类型就好，例如：</p>
                  <figure class="highlight sas">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod u-<span class="meta">x</span> <span class="meta">file</span>.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就是给所有者移除 x 权限，也就是执行权限。</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod g+w <span class="built_in">file</span>.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就是为用户组添加 w 权限，即写入权限。 另外如果是文件夹的话还可以对文件夹进行递归赋权限操作，如：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod -R <span class="number">777</span> share</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就是将 share 文件夹和其内所有内容都赋予 777 权限。 好，有了权限的标识，那我们还得把用户和用户组与文件关联起来啊，这里使用的命令就是 chown 和 chgrp 命令。 命令格式如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chown <span class="tag">&lt;<span class="name">username</span>&gt;</span> <span class="tag">&lt;<span class="name">file</span>&gt;</span></span><br><span class="line">sudo chgrp <span class="tag">&lt;<span class="name">group</span>&gt;</span> <span class="tag">&lt;<span class="name">file</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>例如我要将 file.txt 的所有者换成 cqc，那就可以使用如下命令：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chown cqc <span class="built_in">file</span>.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果我要将 file.txt 所属用户组换成 lab，那就可以使用如下命令：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chgrp <span class="keyword">lab</span> <span class="keyword">file</span>.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外同样可以使用 -R 来进行递归操作，如将 share 文件夹及其内所有内容的所有者都换成 cqc，命令如下：</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo <span class="keyword">chown</span> -R cqc share/</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，了解了 chown、chgrp、chmod 之后，我们就可以灵活地对文件权限进行控制了。</p>
                  <h2 id="实战演示"><a href="#实战演示" class="headerlink" title="实战演示"></a>实战演示</h2>
                  <p>可能上面说起来有点抽象，下面我们以一个实例来演示一下权限控制的流程，通过这个流程，相信理解以上的命令都不在话下了。 首先情况是这样的，我要在某台主机上共享一些文件给我实验室的人，但这台主机上还有其他非实验室的人在使用，我只想让实验室的人查看和修改这些文件，其他人不行。 另外我自己的账号要有最高权限来管理这些文件的共享权限，即要有 root 权限。 现在我已经登录了一个 ubuntu 的账号，是系统初始化的，拥有 root 权限。 下面我就模拟创建三个账号和一个用户组，来得到如下效果：</p>
                  <ul>
                    <li>账号 cqc 是我自己使用的账号，拥有最高权限，可以自由调整文件权限信息，可以自由为某个用户分配用户组。</li>
                    <li>账号 lbd 是我实验室的人员，没有 root 权限，但能查看和修改我共享的文件。</li>
                    <li>账号 slb 不是我实验室的人员，没有 root 权限，也不能修改我共享的文件。</li>
                  </ul>
                  <h3 id="创建自己的账户"><a href="#创建自己的账户" class="headerlink" title="创建自己的账户"></a>创建自己的账户</h3>
                  <p>首先我先为自己创建一个账户，添加一个 cqc 的用户：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">sudo</span> <span class="keyword">adduser </span>cqc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行之后会提示输入密码和其他信息：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Adding<span class="built_in"> user </span>`cqc<span class="string">' ...</span></span><br><span class="line"><span class="string">Adding new group `cqc'</span> (1002) <span class="built_in">..</span>.</span><br><span class="line">Adding new<span class="built_in"> user </span>`cqc<span class="string">' (1002) with group `cqc'</span> <span class="built_in">..</span>.</span><br><span class="line">Creating home directory `/home/cqc<span class="string">' ...</span></span><br><span class="line"><span class="string">Copying files from `/etc/skel'</span> <span class="built_in">..</span>.</span><br><span class="line">Enter new UNIX password: </span><br><span class="line">Retype new UNIX password: </span><br><span class="line">passwd: password updated successfully</span><br><span class="line">Changing the<span class="built_in"> user </span>information <span class="keyword">for</span> cqc</span><br><span class="line">Enter the new value, <span class="keyword">or</span> press ENTER <span class="keyword">for</span> the default</span><br><span class="line">        Full Name []: </span><br><span class="line">        Room Number []: </span><br><span class="line">        Work Phone []: </span><br><span class="line">        Home Phone []: </span><br><span class="line">        Other []: </span><br><span class="line">Is the information correct? [Y/n]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时候发现一个同名的组就被创建了，查看下 cqc 所在的组：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">groups cqc</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">cqc : <span class="type">cqc</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>再用 id 命令查看下信息：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">id</span> cqc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">uid=1002(<span class="name">cqc</span>) gid=1002(<span class="name">cqc</span>) groups=1002(<span class="name">cqc</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到当前 cqc 只属于 cqc 用户组。 接下来我们创建一个用户组，叫做 lab，来标明我的实验室，命令如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo groupadd lab</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后查看下用户组里面的成员：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">members lab</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>没有任何结果，说明我们创建了一个空的组，没有任何成员。 然后我们将刚才创建的 cqc 加入到该组中，因为我自己也属于该实验室，肯定也要加进来，命令如下：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">sudo</span> <span class="keyword">adduser </span>cqc lab</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Adding<span class="built_in"> user </span>`cqc<span class="string">' to group `lab'</span> <span class="built_in">..</span>.</span><br><span class="line">Adding<span class="built_in"> user </span>cqc <span class="keyword">to</span><span class="built_in"> group </span>lab</span><br><span class="line">Done.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后查看下组内成员：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">members lab</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">cqc</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样 lab 组内就有了 cqc 这个用户了。 别忘了 cqc 还需要拥有 root 权限，所以我们还需要将 cqc 添加到 sudo 组内，命令如下：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">sudo</span> <span class="keyword">adduser </span>cqc sudo</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Adding<span class="built_in"> user </span>`cqc<span class="string">' to group `sudo'</span> <span class="built_in">..</span>.</span><br><span class="line">Adding<span class="built_in"> user </span>cqc <span class="keyword">to</span><span class="built_in"> group </span>sudo</span><br><span class="line">Done.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就成功加入到 sudo 组了，cqc 也就是我的账户就可以使用 sudo 命令了。 查看下用户状态：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">id</span> cqc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">uid</span>=1002(cqc) <span class="attribute">gid</span>=1002(cqc) <span class="attribute">groups</span>=1002(cqc),27(sudo),1003(lab)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样 cqc 就属于三个用户组了，既是实验室成员，又拥有 root 权限。 上面的分配用户组的命令我们也可以使用 usermod 来实现：</p>
                  <figure class="highlight nginx">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo</span> usermod -aG sudo,lab cqc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就添加到多个组了。</p>
                  <h3 id="添加实验室用户"><a href="#添加实验室用户" class="headerlink" title="添加实验室用户"></a>添加实验室用户</h3>
                  <p>接下来，再添加实验室的另外一个人员 lbd，然后将其添加到 lab 组中，流程是类似的，命令如下：</p>
                  <figure class="highlight mipsasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo <span class="keyword">adduser </span><span class="keyword">lbd</span></span><br><span class="line"><span class="keyword">sudo </span><span class="keyword">adduser </span><span class="keyword">lbd </span>lab</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行完毕之后，id 命令查看其信息：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">id</span> lbd</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">uid</span>=1004(lbd) <span class="attribute">gid</span>=1005(lbd) <span class="attribute">groups</span>=1005(lbd),1003(lab)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就成功创建 lbd，并将其添加到实验室 lab 组了。</p>
                  <h3 id="添加非实验室用户"><a href="#添加非实验室用户" class="headerlink" title="添加非实验室用户"></a>添加非实验室用户</h3>
                  <p>最后另外添加一个用户 slb，非实验室成员，只创建账户就好了，命令如下：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">sudo</span> <span class="keyword">adduser </span>slb</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但是我们不把他加入 lab 组中。 查看他的状态：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">id</span> slb</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">uid=1003(<span class="name">slb</span>) gid=1004(<span class="name">slb</span>) groups=1004(<span class="name">slb</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所以三人的状态是这样的：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">id cqc</span><br><span class="line"><span class="attribute">uid</span>=1002(cqc) <span class="attribute">gid</span>=1002(cqc) <span class="attribute">groups</span>=1002(cqc),27(sudo),1003(lab)</span><br><span class="line">id lbd</span><br><span class="line"><span class="attribute">uid</span>=1004(lbd) <span class="attribute">gid</span>=1005(lbd) <span class="attribute">groups</span>=1005(lbd),1003(lab)</span><br><span class="line">id slb</span><br><span class="line"><span class="attribute">uid</span>=1003(slb) <span class="attribute">gid</span>=1004(slb) <span class="attribute">groups</span>=1004(slb)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="文件权限分配"><a href="#文件权限分配" class="headerlink" title="文件权限分配"></a>文件权限分配</h3>
                  <p>接下来我们创建一个文件夹来共享实验室数据，放在 /srv 目录下。然后调用 mkdir 命令创建名称为 share 的文件夹，命令如下：</p>
                  <figure class="highlight dos">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">cd</span> /srv</span><br><span class="line">sudo <span class="built_in">mkdir</span> share</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>注意这里我还是使用 ubuntu 账户来创建的。 先看下当前目录权限：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">ls -l</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">total <span class="number">12</span></span><br><span class="line">drwxr-xr-x  <span class="number">3</span> root root <span class="number">4096</span> Sep  <span class="number">4</span> <span class="number">18</span>:<span class="number">17</span> ./</span><br><span class="line">drwxr-xr-x <span class="number">24</span> root root <span class="number">4096</span> Sep  <span class="number">4</span> <span class="number">18</span>:<span class="number">17</span> ../</span><br><span class="line">drwxr-xr-x  <span class="number">2</span> root root <span class="number">4096</span> Sep  <span class="number">4</span> <span class="number">18</span>:<span class="number">17</span> share/</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到 share 文件的所有者是 root，用户组也是 root，权限是 755，即只有 root 拥有修改权限，其他的只有读取和执行权限。 然后进入 share 文件夹创建一个 names.txt：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">cd</span> share</span><br><span class="line">sudo <span class="keyword">vi</span> names.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>编辑内容如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">cqc</span></span><br><span class="line"><span class="attribute">lbd</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>保存完毕之后，这时查看一下文件权限，如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">-rw-r----- <span class="number">1</span> root root    <span class="number">8</span> Sep  <span class="number">4</span> <span class="number">20</span>:<span class="number">00</span> names.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>权限是 640，这表明只有所有者 root 拥有写入的权限，所在组只有读的权限。 这时开启另外一个终端，登录 cqc 账号，实际上是不能查看和修改任何该文件的内容的，下面的修改和读取命令都会提示权限不够：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">vi</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br><span class="line"><span class="selector-tag">cat</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>为什么呢？因为该文件是刚才由 ubuntu 账号使用 sudo 命令创建的，因此文件的所有者是 root，并不是 cqc，因此即使文件的权限是 640，那也就不能使用文件所有者的权限，而且 cqc 也不属于 root 组，所以也不能使用文件组的权限了，因此什么都看不了，什么都改不了。 但 cqc 属于 sudo 组啊，可以利用 sudo 命令临时获取 root 权限，临时以 root 的身份来操作该文件，这样就可以来查看和修改文件了，因此下面的命令是有效的：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">vi</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">cat</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但这样还是需要使用 sudo 才能修改，很不方便。 这时如果我们把文件的所有者改成 cqc，情况那就不一样了。 使用 ubuntu 账号，对 names.txt 更改其所有者为 cqc，改的命令如下：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">chown</span> <span class="selector-tag">cqc</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时查看下文件信息：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">-rw-r----- <span class="number">1</span> cqc  root    <span class="number">8</span> Sep  <span class="number">4</span> <span class="number">20</span>:<span class="number">29</span> names.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到所有者信息已经变成了 cqc，这样 cqc 账号再直接查看和修改，那就可以了，不再需要 sudo 命令：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">vi</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br><span class="line"><span class="selector-tag">cat</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就不会有权限提示，当然加上 sudo 更是没问题。 好，接下来 lbd 呢？我们登录试试修改。 首先当前的文件状态是这样的：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">-rw-r----- <span class="number">1</span> cqc  root    <span class="number">8</span> Sep  <span class="number">4</span> <span class="number">20</span>:<span class="number">31</span> names.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>lbd 不是所有者了，因此前面的 rw- 权限是没什么用的，但他属于 lab 组，而该文件对于用户组的权限是 r—，也就是读取权限。 我们使用 lbd 账号来尝试看下文件的内容：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">cat</span> names.txt </span><br><span class="line"><span class="keyword">ca</span><span class="variable">t:</span> names.tx<span class="variable">t:</span> Permission denied</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>很遗憾，又没有权限。因为什么？因为这个文件的用户组并不是 lab 啊，而 lbd 这个用户又不属于 root 组，所以没有任何权限。 那咋办？将文件的用户组改成 lab 就好了，使用 ubuntu 账号或 cqc 账号来操作：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">chgrp</span> <span class="selector-tag">lab</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就成功将文件所属用户组改成 lab 了，接下来再使用 lbd 账号查看下文件内容：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">cat</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就成功读取了。 然而 lbd 现在是没有写入权限的，因为对于用户组来说，该文件的权限是 r—，如果要获取写入权限，我们可以使用如下命令：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">chmod</span> <span class="selector-tag">g</span>+<span class="selector-tag">w</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod <span class="number">660</span> names.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就相当于赋予了 rw- 权限，下面我们再使用 lbd 账号尝试修改这个文件：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">vi</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就没问题了。 那么对于非实验室同学 slb 呢？它没有任何权限，我们登录 slb 账号尝试修改和读取该文件：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">cat</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br><span class="line"><span class="selector-tag">vi</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>均无权限。 所以说，这样我们就成功为实验室的人员赋予了权限，而非实验室的人则没有任何权限。 如果我要为 slb 赋予读取权限咋办呢？很简单，添加一下就好了：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">chmod</span> <span class="selector-tag">o</span>+<span class="selector-tag">r</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这就是为其他用户添加了读取权限。这时 slb 就可以读取文件，但不能修改文件，也是比较安全的。 好，如果我的文件非常多呢？比如十几二十个，都放在 share 文件夹内，那不能一个个进行权限设置吧？ 这时候我们只需要针对文件夹进行操作即可，下面的命令就可以为 share 文件夹赋予 775 权限，即所有者 cqc 和所在组 lab 可对其进行查看和修改，其他的人只能看不能改：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod -R <span class="number">775</span> <span class="keyword">share</span>/</span><br><span class="line">sudo chown -R cqc <span class="keyword">share</span>/</span><br><span class="line">sudo chgrp -R lab <span class="keyword">share</span>/</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>注意文件夹一般都会赋予 x 权限，不然连进入文件夹的权限都没有。这也就是文件夹一般会赋予 775、755，而文件会赋予 664、600、644、640 的原因了。 赋予 775 权限之后，share 的权限就变成了：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">drwxrwxr-x  <span class="number">2</span> cqc  lab  <span class="number">4096</span> Sep  <span class="number">4</span> <span class="number">20</span>:<span class="number">31</span> share/</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样其他用户就只能看，不能改，这样普通文件就没什么问题了。 如文件夹内包含了可执行文件，还可以单独为其他用户针对可执行文件去除 x 权限，如去除 Python 文件的可执行权限：</p>
                  <figure class="highlight nginx">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo</span> chmod o-x <span class="regexp">*.py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好了，到现在为止，我们就得心应手地完成了权限控制了！ 相信如果你耐心看完的话，什么用户管理、权限管理，都不在话下！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-09-04 23:20:13" itemprop="dateCreated datePublished" datetime="2018-09-04T23:20:13+08:00">2018-09-04</time>
                </span>
                <span id="/6284.html" class="post-meta-item leancloud_visitors" data-flag-title="详解 Linux 下的用户管理、用户组管理和权限管理" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>9.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>8 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6281.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Linux <i class="label-arrow"></i>
                  </a>
                  <a href="/6281.html" class="post-title-link" itemprop="url">如何给Azure云服务器扩展云磁盘</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本文介绍一下如何给 Azure 的云服务器增加一块磁盘。</p>
                  <h2 id="页面操作"><a href="#页面操作" class="headerlink" title="页面操作"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Azure%E3%80%91%E7%BB%99Azure%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%89%A9%E5%B1%95%E7%A3%81%E7%9B%98.md#%E9%A1%B5%E9%9D%A2%E6%93%8D%E4%BD%9C" target="_blank" rel="noopener"></a>页面操作</h2>
                  <p>首先切换到磁盘页面，然后点击添加数据磁盘按钮： <a href="https://github.com/Germey/AI/blob/master/assets/2018-08-02-16-42-27.jpg" target="_blank" rel="noopener"><img src="https://github.com/Germey/AI/raw/master/assets/2018-08-02-16-42-27.jpg" alt=""></a> 然后选定存储容器，这里使用的是存储账户 Blob，然后点击确定按钮： <a href="https://github.com/Germey/AI/blob/master/assets/2018-08-02-16-43-38.jpg" target="_blank" rel="noopener"><img src="https://github.com/Germey/AI/raw/master/assets/2018-08-02-16-43-38.jpg" alt=""></a> 主机缓存切换为“读/写”，然后点击保存： <a href="https://github.com/Germey/AI/blob/master/assets/2018-08-02-16-44-09.jpg" target="_blank" rel="noopener"><img src="https://github.com/Germey/AI/raw/master/assets/2018-08-02-16-44-09.jpg" alt=""></a> 这样就添加好了。</p>
                  <h2 id="挂载磁盘"><a href="#挂载磁盘" class="headerlink" title="挂载磁盘"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Azure%E3%80%91%E7%BB%99Azure%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%89%A9%E5%B1%95%E7%A3%81%E7%9B%98.md#%E6%8C%82%E8%BD%BD%E7%A3%81%E7%9B%98" target="_blank" rel="noopener"></a>挂载磁盘</h2>
                  <p>接下来回到 Linux 服务器下，我们需要将磁盘进行挂载。 首先 SSH 连接到服务器，然后使用 dmesg 命令来查找磁盘：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">dmesg <span class="string">| grep SCSI</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出类似如下：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-attr">[    0.728389]</span> <span class="selector-tag">SCSI</span> <span class="selector-tag">subsystem</span> <span class="selector-tag">initialized</span></span><br><span class="line"><span class="selector-attr">[    2.139341]</span> <span class="selector-tag">Block</span> <span class="selector-tag">layer</span> <span class="selector-tag">SCSI</span> <span class="selector-tag">generic</span> (<span class="selector-tag">bsg</span>) <span class="selector-tag">driver</span> <span class="selector-tag">version</span> 0<span class="selector-class">.4</span> <span class="selector-tag">loaded</span> (<span class="selector-tag">major</span> 244)</span><br><span class="line"><span class="selector-attr">[    2.978928]</span> <span class="selector-tag">sd</span> 1<span class="selector-pseudo">:0</span><span class="selector-pseudo">:1</span><span class="selector-pseudo">:0</span>: <span class="selector-attr">[sdb]</span> <span class="selector-tag">Attached</span> <span class="selector-tag">SCSI</span> <span class="selector-tag">disk</span></span><br><span class="line"><span class="selector-attr">[    3.341183]</span> <span class="selector-tag">sd</span> 0<span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span>: <span class="selector-attr">[sda]</span> <span class="selector-tag">Attached</span> <span class="selector-tag">SCSI</span> <span class="selector-tag">disk</span></span><br><span class="line"><span class="selector-attr">[   18.397942]</span> <span class="selector-tag">Loading</span> <span class="selector-tag">iSCSI</span> <span class="selector-tag">transport</span> <span class="selector-tag">class</span> <span class="selector-tag">v2</span><span class="selector-class">.0-870</span>.</span><br><span class="line"><span class="selector-attr">[ 6641.364794]</span> <span class="selector-tag">sd</span> 3<span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span>: <span class="selector-attr">[sdc]</span> <span class="selector-tag">Attached</span> <span class="selector-tag">SCSI</span> <span class="selector-tag">disk</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 sdc 就是我们新添加的一块硬盘。 然后我们使用 fdisk 对其进行分区，将其设置为分区 1 中的主磁盘，并接受其他的默认值，命令如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo fdisk <span class="regexp">/dev/</span>sdc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>使用 n 命令添加新分区，然后 p 选择主分区，其他的默认：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Welcome <span class="keyword">to</span> fdisk (util-linux 2.27.1).</span><br><span class="line">Changes will remain <span class="keyword">in</span> memory only, until you decide <span class="keyword">to</span> write them.</span><br><span class="line">Be careful before using the write command.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Device does <span class="keyword">not</span> contain a recognized partition table.</span><br><span class="line">Created a new DOS disklabel with disk identifier 0xc305fe54.</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> help): n</span><br><span class="line">Partition type</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended (container <span class="keyword">for</span> logical partitions)</span><br><span class="line">Select (default p): p</span><br><span class="line">Partition number (1-4,<span class="built_in"> default </span>1): </span><br><span class="line">First sector (2048-2145386495,<span class="built_in"> default </span>2048): </span><br><span class="line">Last sector, +sectors <span class="keyword">or</span> +size&#123;K,M,G,T,P&#125; (2048-2145386495,<span class="built_in"> default </span>2145386495): </span><br><span class="line"></span><br><span class="line">Created a new partition 1 of<span class="built_in"> type </span><span class="string">'Linux'</span> <span class="keyword">and</span> of size 1023 GiB.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后使用 p 打印分区表并使用 w 将表写入磁盘，然后退出：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Command (m for <span class="keyword">help</span>): p</span><br><span class="line">Disk /dev/sdc: <span class="number">1023</span> GiB, <span class="number">1098437885952</span> <span class="keyword">bytes</span>, <span class="number">2145386496</span> sectors</span><br><span class="line">Units: sectors <span class="keyword">of</span> <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">Sector <span class="keyword">size</span> (<span class="keyword">logical</span>/<span class="keyword">physical</span>): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">I/O <span class="keyword">size</span> (<span class="keyword">minimum</span>/<span class="keyword">optimal</span>): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">Disklabel <span class="keyword">type</span>: dos</span><br><span class="line">Disk identifier: <span class="number">0xc305fe54</span></span><br><span class="line"></span><br><span class="line">Device     Boot <span class="keyword">Start</span>        <span class="keyword">End</span>    Sectors  <span class="keyword">Size</span> <span class="keyword">Id</span> <span class="keyword">Type</span></span><br><span class="line">/dev/sdc1        <span class="number">2048</span> <span class="number">2145386495</span> <span class="number">2145384448</span> <span class="number">1023</span>G <span class="number">83</span> Linux</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="keyword">help</span>): w</span><br><span class="line">The <span class="keyword">partition</span> <span class="keyword">table</span> has been altered.</span><br><span class="line"><span class="keyword">Calling</span> ioctl() <span class="keyword">to</span> re-<span class="keyword">read</span> <span class="keyword">partition</span> table.</span><br><span class="line">Syncing disks.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来使用 mkfs 命令将文件系统写入分区，指定文件系统的类型和设备名称：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo mkfs -t ext4 <span class="regexp">/dev/</span>sdc1</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出类似如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">mke2fs <span class="number">1.42</span><span class="number">.13</span> (<span class="number">17</span>-May<span class="number">-2015</span>)</span><br><span class="line">Creating filesystem with <span class="number">268173056</span> <span class="number">4</span>k blocks <span class="keyword">and</span> <span class="number">67043328</span> inodes</span><br><span class="line">Filesystem UUID: d744c5d7-f4d1<span class="number">-4f</span>81<span class="number">-9f</span>56<span class="number">-59</span>dfab956782</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">        <span class="number">32768</span>, <span class="number">98304</span>, <span class="number">163840</span>, <span class="number">229376</span>, <span class="number">294912</span>, <span class="number">819200</span>, <span class="number">884736</span>, <span class="number">1605632</span>, <span class="number">2654208</span>, </span><br><span class="line">        <span class="number">4096000</span>, <span class="number">7962624</span>, <span class="number">11239424</span>, <span class="number">20480000</span>, <span class="number">23887872</span>, <span class="number">71663616</span>, <span class="number">78675968</span>, </span><br><span class="line">        <span class="number">102400000</span>, <span class="number">214990848</span></span><br><span class="line"></span><br><span class="line">Allocating group tables: done                            </span><br><span class="line">Writing inode tables: done                            </span><br><span class="line">Creating journal (<span class="number">32768</span> blocks): done</span><br><span class="line">Writing superblocks <span class="keyword">and</span> filesystem accounting information: done</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后使用 mkdir 创建一个目录来装载该文件系统，然后挂载：</p>
                  <figure class="highlight jboss-cli">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo mkdir <span class="string">/datadrive</span></span><br><span class="line">sudo mount <span class="string">/dev/sdc1</span> <span class="string">/datadrive</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就挂载成功了。</p>
                  <h2 id="添加引导信息"><a href="#添加引导信息" class="headerlink" title="添加引导信息"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Azure%E3%80%91%E7%BB%99Azure%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%89%A9%E5%B1%95%E7%A3%81%E7%9B%98.md#%E6%B7%BB%E5%8A%A0%E5%BC%95%E5%AF%BC%E4%BF%A1%E6%81%AF" target="_blank" rel="noopener"></a>添加引导信息</h2>
                  <p>若要确保在重新引导后自动重新装载驱动器，必须将其添加到 /etc/fstab 文件。 此外，强烈建议在 /etc/fstab 中使用 UUID（全局唯一标识符）来引用驱动器而不是只使用设备名称（例如 /dev/sdc1）。 如果 OS 在启动过程中检测到磁盘错误，使用 UUID 可以避免将错误的磁盘装载到给定位置。 然后，为剩余的数据磁盘分配这些设备 ID。 若要查找新驱动器的 UUID，请使用 blkid 实用工具：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo -i blkid</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输入类似如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">/dev/sdb1: <span class="attribute">UUID</span>=<span class="string">"d5b61f40-4129-4b39-b861-c2d3b09cee69"</span> <span class="attribute">TYPE</span>=<span class="string">"ext4"</span> <span class="attribute">PARTUUID</span>=<span class="string">"4927b944-01"</span></span><br><span class="line">/dev/sda1: <span class="attribute">LABEL</span>=<span class="string">"cloudimg-rootfs"</span> <span class="attribute">UUID</span>=<span class="string">"b2e62f4f-d338-470e-9ae7-4fc0e014858c"</span> <span class="attribute">TYPE</span>=<span class="string">"ext4"</span> <span class="attribute">PARTUUID</span>=<span class="string">"577c3e7c-01"</span></span><br><span class="line">/dev/sdc1: <span class="attribute">UUID</span>=<span class="string">"d744c5d7-f4d1-4f81-9f56-59dfab956782"</span> <span class="attribute">TYPE</span>=<span class="string">"ext4"</span> <span class="attribute">PARTUUID</span>=<span class="string">"c305fe54-01"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后编辑 /etc/fstab，添加下面一行：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">UUID=d744c5d7-f4d1<span class="number">-4f</span>81<span class="number">-9f</span>56<span class="number">-59</span>dfab956782       /datadrive      ext4    defaults,nofail <span class="number">1</span>      <span class="number">2</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后保存退出即可。 这样就成功添加了一块外部磁盘。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-09-04 15:42:35" itemprop="dateCreated datePublished" datetime="2018-09-04T15:42:35+08:00">2018-09-04</time>
                </span>
                <span id="/6281.html" class="post-meta-item leancloud_visitors" data-flag-title="如何给Azure云服务器扩展云磁盘" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6255.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Other <i class="label-arrow"></i>
                  </a>
                  <a href="/6255.html" class="post-title-link" itemprop="url">Ubuntu 搭建 Elasticsearch 6 集群流程</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="为何要搭建-Elasticsearch-集群"><a href="#为何要搭建-Elasticsearch-集群" class="headerlink" title="为何要搭建 Elasticsearch 集群"></a>为何要搭建 Elasticsearch 集群</h2>
                  <p>凡事都要讲究个为什么。在搭建集群之前，我们首先先问一句，为什么我们需要搭建集群？它有什么优势呢？</p>
                  <h3 id="高可用性"><a href="#高可用性" class="headerlink" title="高可用性"></a>高可用性</h3>
                  <p>Elasticsearch 作为一个搜索引擎，我们对它的基本要求就是存储海量数据并且可以在非常短的时间内查询到我们想要的信息。所以第一步我们需要保证的就是 Elasticsearch 的高可用性，什么是高可用性呢？它通常是指，通过设计减少系统不能提供服务的时间。假设系统一直能够提供服务，我们说系统的可用性是 100%。如果系统在某个时刻宕掉了，比如某个网站在某个时间挂掉了，那么就可以它临时是不可用的。所以，为了保证 Elasticsearch 的高可用性，我们就应该尽量减少 Elasticsearch 的不可用时间。 那么怎样提高 Elasticsearch 的高可用性呢？这时集群的作用就体现出来了。假如 Elasticsearch 只放在一台服务器上，即单机运行，假如这台主机突然断网了或者被攻击了，那么整个 Elasticsearch 的服务就不可用了。但如果改成 Elasticsearch 集群的话，有一台主机宕机了，还有其他的主机可以支撑，这样就仍然可以保证服务是可用的。 那可能有的小伙伴就会说了，那假如一台主机宕机了，那么不就无法访问这台主机的数据了吗？那假如我要访问的数据正好存在这台主机上，那不就获取不到了吗？难道其他的主机里面也存了一份一模一样的数据？那这岂不是很浪费吗？ 为了解答这个问题，这里就引出了 Elasticsearch 的信息存储机制了。首先解答上面的问题，一台主机宕机了，这台主机里面存的数据依然是可以被访问到的，因为在其他的主机上也有备份，但备份的时候也不是整台主机备份，是分片备份的，那这里就又引出了一个概念——分片。 分片，英文叫做 Shard，顾名思义，分片就是对数据切分成了多个部分。我们知道 Elasticsearch 中一个索引（Index）相当于是一个数据库，如存某网站的用户信息，我们就建一个名为 user 的索引。但索引存储的时候并不是整个存一起的，它是被分片存储的，Elasticsearch 默认会把一个索引分成五个分片，当然这个数字是可以自定义的。分片是数据的容器，数据保存在分片内，分片又被分配到集群内的各个节点里。当你的集群规模扩大或者缩小时， Elasticsearch 会自动的在各节点中迁移分片，使得数据仍然均匀分布在集群里，所以相当于一份数据被分成了多份并保存在不同的主机上。 那这还是没解决问题啊，如果一台主机挂掉了，那么这个分片里面的数据不就无法访问了？别的主机都是存储的其他的分片。其实是可以访问的，因为其他主机存储了这个分片的备份，叫做副本，这里就引出了另外一个概念——副本。 副本，英文叫做 Replica，同样顾名思义，副本就是对原分片的复制，和原分片的内容是一样的，Elasticsearch 默认会生成一份副本，所以相当于是五个原分片和五个分片副本，相当于一份数据存了两份，并分了十个分片，当然副本的数量也是可以自定义的。这时我们只需要将某个分片的副本存在另外一台主机上，这样当某台主机宕机了，我们依然还可以从另外一台主机的副本中找到对应的数据。所以从外部来看，数据结果是没有任何区别的。 一般来说，Elasticsearch 会尽量把一个索引的不同分片存储在不同的主机上，分片的副本也尽可能存在不同的主机上，这样可以提高容错率，从而提高高可用性。 但这时假如你只有一台主机，那不就没办法了吗？分片和副本其实是没意义的，一台主机挂掉了，就全挂掉了。</p>
                  <h3 id="健康状态"><a href="#健康状态" class="headerlink" title="健康状态"></a>健康状态</h3>
                  <p>针对一个索引，Elasticsearch 中其实有专门的衡量索引健康状况的标志，分为三个等级：</p>
                  <ul>
                    <li>green，绿色。这代表所有的主分片和副本分片都已分配。你的集群是 100% 可用的。</li>
                    <li>yellow，黄色。所有的主分片已经分片了，但至少还有一个副本是缺失的。不会有数据丢失，所以搜索结果依然是完整的。不过，你的高可用性在某种程度上被弱化。如果更多的分片消失，你就会丢数据了。所以可把 yellow 想象成一个需要及时调查的警告。</li>
                    <li>red，红色。至少一个主分片以及它的全部副本都在缺失中。这意味着你在缺少数据：搜索只能返回部分数据，而分配到这个分片上的写入请求会返回一个异常。</li>
                  </ul>
                  <p>如果你只有一台主机的话，其实索引的健康状况也是 yellow，因为一台主机，集群没有其他的主机可以防止副本，所以说，这就是一个不健康的状态，因此集群也是十分有必要的。</p>
                  <h3 id="存储空间"><a href="#存储空间" class="headerlink" title="存储空间"></a>存储空间</h3>
                  <p>另外，既然是群集，那么存储空间肯定也是联合起来的，假如一台主机的存储空间是固定的，那么集群它相对于单个主机也有更多的存储空间，可存储的数据量也更大。 所以综上所述，我们需要一个集群！</p>
                  <h2 id="详细了解-Elasticsearch-集群"><a href="#详细了解-Elasticsearch-集群" class="headerlink" title="详细了解 Elasticsearch 集群"></a>详细了解 Elasticsearch 集群</h2>
                  <p>接下来我们再来了解下集群的结构是怎样的。 首先我们应该清楚多台主机构成了一个集群，每台主机称作一个节点（Node）。 如图就是一个三节点的集群：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-04-23-52-42.png" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-04-23-52-42.png" alt=""></p>
                  <p>在图中，每个 Node 都有三个分片，其中 P 开头的代表 Primary 分片，即主分片，R 开头的代表 Replica 分片，即副本分片。所以图中主分片 1、2，副本分片 0 储存在 1 号节点，副本分片 0、1、2 储存在 2 号节点，主分片 0 和副本分片 1、2 储存在 3 号节点，一共是 3 个主分片和 6 个副本分片。同时我们还注意到 1 号节点还有个 MASTER 的标识，这代表它是一个主节点，它相比其他的节点更加特殊，它有权限控制整个集群，比如资源的分配、节点的修改等等。 这里就引出了一个概念就是节点的类型，我们可以将节点分为这么四个类型：</p>
                  <ul>
                    <li>主节点：即 Master 节点。主节点的主要职责是和集群操作相关的内容，如创建或删除索引，跟踪哪些节点是群集的一部分，并决定哪些分片分配给相关的节点。稳定的主节点对集群的健康是非常重要的。默认情况下任何一个集群中的节点都有可能被选为主节点。索引数据和搜索查询等操作会占用大量的cpu，内存，io资源，为了确保一个集群的稳定，分离主节点和数据节点是一个比较好的选择。虽然主节点也可以协调节点，路由搜索和从客户端新增数据到数据节点，但最好不要使用这些专用的主节点。一个重要的原则是，尽可能做尽量少的工作。</li>
                    <li>数据节点：即 Data 节点。数据节点主要是存储索引数据的节点，主要对文档进行增删改查操作，聚合操作等。数据节点对 CPU、内存、IO 要求较高，在优化的时候需要监控数据节点的状态，当资源不够的时候，需要在集群中添加新的节点。</li>
                    <li>负载均衡节点：也称作 Client 节点，也称作客户端节点。当一个节点既不配置为主节点，也不配置为数据节点时，该节点只能处理路由请求，处理搜索，分发索引操作等，从本质上来说该客户节点表现为智能负载平衡器。独立的客户端节点在一个比较大的集群中是非常有用的，他协调主节点和数据节点，客户端节点加入集群可以得到集群的状态，根据集群的状态可以直接路由请求。</li>
                    <li>预处理节点：也称作 Ingest 节点，在索引数据之前可以先对数据做预处理操作，所有节点其实默认都是支持 Ingest 操作的，也可以专门将某个节点配置为 Ingest 节点。</li>
                  </ul>
                  <p>以上就是节点几种类型，一个节点其实可以对应不同的类型，如一个节点可以同时成为主节点和数据节点和预处理节点，但如果一个节点既不是主节点也不是数据节点，那么它就是负载均衡节点。具体的类型可以通过具体的配置文件来设置。</p>
                  <h2 id="怎样搭建-Elasticsearch-集群"><a href="#怎样搭建-Elasticsearch-集群" class="headerlink" title="怎样搭建 Elasticsearch 集群"></a>怎样搭建 Elasticsearch 集群</h2>
                  <p>好，接下来我们就来动手搭建一个集群吧。 这里我一共拥有七台 Linux 主机，系统是 Ubuntu 16.04，都连接在一个内网中，IP 地址为：</p>
                  <figure class="highlight accesslog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">10.0.0.4</span></span><br><span class="line"><span class="number">10.0.0.5</span></span><br><span class="line"><span class="number">10.0.0.6</span></span><br><span class="line"><span class="number">10.0.0.7</span></span><br><span class="line"><span class="number">10.0.0.8</span></span><br><span class="line"><span class="number">10.0.0.9</span></span><br><span class="line"><span class="number">10.0.0.10</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>每台主机的存储空间是 1TB，内存是 13GB。 下面我们来一步步介绍如何用这几台主机搭建一个 Elasticsearch 集群，这里使用的 Elasticsearch 版本是 6.3.2，另外我们还需要安装 Kibana 用来可视化监控和管理 Elasticsearch 的相关配置和数据，使得集群的管理更加方便。 环境配置如下所示：</p>
                  <p>名称</p>
                  <p>内容</p>
                  <p>主机台数</p>
                  <p>7</p>
                  <p>主机内存</p>
                  <p>13GB</p>
                  <p>主机系统</p>
                  <p>Ubuntu 16.04</p>
                  <p>存储空间</p>
                  <p>1TB</p>
                  <p>Elasticsearch 版本</p>
                  <p>6.3.2</p>
                  <p>Java 版本</p>
                  <p>1.8</p>
                  <p>Kibana 版本</p>
                  <p>6.3.2</p>
                  <h3 id="安装-Java"><a href="#安装-Java" class="headerlink" title="安装 Java"></a>安装 Java</h3>
                  <p>Elasticsearch 是基于 Lucene 的，而 Lucene 又是基于 Java 的。所以第一步我们就需要在每台主机上安装 Java。 首先更新 Apt 源：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">update</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后安装 Java：</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="keyword">get</span> install <span class="keyword">default</span>-jre</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装好了之后可以检查下 Java 的版本：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">java -<span class="built_in">version</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的版本是 1.8，类似输出如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">openjdk version <span class="string">"1.8.0_171"</span></span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_171-8u171-b11-0ubuntu0.16.04.1-b11)</span><br><span class="line">OpenJDK 64-Bit<span class="built_in"> Server </span>VM (build 25.171-b11, mixed mode)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果看到上面的内容就说明安装成功了。 注意一定要每台主机都要安装。</p>
                  <h2 id="安装-Elasticsearch"><a href="#安装-Elasticsearch" class="headerlink" title="安装 Elasticsearch"></a>安装 Elasticsearch</h2>
                  <p>接下来我们来安装 Elasticsearch，同样是每台主机都需要安装。 首先需要添加 Apt-key：</p>
                  <figure class="highlight sas">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">wget -qO - https://artifacts.elastic.co/GPG-<span class="meta">KEY</span>-elasticsearch | sudo apt-<span class="meta">key</span> <span class="meta">add</span> -</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后添加 Elasticsearch 的 Repository 定义：</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">echo <span class="string">"deb https://artifacts.elastic.co/packages/6.x/apt stable main"</span> | sudo tee -a /etc/apt/sources.<span class="type">list</span>.d/elastic<span class="number">-6.</span>x.<span class="type">list</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来安装 Elasticsearch 即可：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> update </span><br><span class="line">sudo apt-<span class="builtin-name">get</span> install elasticsearch</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行完毕之后我们就完成了 Elasticsearch 的安装，注意还是要每台主机都要安装。</p>
                  <h3 id="配置-Elasticsearch"><a href="#配置-Elasticsearch" class="headerlink" title="配置 Elasticsearch"></a>配置 Elasticsearch</h3>
                  <p>这时我们只是每台主机都安装好了 Elasticsearch，接下来我们还需要将它们联系在一起构成一个集群。 安装完之后，Elasticsearch 的配置文件是 /etc/elasticsearch/elasticsearch.yml，接下来让我们编辑一下配置文件：</p>
                  <ul>
                    <li>集群的名称</li>
                  </ul>
                  <p>通过 cluster.name 可以配置集群的名称，集群是一个整体，因此名称都要一致，所有主机都配置成相同的名称，配置示例：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">cluster</span>.name: germey-es-clusters</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>节点的名称</li>
                  </ul>
                  <p>通过 node.name 可以配置每个节点的名称，每个节点都是集群的一部分，每个节点名称都不要相同，可以按照顺序编号，配置示例：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">node</span>.name:<span class="title"> es-node-1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其他的主机可以配置为 es-node-2、es-node-3 等。</p>
                  <ul>
                    <li>是否有资格成为主节点</li>
                  </ul>
                  <p>通过 node.master 可以配置该节点是否有资格成为主节点，如果配置为 true，则主机有资格成为主节点，配置为 false 则主机就不会成为主节点，可以去当数据节点或负载均衡节点。注意这里是有资格成为主节点，不是一定会成为主节点，主节点需要集群经过选举产生。这里我配置所有主机都可以成为主节点，因此都配置为 true，配置示例： node.master: true</p>
                  <ul>
                    <li>是否是数据节点</li>
                  </ul>
                  <p>通过 node.data 可以配置该节点是否为数据节点，如果配置为 true，则主机就会作为数据节点，注意主节点也可以作为数据节点，当 node.master 和 node.data 均为 false，则该主机会作为负载均衡节点。这里我配置所有主机都是数据节点，因此都配置为 true，配置示例： node.data: true</p>
                  <ul>
                    <li>数据和日志路径</li>
                  </ul>
                  <p>通过 path.data 和 path.logs 可以配置 Elasticsearch 的数据存储路径和日志存储路径，可以指定任意位置，这里我指定存储到 1T 硬盘对应的路径下，另外注意一下写入权限问题，配置示例： path.data: /datadrive/elasticsearch/data path.logs: /datadrive/elasticsearch/logs</p>
                  <ul>
                    <li>​设置访问的地址和端口</li>
                  </ul>
                  <p>我们需要设定 Elasticsearch 运行绑定的 Host，默认是无法公开访问的，如果设置为主机的公网 IP 或 0.0.0.0 就是可以公开访问的，这里我们可以都设置为公开访问或者部分主机公开访问，如果是公开访问就配置为：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">network</span><span class="selector-class">.host</span>: 0<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果不想被公开访问就不用配置。 另外还可以配置访问的端口，默认是 9200： http.port: 9200</p>
                  <ul>
                    <li>集群地址设置</li>
                  </ul>
                  <p>通过 discovery.zen.ping.unicast.hosts 可以配置集群的主机地址，配置之后集群的主机之间可以自动发现，这里我配置的是内网地址，配置示例：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">discovery</span><span class="selector-class">.zen</span><span class="selector-class">.ping</span><span class="selector-class">.unicast</span><span class="selector-class">.hosts</span>: <span class="selector-attr">[<span class="string">"10.0.0.4"</span>, <span class="string">"10.0.0.5"</span>, <span class="string">"10.0.0.6"</span>, <span class="string">"10.0.0.7"</span>, <span class="string">"10.0.0.8"</span>, <span class="string">"10.0.0.9"</span>, <span class="string">"10.0.0.10"</span>]</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里请改成你的主机对应的 IP 地址。</p>
                  <ul>
                    <li>节点数目相关配置</li>
                  </ul>
                  <p>为了防止集群发生“脑裂”，即一个集群分裂成多个，通常需要配置集群最少主节点数目，通常为 (可成为主节点的主机数目 / 2) + 1，例如我这边可以成为主节点的主机数目为 7，那么结果就是 4，配置示例：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">discovery</span><span class="selector-class">.zen</span><span class="selector-class">.minimum_master_nodes</span>: 4</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外还可以配置当最少几个节点回复之后，集群就正常工作，这里我设置为 4，可以酌情修改，配置示例：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">gateway.recover_after_nodes: <span class="number">4</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其他的暂时先不需要配置，保存即可。注意每台主机都需要配置。</p>
                  <h3 id="启动-Elasticsearch"><a href="#启动-Elasticsearch" class="headerlink" title="启动 Elasticsearch"></a>启动 Elasticsearch</h3>
                  <p>配置完成之后就可以在每台主机上分别启动 Elasticsearch 服务了，命令如下：</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo<span class="keyword"> system</span>ctl daemon-reload</span><br><span class="line">sudo<span class="keyword"> system</span>ctl enable elasticsearch.service</span><br><span class="line">sudo<span class="keyword"> system</span>ctl start elasticsearch.service</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所有主机都启动之后，我们在任意主机上就可以查看到集群状态了，命令行如下：</p>
                  <figure class="highlight pf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -XGET 'http://localhost:<span class="number">9200</span>/_cluster/<span class="keyword">state</span>?pretty'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>类似的输出如下：</p>
                  <figure class="highlight clojure">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"cluster_name"</span>: <span class="string">"germey-es-clusters"</span>,</span><br><span class="line">    <span class="string">"compressed_size_in_bytes"</span>: <span class="number">20799</span>,</span><br><span class="line">    <span class="string">"version"</span>: <span class="number">658</span>,</span><br><span class="line">    <span class="string">"state_uuid"</span>: <span class="string">"a64wCwPnSueKRtVuKx8xRw"</span>,</span><br><span class="line">    <span class="string">"master_node"</span>: <span class="string">"73BQvOC2TpSXcr-IXBcDdg"</span>,</span><br><span class="line">    <span class="string">"blocks"</span>: &#123;&#125;,</span><br><span class="line">    <span class="string">"nodes"</span>: &#123;</span><br><span class="line">        <span class="string">"I2M80AP-T7yVP_AZPA0bpA"</span>: &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"es-node-1"</span>,</span><br><span class="line">            <span class="string">"ephemeral_id"</span>: <span class="string">"KpCG4jNvTUGKNHNwKKoMrA"</span>,</span><br><span class="line">            <span class="string">"transport_address"</span>: <span class="string">"10.0.0.4:9300"</span>,</span><br><span class="line">            <span class="string">"attributes"</span>: &#123;</span><br><span class="line">                <span class="string">"ml.machine_memory"</span>: <span class="string">"7308464128"</span>,</span><br><span class="line">                <span class="string">"ml.max_open_jobs"</span>: <span class="string">"20"</span>,</span><br><span class="line">                <span class="string">"xpack.installed"</span>: <span class="string">"true"</span>,</span><br><span class="line">                <span class="string">"ml.enabled"</span>: <span class="string">"true"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"73BQvOC2TpSXcr-IXBcDdg"</span>: &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"es-node-7"</span>,</span><br><span class="line">            <span class="string">"ephemeral_id"</span>: <span class="string">"Fs9v2XTASnGbqrM8g7IhAQ"</span>,</span><br><span class="line">            <span class="string">"transport_address"</span>: <span class="string">"10.0.0.10:9300"</span>,</span><br><span class="line">            <span class="string">"attributes"</span>: &#123;</span><br><span class="line">                <span class="string">"ml.machine_memory"</span>: <span class="string">"14695202816"</span>,</span><br><span class="line">                <span class="string">"ml.max_open_jobs"</span>: <span class="string">"20"</span>,</span><br><span class="line">                <span class="string">"xpack.installed"</span>: <span class="string">"true"</span>,</span><br><span class="line">                <span class="string">"ml.enabled"</span>: <span class="string">"true"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">....</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到这里输出了集群的相关信息，同时 nodes 字段里面包含了每个节点的详细信息，这样一个基本的集群就构建完成了。</p>
                  <h3 id="安装-Kibana"><a href="#安装-Kibana" class="headerlink" title="安装 Kibana"></a>安装 Kibana</h3>
                  <p>接下来我们需要安装一个 Kibana 来帮助可视化管理 Elasticsearch，依然还是通过 Apt 安装，只需要任意一台主机安装即可，因为集群是一体的，所以 Kibana 在任意一台主机只要能连接到 Elasticsearch 即可，安装命令如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install kibana</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装之后修改 /etc/kibana/kibana.yml，设置公开访问和绑定的端口：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">server</span><span class="selector-class">.port</span>: 5601</span><br><span class="line"><span class="selector-tag">server</span><span class="selector-class">.host</span>: "0<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.0</span>"</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后启动服务：</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo<span class="keyword"> system</span>ctl daemon-reload</span><br><span class="line">sudo<span class="keyword"> system</span>ctl enable kibana.service</span><br><span class="line">sudo<span class="keyword"> system</span>ctl start kibana.service</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们可以在浏览器输入该台主机的 IP 加端口，查看 Kibana 管理页面了，类似如下： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-05-01-44-28.jpg" alt=""></p>
                  <p>这样 Kibana 可视化管理就配置成功了。</p>
                  <h3 id="配置认证"><a href="#配置认证" class="headerlink" title="配置认证"></a>配置认证</h3>
                  <p>现在集群已经初步搭建完成了，但是现在集群很危险，如果我们配置了可公网访问，那么它是可以被任何人操作的，比如储存数据，增删节点等，这是非常危险的，所以我们必须要设置访问权限。 在 Elasticsearch 中，配置认证是通过 X-Pack 插件实现的，幸运的是，我们不需要额外安装了，在 Elasticsearch 6.3.2 版本中，该插件是默认集成到 Elasticsearch 中的，所以我们只需要更改一部分设置就可以了。 首先我们需要升级 License，只有修改了高级版 License 才能使用X-Pack 的权限认证功能。 在 Kibana 中访问 Management -&gt; Elasticsearch -&gt; License Management，点击右侧的升级 License 按钮，可以免费试用 30 天的高级 License，升级完成之后页面会显示如下：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-03-16-45-10.jpg" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-03-16-45-10.jpg" alt=""></p>
                  <p>另外还可以使用 API 来更新 License，详情可以参考官方文档：<span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9lbi9lbGFzdGljc2VhcmNoL3JlZmVyZW5jZS82LjIvdXBkYXRlLWxpY2Vuc2UuaHRtbA==">https://www.elastic.co/guide/en/elasticsearch/reference/6.2/update-license.html<i class="fa fa-external-link-alt"></i></span>。 然后每台主机需要修改 /etc/elasticsearch/elasticsearch.yml 文件，开启 Auth 认证功能：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">xpack</span><span class="selector-class">.security</span><span class="selector-class">.enabled</span>: <span class="selector-tag">true</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>随后设置 elastic、kibana、logstash_system 三个用户的密码，任意一台主机修改之后，一台修改，多台生效，命令如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="regexp">/usr/</span>share<span class="regexp">/elasticsearch/</span>bin<span class="regexp">/elasticsearch-setup-passwords interactive</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行之后会依次提示设置这三个用户的密码并确认，一共需要输入六次密码，完成之后就成功设置好了密码了。 修改完成之后重启 Elasticsearch 和 Kibana 服务：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">systemctl</span> <span class="selector-tag">restart</span> <span class="selector-tag">elasticsearch</span><span class="selector-class">.service</span></span><br><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">systemctl</span> <span class="selector-tag">restart</span> <span class="selector-tag">kibana</span><span class="selector-class">.service</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时再访问 Kibana 就会跳转到登录页面了：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-03-17-18-28.jpg" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-03-17-18-28.jpg" alt=""></p>
                  <p>可以使用 elastic 用户登录，它的角色是超级管理员，登录之后就可以重新进入 Kibana 的管理页面。 我们还可以自行修改和添加账户，在 Management -&gt; Security -&gt; User/Roles 里面：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-03-17-20-05.jpg" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-03-17-20-05.jpg" alt=""></p>
                  <p>例如这里添加一个超级管理员的账户：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-03-17-21-44.jpg" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-03-17-21-44.jpg" alt=""></p>
                  <p>这样以后我们就可以使用新添加的用户来登录和访问了。 另外修改权限认证之后，Elasticsearch 也不能直接访问了，我们也必须输入用户密码才可以访问和调用其 API，保证了安全性。</p>
                  <h3 id="开启内存锁定"><a href="#开启内存锁定" class="headerlink" title="开启内存锁定"></a>开启内存锁定</h3>
                  <p>系统默认会进行内存交换，这样会导致 Elasticsearch 的性能变差，我们查看下内存锁定状态，在任意一台主机上的访问 <span class="exturl" data-url="aHR0cDovL2lwOnBvcnQvX25vZGVzP2ZpbHRlcl9wYXRoPSoqLm1sb2NrYWxs77ya">http://ip:port/_nodes?filter_path=**.mlockall：<i class="fa fa-external-link-alt"></i></span> 可以看到如下结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"nodes"</span>: &#123;</span><br><span class="line">        <span class="attr">"73BQvOC2TpSXcr-IXBcDdg"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"9tRr4nFDT_2rErLLQB2dIQ"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"hskSDv_JQlCUnjp_INI8Kg"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"LgaRuqXBTZaBdDGAktFWJA"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"ZcsZgowERzuvpqVbYOgOEA"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"I2M80AP-T7yVP_AZPA0bpA"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"_mSmfhUtQiqhzTKZ7u75Dw"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这代表内存交换没有开启，会影响 Elasticsearch 的性能，所以我们需要开启内存物理地址锁定，每台主机需要修改 /etc/elasticsearch/elasticsearch.yml 文件，修改如下配置：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">bootstrap.<span class="string">memory_lock:</span> <span class="literal">true</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但这样修改之后重新启动是会报错的，Elasticsearch 无法正常启动，查看日志，报错如下：</p>
                  <figure class="highlight inform7">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">[1]</span> bootstrap checks failed</span><br><span class="line"><span class="comment">[1]</span>: memory locking requested for elasticsearch process but memory <span class="keyword">is</span> not <span class="keyword">locked</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里需要修改两个地方，第一个是 /etc/security/limits.conf，添加如下内容：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="bullet">* </span>soft nofile 65536</span><br><span class="line"><span class="bullet">* </span>hard nofile 65536</span><br><span class="line"><span class="bullet">* </span>soft nproc 32000</span><br><span class="line"><span class="bullet">* </span>hard nproc 32000</span><br><span class="line"><span class="bullet">* </span>hard memlock unlimited</span><br><span class="line"><span class="bullet">* </span>soft memlock unlimited</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外还需要修改 /etc/systemd/system.conf，修改如下内容：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">DefaultLimitNOFILE</span>=<span class="number">65536</span></span><br><span class="line"><span class="attr">DefaultLimitNPROC</span>=<span class="number">32000</span></span><br><span class="line"><span class="attr">DefaultLimitMEMLOCK</span>=infinity</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>详细的解释可以参考：<span class="exturl" data-url="aHR0cHM6Ly9zZWdtZW50ZmF1bHQuY29tL2EvMTE5MDAwMDAxNDg5MTg1Ng==">https://segmentfault.com/a/1190000014891856<i class="fa fa-external-link-alt"></i></span>。 修改之后重启 Elasticsearch 服务：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">systemctl</span> <span class="selector-tag">restart</span> <span class="selector-tag">elasticsearch</span><span class="selector-class">.service</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>重新访问刚才的地址，即可发现每台主机的物理地址锁定都被打开了：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"nodes"</span>: &#123;</span><br><span class="line">        <span class="attr">"73BQvOC2TpSXcr-IXBcDdg"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"9tRr4nFDT_2rErLLQB2dIQ"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"hskSDv_JQlCUnjp_INI8Kg"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"LgaRuqXBTZaBdDGAktFWJA"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"ZcsZgowERzuvpqVbYOgOEA"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"I2M80AP-T7yVP_AZPA0bpA"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"_mSmfhUtQiqhzTKZ7u75Dw"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就又解决了性能的问题。</p>
                  <h3 id="安装分词插件"><a href="#安装分词插件" class="headerlink" title="安装分词插件"></a>安装分词插件</h3>
                  <p>另外还推荐安装中文分词插件，这样可以对中文进行全文索引，安装命令如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo <span class="regexp">/usr/</span>share<span class="regexp">/elasticsearch/</span>bin<span class="regexp">/elasticsearch-plugin install https:/</span><span class="regexp">/github.com/m</span>edcl<span class="regexp">/elasticsearch-analysis-ik/</span>releases<span class="regexp">/download/</span>v6.<span class="number">3.2</span><span class="regexp">/elasticsearch-analysis-ik-6.3.2.zip</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装完之后需要重启 Elasticsearch 服务：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">systemctl</span> <span class="selector-tag">restart</span> <span class="selector-tag">elasticsearch</span><span class="selector-class">.service</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="主机监控"><a href="#主机监控" class="headerlink" title="主机监控"></a>主机监控</h3>
                  <p>到此为止，我们的 Elasticsearch 集群就搭建完成了。 最后我们看下 Kibana 的部分功能，看下整个 Elasticsearch 有没有在正常工作。 访问 Kibana，打开 Management -&gt; Elasticsearch -&gt;Index Management，即可看到当前有的一些索引和状态：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-05-02-29-07.jpg" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-05-02-29-07.jpg" alt=""></p>
                  <p>打开 Monitoring，可以查看 Elasticsearch 和 Kibana 的状态：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-05-02-27-33.jpg" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-05-02-27-33.jpg" alt=""></p>
                  <p>进一步点击 Nodes，可以查看各个节点的状态：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-05-02-28-01.jpg" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-05-02-28-01.jpg" alt=""></p>
                  <p>打开任意节点，可以查看当前资源状况变化：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-05-02-28-30.jpg" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-05-02-28-30.jpg" alt=""></p>
                  <p>另外还有一些其他的功能如可视化、图表、搜索等等，这里就不再一一列举了，更多功能可以详细了解 Kibana。 以上都是自己在安装过程中趟过的坑，如有疏漏，还望指正。 还有更多的 Elasticsearch 相关的内容可以参考官方文档：<span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9pbmRleC5odG1s">https://www.elastic.co/guide/index.html<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2>
                  <ul>
                    <li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9lbi94LXBhY2svY3VycmVudC9zZWN1cml0eS1nZXR0aW5nLXN0YXJ0ZWQuaHRtbA==">https://www.elastic.co/guide/en/x-pack/current/security-getting-started.html<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9zZWdtZW50ZmF1bHQuY29tL2EvMTE5MDAwMDAxNDg5MTg1Ng==">https://segmentfault.com/a/1190000014891856<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ExOTg2MDkwMy9hcnRpY2xlL2RldGFpbHMvNzI0Njc5OTY=">https://blog.csdn.net/a19860903/article/details/72467996<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9sb2d6LmlvL2Jsb2cvZWxhc3RpY3NlYXJjaC1jbHVzdGVyLXR1dG9yaWFsLw==">https://logz.io/blog/elasticsearch-cluster-tutorial/<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9lcy54aWFvbGVpbHUuY29tLzAyMF9EaXN0cmlidXRlZF9DbHVzdGVyLzMwX1NjYWxlX21vcmUuaHRtbA==">https://es.xiaoleilu.com/020_Distributed_Cluster/30_Scale_more.html<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FyY2hlcjExOS9hcnRpY2xlL2RldGFpbHMvNzY1ODkxODk=">https://blog.csdn.net/archer119/article/details/76589189<i class="fa fa-external-link-alt"></i></span></li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-08-05 02:57:01" itemprop="dateCreated datePublished" datetime="2018-08-05T02:57:01+08:00">2018-08-05</time>
                </span>
                <span id="/6255.html" class="post-meta-item leancloud_visitors" data-flag-title="Ubuntu 搭建 Elasticsearch 6 集群流程" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>11k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>10 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6217.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6217.html" class="post-title-link" itemprop="url">快来学习怎么可视化监控你的爬虫</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="大家好，我是四毛，下面是我的个人公众号，欢迎关注。有问题的可以私信我，看到就会回复。"><a href="#大家好，我是四毛，下面是我的个人公众号，欢迎关注。有问题的可以私信我，看到就会回复。" class="headerlink" title="大家好，我是四毛，下面是我的个人公众号，欢迎关注。有问题的可以私信我，看到就会回复。"></a>大家好，我是四毛，下面是我的个人公众号，欢迎关注。有问题的可以私信我，看到就会回复。</h1>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""> </p>
                  <h2 id="更新-2018年08月03日14-39-32"><a href="#更新-2018年08月03日14-39-32" class="headerlink" title="更新 2018年08月03日14:39:32"></a>更新 2018年08月03日14:39:32</h2>
                  <blockquote>
                    <p>其实可以利用scrapy的扩展展示更多的数据，立个flag，后面更新上来</p>
                  </blockquote>
                  <p> 好，开始今天的文章。 今天主要是来说一下怎么可视化来<strong>监控你的爬虫的状态</strong>。 相信大家在跑爬虫的过程中，也会好奇自己养的爬虫一分钟可以<strong>爬多少页面</strong>，<strong>多大的数据量</strong>，当然查询的方式多种多样。今天我来讲一种可视化的方法。</p>
                  <h3 id="关于爬虫数据在mongodb里的版本我写了一个可以热更新配置的版本，即添加了新的爬虫配置以后，不用重启程序，即可获取刚刚添加的爬虫的状态数据，大家可以通过关注我的公众号以后，-回复“可视化”即可获取脚本地址。"><a href="#关于爬虫数据在mongodb里的版本我写了一个可以热更新配置的版本，即添加了新的爬虫配置以后，不用重启程序，即可获取刚刚添加的爬虫的状态数据，大家可以通过关注我的公众号以后，-回复“可视化”即可获取脚本地址。" class="headerlink" title="关于爬虫数据在mongodb里的版本我写了一个可以热更新配置的版本，即添加了新的爬虫配置以后，不用重启程序，即可获取刚刚添加的爬虫的状态数据，大家可以通过关注我的公众号以后， 回复“可视化”即可获取脚本地址。"></a><strong>关于爬虫数据在mongodb里的版本我写了一个可以热更新配置的版本，即添加了新的爬虫配置以后，不用重启程序，即可获取刚刚添加的爬虫的状态数据，大家可以通过关注我的公众号以后， 回复“可视化”即可获取脚本地址</strong>。</h3>
                  <h2 id="1-成品图"><a href="#1-成品图" class="headerlink" title="1.成品图"></a>1.成品图</h2>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/Selection_164.png" alt=""> 这个是监控服务器网速的最后成果，显示的是下载与上传的网速，单位为M。爬虫的原理都是一样的，只不过将数据存到InfluxDB的方式不一样而已， 如下图。</p>
                  <h3 id=""><a href="#" class="headerlink" title=""></a><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/Selection_172.png" alt=""></h3>
                  <p>可以实现对爬虫数量，增量，大小，大小增量的实时监控。 </p>
                  <h2 id="2-环境"><a href="#2-环境" class="headerlink" title="2. 环境"></a>2. 环境</h2>
                  <ul>
                    <li><strong>InfluxDb</strong>，是目前比较流行的时间序列数据库；</li>
                    <li><strong>Grafana</strong>，一个可视化面板（Dashboard），有着非常漂亮的图表和布局展示，功能齐全的度量仪表盘和图形编辑器，支持Graphite、zabbix、InfluxDB、Prometheus和OpenTSDB作为数据源</li>
                    <li><strong>Ubuntu</strong></li>
                    <li>
                      <p><strong>influxdb</strong>（pip install influxdb)</p>
                    </li>
                    <li>
                      <p><strong>Python 2.7</strong></p>
                    </li>
                  </ul>
                  <h2 id="3-原理"><a href="#3-原理" class="headerlink" title="3. 原理"></a>3. 原理</h2>
                  <blockquote>
                    <p>获取要展示的数据，包含当前的时间数据，存到InfluxDb里面，然后再到Grafana里面进行相应的配置即可展示；</p>
                  </blockquote>
                  <h2 id="4-安装"><a href="#4-安装" class="headerlink" title="4. 安装"></a>4. 安装</h2>
                  <h3 id="4-1-Grafana安装"><a href="#4-1-Grafana安装" class="headerlink" title="4.1 Grafana安装"></a>4.1 Grafana安装</h3>
                  <p> <span class="exturl" data-url="aHR0cDovL2RvY3MuZ3JhZmFuYS5vcmcvaW5zdGFsbGF0aW9uL2RlYmlhbi8=">官方安装指导<i class="fa fa-external-link-alt"></i></span> 安装好以后，打开本地的3000端口，即可进入管理界面，用户名与密码都是<strong>admin</strong>。</p>
                  <h3 id="4-2-InfulxDb安装"><a href="#4-2-InfulxDb安装" class="headerlink" title="4.2 InfulxDb安装"></a>4.2 InfulxDb安装</h3>
                  <p>这个安装就网上自己找吧，有很多的配置我都没有配置，就不在这里误人子弟了。</p>
                  <h2 id="5-InfluxDb简单操作"><a href="#5-InfluxDb简单操作" class="headerlink" title="5. InfluxDb简单操作"></a>5. InfluxDb简单操作</h2>
                  <p>碰到了数据库，肯定要把增删改查学会了啊， 和sql几乎一样，只有一丝丝的区别，具体操作，大家可以参考官方的文档。</p>
                  <ul>
                    <li><strong>influx</strong> 进入命令行</li>
                    <li><strong>CREATE DATABASE test</strong> 创建数据库</li>
                    <li><strong>show databases</strong> 查看数据库</li>
                    <li><strong>use test</strong> 使用数据库</li>
                    <li><strong>show series</strong> 看表</li>
                    <li><strong>select * from table_test</strong> 选择数据</li>
                    <li><strong>DROP MEASUREMENT table_test</strong> 删表</li>
                  </ul>
                  <h2 id="6-存数据"><a href="#6-存数据" class="headerlink" title="6. 存数据"></a>6. 存数据</h2>
                  <p>InfluxDb数据库的数据有一定的格式，因为我都是利用python库进行相关操作，所以下面将在python中的格式展示一下：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">json_body</span> = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"measurement"</span>: <span class="string">"crawler"</span>,</span><br><span class="line">        <span class="string">"time"</span>: current_time,</span><br><span class="line">        <span class="string">"tags"</span>: &#123;</span><br><span class="line">            <span class="string">"spider_name"</span>: collection_name</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"fields"</span>: &#123;</span><br><span class="line">            <span class="string">"count"</span>: current_count,</span><br><span class="line">            <span class="string">"increase_count"</span>: increase_amount,</span><br><span class="line">            <span class="string">"size"</span>: co_size,</span><br><span class="line">            <span class="string">"increase_size"</span>: increase_co_size</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中:</p>
                  <ul>
                    <li>measurement, 表名</li>
                    <li>time，时间</li>
                    <li>tags，标签</li>
                    <li>fields，字段</li>
                  </ul>
                  <p>可以看到，就是个列表里面，嵌套了一个字典。其中，对于时间字段，有特殊要求，可以参考<span class="exturl" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzIwOTA4ODMvaG93LXRvLXVzZS10aW1lLWZpZWxkLWluLWFkZGluZy1tZXRyaWNzLWRhdGEtdG8tdGhlLWluZmx1eC1kYg==">这里<i class="fa fa-external-link-alt"></i></span>， 下面是python实现方法：</p>
                  <figure class="highlight cos">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from datetime import datetime</span><br><span class="line">current_time = datetime.utcnow().strftime('<span class="built_in">%Y</span>-<span class="built_in">%m</span>-<span class="built_in">%dT</span><span class="built_in">%H</span>:<span class="built_in">%M</span>:<span class="built_in">%SZ</span>')</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所以，到这里，如何将爬虫的相关属性存进去呢？以MongoDB为例</p>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">mongodb_client</span> = pymongo.MongoClient(uri)</span><br><span class="line">    for db_name, collection_name <span class="keyword">in</span> dbs_and_cos.iteritems():</span><br><span class="line">        <span class="comment"># 数据库操作</span></span><br><span class="line">        <span class="attr">db</span> = mongodb_client[db_name]</span><br><span class="line">        <span class="attr">co</span> = db[collection_name]</span><br><span class="line">        <span class="comment"># 集合大小</span></span><br><span class="line">        <span class="attr">co_size</span> = round(float(db.command(<span class="string">"collstats"</span>, collection_name).get('size')) / <span class="number">1024</span> / <span class="number">1024</span>, <span class="number">2</span>)</span><br><span class="line">        <span class="comment"># 集合内数据条数</span></span><br><span class="line">        <span class="attr">current_count</span> = co.count()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化，当程序刚执行时，初始量就设置为第一次执行时获取的数据</span></span><br><span class="line">        <span class="attr">init_count</span> = _count_dict.get(collection_name, current_count)</span><br><span class="line">        <span class="comment"># 初始化，当程序刚执行时，初始量就设置为第一次执行时获取的数据大小</span></span><br><span class="line">        <span class="attr">init_size</span> = _size_dict.get(collection_name, co_size)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 条数增长量</span></span><br><span class="line">        <span class="attr">increase_amount</span> = current_count - init_count</span><br><span class="line">        <span class="comment"># 集合大小增长量</span></span><br><span class="line">        <span class="attr">increase_co_size</span> = co_size - init_size</span><br><span class="line"></span><br><span class="line">        <span class="attr">current_time</span> = datetime.utcnow().strftime('%Y-%m-%dT%H:%M:%SZ')</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 赋值</span></span><br><span class="line">        _size_dict[collection_name] = co_size</span><br><span class="line">        _count_dict[collection_name] = current_count</span><br><span class="line"></span><br><span class="line">        <span class="attr">json_body</span> = [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"measurement"</span>: <span class="string">"crawler"</span>,</span><br><span class="line">                <span class="string">"time"</span>: current_time,</span><br><span class="line">                <span class="string">"tags"</span>: &#123;</span><br><span class="line">                    <span class="string">"spider_name"</span>: collection_name</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"fields"</span>: &#123;</span><br><span class="line">                    <span class="string">"count"</span>: current_count,</span><br><span class="line">                    <span class="string">"increase_count"</span>: increase_amount,</span><br><span class="line">                    <span class="string">"size"</span>: co_size,</span><br><span class="line">                    <span class="string">"increase_size"</span>: increase_co_size</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">        print json_body</span><br><span class="line">        client.write_points(json_body)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>完整代码，关注上面的公众号，发送“”可视化“”即可获取。 那么现在我们已经往数据里存了数据了，那么接下来要做的就是把存的数据展示出来。</p>
                  <h2 id="7-展示数据"><a href="#7-展示数据" class="headerlink" title="7.展示数据"></a>7.展示数据</h2>
                  <h3 id="7-1-配置数据源"><a href="#7-1-配置数据源" class="headerlink" title="7.1 配置数据源"></a>7.1 配置数据源</h3>
                  <p>以admin登录到Grafana的后台后，我们首先需要配置一下数据源。点击左边栏的最下面的按钮，然后点击DATA SOURCES，这样就可以进入下面的页面： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/Selection_167.png" alt=""> 点击ADD DATA SOURCE，进行配置即可，如下图： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/Selection_168.png" alt=""> 其中，name自行设定；Type 选择InfluxDB；url为默认的<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo4MDg277yM">http://localhost:8086，<i class="fa fa-external-link-alt"></i></span> 其他的因为我前面没有进行配置，所以默认的即可。然后在InfluxDB Details里的填入Database名，最后点击测试，如果没有报错的话，则可以进入下一步的展示数据了；</p>
                  <h3 id="7-2-展示数据"><a href="#7-2-展示数据" class="headerlink" title="7.2 展示数据"></a>7.2 展示数据</h3>
                  <p>点击左边栏的+号，然后点击GRAPH <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/Selection_166.png" alt=""> 接着点击下图中的edit进入编辑页面： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/Selection_169.png" alt=""> <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/Selection_170.png" alt=""> 从上图中可以发现：</p>
                  <ul>
                    <li>中间板块是最后的数据展示</li>
                    <li>下面是数据的设置项</li>
                    <li>右上角是展示时间的设置板块，在这里可以选择要展示多久的数据</li>
                  </ul>
                  <h4 id="7-2-1-配置数据"><a href="#7-2-1-配置数据" class="headerlink" title="7.2.1 配置数据"></a>7.2.1 配置数据</h4>
                  <ol>
                    <li>在Data Source中选择刚刚在配置数据源的时候配置的NAME字段，而不是database名。</li>
                    <li>接着在下面选择要展示的数据。看着就很熟悉是不是，完全是sql语句的可视化。同时，当我们的数据放到相关的字段上的时候，双击，就会把可以选择的项展示出来了，我们要做的就是直接选择即可；</li>
                    <li>设置右上角的时间，则可以让数据实时进行更新与展示</li>
                  </ol>
                  <p>因为下面的配置实质就是sql查询语句，所以大家按照自己的需求，进行选择配置即可，当配置完以后，就可以在中间的面板里面看到数据了。 </p>
                  <h2 id="8-总结"><a href="#8-总结" class="headerlink" title="8. 总结"></a>8. 总结</h2>
                  <p>到这里，本篇文章就结束了。其中，对于Grafana的操作我没有介绍的很详细，因为本篇主要讲的是怎么利用这几个工具完成我们的任务。 同时，里面的功能确实很多，还有可以安装的插件。我自己目前还是仅仅对于用到的部分比较了解，所以大家可以查询官方的或者别的教程资料来对Grafana进行更深入的了解，制作出更加好看的可视化作品来。 最后，关注公众号，回复“可视化” 即可获取本文代码哦</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/四毛" class="author" itemprop="url" rel="index">四毛</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-08-02 19:24:36" itemprop="dateCreated datePublished" datetime="2018-08-02T19:24:36+08:00">2018-08-02</time>
                </span>
                <span id="/6217.html" class="post-meta-item leancloud_visitors" data-flag-title="快来学习怎么可视化监控你的爬虫" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6214.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6214.html" class="post-title-link" itemprop="url">Elasticsearch 基本介绍及其与 Python 的对接实现</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="什么是-Elasticsearch"><a href="#什么是-Elasticsearch" class="headerlink" title="什么是 Elasticsearch"></a>什么是 Elasticsearch</h2>
                  <p>想查数据就免不了搜索，搜索就离不开搜索引擎，百度、谷歌都是一个非常庞大复杂的搜索引擎，他们几乎索引了互联网上开放的所有网页和数据。然而对于我们自己的业务数据来说，肯定就没必要用这么复杂的技术了，如果我们想实现自己的搜索引擎，方便存储和检索，Elasticsearch 就是不二选择，它是一个全文搜索引擎，可以快速地储存、搜索和分析海量数据。</p>
                  <h2 id="为什么要用-Elasticsearch"><a href="#为什么要用-Elasticsearch" class="headerlink" title="为什么要用 Elasticsearch"></a>为什么要用 Elasticsearch</h2>
                  <p>Elasticsearch 是一个开源的搜索引擎，建立在一个全文搜索引擎库 Apache Lucene™ 基础之上。 那 Lucene 又是什么？Lucene 可能是目前存在的，不论开源还是私有的，拥有最先进，高性能和全功能搜索引擎功能的库，但也仅仅只是一个库。要用上 Lucene，我们需要编写 Java 并引用 Lucene 包才可以，而且我们需要对信息检索有一定程度的理解才能明白 Lucene 是怎么工作的，反正用起来没那么简单。 那么为了解决这个问题，Elasticsearch 就诞生了。Elasticsearch 也是使用 Java 编写的，它的内部使用 Lucene 做索引与搜索，但是它的目标是使全文检索变得简单，相当于 Lucene 的一层封装，它提供了一套简单一致的 RESTful API 来帮助我们实现存储和检索。 所以 Elasticsearch 仅仅就是一个简易版的 Lucene 封装吗？那就大错特错了，Elasticsearch 不仅仅是 Lucene，并且也不仅仅只是一个全文搜索引擎。 它可以被下面这样准确的形容：</p>
                  <ul>
                    <li>一个分布式的实时文档存储，每个字段可以被索引与搜索</li>
                    <li>一个分布式实时分析搜索引擎</li>
                    <li>能胜任上百个服务节点的扩展，并支持 PB 级别的结构化或者非结构化数据</li>
                  </ul>
                  <p>总之，是一个相当牛逼的搜索引擎，维基百科、Stack Overflow、GitHub 都纷纷采用它来做搜索。</p>
                  <h2 id="Elasticsearch-的安装"><a href="#Elasticsearch-的安装" class="headerlink" title="Elasticsearch 的安装"></a>Elasticsearch 的安装</h2>
                  <p>我们可以到 Elasticsearch 的官方网站下载 Elasticsearch：<span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9kb3dubG9hZHMvZWxhc3RpY3NlYXJjaA==">https://www.elastic.co/downloads/elasticsearch<i class="fa fa-external-link-alt"></i></span>，同时官网也附有安装说明。 首先把安装包下载下来并解压，然后运行 bin/elasticsearch（Mac 或 Linux）或者 bin\elasticsearch.bat (Windows) 即可启动 Elasticsearch 了。 我使用的是 Mac，Mac 下个人推荐使用 Homebrew 安装：</p>
                  <figure class="highlight mipsasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>elasticsearch</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Elasticsearch 默认会在 9200 端口上运行，我们打开浏览器访问 <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MjAwLw==">http://localhost:9200/<i class="fa fa-external-link-alt"></i></span> 就可以看到类似内容：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span> : <span class="string">"atntrTf"</span>,</span><br><span class="line">  <span class="attr">"cluster_name"</span> : <span class="string">"elasticsearch"</span>,</span><br><span class="line">  <span class="attr">"cluster_uuid"</span> : <span class="string">"e64hkjGtTp6_G2h1Xxdv5g"</span>,</span><br><span class="line">  <span class="attr">"version"</span> : &#123;</span><br><span class="line">    <span class="attr">"number"</span>: <span class="string">"6.2.4"</span>,</span><br><span class="line">    <span class="attr">"build_hash"</span>: <span class="string">"ccec39f"</span>,</span><br><span class="line">    <span class="attr">"build_date"</span>: <span class="string">"2018-04-12T20:37:28.497551Z"</span>,</span><br><span class="line">    <span class="attr">"build_snapshot"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"lucene_version"</span>: <span class="string">"7.2.1"</span>,</span><br><span class="line">    <span class="attr">"minimum_wire_compatibility_version"</span>: <span class="string">"5.6.0"</span>,</span><br><span class="line">    <span class="attr">"minimum_index_compatibility_version"</span>: <span class="string">"5.0.0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"tagline"</span> : <span class="string">"You Know, for Search"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果看到这个内容，就说明 Elasticsearch 安装并启动成功了，这里显示我的 Elasticsearch 版本是 6.2.4 版本，版本很重要，以后安装一些插件都要做到版本对应才可以。 接下来我们来了解一下 Elasticsearch 的基本概念以及和 Python 的对接。</p>
                  <h2 id="Elasticsearch-相关概念"><a href="#Elasticsearch-相关概念" class="headerlink" title="Elasticsearch 相关概念"></a>Elasticsearch 相关概念</h2>
                  <p>在 Elasticsearch 中有几个基本的概念，如节点、索引、文档等等，下面来分别说明一下，理解了这些概念对熟悉 Elasticsearch 是非常有帮助的。</p>
                  <h3 id="Node-和-Cluster"><a href="#Node-和-Cluster" class="headerlink" title="Node 和 Cluster"></a>Node 和 Cluster</h3>
                  <p>Elasticsearch 本质上是一个分布式数据库，允许多台服务器协同工作，每台服务器可以运行多个 Elasticsearch 实例。 单个 Elasticsearch 实例称为一个节点（Node）。一组节点构成一个集群（Cluster）。</p>
                  <h3 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h3>
                  <p>Elasticsearch 会索引所有字段，经过处理后写入一个反向索引（Inverted Index）。查找数据的时候，直接查找该索引。 所以，Elasticsearch 数据管理的顶层单位就叫做 Index（索引），其实就相当于 MySQL、MongoDB 等里面的数据库的概念。另外值得注意的是，每个 Index （即数据库）的名字必须是小写。</p>
                  <h3 id="Document"><a href="#Document" class="headerlink" title="Document"></a>Document</h3>
                  <p>Index 里面单条的记录称为 Document（文档）。许多条 Document 构成了一个 Index。 Document 使用 JSON 格式表示，下面是一个例子。 同一个 Index 里面的 Document，不要求有相同的结构（scheme），但是最好保持相同，这样有利于提高搜索效率。</p>
                  <h3 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h3>
                  <p>Document 可以分组，比如 weather 这个 Index 里面，可以按城市分组（北京和上海），也可以按气候分组（晴天和雨天）。这种分组就叫做 Type，它是虚拟的逻辑分组，用来过滤 Document，类似 MySQL 中的数据表，MongoDB 中的 Collection。 不同的 Type 应该有相似的结构（Schema），举例来说，id 字段不能在这个组是字符串，在另一个组是数值。这是与关系型数据库的表的一个区别。性质完全不同的数据（比如 products 和 logs）应该存成两个 Index，而不是一个 Index 里面的两个 Type（虽然可以做到）。 根据规划，Elastic 6.x 版只允许每个 Index 包含一个 Type，7.x 版将会彻底移除 Type。</p>
                  <h3 id="Fields"><a href="#Fields" class="headerlink" title="Fields"></a>Fields</h3>
                  <p>即字段，每个 Document 都类似一个 JSON 结构，它包含了许多字段，每个字段都有其对应的值，多个字段组成了一个 Document，其实就可以类比 MySQL 数据表中的字段。 在 Elasticsearch 中，文档归属于一种类型（Type），而这些类型存在于索引（Index）中，我们可以画一些简单的对比图来类比传统关系型数据库：</p>
                  <figure class="highlight xl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">R<span class="function"><span class="title">elational</span> DB -&gt;</span> D<span class="function"><span class="title">atabases</span> -&gt;</span> T<span class="function"><span class="title">ables</span> -&gt;</span> R<span class="function"><span class="title">ows</span> -&gt;</span> Columns</span><br><span class="line">E<span class="function"><span class="title">lasticsearch</span> -&gt;</span> I<span class="function"><span class="title">ndices</span>   -&gt;</span> T<span class="function"><span class="title">ypes</span>  -&gt;</span> D<span class="function"><span class="title">ocuments</span> -&gt;</span> Fields</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上就是 Elasticsearch 里面的一些基本概念，通过和关系性数据库的对比更加有助于理解。</p>
                  <h2 id="Python-对接-Elasticsearch"><a href="#Python-对接-Elasticsearch" class="headerlink" title="Python 对接 Elasticsearch"></a>Python 对接 Elasticsearch</h2>
                  <p>Elasticsearch 实际上提供了一系列 Restful API 来进行存取和查询操作，我们可以使用 curl 等命令来进行操作，但毕竟命令行模式没那么方便，所以这里我们就直接介绍利用 Python 来对接 Elasticsearch 的相关方法。 Python 中对接 Elasticsearch 使用的就是一个同名的库，安装方式非常简单：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> elasticsearch</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>官方文档是：<span class="exturl" data-url="aHR0cHM6Ly9lbGFzdGljc2VhcmNoLXB5LnJlYWR0aGVkb2NzLmlvLw==">https://elasticsearch-py.readthedocs.io/<i class="fa fa-external-link-alt"></i></span>，所有的用法都可以在里面查到，文章后面的内容也是基于官方文档来的。</p>
                  <h3 id="创建-Index"><a href="#创建-Index" class="headerlink" title="创建 Index"></a>创建 Index</h3>
                  <p>我们先来看下怎样创建一个索引（Index），这里我们创建一个名为 news 的索引：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> elasticsearch import Elasticsearch</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line">result = es.indices.create(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">ignore</span>=400)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果创建成功，会返回如下结果：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="symbol">'acknowledged</span>': <span class="literal">True</span>, <span class="symbol">'shards_acknowledged</span>': <span class="literal">True</span>, <span class="symbol">'index</span>': <span class="symbol">'news</span>'&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>返回结果是 JSON 格式，其中的 acknowledged 字段表示创建操作执行成功。 但这时如果我们再把代码执行一次的话，就会返回如下结果：</p>
                  <figure class="highlight sml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="symbol">'error'</span>: &#123;<span class="symbol">'root_cause'</span>: [&#123;<span class="symbol">'type'</span>: <span class="symbol">'resource_already_exists_exception'</span>, <span class="symbol">'reason'</span>: <span class="symbol">'index</span> [news/<span class="type">QM6yz2W8QE</span>-bflKhc5oThw] already exists', <span class="symbol">'index_uuid'</span>: <span class="symbol">'QM6yz2W8QE</span>-bflKhc5oThw', <span class="symbol">'index'</span>: <span class="symbol">'news'</span>&#125;], <span class="symbol">'type'</span>: <span class="symbol">'resource_already_exists_exception'</span>, <span class="symbol">'reason'</span>: <span class="symbol">'index</span> [news/<span class="type">QM6yz2W8QE</span>-bflKhc5oThw] already exists', <span class="symbol">'index_uuid'</span>: <span class="symbol">'QM6yz2W8QE</span>-bflKhc5oThw', <span class="symbol">'index'</span>: <span class="symbol">'news'</span>&#125;, <span class="symbol">'status'</span>: <span class="number">400</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>它提示创建失败，status 状态码是 400，错误原因是 Index 已经存在了。 注意这里我们的代码里面使用了 ignore 参数为 400，这说明如果返回结果是 400 的话，就忽略这个错误不会报错，程序不会执行抛出异常。 假如我们不加 ignore 这个参数的话：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">es</span> = <span class="function"><span class="title">Elasticsearch</span>()</span></span><br><span class="line"><span class="variable"><span class="class">result</span></span> = <span class="variable">es.indices.create</span>(<span class="variable">index</span>=<span class="string">'news'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable"><span class="class">result</span></span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>再次执行就会报错了：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">raise <span class="module-access"><span class="module"><span class="identifier">HTTP_EXCEPTIONS</span>.</span></span>get(status_code, TransportError)(status_code, error_message, additional_info)</span><br><span class="line">elasticsearch.exceptions.RequestError: <span class="constructor">TransportError(400, '<span class="params">resource_already_exists_exception</span>', '<span class="params">index</span> [<span class="params">news</span><span class="operator">/</span>QM6yz2W8QE-<span class="params">bflKhc5oThw</span>] <span class="params">already</span> <span class="params">exists</span>')</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样程序的执行就会出现问题，所以说，我们需要善用 ignore 参数，把一些意外情况排除，这样可以保证程序的正常执行而不会中断。</p>
                  <h3 id="删除-Index"><a href="#删除-Index" class="headerlink" title="删除 Index"></a>删除 Index</h3>
                  <p>删除 Index 也是类似的，代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> elasticsearch import Elasticsearch</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line">result = es.indices.delete(<span class="attribute">index</span>=<span class="string">'news'</span>, ignore=[400, 404])</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里也是使用了 ignore 参数，来忽略 Index 不存在而删除失败导致程序中断的问题。 如果删除成功，会输出如下结果：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="symbol">'acknowledged</span>': <span class="literal">True</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果 Index 已经被删除，再执行删除则会输出如下结果：</p>
                  <figure class="highlight sml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="symbol">'error'</span>: &#123;<span class="symbol">'root_cause'</span>: [&#123;<span class="symbol">'type'</span>: <span class="symbol">'index_not_found_exception'</span>, <span class="symbol">'reason'</span>: <span class="symbol">'no</span> such index', <span class="symbol">'resource</span>.type': <span class="symbol">'index_or_alias'</span>, <span class="symbol">'resource</span>.id': <span class="symbol">'news'</span>, <span class="symbol">'index_uuid'</span>: <span class="symbol">'_na_'</span>, <span class="symbol">'index'</span>: <span class="symbol">'news'</span>&#125;], <span class="symbol">'type'</span>: <span class="symbol">'index_not_found_exception'</span>, <span class="symbol">'reason'</span>: <span class="symbol">'no</span> such index', <span class="symbol">'resource</span>.type': <span class="symbol">'index_or_alias'</span>, <span class="symbol">'resource</span>.id': <span class="symbol">'news'</span>, <span class="symbol">'index_uuid'</span>: <span class="symbol">'_na_'</span>, <span class="symbol">'index'</span>: <span class="symbol">'news'</span>&#125;, <span class="symbol">'status'</span>: <span class="number">404</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个结果表明当前 Index 不存在，删除失败，返回的结果同样是 JSON，状态码是 400，但是由于我们添加了 ignore 参数，忽略了 400 状态码，因此程序正常执行输出 JSON 结果，而不是抛出异常。</p>
                  <h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3>
                  <p>Elasticsearch 就像 MongoDB 一样，在插入数据的时候可以直接插入结构化字典数据，插入数据可以调用 create() 方法，例如这里我们插入一条新闻数据：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> elasticsearch import Elasticsearch</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line">es.indices.create(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">ignore</span>=400)</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">'title'</span>: <span class="string">'美国留给伊拉克的是个烂摊子吗'</span>, <span class="string">'url'</span>: <span class="string">'http://view.news.qq.com/zt2011/usa_iraq/index.htm'</span>&#125;</span><br><span class="line">result = es.create(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">doc_type</span>=<span class="string">'politics'</span>, <span class="attribute">id</span>=1, <span class="attribute">body</span>=data)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们首先声明了一条新闻数据，包括标题和链接，然后通过调用 create() 方法插入了这条数据，在调用 create() 方法时，我们传入了四个参数，index 参数代表了索引名称，doc_type 代表了文档类型，body 则代表了文档具体内容，id 则是数据的唯一标识 ID。 运行结果如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;'_index': 'news', '_type': 'politics', '_id': '1', '_version': <span class="number">1</span>, 'result': 'created', '_shards': &#123;'total': <span class="number">2</span>, 'successful': <span class="number">1</span>, 'failed': <span class="number">0</span>&#125;, '_seq_no': <span class="number">0</span>, '_primary_term': <span class="number">1</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果中 result 字段为 created，代表该数据插入成功。 另外其实我们也可以使用 index() 方法来插入数据，但与 create() 不同的是，create() 方法需要我们指定 id 字段来唯一标识该条数据，而 index() 方法则不需要，如果不指定 id，会自动生成一个 id，调用 index() 方法的写法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">es.index(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">doc_type</span>=<span class="string">'politics'</span>, <span class="attribute">body</span>=data)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>create() 方法内部其实也是调用了 index() 方法，是对 index() 方法的封装。</p>
                  <h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3>
                  <p>更新数据也非常简单，我们同样需要指定数据的 id 和内容，调用 update() 方法即可，代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> elasticsearch import Elasticsearch</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'title'</span>: <span class="string">'美国留给伊拉克的是个烂摊子吗'</span>,</span><br><span class="line">    <span class="string">'url'</span>: <span class="string">'http://view.news.qq.com/zt2011/usa_iraq/index.htm'</span>,</span><br><span class="line">    <span class="string">'date'</span>: <span class="string">'2011-12-16'</span></span><br><span class="line">&#125;</span><br><span class="line">result = es.update(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">doc_type</span>=<span class="string">'politics'</span>, <span class="attribute">body</span>=data, <span class="attribute">id</span>=1)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们为数据增加了一个日期字段，然后调用了 update() 方法，结果如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;'_index': 'news', '_type': 'politics', '_id': '1', '_version': <span class="number">2</span>, 'result': 'updated', '_shards': &#123;'total': <span class="number">2</span>, 'successful': <span class="number">1</span>, 'failed': <span class="number">0</span>&#125;, '_seq_no': <span class="number">1</span>, '_primary_term': <span class="number">1</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到返回结果中，result 字段为 updated，即表示更新成功，另外我们还注意到有一个字段 _version，这代表更新后的版本号数，2 代表这是第二个版本，因为之前已经插入过一次数据，所以第一次插入的数据是版本 1，可以参见上例的运行结果，这次更新之后版本号就变成了 2，以后每更新一次，版本号都会加 1。 另外更新操作其实利用 index() 方法同样可以做到，写法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">es.index(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">doc_type</span>=<span class="string">'politics'</span>, <span class="attribute">body</span>=data, <span class="attribute">id</span>=1)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，index() 方法可以代替我们完成两个操作，如果数据不存在，那就执行插入操作，如果已经存在，那就执行更新操作，非常方便。</p>
                  <h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3>
                  <p>如果想删除一条数据可以调用 delete() 方法，指定需要删除的数据 id 即可，写法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> elasticsearch import Elasticsearch</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line">result = es.delete(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">doc_type</span>=<span class="string">'politics'</span>, <span class="attribute">id</span>=1)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;'_index': 'news', '_type': 'politics', '_id': '1', '_version': <span class="number">3</span>, 'result': 'deleted', '_shards': &#123;'total': <span class="number">2</span>, 'successful': <span class="number">1</span>, 'failed': <span class="number">0</span>&#125;, '_seq_no': <span class="number">2</span>, '_primary_term': <span class="number">1</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到运行结果中 result 字段为 deleted，代表删除成功，_version 变成了 3，又增加了 1。</p>
                  <h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3>
                  <p>上面的几个操作都是非常简单的操作，普通的数据库如 MongoDB 都是可以完成的，看起来并没有什么了不起的，Elasticsearch 更特殊的地方在于其异常强大的检索功能。 对于中文来说，我们需要安装一个分词插件，这里使用的是 elasticsearch-analysis-ik，GitHub 链接为：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21lZGNsL2VsYXN0aWNzZWFyY2gtYW5hbHlzaXMtaWs=">https://github.com/medcl/elasticsearch-analysis-ik<i class="fa fa-external-link-alt"></i></span>，这里我们使用 Elasticsearch 的另一个命令行工具 elasticsearch-plugin 来安装，这里安装的版本是 6.2.4，请确保和 Elasticsearch 的版本对应起来，命令如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">elasticsearch-plugin install https:<span class="regexp">//gi</span>thub.com<span class="regexp">/medcl/</span>elasticsearch-analysis-ik<span class="regexp">/releases/</span>download<span class="regexp">/v6.2.4/</span>elasticsearch-analysis-ik-<span class="number">6.2</span>.<span class="number">4</span>.zip</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的版本号请替换成你的 Elasticsearch 的版本号。 安装之后重新启动 Elasticsearch 就可以了，它会自动加载安装好的插件。 首先我们新建一个索引并指定需要分词的字段，代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> elasticsearch import Elasticsearch</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line">mapping = &#123;</span><br><span class="line">    <span class="string">'properties'</span>: &#123;</span><br><span class="line">        <span class="string">'title'</span>: &#123;</span><br><span class="line">            <span class="string">'type'</span>: <span class="string">'text'</span>,</span><br><span class="line">            <span class="string">'analyzer'</span>: <span class="string">'ik_max_word'</span>,</span><br><span class="line">            <span class="string">'search_analyzer'</span>: <span class="string">'ik_max_word'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">es.indices.delete(<span class="attribute">index</span>=<span class="string">'news'</span>, ignore=[400, 404])</span><br><span class="line">es.indices.create(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">ignore</span>=400)</span><br><span class="line">result = es.indices.put_mapping(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">doc_type</span>=<span class="string">'politics'</span>, <span class="attribute">body</span>=mapping)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们先将之前的索引删除了，然后新建了一个索引，然后更新了它的 mapping 信息，mapping 信息中指定了分词的字段，指定了字段的类型 type 为 text，分词器 analyzer 和 搜索分词器 search_analyzer 为 ik_max_word，即使用我们刚才安装的中文分词插件。如果不指定的话则使用默认的英文分词器。 接下来我们插入几条新的数据：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">datas = [</span><br><span class="line">    &#123;</span><br><span class="line">        'title': '美国留给伊拉克的是个烂摊子吗',</span><br><span class="line">        'url': 'http://view.news.qq.com/zt<span class="number">2011</span>/usa_iraq/index.htm',</span><br><span class="line">        'date': '<span class="number">2011-12-16</span>'</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        'title': '公安部：各地校车将享最高路权',</span><br><span class="line">        'url': 'http://www.chinanews.com/gn/<span class="number">2011/12-16/353607</span>7.shtml',</span><br><span class="line">        'date': '<span class="number">2011-12-16</span>'</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        'title': '中韩渔警冲突调查：韩警平均每天扣1艘中国渔船',</span><br><span class="line">        'url': 'https://news.qq.com/a/<span class="number">20111216/001044</span>.htm',</span><br><span class="line">        'date': '<span class="number">2011-12-17</span>'</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        'title': '中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首',</span><br><span class="line">        'url': 'http://news.ifeng.com/world/detail_<span class="number">2011</span>_12/16/<span class="number">11372558</span>_0.shtml',</span><br><span class="line">        'date': '<span class="number">2011-12-18</span>'</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">for data in datas:</span><br><span class="line">    es.index(index='news', doc_type='politics', body=data)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们指定了四条数据，都带有 title、url、date 字段，然后通过 index() 方法将其插入 Elasticsearch 中，索引名称为 news，类型为 politics。 接下来我们根据关键词查询一下相关内容：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">result = es.search(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">doc_type</span>=<span class="string">'politics'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到查询出了所有插入的四条数据：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"took"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">    <span class="attr">"total"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"successful"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"skipped"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"hits"</span>: &#123;</span><br><span class="line">    <span class="attr">"total"</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">"max_score"</span>: <span class="number">1.0</span>,</span><br><span class="line">    <span class="attr">"hits"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"_index"</span>: <span class="string">"news"</span>,</span><br><span class="line">        <span class="attr">"_type"</span>: <span class="string">"politics"</span>,</span><br><span class="line">        <span class="attr">"_id"</span>: <span class="string">"c05G9mQBD9BuE5fdHOUT"</span>,</span><br><span class="line">        <span class="attr">"_score"</span>: <span class="number">1.0</span>,</span><br><span class="line">        <span class="attr">"_source"</span>: &#123;</span><br><span class="line">          <span class="attr">"title"</span>: <span class="string">"美国留给伊拉克的是个烂摊子吗"</span>,</span><br><span class="line">          <span class="attr">"url"</span>: <span class="string">"http://view.news.qq.com/zt2011/usa_iraq/index.htm"</span>,</span><br><span class="line">          <span class="attr">"date"</span>: <span class="string">"2011-12-16"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"_index"</span>: <span class="string">"news"</span>,</span><br><span class="line">        <span class="attr">"_type"</span>: <span class="string">"politics"</span>,</span><br><span class="line">        <span class="attr">"_id"</span>: <span class="string">"dk5G9mQBD9BuE5fdHOUm"</span>,</span><br><span class="line">        <span class="attr">"_score"</span>: <span class="number">1.0</span>,</span><br><span class="line">        <span class="attr">"_source"</span>: &#123;</span><br><span class="line">          <span class="attr">"title"</span>: <span class="string">"中国驻洛杉矶领事馆遭亚裔男子枪击，嫌犯已自首"</span>,</span><br><span class="line">          <span class="attr">"url"</span>: <span class="string">"http://news.ifeng.com/world/detail_2011_12/16/11372558_0.shtml"</span>,</span><br><span class="line">          <span class="attr">"date"</span>: <span class="string">"2011-12-18"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"_index"</span>: <span class="string">"news"</span>,</span><br><span class="line">        <span class="attr">"_type"</span>: <span class="string">"politics"</span>,</span><br><span class="line">        <span class="attr">"_id"</span>: <span class="string">"dU5G9mQBD9BuE5fdHOUj"</span>,</span><br><span class="line">        <span class="attr">"_score"</span>: <span class="number">1.0</span>,</span><br><span class="line">        <span class="attr">"_source"</span>: &#123;</span><br><span class="line">          <span class="attr">"title"</span>: <span class="string">"中韩渔警冲突调查：韩警平均每天扣1艘中国渔船"</span>,</span><br><span class="line">          <span class="attr">"url"</span>: <span class="string">"https://news.qq.com/a/20111216/001044.htm"</span>,</span><br><span class="line">          <span class="attr">"date"</span>: <span class="string">"2011-12-17"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"_index"</span>: <span class="string">"news"</span>,</span><br><span class="line">        <span class="attr">"_type"</span>: <span class="string">"politics"</span>,</span><br><span class="line">        <span class="attr">"_id"</span>: <span class="string">"dE5G9mQBD9BuE5fdHOUf"</span>,</span><br><span class="line">        <span class="attr">"_score"</span>: <span class="number">1.0</span>,</span><br><span class="line">        <span class="attr">"_source"</span>: &#123;</span><br><span class="line">          <span class="attr">"title"</span>: <span class="string">"公安部：各地校车将享最高路权"</span>,</span><br><span class="line">          <span class="attr">"url"</span>: <span class="string">"http://www.chinanews.com/gn/2011/12-16/3536077.shtml"</span>,</span><br><span class="line">          <span class="attr">"date"</span>: <span class="string">"2011-12-16"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到返回结果会出现在 hits 字段里面，然后其中有 total 字段标明了查询的结果条目数，还有 max_score 代表了最大匹配分数。 另外我们还可以进行全文检索，这才是体现 Elasticsearch 搜索引擎特性的地方：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">dsl = &#123;</span><br><span class="line">    <span class="string">'query'</span>: &#123;</span><br><span class="line">        <span class="string">'match'</span>: &#123;</span><br><span class="line">            <span class="string">'title'</span>: <span class="string">'中国 领事馆'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line">result = es.search(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">doc_type</span>=<span class="string">'politics'</span>, <span class="attribute">body</span>=dsl)</span><br><span class="line"><span class="builtin-name">print</span>(json.dumps(result, <span class="attribute">indent</span>=2, <span class="attribute">ensure_ascii</span>=<span class="literal">False</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们使用 Elasticsearch 支持的 DSL 语句来进行查询，使用 match 指定全文检索，检索的字段是 title，内容是“中国领事馆”，搜索结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"took"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">    <span class="attr">"total"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"successful"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"skipped"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"hits"</span>: &#123;</span><br><span class="line">    <span class="attr">"total"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">"max_score"</span>: <span class="number">2.546152</span>,</span><br><span class="line">    <span class="attr">"hits"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"_index"</span>: <span class="string">"news"</span>,</span><br><span class="line">        <span class="attr">"_type"</span>: <span class="string">"politics"</span>,</span><br><span class="line">        <span class="attr">"_id"</span>: <span class="string">"dk5G9mQBD9BuE5fdHOUm"</span>,</span><br><span class="line">        <span class="attr">"_score"</span>: <span class="number">2.546152</span>,</span><br><span class="line">        <span class="attr">"_source"</span>: &#123;</span><br><span class="line">          <span class="attr">"title"</span>: <span class="string">"中国驻洛杉矶领事馆遭亚裔男子枪击，嫌犯已自首"</span>,</span><br><span class="line">          <span class="attr">"url"</span>: <span class="string">"http://news.ifeng.com/world/detail_2011_12/16/11372558_0.shtml"</span>,</span><br><span class="line">          <span class="attr">"date"</span>: <span class="string">"2011-12-18"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"_index"</span>: <span class="string">"news"</span>,</span><br><span class="line">        <span class="attr">"_type"</span>: <span class="string">"politics"</span>,</span><br><span class="line">        <span class="attr">"_id"</span>: <span class="string">"dU5G9mQBD9BuE5fdHOUj"</span>,</span><br><span class="line">        <span class="attr">"_score"</span>: <span class="number">0.2876821</span>,</span><br><span class="line">        <span class="attr">"_source"</span>: &#123;</span><br><span class="line">          <span class="attr">"title"</span>: <span class="string">"中韩渔警冲突调查：韩警平均每天扣1艘中国渔船"</span>,</span><br><span class="line">          <span class="attr">"url"</span>: <span class="string">"https://news.qq.com/a/20111216/001044.htm"</span>,</span><br><span class="line">          <span class="attr">"date"</span>: <span class="string">"2011-12-17"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们看到匹配的结果有两条，第一条的分数为 2.54，第二条的分数为 0.28，这是因为第一条匹配的数据中含有“中国”和“领事馆”两个词，第二条匹配的数据中不包含“领事馆”，但是包含了“中国”这个词，所以也被检索出来了，但是分数比较低。 因此可以看出，检索时会对对应的字段全文检索，结果还会按照检索关键词的相关性进行排序，这就是一个基本的搜索引擎雏形。 另外 Elasticsearch 还支持非常多的查询方式，详情可以参考官方文档：<span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9lbi9lbGFzdGljc2VhcmNoL3JlZmVyZW5jZS82LjMvcXVlcnktZHNsLmh0bWw=">https://www.elastic.co/guide/en/elasticsearch/reference/6.3/query-dsl.html<i class="fa fa-external-link-alt"></i></span> 以上便是对 Elasticsearch 的基本介绍以及 Python 操作 Elasticsearch 的基本用法，但这仅仅是 Elasticsearch 的基本功能，它还有更多强大的功能等待着我们的探索，后面会继续更新，敬请期待。 本节代码：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dlcm1leS9FbGFzdGljU2VhcmNo">https://github.com/Germey/ElasticSearch<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="资料推荐"><a href="#资料推荐" class="headerlink" title="资料推荐"></a>资料推荐</h2>
                  <p>另外推荐几个不错的学习站点：</p>
                  <ul>
                    <li>Elasticsearch 权威指南：<span class="exturl" data-url="aHR0cHM6Ly9lcy54aWFvbGVpbHUuY29tL2luZGV4Lmh0bWw=">https://es.xiaoleilu.com/index.html<i class="fa fa-external-link-alt"></i></span></li>
                    <li>全文搜索引擎 Elasticsearch 入门教程：<span class="exturl" data-url="aHR0cDovL3d3dy5ydWFueWlmZW5nLmNvbS9ibG9nLzIwMTcvMDgvZWxhc3RpY3NlYXJjaC5odG1s">http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html<i class="fa fa-external-link-alt"></i></span></li>
                    <li>Elastic 中文社区：<span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpY3NlYXJjaC5jbi8=">https://www.elasticsearch.cn/<i class="fa fa-external-link-alt"></i></span></li>
                  </ul>
                  <h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2>
                  <ul>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9lcy54aWFvbGVpbHUuY29tL2luZGV4Lmh0bWw=">https://es.xiaoleilu.com/index.html<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3k0NzIzNjA2NTEvYXJ0aWNsZS9kZXRhaWxzLzc2NDY4MzI3">https://blog.csdn.net/y472360651/article/details/76468327<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9lbGFzdGljc2VhcmNoLXB5LnJlYWR0aGVkb2NzLmlvL2VuL21hc3Rlci8=">https://elasticsearch-py.readthedocs.io/en/master/<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9lcy54aWFvbGVpbHUuY29tLzAxMF9JbnRyby8xMF9JbnN0YWxsaW5nX0VTLmh0bWw=">https://es.xiaoleilu.com/010_Intro/10_Installing_ES.html<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21lZGNsL2VsYXN0aWNzZWFyY2gtYW5hbHlzaXMtaWs=">https://github.com/medcl/elasticsearch-analysis-ik<i class="fa fa-external-link-alt"></i></span></li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-08-02 01:14:22" itemprop="dateCreated datePublished" datetime="2018-08-02T01:14:22+08:00">2018-08-02</time>
                </span>
                <span id="/6214.html" class="post-meta-item leancloud_visitors" data-flag-title="Elasticsearch 基本介绍及其与 Python 的对接实现" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>12k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>11 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6182.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6182.html" class="post-title-link" itemprop="url">Python glom包初探</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="大家好，-我不是崔老师，我是四毛，下面是我的个人公众号，欢迎大家关注。"><a href="#大家好，-我不是崔老师，我是四毛，下面是我的个人公众号，欢迎大家关注。" class="headerlink" title="大家好， 我不是崔老师，我是四毛，下面是我的个人公众号，欢迎大家关注。"></a>大家好， 我不是崔老师，我是四毛，下面是我的个人公众号，欢迎大家关注。</h1>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""></p>
                  <h1 id="好久没有写东西了，一直都记录在了自己的笔记上，这一篇是关于glom的一个介绍与初步使用，后期会将里面的各种API再给大家介绍下，同时，最近在搞爬虫的实时数据监控，也挺有意思，后面会和大家分享，敬请期待。"><a href="#好久没有写东西了，一直都记录在了自己的笔记上，这一篇是关于glom的一个介绍与初步使用，后期会将里面的各种API再给大家介绍下，同时，最近在搞爬虫的实时数据监控，也挺有意思，后面会和大家分享，敬请期待。" class="headerlink" title="好久没有写东西了，一直都记录在了自己的笔记上，这一篇是关于glom的一个介绍与初步使用，后期会将里面的各种API再给大家介绍下，同时，最近在搞爬虫的实时数据监控，也挺有意思，后面会和大家分享，敬请期待。"></a>好久没有写东西了，一直都记录在了自己的笔记上，这一篇是关于glom的一个介绍与初步使用，后期会将里面的各种API再给大家介绍下，同时，最近在搞爬虫的实时数据监控，也挺有意思，后面会和大家分享，敬请期待。</h1>
                  <p>猛然发现，英语水平巅峰就在高考那一天。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2016/12/吃惊表情1.jpg" alt=""> 因为是边看，边练习，然后翻译，所以个人理解可能有偏差，有错误的地方，请大家指正。 首先，这个库是用来处理一些嵌套的数据的，作者也在PyCon 2018上做了个分享，老美的PyCon还是有点质量的，不像国内的，搞的什么玩意。 视频地址：<span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1iVEFGbDhQMkRrRSZhbXA7dD0xOG0wN3M=">https://www.youtube.com/watch?v=bTAFl8P2DkE&amp;t=18m07s<i class="fa fa-external-link-alt"></i></span> </p>
                  <h2 id="更新-2018年7月28日10-32-08"><a href="#更新-2018年7月28日10-32-08" class="headerlink" title="更新: 2018年7月28日10:32:08"></a>更新: 2018年7月28日10:32:08</h2>
                  <p>经过咨询库的作者，在最后留的那个问题的准确解法如下：</p>
                  <figure class="highlight clean">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> glom</span><br><span class="line"></span><br><span class="line">target = &#123;</span><br><span class="line">    <span class="string">'data'</span>: &#123;</span><br><span class="line">        <span class="string">'name'</span>: <span class="string">'just_test'</span>,</span><br><span class="line">        <span class="string">'likes'</span>: [&#123;<span class="string">'ball'</span>: <span class="string">'basketball'</span>&#125;,</span><br><span class="line">                  &#123;<span class="string">'ball'</span>: <span class="string">'football'</span>&#125;,</span><br><span class="line">                  &#123;<span class="string">'water'</span>: <span class="string">'swim'</span>&#125;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">spec = &#123;</span><br><span class="line">    <span class="string">'name'</span> : (<span class="string">'data.name'</span>),</span><br><span class="line">    <span class="string">'likes'</span> : (<span class="string">'data'</span>, <span class="string">'likes'</span>, [glom.Coalesce(<span class="string">'ball'</span>, <span class="string">'water'</span>)])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print glom.glom(target, spec)</span><br><span class="line">####</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'just_test'</span>, <span class="string">'likes'</span>: [<span class="string">'basketball'</span>, <span class="string">'football'</span>, <span class="string">'swim'</span>]&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>非常棒，准确来说就是得灵活运用Coalesce方法啊，不能太死板。非常Pythonic。 另附网址，作者有个很搞笑little four hair ,哈哈哈哈 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21haG1vdWQvZ2xvbS9pc3N1ZXMvNDY=">Issue地址<i class="fa fa-external-link-alt"></i></span> </p>
                  <h1 id="1-官方文档地址"><a href="#1-官方文档地址" class="headerlink" title="1. 官方文档地址"></a>1. 官方文档地址</h1>
                  <p><span class="exturl" data-url="aHR0cHM6Ly9nbG9tLnJlYWR0aGVkb2NzLmlvL2VuL2xhdGVzdC90dXRvcmlhbC5odG1s">文档地址<i class="fa fa-external-link-alt"></i></span></p>
                  <h1 id="2-安装方法"><a href="#2-安装方法" class="headerlink" title="2. 安装方法"></a>2. 安装方法</h1>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip <span class="keyword">install</span> glom</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h1 id="3-正式开始"><a href="#3-正式开始" class="headerlink" title="3. 正式开始"></a>3. 正式开始</h1>
                  <p>glom，官方的说法是用PYTHONIC的方式来处理内嵌的数据。对于现实世界中的数据处理更加给力，现实世界中的数据，我的理解就是AJAX越来越流行了，处理这类数据会越来越频繁。有如下特点：</p>
                  <ul>
                    <li>对于嵌套数据结构的基于路径式的访问</li>
                    <li>可读，有意义的错误消息</li>
                    <li>声明性数据转换，使用轻量级，Pythonic规范</li>
                    <li>内置数据探索和调试功能</li>
                  </ul>
                  <h2 id="3-1-原始处理嵌套数据"><a href="#3-1-原始处理嵌套数据" class="headerlink" title="3.1 原始处理嵌套数据"></a>3.1 原始处理嵌套数据</h2>
                  <p>下面的脚本包导入</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> glom <span class="keyword">import</span> glom</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>下面的data就是个简单的嵌套数据，一般都可以用下面几种方法进行处理</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">data = &#123;<span class="string">'a'</span>: &#123;<span class="string">'b'</span>: &#123;<span class="string">'c'</span>: <span class="string">'d'</span>&#125;&#125;&#125;</span><br><span class="line">data[<span class="string">'a'</span>][<span class="string">'b'</span>][<span class="string">'c'</span>]</span><br><span class="line">data.<span class="builtin-name">get</span>(<span class="string">'a'</span>).<span class="builtin-name">get</span>(<span class="string">'b'</span>).<span class="builtin-name">get</span>(<span class="string">'c'</span>)</span><br><span class="line">data.<span class="builtin-name">get</span>(<span class="string">'a'</span>, &#123;&#125;).<span class="builtin-name">get</span>(<span class="string">'b'</span>,&#123;&#125;).<span class="builtin-name">get</span>(<span class="string">'c'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但是当我们的数据改变成下面的这样时：</p>
                  <figure class="highlight markdown">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">data2 = &#123;'a': &#123;'b': None&#125;&#125;</span><br><span class="line">data2[<span class="string">'a'</span>][<span class="symbol">'b'</span>][<span class="string">'c'</span>]</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">...</span><br><span class="line">TypeError: 'NoneType' object has no attribute '<span class="strong">__getitem__</span>'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>会报错，而且由于是嵌套数据，从错误信息里我们只知道有个None值，但是到底谁是呢，是a，是b呢，反正肯定不是我们的朋友小哪吒。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/07/4399_9165819336.jpg" alt=""></p>
                  <h2 id="3-2-glom出场"><a href="#3-2-glom出场" class="headerlink" title="3.2 glom出场"></a>3.2 glom出场</h2>
                  <p>那么glom怎么处理上面的数据呢？ 如其所言，路径式：</p>
                  <figure class="highlight powershell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">data</span> = &#123;<span class="string">'a'</span>: &#123;<span class="string">'b'</span>: &#123;<span class="string">'c'</span>: <span class="string">'d'</span>&#125;&#125;&#125;</span><br><span class="line">print glom(<span class="keyword">data</span>, <span class="string">'a.b.c'</span>)  <span class="comment"># d</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>看起来还是很优雅， 很Pythonic。</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">data2 = &#123;<span class="string">'a'</span>: &#123;<span class="string">'b'</span>: None&#125;&#125;</span><br><span class="line"><span class="function"><span class="title">glom</span><span class="params">(data2, <span class="string">'a.b.c'</span>)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>错误信息如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glom.core.<span class="string">PathAccessError:</span> could not access <span class="string">'c'</span>, part <span class="number">2</span> of Path(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>), got <span class="string">error:</span> AttributeError(<span class="string">"'NoneType' object has no attribute 'c'"</span>,)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>很明显，这个错误就很直观。 难道仅仅只有这个？当然不是</p>
                  <h3 id="3-2-1-Going-Beyond-Access"><a href="#3-2-1-Going-Beyond-Access" class="headerlink" title="3.2.1  Going Beyond Access"></a>3.2.1 Going Beyond Access</h3>
                  <p>上面的是原标题，我的理解是不仅仅获取数据，还有别的呢。 首先，介绍两个基本的术语</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">target</span> <span class="string">目标数据，可以是字典，列表，或其他任意的对象</span></span><br><span class="line"><span class="attr">spec</span>  <span class="string">我们想要的输出格式 【specifications】， 定义你自己所需要的格式</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>现在让我们跟随宇航员的脚步，探索太阳系吧。</p>
                  <ul>
                    <li>获取某个行星的名字：</li>
                  </ul>
                  <figure class="highlight vala">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">target = &#123;<span class="string">'galaxy'</span>: &#123;<span class="string">'system'</span>: &#123;<span class="string">'planet'</span>: <span class="string">'jupiter'</span>&#125;&#125;&#125;</span><br><span class="line"><span class="meta"># 这个格式就是需要个字段值，所以输出的就是个字段值</span></span><br><span class="line">spec = <span class="string">'galaxy.system.planet'</span></span><br><span class="line">glom(target, spec)</span><br><span class="line"><span class="meta"># 'jupyter'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>现在，宇航员们想把行星的名字放进一个列表中，数据是这样：</li>
                  </ul>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">target</span> = &#123;<span class="string">'system'</span>: &#123;<span class="string">'planets'</span>: [&#123;<span class="string">'name'</span>: <span class="string">'earth'</span>&#125;, &#123;<span class="string">'name'</span>: <span class="string">'jupiter'</span>&#125;]&#125;&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>通常，处理这样的话，都要写个循环，或者搞个列表解析式，那么glom怎么处理呢？</li>
                  </ul>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glom(target, (<span class="string">'system.planets'</span>, [<span class="string">'name'</span>]))</span><br><span class="line">print glom(target, spec)</span><br><span class="line"># [<span class="string">'earth'</span>, <span class="string">'jupiter'</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>是不是很简单。那么现在新需求又来了，宇航员想得到下面这个数据里面的行星的卫星的数:</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">target</span> = &#123;<span class="string">'system'</span>: &#123;<span class="string">'planets'</span>: [&#123;<span class="string">'name'</span>: <span class="string">'earth'</span>, <span class="string">'moons'</span>: <span class="number">1</span>&#125;,</span><br><span class="line">                                  &#123;<span class="string">'name'</span>: <span class="string">'jupiter'</span>, <span class="string">'moons'</span>: <span class="number">69</span>&#125;]&#125;&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>glom解决方法：</li>
                  </ul>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># 自定义的格式</span><br><span class="line">spec = &#123;<span class="string">'names'</span>: (<span class="string">'system.planets'</span>, [<span class="string">'name'</span>]),</span><br><span class="line">        <span class="string">'moons'</span>: (<span class="string">'system.planets'</span>, [<span class="string">'moons'</span>])&#125;</span><br><span class="line">print glom(target, spec)</span><br><span class="line"># &#123;<span class="string">'moons'</span>: [<span class="number">1</span>, <span class="number">69</span>], <span class="string">'names'</span>: [<span class="string">'earth'</span>, <span class="string">'jupiter'</span>]&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="3-2-2-Changing-Requirements"><a href="#3-2-2-Changing-Requirements" class="headerlink" title="3.2.2  Changing Requirements"></a>3.2.2 Changing Requirements</h3>
                  <p>Coalesce 是glom定义的一种结构，允许我们对于spec中的子spec进行进一步的处理，你只要在子spec中将可能存在的值定义好就行了，听起来有点绕，现在来梳理一下。</p>
                  <ul>
                    <li>首先，子spec是什么？</li>
                  </ul>
                  <figure class="highlight clean">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">spec = &#123;<span class="string">'names'</span>: (<span class="string">'system.planets'</span>, [<span class="string">'name'</span>]),</span><br><span class="line">         <span class="string">'moons'</span>: (<span class="string">'system.planets'</span>, [<span class="string">'moons'</span>])&#125;</span><br><span class="line"># 以这个为例，这里面的<span class="keyword">system</span>.planets就是个子spec</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>然后，使用其解析数据：</li>
                  </ul>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">target = &#123;<span class="string">'system'</span>: &#123;</span><br><span class="line">    <span class="string">'planets'</span>: [&#123;<span class="string">'name'</span>: <span class="string">'earth'</span>, <span class="string">'moons'</span>: <span class="number">1</span>&#125;, &#123;<span class="string">'name'</span>: <span class="string">'jupiter'</span>, <span class="string">'moons'</span>: <span class="number">69</span>&#125;],</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">spec = &#123;<span class="string">'names'</span>: (<span class="symbol">Coalesce</span>(<span class="string">'system.planets'</span>, <span class="string">'system.dwarf_planets'</span>), [<span class="string">'name'</span>]),</span><br><span class="line">         <span class="string">'moons'</span>: (<span class="symbol">Coalesce</span>(<span class="string">'system.planets'</span>, <span class="string">'system.dwarf_planets'</span>), [<span class="string">'moons'</span>])&#125;</span><br><span class="line"></span><br><span class="line">print glom(target, spec)</span><br><span class="line"># &#123;<span class="string">'moons'</span>: [<span class="number">1</span>, <span class="number">69</span>], <span class="string">'names'</span>: [<span class="string">'earth'</span>, <span class="string">'jupiter'</span>]&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>接着当我们的数据变成了这个以后</li>
                  </ul>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">target = &#123;<span class="string">'system'</span>: &#123;<span class="string">'dwarf_planets'</span>: [&#123;<span class="string">'name'</span>: <span class="string">'pluto'</span>, <span class="string">'moons'</span>: <span class="number">5</span>&#125;,</span><br><span class="line">                                        &#123;<span class="string">'name'</span>: <span class="string">'ceres'</span>, <span class="string">'moons'</span>: <span class="number">0</span>&#125;]&#125;&#125;</span><br><span class="line">spec = &#123;<span class="string">'names'</span>: (<span class="symbol">Coalesce</span>(<span class="string">'system.planets'</span>, <span class="string">'system.dwarf_planets'</span>), [<span class="string">'name'</span>]),</span><br><span class="line">         <span class="string">'moons'</span>: (<span class="symbol">Coalesce</span>(<span class="string">'system.planets'</span>, <span class="string">'system.dwarf_planets'</span>), [<span class="string">'moons'</span>])&#125;</span><br><span class="line">print glom(target, spec)</span><br><span class="line"># &#123;<span class="string">'moons'</span>: [<span class="number">5</span>, <span class="number">0</span>], <span class="string">'names'</span>: [<span class="string">'pluto'</span>, <span class="string">'ceres'</span>]&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，依然可以使用相同的spec来解析不同的目标数据。 有意思的是，你可以在target里面同时写入plantes和dwarf_plants数据试试看，会返回什么数据。 【这里应该是个惰性的匹配，只要匹配到一个，后面的就不再去匹配了】</p>
                  <h3 id="3-2-3-True-Python-Native"><a href="#3-2-3-True-Python-Native" class="headerlink" title="3.2.3  True Python Native"></a>3.2.3 True Python Native</h3>
                  <p>真正的原生python 在glom里面，你可以传值给python里面的任意的函数 举例：</p>
                  <ul>
                    <li>求和</li>
                  </ul>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">target = &#123;<span class="string">'system'</span>: &#123;<span class="string">'planets'</span>: [&#123;<span class="string">'name'</span>: <span class="string">'earth'</span>, <span class="string">'moons'</span>: <span class="number">1</span>&#125;,</span><br><span class="line">                                  &#123;<span class="string">'name'</span>: <span class="string">'jupiter'</span>, <span class="string">'moons'</span>: <span class="number">69</span>&#125;]&#125;&#125;</span><br><span class="line"></span><br><span class="line">print glom(target, &#123;<span class="string">'moon_count'</span>: (<span class="string">'system.planets'</span>, [<span class="string">'moons'</span>], sum)&#125;)</span><br><span class="line"></span><br><span class="line"># &#123;<span class="string">'moon_count'</span>: <span class="number">70</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>原教程这里还有个案例，但是我还没有理解好，就不写出来了，大家可以点击链接自己看一下。 </p>
                  <h1 id="4-结论"><a href="#4-结论" class="headerlink" title="4. 结论"></a>4. 结论</h1>
                  <p>下一节，为大家带来其中一些重要的函数。 最后，在用的过程中，一直有个疑问，数据如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">target</span> = &#123;</span><br><span class="line">    <span class="string">'data'</span>: &#123;</span><br><span class="line">        <span class="string">'name'</span>: <span class="string">'just_test'</span>,</span><br><span class="line">        <span class="string">'likes'</span>: [&#123;<span class="string">'ball'</span>: <span class="string">'basketball'</span>&#125;,</span><br><span class="line">                  &#123;<span class="string">'ball'</span>: <span class="string">'football'</span>&#125;,</span><br><span class="line">                  &#123;<span class="string">'water'</span>: <span class="string">'swim'</span>&#125;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>现在，我想返回的数据格式为：</p>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'just_for_test'</span>, <span class="string">'likes'</span>: [<span class="string">'basketball'</span>, <span class="string">'football'</span>, <span class="string">'water'</span>]&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>一开始我以为可以这么用：</p>
                  <figure class="highlight sml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">spec = &#123;</span><br><span class="line">    <span class="symbol">'name'</span>: (<span class="symbol">'data</span>.name'),</span><br><span class="line">    <span class="symbol">'likes'</span>: (<span class="symbol">'data</span>.likes', [<span class="symbol">'ball'</span>, <span class="symbol">'water'</span>] ),</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但是不行，这样会报错。后来用了另外的方法：</p>
                  <figure class="highlight gml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">spec = &#123;</span><br><span class="line">    <span class="string">'name'</span>: (<span class="string">'data.name'</span>),</span><br><span class="line">    <span class="string">'likes'</span>: (<span class="string">'data.likes'</span>, [lambda <span class="symbol">x</span>: <span class="symbol">x</span>.values()[<span class="number">0</span>] <span class="keyword">if</span> <span class="string">'ball'</span> <span class="keyword">or</span> <span class="string">'water'</span> in <span class="symbol">x</span>.keys() <span class="keyword">else</span> <span class="string">''</span>] ),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print glom(target, spec)</span><br><span class="line"># &#123;<span class="string">'name'</span>: <span class="string">'just_test'</span>, <span class="string">'likes'</span>: [<span class="string">'basketball'</span>, <span class="string">'football'</span>, <span class="string">'swim'</span>]&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样感觉很不爽啊，还望会的同学不吝赐教啊。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/四毛" class="author" itemprop="url" rel="index">四毛</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-07-28 18:19:35" itemprop="dateCreated datePublished" datetime="2018-07-28T18:19:35+08:00">2018-07-28</time>
                </span>
                <span id="/6182.html" class="post-meta-item leancloud_visitors" data-flag-title="Python glom包初探" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6173.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6173.html" class="post-title-link" itemprop="url">《Python3网络爬虫开发实战》第三波赠书活动来了！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="开门见山"><a href="#开门见山" class="headerlink" title="开门见山"></a>开门见山</h2>
                  <p>话不多说了！第三波送书活动来了！这次送 20 本签名版《Python3网络爬虫开发实战》。 本书目前上市三个月已经重印 6 次，上市三个月以来长期位居京东计算机类新书榜第一位（现已不算新书），目前在豆瓣的评分是 9.2 分。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/05/Python-3网格爬虫开发实战-立体图-857x1100.jpg" alt=""> <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/WechatIMG1030.jpeg" alt=""></p>
                  <h2 id="书籍介绍"><a href="#书籍介绍" class="headerlink" title="书籍介绍"></a><strong>书籍介绍</strong></h2>
                  <p>本书<strong>《Python3网络爬虫开发实战》</strong>全面介绍了利用 Python3 开发网络爬虫的知识，书中首先详细介绍了各种类型的环境配置过程和爬虫基础知识，还讨论了 urllib、requests 等请求库和 Beautiful Soup、XPath、pyquery 等解析库以及文本和各类数据库的存储方法，另外本书通过多个真实新鲜案例介绍了分析 Ajax 进行数据爬取，Selenium 和 Splash 进行动态网站爬取的过程，接着又分享了一些切实可行的爬虫技巧，比如使用代理爬取和维护动态代理池的方法、ADSL 拨号代理的使用、各类验证码（图形、极验、点触、宫格等）的破解方法、模拟登录网站爬取的方法及 Cookies 池的维护等等。 此外，本书的内容还远远不止这些，作者还结合移动互联网的特点探讨了使用 Charles、mitmdump、Appium 等多种工具实现 App 抓包分析、加密参数接口爬取、微信朋友圈爬取的方法。此外本书还详细介绍了 pyspider 框架、Scrapy 框架的使用和分布式爬虫的知识，另外对于优化及部署工作，本书还包括 Bloom Filter 效率优化、Docker 和 Scrapyd 爬虫部署、分布式爬虫管理框架Gerapy 的分享。 全书共 604 页，足足两斤重呢~ 定价为 99 元！</p>
                  <h2 id="作者介绍"><a href="#作者介绍" class="headerlink" title="作者介绍"></a><strong>作者介绍</strong></h2>
                  <p>看书就先看看谁写的嘛，我们来了解一下~ 崔庆才，静觅博客博主（<span class="exturl" data-url="aHR0cHM6Ly9jdWlxaW5nY2FpLmNvbe+8ie+8jOWNmuWuog==">https://cuiqingcai.com），博客<i class="fa fa-external-link-alt"></i></span> Python 爬虫博文阅读量已过千万，北京航空航天大学硕士，天善智能、网易云课堂讲师，微软小冰大数据工程师，有多个大型分布式爬虫项目经验，乐于技术分享，文章通俗易懂 ^<em>^ 附皂片一张 ~(@^</em>^@)~ <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/WechatIMG785-240x320.jpeg" alt=""></p>
                  <h2 id="图文介绍"><a href="#图文介绍" class="headerlink" title="图文介绍"></a><strong>图文介绍</strong></h2>
                  <p>呕心沥血设计的宣传图也得放一下~ <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/WechatIMG556.jpeg" alt=""></p>
                  <h2 id="专家评论"><a href="#专家评论" class="headerlink" title="专家评论"></a><strong>专家评论</strong></h2>
                  <p>书是好是坏，得让专家看评一评呀，那么下面就是几位专家的精彩评论，快来看看吧~ 在互联网软件开发工程师的分类中，爬虫工程师是非常重要的。爬虫工作往往是一个公司核心业务开展的基础，数据抓取下来，才有后续的加工处理和最终展现。此时数据的抓取规模、稳定性、实时性、准确性就显得非常重要。早期的互联网充分开放互联，数据获取的难度很小。随着各大公司对数据资产日益看重，反爬水平也在不断提高，各种新技术不断给爬虫软件提出新的课题。本书作者对爬虫的各个领域都有深刻研究，书中探讨了Ajax数据的抓取、动态渲染页面的抓取、验证码识别、模拟登录等高级话题，同时也结合移动互联网的特点探讨了App的抓取等。更重要的是，本书提供了大量源码，可以帮助读者更好地理解相关内容。强烈推荐给各位技术爱好者阅读！</p>
                  <p><strong>——梁斌</strong>，八友科技总经理</p>
                  <p>数据既是当今大数据分析的前提，也是各种人工智能应用场景的基础。得数据者得天下，会爬虫者走遍天下也不怕！一册在手，让小白到老司机都能有所收获！</p>
                  <p><strong>——李舟军</strong>，北京航空航天大学教授，博士生导师</p>
                  <p>本书从爬虫入门到分布式抓取，详细介绍了爬虫技术的各个要点，并针对不同的场景提出了对应的解决方案。另外，书中通过大量的实例来帮助读者更好地学习爬虫技术，通俗易懂，干货满满。强烈推荐给大家！</p>
                  <p><strong>——宋睿华</strong>，微软小冰首席科学家</p>
                  <p>有人说中国互联网的带宽全给各种爬虫占据了，这说明网络爬虫的重要性以及中国互联网数据封闭垄断的现状。爬是一种能力，爬是为了不爬。</p>
                  <p><strong>——施水才</strong>，北京拓尔思信息技术股份有限公司总裁</p>
                  <h2 id="全书目录"><a href="#全书目录" class="headerlink" title="全书目录"></a><strong>全书目录</strong></h2>
                  <p>书的目录也有~ 看这里！</p>
                  <ul>
                    <li><strong>1-开发环境配置</strong></li>
                    <li>1.1-Python3的安装</li>
                    <li>1.2-请求库的安装</li>
                    <li>1.3-解析库的安装</li>
                    <li>1.4-数据库的安装</li>
                    <li>1.5-存储库的安装</li>
                    <li>1.6-Web库的安装</li>
                    <li>1.7-App爬取相关库的安装</li>
                    <li>1.8-爬虫框架的安装</li>
                    <li>1.9-部署相关库的安装</li>
                    <li><strong>2-爬虫基础</strong></li>
                    <li>2.1-HTTP基本原理</li>
                    <li>2.2-网页基础</li>
                    <li>2.3-爬虫的基本原理</li>
                    <li>2.4-会话和Cookies</li>
                    <li>2.5-代理的基本原理</li>
                    <li><strong>3-基本库的使用</strong></li>
                    <li>3.1-使用urllib</li>
                    <li>3.1.1-发送请求</li>
                    <li>3.1.2-处理异常</li>
                    <li>3.1.3-解析链接</li>
                    <li>3.1.4-分析Robots协议</li>
                    <li>3.2-使用requests</li>
                    <li>3.2.1-基本用法</li>
                    <li>3.2.2-高级用法</li>
                    <li>3.3-正则表达式</li>
                    <li>3.4-抓取猫眼电影排行</li>
                    <li><strong>4-解析库的使用</strong></li>
                    <li>4.1-使用XPath</li>
                    <li>4.2-使用Beautiful Soup</li>
                    <li>4.3-使用pyquery</li>
                    <li><strong>5-数据存储</strong></li>
                    <li>5.1-文件存储</li>
                    <li>5.1.1-TXT文本存储</li>
                    <li>5.1.2-JSON文件存储</li>
                    <li>5.1.3-CSV文件存储</li>
                    <li>5.2-关系型数据库存储</li>
                    <li>5.2.1-MySQL存储</li>
                    <li>5.3-非关系型数据库存储</li>
                    <li>5.3.1-MongoDB存储</li>
                    <li>5.3.2-Redis存储</li>
                    <li><strong>6-Ajax数据爬取</strong></li>
                    <li>6.1-什么是Ajax</li>
                    <li>6.2-Ajax分析方法</li>
                    <li>6.3-Ajax结果提取</li>
                    <li>6.4-分析Ajax爬取今日头条街拍美图</li>
                    <li><strong>7-动态渲染页面爬取</strong></li>
                    <li>7.1-Selenium的使用</li>
                    <li>7.2-Splash的使用</li>
                    <li>7.3-Splash负载均衡配置</li>
                    <li>7.4-使用Selenium爬取淘宝商品</li>
                    <li><strong>8-验证码的识别</strong></li>
                    <li>8.1-图形验证码的识别</li>
                    <li>8.2-极验滑动验证码的识别</li>
                    <li>8.3-点触验证码的识别</li>
                    <li>8.4-微博宫格验证码的识别</li>
                    <li><strong>9-代理的使用</strong></li>
                    <li>9.1-代理的设置</li>
                    <li>9.2-代理池的维护</li>
                    <li>9.3-付费代理的使用</li>
                    <li>9.4-ADSL拨号代理</li>
                    <li>9.5-使用代理爬取微信公众号文章</li>
                    <li><strong>10-模拟登录</strong></li>
                    <li>10.1-模拟登录并爬取GitHub</li>
                    <li>10.2-Cookies池的搭建</li>
                    <li><strong>11-App的爬取</strong></li>
                    <li>11.1-Charles的使用</li>
                    <li>11.2-mitmproxy的使用</li>
                    <li>11.3-mitmdump爬取“得到”App电子书信息</li>
                    <li>11.4-Appium的基本使用</li>
                    <li>11.5-Appium爬取微信朋友圈</li>
                    <li>11.6-Appium+mitmdump爬取京东商品</li>
                    <li><strong>12-pyspider框架的使用</strong></li>
                    <li>12.1-pyspider框架介绍</li>
                    <li>12.2-pyspider的基本使用</li>
                    <li>12.3-pyspider用法详解</li>
                    <li><strong>13-Scrapy框架的使用</strong></li>
                    <li>13.1-Scrapy框架介绍</li>
                    <li>13.2-Scrapy入门</li>
                    <li>13.3-Selector的用法</li>
                    <li>13.4-Spider的用法</li>
                    <li>13.5-Downloader Middleware的用法</li>
                    <li>13.6-Spider Middleware的用法</li>
                    <li>13.7-Item Pipeline的用法</li>
                    <li>13.8-Scrapy对接Selenium</li>
                    <li>13.9-Scrapy对接Splash</li>
                    <li>13.10-Scrapy通用爬虫</li>
                    <li>13.11-Scrapyrt的使用</li>
                    <li>13.12-Scrapy对接Docker</li>
                    <li>13.13-Scrapy爬取新浪微博</li>
                    <li><strong>14-分布式爬虫</strong></li>
                    <li>14.1-分布式爬虫原理</li>
                    <li>14.2-Scrapy-Redis源码解析</li>
                    <li>14.3-Scrapy分布式实现</li>
                    <li>14.4-Bloom Filter的对接</li>
                    <li><strong>15-分布式爬虫的部署</strong></li>
                    <li>15.1-Scrapyd分布式部署</li>
                    <li>15.2-Scrapyd-Client的使用</li>
                    <li>15.3-Scrapyd对接Docker</li>
                    <li>15.4-Scrapyd批量部署</li>
                    <li>15.5-Gerapy分布式管理</li>
                  </ul>
                  <h2 id="购买链接"><a href="#购买链接" class="headerlink" title="购买链接"></a><strong>购买链接</strong></h2>
                  <p>想必很多小伙伴已经等了很久了，之前预售那么久也一直迟迟没有货，发售就有不少网店又售空了，不过现在起不用担心了！</p>
                  <p>书籍现已在京东、天猫、当当等网店上架并全面供应啦，复制链接到浏览器打开或扫描二维码打开即可购买了！</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/京东二维码.png" alt=""></p>
                  <p> 京东商城</p>
                  <p><span class="exturl" data-url="aHR0cHM6Ly9pdGVtLmpkLmNvbS8xMjMzMzU0MC5odG1s">https://item.jd.com/12333540.html<i class="fa fa-external-link-alt"></i></span></p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/天猫二维码.png" alt=""></p>
                  <p> 天猫商城</p>
                  <p><span class="exturl" data-url="aHR0cHM6Ly9kZXRhaWwudG1hbGwuY29tL2l0ZW0uaHRtP2lkPTU2NjY5OTcwMzkxNw==">https://detail.tmall.com/item.htm?id=566699703917<i class="fa fa-external-link-alt"></i></span></p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/当当二维码.png" alt=""></p>
                  <p>当当网</p>
                  <p><span class="exturl" data-url="aHR0cDovL3Byb2R1Y3QuZGFuZ2RhbmcuY29tLzI1MjQ5NjAyLmh0bWw=">http://product.dangdang.com/25249602.html<i class="fa fa-external-link-alt"></i></span></p>
                  <p>欢迎大家购买，谢谢支持！O(∩_∩)O</p>
                  <h2 id="免费预览"><a href="#免费预览" class="headerlink" title="免费预览"></a><strong>免费预览</strong></h2>
                  <p>不放心？想先看看有些啥，没问题！看这里： 免费章节试读： <a href="https://cuiqingcai.com/5052.html">https://cuiqingcai.com/5052.html</a> 将一直免费开放<strong>前7章节</strong>，欢迎大家试读！ 好了，接下来就是我们的福利环节啦~</p>
                  <h2 id="福利一：签名书！！！"><a href="#福利一：签名书！！！" class="headerlink" title="福利一：签名书！！！"></a><strong>福利一：签名书！！！</strong></h2>
                  <p>恭喜你看到这里了！那么接下来的福利时间就到了！后面还有两个福利不容错过~ 赠书活动第三波来袭，送 20 本作者亲笔签名书籍！！！ 活动流程（重要，请一定认真阅读）： <strong>公众号进击的Coder回复 “赠书” 获取序列码参与活动，2018.7.24 22:00 截止，逾期参与无效，请记住您的序列码，这是您的唯一标识。</strong> <strong>您可以转发活动页面邀请好友帮忙积攒人气值，最终取人气值前 20 位赠书，截止日期 2018.7.24 22:00，该时刻人气值前 20 位的朋友每人会获得签名书一本。</strong> 最终赠书名单会在微信公众号进击的Coder公布，届时请关注公众号消息！</p>
                  <h2 id="福利二：独家优惠！！！"><a href="#福利二：独家优惠！！！" class="headerlink" title="福利二：独家优惠！！！"></a><strong>福利二：独家优惠！！！</strong></h2>
                  <p>等等，你以为这就是全部福利吗？当然不是！除了抽奖送书，我们还拿到了拨号VPS知名品牌云立方的独家优惠，在公众号（进击的Coder ）中回复：“优惠券”，即可免费领取云立方50元主机优惠券，数量有限，先到先得！优惠券可在云立方官网（www.yunlifang.cn）购买动态IP拨号VPS时抵扣现金，有了它，爬虫代理易如反掌！ 你问我动态拨号VPS能做什么？应该怎么用在爬虫里？来这里了解一下： <span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3M/X19iaXo9TXpJek56QTRORGszTnc9PSZhbXA7bWlkPTI0NTc3MzU3MzQmYW1wO2lkeD0xJmFtcDtzbj1jYTBkMDY2ZDc2NzU3MDIwNWRhYTk0NzVlMzFjYmMxZiZhbXA7c2NlbmU9MjEjd2VjaGF0X3JlZGlyZWN0">轻松获得海量稳定代理！ADSL拨号代理的搭建<i class="fa fa-external-link-alt"></i></span></p>
                  <h2 id="福利三：视频课程！！！"><a href="#福利三：视频课程！！！" class="headerlink" title="福利三：视频课程！！！"></a><strong>福利三：视频课程！！！</strong></h2>
                  <p>当然除了书籍，也有配套的视频课程，目前半价促销中，作者同样是崔庆才，二者结合学习效果更佳！限时优惠折扣中！扫描下图中二维码即可了解详情！ <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/课程宣传图.png" alt=""> 最后也是最重要的就是参与活动的地址了！！！快来扫码回复领取属于你的福利吧！！！</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/gzh.jpg" alt=""></p>
                  <h2 id="特别致谢"><a href="#特别致谢" class="headerlink" title="特别致谢"></a>特别致谢</h2>
                  <p>最后特别感谢云立方、天善智能对本活动的大力支持！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-07-15 16:16:59" itemprop="dateCreated datePublished" datetime="2018-07-15T16:16:59+08:00">2018-07-15</time>
                </span>
                <span id="/6173.html" class="post-meta-item leancloud_visitors" data-flag-title="《Python3网络爬虫开发实战》第三波赠书活动来了！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6160.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6160.html" class="post-title-link" itemprop="url">Python中异步协程的使用方法介绍</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h2>
                  <p>在执行一些 IO 密集型任务的时候，程序常常会因为等待 IO 而阻塞。比如在网络爬虫中，如果我们使用 requests 库来进行请求的话，如果网站响应速度过慢，程序一直在等待网站响应，最后导致其爬取效率是非常非常低的。 为了解决这类问题，本文就来探讨一下 Python 中异步协程来加速的方法，此种方法对于 IO 密集型任务非常有效。如将其应用到网络爬虫中，爬取效率甚至可以成百倍地提升。 注：本文协程使用 async/await 来实现，需要 Python 3.5 及以上版本。</p>
                  <h2 id="2-基本了解"><a href="#2-基本了解" class="headerlink" title="2. 基本了解"></a>2. 基本了解</h2>
                  <p>在了解异步协程之前，我们首先得了解一些基础概念，如阻塞和非阻塞、同步和异步、多进程和协程。</p>
                  <h3 id="2-1-阻塞"><a href="#2-1-阻塞" class="headerlink" title="2.1 阻塞"></a>2.1 阻塞</h3>
                  <p>阻塞状态指程序未得到所需计算资源时被挂起的状态。程序在等待某个操作完成期间，自身无法继续干别的事情，则称该程序在该操作上是阻塞的。 常见的阻塞形式有：网络 I/O 阻塞、磁盘 I/O 阻塞、用户输入阻塞等。阻塞是无处不在的，包括 CPU 切换上下文时，所有的进程都无法真正干事情，它们也会被阻塞。如果是多核 CPU 则正在执行上下文切换操作的核不可被利用。</p>
                  <h3 id="2-2-非阻塞"><a href="#2-2-非阻塞" class="headerlink" title="2.2 非阻塞"></a>2.2 非阻塞</h3>
                  <p>程序在等待某操作过程中，自身不被阻塞，可以继续运行干别的事情，则称该程序在该操作上是非阻塞的。 非阻塞并不是在任何程序级别、任何情况下都可以存在的。 仅当程序封装的级别可以囊括独立的子程序单元时，它才可能存在非阻塞状态。 非阻塞的存在是因为阻塞存在，正因为某个操作阻塞导致的耗时与效率低下，我们才要把它变成非阻塞的。</p>
                  <h3 id="2-3-同步"><a href="#2-3-同步" class="headerlink" title="2.3 同步"></a>2.3 同步</h3>
                  <p>不同程序单元为了完成某个任务，在执行过程中需靠某种通信方式以协调一致，称这些程序单元是同步执行的。 例如购物系统中更新商品库存，需要用“行锁”作为通信信号，让不同的更新请求强制排队顺序执行，那更新库存的操作是同步的。 简言之，同步意味着有序。</p>
                  <h3 id="2-4-异步"><a href="#2-4-异步" class="headerlink" title="2.4 异步"></a>2.4 异步</h3>
                  <p>为完成某个任务，不同程序单元之间过程中无需通信协调，也能完成任务的方式，不相关的程序单元之间可以是异步的。 例如，爬虫下载网页。调度程序调用下载程序后，即可调度其他任务，而无需与该下载任务保持通信以协调行为。不同网页的下载、保存等操作都是无关的，也无需相互通知协调。这些异步操作的完成时刻并不确定。 简言之，异步意味着无序。</p>
                  <h3 id="2-5-多进程"><a href="#2-5-多进程" class="headerlink" title="2.5 多进程"></a>2.5 多进程</h3>
                  <p>多进程就是利用 CPU 的多核优势，在同一时间并行地执行多个任务，可以大大提高执行效率。</p>
                  <h3 id="2-6-协程"><a href="#2-6-协程" class="headerlink" title="2.6 协程"></a>2.6 协程</h3>
                  <p>协程，英文叫做 Coroutine，又称微线程，纤程，协程是一种用户态的轻量级线程。 协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈。因此协程能保留上一次调用时的状态，即所有局部状态的一个特定组合，每次过程重入时，就相当于进入上一次调用的状态。 协程本质上是个单进程，协程相对于多进程来说，无需线程上下文切换的开销，无需原子操作锁定及同步的开销，编程模型也非常简单。 我们可以使用协程来实现异步操作，比如在网络爬虫场景下，我们发出一个请求之后，需要等待一定的时间才能得到响应，但其实在这个等待过程中，程序可以干许多其他的事情，等到响应得到之后才切换回来继续处理，这样可以充分利用 CPU 和其他资源，这就是异步协程的优势。</p>
                  <h2 id="3-异步协程用法"><a href="#3-异步协程用法" class="headerlink" title="3. 异步协程用法"></a>3. 异步协程用法</h2>
                  <p>接下来让我们来了解下协程的实现，从 Python 3.4 开始，Python 中加入了协程的概念，但这个版本的协程还是以生成器对象为基础的，在 Python 3.5 则增加了 async/await，使得协程的实现更加方便。 Python 中使用协程最常用的库莫过于 asyncio，所以本文会以 asyncio 为基础来介绍协程的使用。 首先我们需要了解下面几个概念：</p>
                  <ul>
                    <li>event_loop：事件循环，相当于一个无限循环，我们可以把一些函数注册到这个事件循环上，当满足条件发生的时候，就会调用对应的处理方法。</li>
                    <li>coroutine：中文翻译叫协程，在 Python 中常指代为协程对象类型，我们可以将协程对象注册到时间循环中，它会被事件循环调用。我们可以使用 async 关键字来定义一个方法，这个方法在调用时不会立即被执行，而是返回一个协程对象。</li>
                    <li>task：任务，它是对协程对象的进一步封装，包含了任务的各个状态。</li>
                    <li>future：代表将来执行或没有执行的任务的结果，实际上和 task 没有本质区别。</li>
                  </ul>
                  <p>另外我们还需要了解 async/await 关键字，它是从 Python 3.5 才出现的，专门用于定义协程。其中，async 定义一个协程，await 用来挂起阻塞方法的执行。</p>
                  <h3 id="3-1-定义协程"><a href="#3-1-定义协程" class="headerlink" title="3.1 定义协程"></a>3.1 定义协程</h3>
                  <p>首先我们来定义一个协程，体验一下它和普通进程在实现上的不同之处，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">execute</span><span class="params">(x)</span>:</span></span><br><span class="line">    print(<span class="string">'Number:'</span>, x)</span><br><span class="line"></span><br><span class="line">coroutine = execute(<span class="number">1</span>)</span><br><span class="line">print(<span class="string">'Coroutine:'</span>, coroutine)</span><br><span class="line">print(<span class="string">'After calling execute'</span>)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(coroutine)</span><br><span class="line">print(<span class="string">'After calling loop'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Coroutine: &lt;coroutine object<span class="built_in"> execute </span>at 0x1034cf830&gt;</span><br><span class="line">After calling execute</span><br><span class="line">Number: 1</span><br><span class="line">After calling loop</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先我们引入了 asyncio 这个包，这样我们才可以使用 async 和 await，然后我们使用 async 定义了一个 execute() 方法，方法接收一个数字参数，方法执行之后会打印这个数字。 随后我们直接调用了这个方法，然而这个方法并没有执行，而是返回了一个 coroutine 协程对象。随后我们使用 get_event_loop() 方法创建了一个事件循环 loop，并调用了 loop 对象的 run_until_complete() 方法将协程注册到事件循环 loop 中，然后启动。最后我们才看到了 execute() 方法打印了输出结果。 可见，async 定义的方法就会变成一个无法直接执行的 coroutine 对象，必须将其注册到事件循环中才可以执行。 上文我们还提到了 task，它是对 coroutine 对象的进一步封装，它里面相比 coroutine 对象多了运行状态，比如 running、finished 等，我们可以用这些状态来获取协程对象的执行情况。 在上面的例子中，当我们将 coroutine 对象传递给 run_until_complete() 方法的时候，实际上它进行了一个操作就是将 coroutine 封装成了 task 对象，我们也可以显式地进行声明，如下所示：</p>
                  <figure class="highlight gradle">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line">async <span class="keyword">def</span> execute(x):</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Number:'</span>, x)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">coroutine = execute(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Coroutine:'</span>, coroutine)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'After calling execute'</span>)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line"><span class="keyword">task</span> = loop.create_task(coroutine)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task:'</span>, <span class="keyword">task</span>)</span><br><span class="line">loop.run_until_complete(<span class="keyword">task</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task:'</span>, <span class="keyword">task</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'After calling loop'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Coroutine: &lt;coroutine object<span class="built_in"> execute </span>at 0x10e0f7830&gt;</span><br><span class="line">After calling execute</span><br><span class="line">Task: &lt;Task pending coro=&lt;execute() running at demo.py:4&gt;&gt;</span><br><span class="line">Number: 1</span><br><span class="line">Task: &lt;Task finished coro=&lt;execute() done, defined at demo.py:4&gt; result=1&gt;</span><br><span class="line">After calling loop</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们定义了 loop 对象之后，接着调用了它的 create_task() 方法将 coroutine 对象转化为了 task 对象，随后我们打印输出一下，发现它是 pending 状态。接着我们将 task 对象添加到事件循环中得到执行，随后我们再打印输出一下 task 对象，发现它的状态就变成了 finished，同时还可以看到其 result 变成了 1，也就是我们定义的 execute() 方法的返回结果。 另外定义 task 对象还有一种方式，就是直接通过 asyncio 的 ensure_future() 方法，返回结果也是 task 对象，这样的话我们就可以不借助于 loop 来定义，即使我们还没有声明 loop 也可以提前定义好 task 对象，写法如下：</p>
                  <figure class="highlight gradle">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line">async <span class="keyword">def</span> execute(x):</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Number:'</span>, x)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">coroutine = execute(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Coroutine:'</span>, coroutine)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'After calling execute'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">task</span> = asyncio.ensure_future(coroutine)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task:'</span>, <span class="keyword">task</span>)</span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(<span class="keyword">task</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task:'</span>, <span class="keyword">task</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'After calling loop'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Coroutine: &lt;coroutine object<span class="built_in"> execute </span>at 0x10aa33830&gt;</span><br><span class="line">After calling execute</span><br><span class="line">Task: &lt;Task pending coro=&lt;execute() running at demo.py:4&gt;&gt;</span><br><span class="line">Number: 1</span><br><span class="line">Task: &lt;Task finished coro=&lt;execute() done, defined at demo.py:4&gt; result=1&gt;</span><br><span class="line">After calling loop</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>发现其效果都是一样的。</p>
                  <h3 id="3-2-绑定回调"><a href="#3-2-绑定回调" class="headerlink" title="3.2 绑定回调"></a>3.2 绑定回调</h3>
                  <p>另外我们也可以为某个 task 绑定一个回调方法，来看下面的例子：</p>
                  <figure class="highlight gradle">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">async <span class="keyword">def</span> request():</span><br><span class="line">    url = <span class="string">'https://www.baidu.com'</span></span><br><span class="line">    status = requests.get(url)</span><br><span class="line">    <span class="keyword">return</span> status</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> callback(<span class="keyword">task</span>):</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Status:'</span>, <span class="keyword">task</span>.result())</span><br><span class="line"></span><br><span class="line">coroutine = request()</span><br><span class="line"><span class="keyword">task</span> = asyncio.ensure_future(coroutine)</span><br><span class="line"><span class="keyword">task</span>.add_done_callback(callback)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task:'</span>, <span class="keyword">task</span>)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(<span class="keyword">task</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task:'</span>, <span class="keyword">task</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们定义了一个 request() 方法，请求了百度，返回状态码，但是这个方法里面我们没有任何 print() 语句。随后我们定义了一个 callback() 方法，这个方法接收一个参数，是 task 对象，然后调用 print() 方法打印了 task 对象的结果。这样我们就定义好了一个 coroutine 对象和一个回调方法，我们现在希望的效果是，当 coroutine 对象执行完毕之后，就去执行声明的 callback() 方法。 那么它们二者怎样关联起来呢？很简单，只需要调用 add_done_callback() 方法即可，我们将 callback() 方法传递给了封装好的 task 对象，这样当 task 执行完毕之后就可以调用 callback() 方法了，同时 task 对象还会作为参数传递给 callback() 方法，调用 task 对象的 result() 方法就可以获取返回结果了。 运行结果：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Task</span>: &lt;<span class="keyword">Task</span> pending coro=&lt;request() running <span class="keyword">at</span> demo.py:<span class="number">5</span>&gt; cb=[callback() <span class="keyword">at</span> demo.py:<span class="number">11</span>]&gt;</span><br><span class="line">Status: &lt;Response [<span class="number">200</span>]&gt;</span><br><span class="line"><span class="keyword">Task</span>: &lt;<span class="keyword">Task</span> finished coro=&lt;request() done, defined <span class="keyword">at</span> demo.py:<span class="number">5</span>&gt; result=&lt;Response [<span class="number">200</span>]&gt;&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>实际上不用回调方法，直接在 task 运行完毕之后也可以直接调用 result() 方法获取结果，如下所示：</p>
                  <figure class="highlight gradle">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">async <span class="keyword">def</span> request():</span><br><span class="line">    url = <span class="string">'https://www.baidu.com'</span></span><br><span class="line">    status = requests.get(url)</span><br><span class="line">    <span class="keyword">return</span> status</span><br><span class="line"></span><br><span class="line">coroutine = request()</span><br><span class="line"><span class="keyword">task</span> = asyncio.ensure_future(coroutine)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task:'</span>, <span class="keyword">task</span>)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(<span class="keyword">task</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task:'</span>, <span class="keyword">task</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task Result:'</span>, <span class="keyword">task</span>.result())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果是一样的：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Task</span>: &lt;<span class="keyword">Task</span> pending coro=&lt;request() running <span class="keyword">at</span> demo.py:<span class="number">4</span>&gt;&gt;</span><br><span class="line"><span class="keyword">Task</span>: &lt;<span class="keyword">Task</span> finished coro=&lt;request() done, defined <span class="keyword">at</span> demo.py:<span class="number">4</span>&gt; result=&lt;Response [<span class="number">200</span>]&gt;&gt;</span><br><span class="line"><span class="keyword">Task</span> Result: &lt;Response [<span class="number">200</span>]&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="3-3-多任务协程"><a href="#3-3-多任务协程" class="headerlink" title="3.3 多任务协程"></a>3.3 多任务协程</h3>
                  <p>上面的例子我们只执行了一次请求，如果我们想执行多次请求应该怎么办呢？我们可以定义一个 task 列表，然后使用 asyncio 的 wait() 方法即可执行，看下面的例子：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">request</span><span class="params">()</span>:</span></span><br><span class="line">    url = <span class="string">'https://www.baidu.com'</span></span><br><span class="line">    status = requests.get(url)</span><br><span class="line">    <span class="keyword">return</span> status</span><br><span class="line"></span><br><span class="line">tasks = [asyncio.ensure_future(request()) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">5</span>)]</span><br><span class="line">print(<span class="string">'Tasks:'</span>, tasks)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> task <span class="keyword">in</span> tasks:</span><br><span class="line">    print(<span class="string">'Task Result:'</span>, task.result())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们使用一个 for 循环创建了五个 task，组成了一个列表，然后把这个列表首先传递给了 asyncio 的 wait() 方法，然后再将其注册到时间循环中，就可以发起五个任务了。最后我们再将任务的运行结果输出出来，运行结果如下：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Tasks: [&lt;<span class="keyword">Task</span> pending coro=&lt;request() running <span class="keyword">at</span> demo.py:<span class="number">5</span>&gt;&gt;, &lt;<span class="keyword">Task</span> pending coro=&lt;request() running <span class="keyword">at</span> demo.py:<span class="number">5</span>&gt;&gt;, &lt;<span class="keyword">Task</span> pending coro=&lt;request() running <span class="keyword">at</span> demo.py:<span class="number">5</span>&gt;&gt;, &lt;<span class="keyword">Task</span> pending coro=&lt;request() running <span class="keyword">at</span> demo.py:<span class="number">5</span>&gt;&gt;, &lt;<span class="keyword">Task</span> pending coro=&lt;request() running <span class="keyword">at</span> demo.py:<span class="number">5</span>&gt;&gt;]</span><br><span class="line"><span class="keyword">Task</span> Result: &lt;Response [<span class="number">200</span>]&gt;</span><br><span class="line"><span class="keyword">Task</span> Result: &lt;Response [<span class="number">200</span>]&gt;</span><br><span class="line"><span class="keyword">Task</span> Result: &lt;Response [<span class="number">200</span>]&gt;</span><br><span class="line"><span class="keyword">Task</span> Result: &lt;Response [<span class="number">200</span>]&gt;</span><br><span class="line"><span class="keyword">Task</span> Result: &lt;Response [<span class="number">200</span>]&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到五个任务被顺次执行了，并得到了运行结果。</p>
                  <h3 id="3-4-协程实现"><a href="#3-4-协程实现" class="headerlink" title="3.4 协程实现"></a>3.4 协程实现</h3>
                  <p>前面说了这么一通，又是 async，又是 coroutine，又是 task，又是 callback，但似乎并没有看出协程的优势啊？反而写法上更加奇怪和麻烦了，别急，上面的案例只是为后面的使用作铺垫，接下来我们正式来看下协程在解决 IO 密集型任务上有怎样的优势吧！ 上面的代码中，我们用一个网络请求作为示例，这就是一个耗时等待的操作，因为我们请求网页之后需要等待页面响应并返回结果。耗时等待的操作一般都是 IO 操作，比如文件读取、网络请求等等。协程对于处理这种操作是有很大优势的，当遇到需要等待的情况的时候，程序可以暂时挂起，转而去执行其他的操作，从而避免一直等待一个程序而耗费过多的时间，充分利用资源。 为了表现出协程的优势，我们需要先创建一个合适的实验环境，最好的方法就是模拟一个需要等待一定时间才可以获取返回结果的网页，上面的代码中使用了百度，但百度的响应太快了，而且响应速度也会受本机网速影响，所以最好的方式是自己在本地模拟一个慢速服务器，这里我们选用 Flask。 如果没有安装 Flask 的话可以执行如下命令安装：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> flask</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后编写服务器代码如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">'/'</span>)</span><br><span class="line">def <span class="keyword">index</span>():</span><br><span class="line">    <span class="type">time</span>.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello!'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(threaded=<span class="keyword">True</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们定义了一个 Flask 服务，主入口是 index() 方法，方法里面先调用了 sleep() 方法休眠 3 秒，然后接着再返回结果，也就是说，每次请求这个接口至少要耗时 3 秒，这样我们就模拟了一个慢速的服务接口。 注意这里服务启动的时候，run() 方法加了一个参数 threaded，这表明 Flask 启动了多线程模式，不然默认是只有一个线程的。如果不开启多线程模式，同一时刻遇到多个请求的时候，只能顺次处理，这样即使我们使用协程异步请求了这个服务，也只能一个一个排队等待，瓶颈就会出现在服务端。所以，多线程模式是有必要打开的。 启动之后，Flask 应该默认会在 127.0.0.1:5000 上运行，运行之后控制台输出结果如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"> * Running <span class="keyword">on</span> http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">5000</span>/ (Press CTRL+C <span class="keyword">to</span> <span class="keyword">quit</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们再重新使用上面的方法请求一遍：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"></span><br><span class="line">start = <span class="type">time</span>.time()</span><br><span class="line"></span><br><span class="line">async def request():</span><br><span class="line">    url = <span class="string">'http://127.0.0.1:5000'</span></span><br><span class="line">    print(<span class="string">'Waiting for'</span>, url)</span><br><span class="line">    response = requests.<span class="keyword">get</span>(url)</span><br><span class="line">    print(<span class="string">'Get response from'</span>, url, <span class="string">'Result:'</span>, response.text)</span><br><span class="line"></span><br><span class="line">tasks = [asyncio.ensure_future(request()) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">5</span>)]</span><br><span class="line"><span class="keyword">loop</span> = asyncio.get_event_loop()</span><br><span class="line"><span class="keyword">loop</span>.run_until_complete(asyncio.wait(tasks))</span><br><span class="line"></span><br><span class="line">end = <span class="type">time</span>.time()</span><br><span class="line">print(<span class="string">'Cost time:'</span>, <span class="keyword">end</span> - <span class="keyword">start</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们还是创建了五个 task，然后将 task 列表传给 wait() 方法并注册到时间循环中执行。 运行结果如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Cost <span class="string">time:</span> <span class="number">15.049368143081665</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现和正常的请求并没有什么两样，依然还是顺次执行的，耗时 15 秒，平均一个请求耗时 3 秒，说好的异步处理呢？ 其实，要实现异步处理，我们得先要有挂起的操作，当一个任务需要等待 IO 结果的时候，可以挂起当前任务，转而去执行其他任务，这样我们才能充分利用好资源，上面方法都是一本正经的串行走下来，连个挂起都没有，怎么可能实现异步？想太多了。 要实现异步，接下来我们再了解一下 await 的用法，使用 await 可以将耗时等待的操作挂起，让出控制权。当协程执行的时候遇到 await，时间循环就会将本协程挂起，转而去执行别的协程，直到其他的协程挂起或执行完毕。 所以，我们可能会将代码中的 request() 方法改成如下的样子：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">request</span><span class="params">()</span>:</span></span><br><span class="line">    url = <span class="string">'http://127.0.0.1:5000'</span></span><br><span class="line">    print(<span class="string">'Waiting for'</span>, url)</span><br><span class="line">    response = <span class="keyword">await</span> requests.get(url)</span><br><span class="line">    print(<span class="string">'Get response from'</span>, url, <span class="string">'Result:'</span>, response.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>仅仅是在 requests 前面加了一个 await，然而执行以下代码，会得到如下报错：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Cost <span class="string">time:</span> <span class="number">15.048935890197754</span></span><br><span class="line">Task exception was never retrieved</span><br><span class="line"><span class="string">future:</span> &lt;Task finished coro=&lt;request() done, defined at demo.<span class="string">py:</span><span class="number">7</span>&gt; exception=TypeError(<span class="string">"object Response can't be used in 'await' expression"</span>,)&gt;</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"demo.py"</span>, line <span class="number">10</span>, <span class="keyword">in</span> request</span><br><span class="line">    status = await requests.get(url)</span><br><span class="line"><span class="string">TypeError:</span> object Response can<span class="string">'t be used in '</span>await<span class="string">' expression</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这次它遇到 await 方法确实挂起了，也等待了，但是最后却报了这么个错，这个错误的意思是 requests 返回的 Response 对象不能和 await 一起使用，为什么呢？因为根据官方文档说明，await 后面的对象必须是如下格式之一：</p>
                  <ul>
                    <li>A native coroutine object returned from a native coroutine function，一个原生 coroutine 对象。</li>
                    <li>A generator-based coroutine object returned from a function decorated with types.coroutine()，一个由 types.coroutine() 修饰的生成器，这个生成器可以返回 coroutine 对象。</li>
                    <li>An object with an await<strong> method returning an iterator，一个包含 </strong>await 方法的对象返回的一个迭代器。</li>
                  </ul>
                  <p>可以参见：<span class="exturl" data-url="aHR0cHM6Ly93d3cucHl0aG9uLm9yZy9kZXYvcGVwcy9wZXAtMDQ5Mi8jYXdhaXQtZXhwcmVzc2lvbg==">https://www.python.org/dev/peps/pep-0492/#await-expression<i class="fa fa-external-link-alt"></i></span>。 reqeusts 返回的 Response 不符合上面任一条件，因此就会报上面的错误了。 那么有的小伙伴就发现了，既然 await 后面可以跟一个 coroutine 对象，那么我用 async 把请求的方法改成 coroutine 对象不就可以了吗？所以就改写成如下的样子：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"></span><br><span class="line">start = <span class="type">time</span>.time()</span><br><span class="line"></span><br><span class="line">async def <span class="keyword">get</span>(url):</span><br><span class="line">    <span class="keyword">return</span> requests.<span class="keyword">get</span>(url)</span><br><span class="line"></span><br><span class="line">async def request():</span><br><span class="line">    url = <span class="string">'http://127.0.0.1:5000'</span></span><br><span class="line">    print(<span class="string">'Waiting for'</span>, url)</span><br><span class="line">    response = await <span class="keyword">get</span>(url)</span><br><span class="line">    print(<span class="string">'Get response from'</span>, url, <span class="string">'Result:'</span>, response.text)</span><br><span class="line"></span><br><span class="line">tasks = [asyncio.ensure_future(request()) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">5</span>)]</span><br><span class="line"><span class="keyword">loop</span> = asyncio.get_event_loop()</span><br><span class="line"><span class="keyword">loop</span>.run_until_complete(asyncio.wait(tasks))</span><br><span class="line"></span><br><span class="line">end = <span class="type">time</span>.time()</span><br><span class="line">print(<span class="string">'Cost time:'</span>, <span class="keyword">end</span> - <span class="keyword">start</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们将请求页面的方法独立出来，并用 async 修饰，这样就得到了一个 coroutine 对象，我们运行一下看看：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Cost <span class="string">time:</span> <span class="number">15.134317874908447</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>还是不行，它还不是异步执行，也就是说我们仅仅将涉及 IO 操作的代码封装到 async 修饰的方法里面是不可行的！我们必须要使用支持异步操作的请求方式才可以实现真正的异步，所以这里就需要 aiohttp 派上用场了。</p>
                  <h3 id="3-5-使用-aiohttp"><a href="#3-5-使用-aiohttp" class="headerlink" title="3.5 使用 aiohttp"></a>3.5 使用 aiohttp</h3>
                  <p>aiohttp 是一个支持异步请求的库，利用它和 asyncio 配合我们可以非常方便地实现异步请求操作。 安装方式如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> aiohttp</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>官方文档链接为：<span class="exturl" data-url="aHR0cHM6Ly9haW9odHRwLnJlYWR0aGVkb2NzLmlvLw==">https://aiohttp.readthedocs.io/<i class="fa fa-external-link-alt"></i></span>，它分为两部分，一部分是 Client，一部分是 Server，详细的内容可以参考官方文档。 下面我们将 aiohttp 用上来，将代码改成如下样子：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"></span><br><span class="line">start = <span class="type">time</span>.time()</span><br><span class="line"></span><br><span class="line">async def <span class="keyword">get</span>(url):</span><br><span class="line">    <span class="keyword">session</span> = aiohttp.ClientSession()</span><br><span class="line">    response = await <span class="keyword">session</span>.<span class="keyword">get</span>(url)</span><br><span class="line">    result = await response.text()</span><br><span class="line">    <span class="keyword">session</span>.<span class="keyword">close</span>()</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">async def request():</span><br><span class="line">    url = <span class="string">'http://127.0.0.1:5000'</span></span><br><span class="line">    print(<span class="string">'Waiting for'</span>, url)</span><br><span class="line">    result = await <span class="keyword">get</span>(url)</span><br><span class="line">    print(<span class="string">'Get response from'</span>, url, <span class="string">'Result:'</span>, result)</span><br><span class="line"></span><br><span class="line">tasks = [asyncio.ensure_future(request()) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">5</span>)]</span><br><span class="line"><span class="keyword">loop</span> = asyncio.get_event_loop()</span><br><span class="line"><span class="keyword">loop</span>.run_until_complete(asyncio.wait(tasks))</span><br><span class="line"></span><br><span class="line">end = <span class="type">time</span>.time()</span><br><span class="line">print(<span class="string">'Cost time:'</span>, <span class="keyword">end</span> - <span class="keyword">start</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们将请求库由 requests 改成了 aiohttp，通过 aiohttp 的 ClientSession 类的 get() 方法进行请求，结果如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Cost <span class="string">time:</span> <span class="number">3.0199508666992188</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>成功了！我们发现这次请求的耗时由 15 秒变成了 3 秒，耗时直接变成了原来的 1/5。 代码里面我们使用了 await，后面跟了 get() 方法，在执行这五个协程的时候，如果遇到了 await，那么就会将当前协程挂起，转而去执行其他的协程，直到其他的协程也挂起或执行完毕，再进行下一个协程的执行。 开始运行时，时间循环会运行第一个 task，针对第一个 task 来说，当执行到第一个 await 跟着的 get() 方法时，它被挂起，但这个 get() 方法第一步的执行是非阻塞的，挂起之后立马被唤醒，所以立即又进入执行，创建了 ClientSession 对象，接着遇到了第二个 await，调用了 session.get() 请求方法，然后就被挂起了，由于请求需要耗时很久，所以一直没有被唤醒，好第一个 task 被挂起了，那接下来该怎么办呢？事件循环会寻找当前未被挂起的协程继续执行，于是就转而执行第二个 task 了，也是一样的流程操作，直到执行了第五个 task 的 session.get() 方法之后，全部的 task 都被挂起了。所有 task 都已经处于挂起状态，那咋办？只好等待了。3 秒之后，几个请求几乎同时都有了响应，然后几个 task 也被唤醒接着执行，输出请求结果，最后耗时，3 秒！ 怎么样？这就是异步操作的便捷之处，当遇到阻塞式操作时，任务被挂起，程序接着去执行其他的任务，而不是傻傻地等着，这样可以充分利用 CPU 时间，而不必把时间浪费在等待 IO 上。 有人就会说了，既然这样的话，在上面的例子中，在发出网络请求后，既然接下来的 3 秒都是在等待的，在 3 秒之内，CPU 可以处理的 task 数量远不止这些，那么岂不是我们放 10 个、20 个、50 个、100 个、1000 个 task 一起执行，最后得到所有结果的耗时不都是 3 秒左右吗？因为这几个任务被挂起后都是一起等待的。 理论来说确实是这样的，不过有个前提，那就是服务器在同一时刻接受无限次请求都能保证正常返回结果，也就是服务器无限抗压，另外还要忽略 IO 传输时延，确实可以做到无限 task 一起执行且在预想时间内得到结果。 我们这里将 task 数量设置成 100，再试一下：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">tasks</span> = [asyncio.ensure_future(request()) for _ in range(<span class="number">100</span>)]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>耗时结果如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Cost</span> <span class="type">time</span>: <span class="number">3.106252670288086</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后运行时间也是在 3 秒左右，当然多出来的时间就是 IO 时延了。 可见，使用了异步协程之后，我们几乎可以在相同的时间内实现成百上千倍次的网络请求，把这个运用在爬虫中，速度提升可谓是非常可观了。</p>
                  <h3 id="3-6-与单进程、多进程对比"><a href="#3-6-与单进程、多进程对比" class="headerlink" title="3.6 与单进程、多进程对比"></a>3.6 与单进程、多进程对比</h3>
                  <p>可能有的小伙伴非常想知道上面的例子中，如果 100 次请求，不是用异步协程的话，使用单进程和多进程会耗费多少时间，我们来测试一下： 首先来测试一下单进程的时间：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"></span><br><span class="line">start = <span class="type">time</span>.time()</span><br><span class="line"></span><br><span class="line">def request():</span><br><span class="line">    url = <span class="string">'http://127.0.0.1:5000'</span></span><br><span class="line">    print(<span class="string">'Waiting for'</span>, url)</span><br><span class="line">    result = requests.<span class="keyword">get</span>(url).text</span><br><span class="line">    print(<span class="string">'Get response from'</span>, url, <span class="string">'Result:'</span>, result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    request()</span><br><span class="line"></span><br><span class="line">end = <span class="type">time</span>.time()</span><br><span class="line">print(<span class="string">'Cost time:'</span>, <span class="keyword">end</span> - <span class="keyword">start</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后耗时：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Cost</span> <span class="type">time</span>: <span class="number">305.16639709472656</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们使用多进程来测试下，使用 multiprocessing 库：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">import multiprocessing</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line"></span><br><span class="line">def request(_):</span><br><span class="line">    url = <span class="string">'http://127.0.0.1:5000'</span></span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'Waiting for'</span>, url)</span><br><span class="line">    result = requests.<span class="builtin-name">get</span>(url).text</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'Get response from'</span>, url, <span class="string">'Result:'</span>, result)</span><br><span class="line"></span><br><span class="line">cpu_count = multiprocessing.cpu_count()</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'Cpu count:'</span>, cpu_count)</span><br><span class="line">pool = multiprocessing.Pool(cpu_count)</span><br><span class="line">pool.map(request, range(100))</span><br><span class="line"></span><br><span class="line">end = time.time()</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'Cost time:'</span>, end - start)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我使用了multiprocessing 里面的 Pool 类，即进程池。我的电脑的 CPU 个数是 8 个，这里的进程池的大小就是 8。 运行时间：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Cost</span> <span class="type">time</span>: <span class="number">48.17306900024414</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可见 multiprocessing 相比单线程来说，还是可以大大提高效率的。</p>
                  <h3 id="3-7-与多进程的结合"><a href="#3-7-与多进程的结合" class="headerlink" title="3.7 与多进程的结合"></a>3.7 与多进程的结合</h3>
                  <p>既然异步协程和多进程对网络请求都有提升，那么为什么不把二者结合起来呢？在最新的 PyCon 2018 上，来自 Facebook 的 John Reese 介绍了 asyncio 和 multiprocessing 各自的特点，并开发了一个新的库，叫做 aiomultiprocess，感兴趣的可以了解下：<span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj0wa1hhTGg4Rnozaw==">https://www.youtube.com/watch?v=0kXaLh8Fz3k<i class="fa fa-external-link-alt"></i></span>。 这个库的安装方式是：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> aiomultiprocess</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>需要 Python 3.6 及更高版本才可使用。 使用这个库，我们可以将上面的例子改写如下：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import asyncio</span><br><span class="line">import aiohttp</span><br><span class="line">import time</span><br><span class="line">from aiomultiprocess import Pool</span><br><span class="line"></span><br><span class="line"><span class="keyword">start</span> = time.time()</span><br><span class="line"></span><br><span class="line">async <span class="keyword">def</span> <span class="keyword">get</span>(<span class="keyword">url</span>):</span><br><span class="line">    <span class="keyword">session</span> = aiohttp.ClientSession()</span><br><span class="line">    response = await session.get(<span class="keyword">url</span>)</span><br><span class="line">    <span class="keyword">result</span> = await response.text()</span><br><span class="line">    session.close()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">result</span></span><br><span class="line"></span><br><span class="line">async <span class="keyword">def</span> request():</span><br><span class="line">    <span class="keyword">url</span> = <span class="string">'http://127.0.0.1:5000'</span></span><br><span class="line">    urls = [<span class="keyword">url</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="keyword">range</span>(<span class="number">100</span>)]</span><br><span class="line">    async <span class="keyword">with</span> Pool() <span class="keyword">as</span> pool:</span><br><span class="line">        <span class="keyword">result</span> = await pool.map(<span class="keyword">get</span>, urls)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">result</span></span><br><span class="line"></span><br><span class="line">coroutine = request()</span><br><span class="line">task = asyncio.ensure_future(coroutine)</span><br><span class="line"><span class="keyword">loop</span> = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(task)</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> = time.time()</span><br><span class="line">print(<span class="string">'Cost time:'</span>, <span class="keyword">end</span> - <span class="keyword">start</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就会同时使用多进程和异步协程进行请求，当然最后的结果其实和异步是差不多的：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Cost</span> <span class="type">time</span>: <span class="number">3.1156570434570312</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>因为我的测试接口的原因，最快的响应也是 3 秒，所以这部分多余的时间基本都是 IO 传输时延。但在真实情况下，我们在做爬取的时候遇到的情况千变万化，一方面我们使用异步协程来防止阻塞，另一方面我们使用 multiprocessing 来利用多核成倍加速，节省时间其实还是非常可观的。 以上便是 Python 中协程的基本用法，希望对大家有帮助。</p>
                  <h2 id="4-参考来源"><a href="#4-参考来源" class="headerlink" title="4. 参考来源"></a>4. 参考来源</h2>
                  <ul>
                    <li><span class="exturl" data-url="aHR0cDovL3B5dGhvbi5qb2Jib2xlLmNvbS84NzMxMC8=">http://python.jobbole.com/87310/<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20veHliYWJ5L3AvNjQwNjE5MS5odG1s">https://www.cnblogs.com/xybaby/p/6406191.html<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cDovL3B5dGhvbi5qb2Jib2xlLmNvbS84ODI5MS8=">http://python.jobbole.com/88291/<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cDovL2xvdGFib3V0Lm1lLzIwMTcvdW5kZXJzdGFuZC1weXRob24tYXN5bmNpby8=">http://lotabout.me/2017/understand-python-asyncio/<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9zZWdtZW50ZmF1bHQuY29tL2EvMTE5MDAwMDAwODgxNDY3Ng==">https://segmentfault.com/a/1190000008814676<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vYW5pbWFsaXplL3AvNDczODk0MS5odG1s">https://www.cnblogs.com/animalize/p/4738941.html<i class="fa fa-external-link-alt"></i></span></li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-07-06 01:38:16" itemprop="dateCreated datePublished" datetime="2018-07-06T01:38:16+08:00">2018-07-06</time>
                </span>
                <span id="/6160.html" class="post-meta-item leancloud_visitors" data-flag-title="Python中异步协程的使用方法介绍" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>16k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>14 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6146.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/6146.html" class="post-title-link" itemprop="url">推荐一些Mac上比较好用的软件</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>最近有一个朋友刚入手了 Mac，准备专门搞开发用，让我给他推荐几款软件，然后我就把我的 Launchpad 截图发给了他，他看到这密密麻麻的软件完全不知所措。<a href="https://github.com/Germey/AI/blob/master/assets/2018-07-03-01-51-59.jpg" target="_blank" rel="noopener"><img src="https://github.com/Germey/AI/raw/master/assets/2018-07-03-01-51-59.jpg" alt=""></a> 于是乎，我就大略整理了一些我比较推荐的几款软件，同时分享给大家，希望对大家有所帮助！ 下面的一些软件都是我个人比较喜欢的，其实还有很多其他的恕不能一一列举了，如果大家有其他推荐的欢迎留言给我，谢谢！</p>
                  <h2 id="日常工具"><a href="#日常工具" class="headerlink" title="日常工具"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#%E6%97%A5%E5%B8%B8%E5%B7%A5%E5%85%B7" target="_blank" rel="noopener"></a>日常工具</h2>
                  <p>一些日常工具在这里我就不一一列举了，大部分使用 Mac 的小伙伴都会安装，比如 QQ、微信、Chrome 浏览器、网易云音乐、迅雷等等，这些在 Windows 上也几乎都是必备软件，这里就不再展开说明了。</p>
                  <h2 id="效率工具"><a href="#效率工具" class="headerlink" title="效率工具"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7" target="_blank" rel="noopener"></a>效率工具</h2>
                  <p>效率工具顾名思义，可以方便和简化 Mac 的操作，提高生产工作效率的工具，下面推荐几款我比较常用的。</p>
                  <h3 id="Alfred"><a href="#Alfred" class="headerlink" title="Alfred"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#alfred" target="_blank" rel="noopener"></a>Alfred</h3>
                  <p>首推 Alfred，可以说是 Mac 必备软件，利用它我们可以快速地进行各种操作，大幅提高工作效率，如快速打开某个软件、快速打开某个链接、快速搜索某个文档，快速定位某个文件，快速查看本机 IP，快速定义某个色值，几乎你能想到的都能对接实现。 这些快速功能是怎么实现的呢？实际上是 Alfred 对接了很多 Workflow，我们可以使用 Workflow 方便地进行功能扩展，一些比较优秀的 Workflow 已经有人专门做过整理了，可以参见：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3plbm9yb2NoYS9hbGZyZWQtd29ya2Zsb3dz">https://github.com/zenorocha/alfred-workflows<i class="fa fa-external-link-alt"></i></span>。 推荐指数：★★★★★</p>
                  <h3 id="Todoist"><a href="#Todoist" class="headerlink" title="Todoist"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#todoist" target="_blank" rel="noopener"></a>Todoist</h3>
                  <p>大家肯定也在使用各种 Todo List 的软件，这种软件其实也是五花八门，经过我本人试用，我觉得 Todoist 这款软件是最方便的。 它支持各种类型的任务定制，还可以设置分组、优先级、Deadline、执行人员、提醒、协作、效率统计等功能。另外它的各个平台支持真是异常地全啊，网页、PC、移动端就不用说了，都必须有的，另外它还有浏览器插件版、电邮版、可穿戴设备（如 Apple Watch、Google Wear）版，另外他还可以和 Mac 的日历事件进行同步，日历添加的事件也会自动添加到 Todoist 里面，非常方便，是目前我体验过的最好用的一款。 这款软件个人推荐购买专业版解锁全部功能，一个月 3 刀，但个人觉得确实非常值。 推荐指数：★★★★☆</p>
                  <h3 id="Paste"><a href="#Paste" class="headerlink" title="Paste"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#paste" target="_blank" rel="noopener"></a>Paste</h3>
                  <p>Mac 上默认只有一个粘贴板，当我们新复制了一段文字之后，如果我们想再找寻之前复制的历史记录就找不到了，这其实是很反人类的。 好在 Paste 这款软件帮我们解决了这个问题，它可以保存我们粘贴板的历史记录，等需要粘贴某个内容的时候只需要呼出 Paste 历史粘贴板，然后选择某个特定的内容粘贴就好了，另外它还支持文本格式调整粘贴板分类和搜索，还可以支持快速便捷粘贴。有了它，妈妈再也不用担心我的粘贴板丢失了！ 推荐指数：★★★★★</p>
                  <h3 id="Synergy"><a href="#Synergy" class="headerlink" title="Synergy"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#synergy" target="_blank" rel="noopener"></a>Synergy</h3>
                  <p>工作时我会使用公司的台式机，是 Windows 系统，另外自己的个人笔记本 Mac 也会放在旁边，两台 PC 有时候会交替使用，但是我总不能配两套键盘和鼠标吧，这样就显得累赘了，而且也没那么多地方放啊。 有了 Synergy，我们可以将两台 PC 关联，实现键盘鼠标共享。我们可以使用一套键盘和鼠标来操作两台 PC，注意这是两个完全独立的 PC，各自有各自的屏幕和系统，使用 Synergy 我们可以做到一套键鼠同时控制两台电脑，鼠标可以直接从一台电脑的屏幕滑动到另一台电脑屏幕上，同时键盘、粘贴板也都是共享的。 设想这么个情景，我在我的台式机 Windows 上打开了一个页面，需要让我输入一个很长的序列号，而这个序列号又恰巧存在 Mac 上，这时如果有了 Synergy 将二者关联，我们只需要把鼠标从 Windows 的屏幕上直接滑动到 Mac 的屏幕上，选中序列号，然后键盘按下复制的快捷键，然后再把鼠标移回 Windows，粘贴即可，一气呵成。而不必再想办法发消息传输了，大大提高效率。 推荐指数：★★★★</p>
                  <h3 id="Feedly、Reeder"><a href="#Feedly、Reeder" class="headerlink" title="Feedly、Reeder"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#feedlyreeder" target="_blank" rel="noopener"></a>Feedly、Reeder</h3>
                  <p>博客现在已经越来越多了，越来越多的人开始在博客上发表文章，而当我们遇到优质的博客时，我们还想随时知道博客的发表动态，一旦有新文章发表我们想立马得到相关动态，这样可以实现吗？ 肯定是可行的，现在绝大多数博客都有 RSS 订阅功能，有了它我们可以订阅自己喜欢的博客，这里我使用的 RSS 订阅工具就是 Feedly，利用它我可以很轻松地添加自己喜欢的博客或论坛到自己的 Feed 流里面，一旦有文章更新，我就会收到相应提示。 但是 Feedly 有个小问题，就是在国内速度太慢了，所以我又使用 Reeder 将 Feedly 里面的 Feed 流做了转接，它可以添加 Feedly 源，并带有灵活的分类、标记等管理功能，还支持各种预览方式，还支持存储到 Pocket，还有各种分享方式，功能十分齐全。 总之，推荐 Feedly 来添加自己喜欢的博客，用 Reeder 来阅读订阅的内容，双剑合璧，另外 Reeder 对移动版的支持也很不错，可以体验一下。 推荐指数：★★★★</p>
                  <h3 id="Mindnode"><a href="#Mindnode" class="headerlink" title="Mindnode"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#mindnode" target="_blank" rel="noopener"></a>Mindnode</h3>
                  <p>有时候在思考问题的时候我们想要把一些思路记录下来，另外在做一些概要设计的时候需要把概要图大体描述出来，这时候画一个思维导图再合适不过了，比如你现在读的这篇文章就很适合用一个思维导图画一下。 画思维导图我个人比较喜欢的一款软件是 Mindnode，觉得比较简洁好用，当然也有不少人使用 XMind，也很不错。可能是先入为主，也可能是界面设计风格，我个人更加偏向于使用 Mindnode。 推荐指数：★★★★</p>
                  <h3 id="1Password"><a href="#1Password" class="headerlink" title="1Password"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#1password" target="_blank" rel="noopener"></a>1Password</h3>
                  <p>随着年龄的增长，我们可能变得越来越忘事了。另外还有些反人类的网站密码必须要至少大写、小写、数字、特殊符号，有的还要求不少于多少位，有的还要求我么能定时更换密码，还不能与之前用过的相同！这会使得我们之前预想设计的很多密码都没法用了。另外网站又这么多，谁又能把网站的密码都记下来啊？ 这时候我们就需要一款专门管理密码的软件，我个人推荐一款叫做 1Password，有了它我们可以将各个平台的密码保存起来，同时它还可以根据我们的要求帮我们随机生成一些密码并保存，这对注册一些新网站非常有用，同时使用随机的密码还降低了撞库的风险，不然一个平台的密码被盗了，其他平台用的同样的密码的话，就很不安全了。 1Password 还支持各种平台，如网页、PC、移动版都通通完美支持，实现密码云同步，妈妈再也不用担心我忘记密码了！ 推荐指数：★★★★</p>
                  <h2 id="系统工具"><a href="#系统工具" class="headerlink" title="系统工具"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#%E7%B3%BB%E7%BB%9F%E5%B7%A5%E5%85%B7" target="_blank" rel="noopener"></a>系统工具</h2>
                  <p>下面介绍的两款系统工具软件几乎是装机必备的。</p>
                  <h3 id="Tuxera-NTFS-For-Mac"><a href="#Tuxera-NTFS-For-Mac" class="headerlink" title="Tuxera NTFS For Mac"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#tuxera-ntfs-for-mac" target="_blank" rel="noopener"></a>Tuxera NTFS For Mac</h3>
                  <p>用了 Mac，我们在使用移动硬盘的时候可能会遇到一个无法传输数据（如拷贝文件）的问题，这是因为部分移动硬盘是 NTFS 格式的，而 Mac 的磁盘不是这个格式，因此就会导致二者之间无法拷贝文件。有一个解决方法就是使用 Tuxera NTFS For Mac，有了它，我们就可以比较顺利地拷贝文件了。 另外还有其他品牌的 NTFS For Mac 软件，也可以尝试使用一下。 推荐指数：★★★★☆</p>
                  <h3 id="VMware、Parallels-Desktop"><a href="#VMware、Parallels-Desktop" class="headerlink" title="VMware、Parallels Desktop"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#vmwareparallels-desktop" target="_blank" rel="noopener"></a>VMware、Parallels Desktop</h3>
                  <p>用了 Mac 之后，难免会有些情况下也还会不得不使用 Windows，毕竟很多软件可能只有 Windows 版本，但用 Mac 我就不推荐装双系统了，直接装虚拟机就好了，Mac 上虚拟机软件有两款比较好用，一个就是著名的 VMware，另一个就是 Parallels Desktop，这两款我都使用过，觉得都非常不错，现在用的是 VMware。 推荐指数：★★★★☆</p>
                  <h3 id="CleanMyMac"><a href="#CleanMyMac" class="headerlink" title="CleanMyMac"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#cleanmymac" target="_blank" rel="noopener"></a>CleanMyMac</h3>
                  <p>很多时候用着用着磁盘就不够用了，如果你的 Mac 硬盘是 512GB 的倒还好，256GB 的你就得多注意一下了，另外 1T 定制版土豪请绕道，这款软件不适合你。 CleanMyMac 可以非常方便地帮助我们扫描缓存、大文件、废纸篓、残留项等内容，清理这些内容之后我们可以节省很多硬盘空间，另外它还支持软件卸载和残留清扫功能，可以帮我们非常干净地移除 Mac 中的软件，目前应该是出到第三版了，非常推荐。 推荐指数：★★★★☆</p>
                  <h2 id="编辑器"><a href="#编辑器" class="headerlink" title="编辑器"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#%E7%BC%96%E8%BE%91%E5%99%A8" target="_blank" rel="noopener"></a>编辑器</h2>
                  <p>既然做程序开发嘛，不配置好自己的开发环境怎么行，下面推荐一下我平常使用的开发软件。</p>
                  <h3 id="JetBrains"><a href="#JetBrains" class="headerlink" title="JetBrains"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#jetbrains" target="_blank" rel="noopener"></a>JetBrains</h3>
                  <p>我目前使用的 IDE 是 JetBrains 全家桶，目前我编写 Python 比较多，所以主要使用 PyCharm，另外写前端的时候也会使用 WebStorm，写 Java 就用 IntelliJ IDEA，C、C++ 用 CLion，PHP 的话就用 PhpStorm，Ruby 的话就用 RubyMine，其他的语言用的就少了，就没有装了。 当然有的小伙伴会说 JetBrains 系列的 IDE 需要购买啊？我只想说，国人的力量是无穷的，在网上其实可以搜到各种破解方法，如 License Server 验证，你能搜到各种五花八门的 License Server。另外 JetBrains 还有专门的 Educational Programs，可以来这里申请：<span class="exturl" data-url="aHR0cHM6Ly93d3cuamV0YnJhaW5zLmNvbS9lZHVjYXRpb24vcHJvZ3JhbXMvP2Zyb21NZW51">https://www.jetbrains.com/education/programs/?fromMenu<i class="fa fa-external-link-alt"></i></span>，学生、老师或教育工作者可以使用学校的 edu 邮箱申请免费的 License，如果你还是学生的话，那么申请是十分方便的，因为我还是个学生，我目前就在使用学生套餐，当然如果你已经工作的话也可以向正在上学的弟弟妹妹们借一下嘛。 总之我个人比较喜欢 JetBrains 全家桶，不论是页面风格还是开发习惯我都比较喜欢，推荐使用。 推荐指数：★★★★☆</p>
                  <h3 id="Sublime"><a href="#Sublime" class="headerlink" title="Sublime"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#sublime" target="_blank" rel="noopener"></a>Sublime</h3>
                  <p>有时候我们可能下载了或接收了一些单个的文本文件，我们只想看看文本文件内容是什么，或者对其再做一些简单的修改操作，这时候就没必要单独用 JetBrains 的 IDE 打开了，显得有点重了。或者有时候需要修改某个配置文件，这时候也需要一个比较好用的编辑器。我使用的就是 Sublime，对于一些日常的文本编辑是足够了，另外 Sublime 还可以扩展好多插件，配置好了功能上基本不输 JetBrains IDE，非常推荐。 推荐指数：★★★★</p>
                  <h3 id="MarkEditor"><a href="#MarkEditor" class="headerlink" title="MarkEditor"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#markeditor" target="_blank" rel="noopener"></a>MarkEditor</h3>
                  <p>现在越来越多的写作平台开始支持 MarkDown，不得不说这确实是一门提高文字生产效率的语言，写 MarkDown 我强烈推荐 MarkEditor，我之前尝试过各种 MarkDown 写作软件，觉得都不如这款好用，如 Typora、MWeb、GitBook 等等。 MarkEditor 支持写作及预览模式，更重要的是支持文件管理，很多软件如 Typora 只能打开单个的 Makrdown 文件，不能打开整个文件夹，这就很鸡肋了。另外 MarkEditor 支持直接插入图片，如我们截了一张图或者刚从网上复制了一张图，在 MarkEditor 里面直接粘贴就可以了，它会自动把这张图保存到当前目录下，同时生成 Makrdown 格式的的图片链接，不能更方便了！另外还支持主题自定义、样式自定义，还可以快速插入某些 Makrdown 元素，还支持 Latex 公式，还可以快速导出电子书，快速生成文稿网页，快速局域网共享，功能应有尽有，强烈推荐！ 这个软件我购买了 Pro 版，解锁了全部功能，订购地址：<span class="exturl" data-url="aHR0cHM6Ly93d3cubWFya2VkaXRvci5jb20v">https://www.markeditor.com/<i class="fa fa-external-link-alt"></i></span>，个人觉得物超所值！ 推荐指数：★★★★★</p>
                  <h3 id="SnippetLab"><a href="#SnippetLab" class="headerlink" title="SnippetLab"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#snippetlab" target="_blank" rel="noopener"></a>SnippetLab</h3>
                  <p>在写代码的时候，我们经常会有一些常用代码或者精华代码，或者一些常用的配置，想要单独保存下来复用，这时我们可能会把它保存到某个文本文件里面，更高级点可以使用云笔记，如有道云笔记或者印象笔记，用过 GitHub Gists 的小伙伴可能会选择 GitHub Gists，但我觉得这些都不是最佳的。 首先文本文件、云笔记里面其实并不是专门为了保存代码使用的，另外 GitHub Gists 保存操作并没有那么便捷，而且打开速度也很慢，影响体验。在这里推荐一款专门用来保存代码的软件叫做 SnippetLab，涉设计初衷就是为了保存短代码片的，它支持几乎所有编程语言，另外支持分类、分级、加标签、加描述等，另外它还可以和 Alfred 对接实现快速搜索查找，另外还支持备份、导出、云同步等各种功能，非常适合做代码片的管理。 推荐指数：★★★★</p>
                  <h3 id="Beyond-Compare"><a href="#Beyond-Compare" class="headerlink" title="Beyond Compare"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#beyond-compare" target="_blank" rel="noopener"></a>Beyond Compare</h3>
                  <p>有时候我们需要比较两个文件的不同之处，以便于快速得知两个版本的修改内容，我使用的软件是 Beyond Compare，个人觉得比较简洁好用，同时删除和添加的内容有对应的红绿颜色标识，推荐给大家使用。 推荐指数：★★★☆</p>
                  <h2 id="管理工具"><a href="#管理工具" class="headerlink" title="管理工具"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7" target="_blank" rel="noopener"></a>管理工具</h2>
                  <p>有时候我们需要管理很多文件，或者还需要远程管理很多终端设备，在这里推荐几款比较好用的工具。</p>
                  <h3 id="Filezlla"><a href="#Filezlla" class="headerlink" title="Filezlla"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#filezlla" target="_blank" rel="noopener"></a>Filezlla</h3>
                  <p>有时候我们需要管理一些远程的服务器，比如 Linux 服务器。那么如何和这些服务器之间传递数据和文件呢？这里推荐一个轻便简洁的软件 Filezlla，它支持 FTP、SFTP 等协议类型，使用它我们可以方便地进行文件传输和远程文件管理。 推荐指数：★★★</p>
                  <h3 id="ForkLift"><a href="#ForkLift" class="headerlink" title="ForkLift"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#forklift" target="_blank" rel="noopener"></a>ForkLift</h3>
                  <p>Mac 上的 Finder 你是不是已经受够了？在一些方面做得相当不友好，例如在当前打开的目录下新建一个空白文件，在当前的目录下打开命令行工具等等，有了 ForkLift 这些都是小意思了。另外 ForkLift 还集成了 Filezlla 的功能，利用它我们还可以像普通文件管理器一样管理远程的主机内容，它还支持 FTP、SFTP、SMB、WebDAV、NFS 等等各种协议。同时界面也非常美观，有了它，几乎可以抛弃 Finder 和 Filezlla 了，强烈推荐！ 推荐指数：★★★★☆</p>
                  <h3 id="SSH-Shell"><a href="#SSH-Shell" class="headerlink" title="SSH Shell"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#ssh-shell" target="_blank" rel="noopener"></a>SSH Shell</h3>
                  <p>我们经常会和各种服务器打交道，例如我们经常使用 SSH 来远程连接某台 Linux 服务器，原生 Terminal 是支持 SSH 的，但你会发现原生带的这个太难用了。可能很多小伙伴使用 iTerm，不得不说这确实是个神器，大大方便了远程管理流程。但我在这里还要推荐一个我经常使用的 SSH Shell，没错，它的名字就是 SSH Shell，它的页面操作简洁，同时管理和记录远程主机十分方便，另外还支持秘钥管理、自动重连、自定义主题等等功能，个人用起来十分顺手，强烈推荐！ 推荐指数：★★★★☆</p>
                  <h3 id="HomeBrew、CakeBrew"><a href="#HomeBrew、CakeBrew" class="headerlink" title="HomeBrew、CakeBrew"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#homebrewcakebrew" target="_blank" rel="noopener"></a>HomeBrew、CakeBrew</h3>
                  <p>对于开发者来说，这个软件几乎是 Mac 上必备的一个软件，它的官方简介就是 “The missing package manager for macOS”，算是 Mac 上的一个软件包平台，它里面包含着非常多的 Mac 开发软件包，比如 Python、PHP、Redis、MySQL、RabbitMQ、HBase 等等，几乎你能想到的开发软件都集成在里面了，堪称神器！ 它的安装也非常简单，参见这里：<span class="exturl" data-url="aHR0cHM6Ly9icmV3LnNoLw==">https://brew.sh/<i class="fa fa-external-link-alt"></i></span>，另外 HomeBrew 也有对应的图形界面，叫做 CakeBrew，如果不喜欢命令行操作的话可以使用 CakeBrew 来代替。 推荐指数：★★★★★</p>
                  <h2 id="影音图像"><a href="#影音图像" class="headerlink" title="影音图像"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#%E5%BD%B1%E9%9F%B3%E5%9B%BE%E5%83%8F" target="_blank" rel="noopener"></a>影音图像</h2>
                  <h3 id="IINA"><a href="#IINA" class="headerlink" title="IINA"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#iina" target="_blank" rel="noopener"></a>IINA</h3>
                  <p>这个必须要赞一下，非常强大简洁好用的视频播放器，是 GitHub 上的一个开源软件，链接是：<span class="exturl" data-url="aHR0cHM6Ly9saGM3MDAwMC5naXRodWIuaW8vaWluYS8=">https://lhc70000.github.io/iina/<i class="fa fa-external-link-alt"></i></span>，播放控制、视频设置、音频设置、字幕设置、文件操作，几乎你能想到的应有尽有，而且无广告，简洁清爽，支持的视频格式也十分广泛，推荐使用！ 推荐指数：★★★★</p>
                  <h3 id="ScreenFlow"><a href="#ScreenFlow" class="headerlink" title="ScreenFlow"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#screenflow" target="_blank" rel="noopener"></a>ScreenFlow</h3>
                  <p>之前我曾录制过一些 Python 的视频课程，本来尝试过 QuickTime 录制，可是实在是太难用了，另外视频剪辑、音频剪辑等又是个麻烦事。后来我就使用了 ScreenFlow，它集录制、剪辑、配音、字幕、特效等功能于一体，另外录制质量，渲染质量也是一流，大大提高了我的效率，堪称神器！ 推荐指数：★★★★☆</p>
                  <h3 id="iPic"><a href="#iPic" class="headerlink" title="iPic"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#ipic" target="_blank" rel="noopener"></a>iPic</h3>
                  <p>有时候我们在写 MarkDown 的时候，可能突然需要一张插入一张图片，比如我们想插入一张屏幕截图，我们就需要把这张图片先存下来，然后加上图片的路径，如果转发给别人还需要连着图片一并发给对方，这其实是不怎么方便的，倘若这张图片是一张来自网络的图片，我们直接用 HTTP 访问的话，那岂不是方便太多了？ 要将图片传到网上分几步？三步。第一步，把上传页面打开，第二步，把图片传到网上并把传后链接拷贝下来，第三步，把上传页面关闭。简直是太麻烦了对不对？另外找个合适的图床也是个麻烦事啊，七牛？又拍？你不得又得申请和注册。那么有了 iPic，一切就不是难事了，它可以监听 Mac 的粘贴板，一旦我们复制了一张图或者新截了一张图，它就能显示到待上传队列里面，我们点一下它就会把图片上传到网络上，然后生成上传后的链接，默认使用的是新浪的图床，网速也非常快。有了它，传图什么的都不是事了！另外付费版还支持各种自定义图床，如七牛云、又拍云、阿里云、腾讯云等等。 推荐指数：★★★★☆</p>
                  <h3 id="PixelMator"><a href="#PixelMator" class="headerlink" title="PixelMator"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#pixelmator" target="_blank" rel="noopener"></a>PixelMator</h3>
                  <p>在 Windows 上我们常用 PS 来修改和处理图片，Mac 上我是没有使用 PS，使用了 PixelMator，个人觉得使用这款软件能完全胜任 PS 的工作，一般的图片设计、排版、抠图、特效、蒙版等操作都支持，我个人比较喜欢使用这款软件做设计。 推荐指数：★★★★</p>
                  <h3 id="Polarr-Photo-Editor"><a href="#Polarr-Photo-Editor" class="headerlink" title="Polarr Photo Editor"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#polarr-photo-editor" target="_blank" rel="noopener"></a>Polarr Photo Editor</h3>
                  <p>这个软件又名“泼辣修图”，类似 Mac 上的美图秀秀，它自带了各种后期滤镜，还带有 Lightroom 的很多调光调色的工具，能够帮我们快速对照片进行后期处理，效果也还不错，当然比不上 Photoshop 和 Lightroom 那么专业，但对于快速进行后处理的小伙伴来说不失为一个好的选择。 推荐指数：★★★★</p>
                  <h3 id="Boom2"><a href="#Boom2" class="headerlink" title="Boom2"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#boom2" target="_blank" rel="noopener"></a>Boom2</h3>
                  <p>我有边工作边听歌的习惯，所以音乐几乎离不开我的生活，入了个好耳机，那当然就得配上好音乐。大家肯定也听说过音效均衡器，我们可以调整不同的音效参数来达到不同的声音效果，如电子音、人声、环绕、重低音等等，在 Mac 上我觉得最好用的就是 Boom2 了，它内置了各种音效均衡器，还有一些高保真效果的渲染，效果非常给力。我一般听歌的时候就会把 Boom2 开起来，享受不一样的音效感觉，美哉。 推荐指数：★★★★</p>
                  <h2 id="趣味扩展"><a href="#趣味扩展" class="headerlink" title="趣味扩展"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#%E8%B6%A3%E5%91%B3%E6%89%A9%E5%B1%95" target="_blank" rel="noopener"></a>趣味扩展</h2>
                  <p>另外还有几个比较有意思的工具推荐下。</p>
                  <h3 id="Tickeys"><a href="#Tickeys" class="headerlink" title="Tickeys"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#tickeys" target="_blank" rel="noopener"></a>Tickeys</h3>
                  <p>使用过机械键盘吗？按键感觉和声音很爽吧，但是用了 Mac，你如果不使用外接键盘的话，想必手感就差上不少，但这款软件或许可以拯救一下，它可以模拟机械键盘的按键声，每次按键都有有机械键盘清脆的声音，我平时戴耳机撸代码的时候就会开着这个软件，感觉体验还是不错的，建议尝试一下。 推荐指数：★★★☆</p>
                  <h3 id="Duet"><a href="#Duet" class="headerlink" title="Duet"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#duet" target="_blank" rel="noopener"></a>Duet</h3>
                  <p>Duet 这款软件可以将 iPad 或 iPhone 变成电脑的扩展屏幕，如果你有一个大屏的比如 12.9 寸的 iPad 的话，非常建议你尝试一下这款软件，这样如果正你在用 Mac 不用 iPad 的话，完全可以用 Duet 把 iPad 和电脑屏幕连接起来来扩展显示，充分利用资源。 推荐指数：★★★☆ 好了，暂时推荐这么多，其实还有很多很多，尤其是专门针对于开发者的一些工具，这些就太偏极客化了，后面再为大家整理一些好用的开发者工具，敬请期待。 还不尽兴的小伙伴可以关注 GitHub 上的一个仓库叫 awesome-mac，里面列出来了 Mac 上推荐的非常多的软件，总结得非常非常详细，链接是：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2pheXdjamxvdmUvYXdlc29tZS1tYWM=">https://github.com/jaywcjlove/awesome-mac<i class="fa fa-external-link-alt"></i></span>，大家可以去看下。</p>
                  <h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#tips" target="_blank" rel="noopener"></a>Tips</h2>
                  <p>可能有的小伙伴好奇我的 Launchpad 为啥能放那么多图标，是怎么做到的？其实很简单，几行代码就搞定了。 调整每列显示图标数量，这里以 7 为例：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">defaults <span class="keyword">write</span> com.apple.dock springboard-<span class="keyword">rows</span> -<span class="type">int</span> <span class="number">7</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>调整每行显示图标的数量，这里以 8 为例：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">defaults <span class="keyword">write</span> com.apple.dock springboard-<span class="keyword">columns</span> -<span class="type">int</span> <span class="number">8</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上面两行代码最后的数字可以自行修改。 修改完了之后还需要重置一下 Launchpad，代码如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">defaults <span class="keyword">write</span> com.apple.dock ResetLaunchPad -<span class="type">bool</span> <span class="keyword">TRUE</span>;killall Dock</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好了，这样我们就可以自由定制我们的 Launchpad 图标数量啦！ 另外，还有的小伙伴会说，很多软件都需要花钱购买啊，咋办？告诉你个网址：<span class="exturl" data-url="aHR0cDovL3hjbGllbnQuaW5mby8=">http://xclient.info/<i class="fa fa-external-link-alt"></i></span>，几乎你想找的破解版都有，别说别的了，雷锋也别叫了，省下的钱打赏给我一点就行哈哈。 以上就是我的一些 Mac 常用软件分享及 Tips，希望对大家有帮助！ 另外大家如有还有推荐的软件，欢迎留言给我，非常感谢！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-07-03 02:35:47" itemprop="dateCreated datePublished" datetime="2018-07-03T02:35:47+08:00">2018-07-03</time>
                </span>
                <span id="/6146.html" class="post-meta-item leancloud_visitors" data-flag-title="推荐一些Mac上比较好用的软件" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>8.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6110.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6110.html" class="post-title-link" itemprop="url">《Python3网络爬虫开发实战》第二波抽奖赠书活动来了！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>嗨~ 给大家重磅推荐一本书！上市两月就已经重印 4 次的 Python 爬虫书！它就是由静觅博客博主崔庆才所作的《Python3网络爬虫开发实战》！！！同时文末还有抽奖赠书活动，不容错过！！！</p>
                  <h2 id="书籍介绍"><a href="#书籍介绍" class="headerlink" title="书籍介绍"></a><strong>书籍介绍</strong></h2>
                  <p>本书<strong>《Python3网络爬虫开发实战》</strong>全面介绍了利用 Python3 开发网络爬虫的知识，书中首先详细介绍了各种类型的环境配置过程和爬虫基础知识，还讨论了 urllib、requests 等请求库和 Beautiful Soup、XPath、pyquery 等解析库以及文本和各类数据库的存储方法，另外本书通过多个真实新鲜案例介绍了分析 Ajax 进行数据爬取，Selenium 和 Splash 进行动态网站爬取的过程，接着又分享了一些切实可行的爬虫技巧，比如使用代理爬取和维护动态代理池的方法、ADSL 拨号代理的使用、各类验证码（图形、极验、点触、宫格等）的破解方法、模拟登录网站爬取的方法及 Cookies 池的维护等等。 此外，本书的内容还远远不止这些，作者还结合移动互联网的特点探讨了使用 Charles、mitmdump、Appium 等多种工具实现 App 抓包分析、加密参数接口爬取、微信朋友圈爬取的方法。此外本书还详细介绍了 pyspider 框架、Scrapy 框架的使用和分布式爬虫的知识，另外对于优化及部署工作，本书还包括 Bloom Filter 效率优化、Docker 和 Scrapyd 爬虫部署、分布式爬虫管理框架Gerapy 的分享。 全书共 604 页，足足两斤重呢~ 定价为 99 元！</p>
                  <h2 id="作者介绍"><a href="#作者介绍" class="headerlink" title="作者介绍"></a><strong>作者介绍</strong></h2>
                  <p>看书就先看看谁写的嘛，我们来了解一下~ 崔庆才，静觅博客博主（<span class="exturl" data-url="aHR0cHM6Ly9jdWlxaW5nY2FpLmNvbe+8ie+8jOWNmuWuog==">https://cuiqingcai.com），博客<i class="fa fa-external-link-alt"></i></span> Python 爬虫博文阅读量已过千万，北京航空航天大学硕士，天善智能、网易云课堂讲师，微软小冰大数据工程师，有多个大型分布式爬虫项目经验，乐于技术分享，文章通俗易懂 ^<em>^ 附皂片一张 ~(@^</em>^@)~ <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/WechatIMG785-240x320.jpeg" alt=""></p>
                  <h2 id="图文介绍"><a href="#图文介绍" class="headerlink" title="图文介绍"></a><strong>图文介绍</strong></h2>
                  <p>呕心沥血设计的宣传图也得放一下~ <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/WechatIMG556.jpeg" alt=""></p>
                  <h2 id="专家评论"><a href="#专家评论" class="headerlink" title="专家评论"></a><strong>专家评论</strong></h2>
                  <p>书是好是坏，得让专家看评一评呀，那么下面就是几位专家的精彩评论，快来看看吧~ 在互联网软件开发工程师的分类中，爬虫工程师是非常重要的。爬虫工作往往是一个公司核心业务开展的基础，数据抓取下来，才有后续的加工处理和最终展现。此时数据的抓取规模、稳定性、实时性、准确性就显得非常重要。早期的互联网充分开放互联，数据获取的难度很小。随着各大公司对数据资产日益看重，反爬水平也在不断提高，各种新技术不断给爬虫软件提出新的课题。本书作者对爬虫的各个领域都有深刻研究，书中探讨了Ajax数据的抓取、动态渲染页面的抓取、验证码识别、模拟登录等高级话题，同时也结合移动互联网的特点探讨了App的抓取等。更重要的是，本书提供了大量源码，可以帮助读者更好地理解相关内容。强烈推荐给各位技术爱好者阅读！</p>
                  <p><strong>——梁斌</strong>，八友科技总经理</p>
                  <p>数据既是当今大数据分析的前提，也是各种人工智能应用场景的基础。得数据者得天下，会爬虫者走遍天下也不怕！一册在手，让小白到老司机都能有所收获！</p>
                  <p><strong>——李舟军</strong>，北京航空航天大学教授，博士生导师</p>
                  <p>本书从爬虫入门到分布式抓取，详细介绍了爬虫技术的各个要点，并针对不同的场景提出了对应的解决方案。另外，书中通过大量的实例来帮助读者更好地学习爬虫技术，通俗易懂，干货满满。强烈推荐给大家！</p>
                  <p><strong>——宋睿华</strong>，微软小冰首席科学家</p>
                  <p>有人说中国互联网的带宽全给各种爬虫占据了，这说明网络爬虫的重要性以及中国互联网数据封闭垄断的现状。爬是一种能力，爬是为了不爬。</p>
                  <p><strong>——施水才</strong>，北京拓尔思信息技术股份有限公司总裁</p>
                  <h2 id="全书目录"><a href="#全书目录" class="headerlink" title="全书目录"></a><strong>全书目录</strong></h2>
                  <p>书的目录也有~ 看这里！</p>
                  <ul>
                    <li><strong>1-开发环境配置</strong></li>
                    <li>1.1-Python3的安装</li>
                    <li>1.2-请求库的安装</li>
                    <li>1.3-解析库的安装</li>
                    <li>1.4-数据库的安装</li>
                    <li>1.5-存储库的安装</li>
                    <li>1.6-Web库的安装</li>
                    <li>1.7-App爬取相关库的安装</li>
                    <li>1.8-爬虫框架的安装</li>
                    <li>1.9-部署相关库的安装</li>
                    <li><strong>2-爬虫基础</strong></li>
                    <li>2.1-HTTP基本原理</li>
                    <li>2.2-网页基础</li>
                    <li>2.3-爬虫的基本原理</li>
                    <li>2.4-会话和Cookies</li>
                    <li>2.5-代理的基本原理</li>
                    <li><strong>3-基本库的使用</strong></li>
                    <li>3.1-使用urllib</li>
                    <li>3.1.1-发送请求</li>
                    <li>3.1.2-处理异常</li>
                    <li>3.1.3-解析链接</li>
                    <li>3.1.4-分析Robots协议</li>
                    <li>3.2-使用requests</li>
                    <li>3.2.1-基本用法</li>
                    <li>3.2.2-高级用法</li>
                    <li>3.3-正则表达式</li>
                    <li>3.4-抓取猫眼电影排行</li>
                    <li><strong>4-解析库的使用</strong></li>
                    <li>4.1-使用XPath</li>
                    <li>4.2-使用Beautiful Soup</li>
                    <li>4.3-使用pyquery</li>
                    <li><strong>5-数据存储</strong></li>
                    <li>5.1-文件存储</li>
                    <li>5.1.1-TXT文本存储</li>
                    <li>5.1.2-JSON文件存储</li>
                    <li>5.1.3-CSV文件存储</li>
                    <li>5.2-关系型数据库存储</li>
                    <li>5.2.1-MySQL存储</li>
                    <li>5.3-非关系型数据库存储</li>
                    <li>5.3.1-MongoDB存储</li>
                    <li>5.3.2-Redis存储</li>
                    <li><strong>6-Ajax数据爬取</strong></li>
                    <li>6.1-什么是Ajax</li>
                    <li>6.2-Ajax分析方法</li>
                    <li>6.3-Ajax结果提取</li>
                    <li>6.4-分析Ajax爬取今日头条街拍美图</li>
                    <li><strong>7-动态渲染页面爬取</strong></li>
                    <li>7.1-Selenium的使用</li>
                    <li>7.2-Splash的使用</li>
                    <li>7.3-Splash负载均衡配置</li>
                    <li>7.4-使用Selenium爬取淘宝商品</li>
                    <li><strong>8-验证码的识别</strong></li>
                    <li>8.1-图形验证码的识别</li>
                    <li>8.2-极验滑动验证码的识别</li>
                    <li>8.3-点触验证码的识别</li>
                    <li>8.4-微博宫格验证码的识别</li>
                    <li><strong>9-代理的使用</strong></li>
                    <li>9.1-代理的设置</li>
                    <li>9.2-代理池的维护</li>
                    <li>9.3-付费代理的使用</li>
                    <li>9.4-ADSL拨号代理</li>
                    <li>9.5-使用代理爬取微信公众号文章</li>
                    <li><strong>10-模拟登录</strong></li>
                    <li>10.1-模拟登录并爬取GitHub</li>
                    <li>10.2-Cookies池的搭建</li>
                    <li><strong>11-App的爬取</strong></li>
                    <li>11.1-Charles的使用</li>
                    <li>11.2-mitmproxy的使用</li>
                    <li>11.3-mitmdump爬取“得到”App电子书信息</li>
                    <li>11.4-Appium的基本使用</li>
                    <li>11.5-Appium爬取微信朋友圈</li>
                    <li>11.6-Appium+mitmdump爬取京东商品</li>
                    <li><strong>12-pyspider框架的使用</strong></li>
                    <li>12.1-pyspider框架介绍</li>
                    <li>12.2-pyspider的基本使用</li>
                    <li>12.3-pyspider用法详解</li>
                    <li><strong>13-Scrapy框架的使用</strong></li>
                    <li>13.1-Scrapy框架介绍</li>
                    <li>13.2-Scrapy入门</li>
                    <li>13.3-Selector的用法</li>
                    <li>13.4-Spider的用法</li>
                    <li>13.5-Downloader Middleware的用法</li>
                    <li>13.6-Spider Middleware的用法</li>
                    <li>13.7-Item Pipeline的用法</li>
                    <li>13.8-Scrapy对接Selenium</li>
                    <li>13.9-Scrapy对接Splash</li>
                    <li>13.10-Scrapy通用爬虫</li>
                    <li>13.11-Scrapyrt的使用</li>
                    <li>13.12-Scrapy对接Docker</li>
                    <li>13.13-Scrapy爬取新浪微博</li>
                    <li><strong>14-分布式爬虫</strong></li>
                    <li>14.1-分布式爬虫原理</li>
                    <li>14.2-Scrapy-Redis源码解析</li>
                    <li>14.3-Scrapy分布式实现</li>
                    <li>14.4-Bloom Filter的对接</li>
                    <li><strong>15-分布式爬虫的部署</strong></li>
                    <li>15.1-Scrapyd分布式部署</li>
                    <li>15.2-Scrapyd-Client的使用</li>
                    <li>15.3-Scrapyd对接Docker</li>
                    <li>15.4-Scrapyd批量部署</li>
                    <li>15.5-Gerapy分布式管理</li>
                  </ul>
                  <h2 id="购买链接"><a href="#购买链接" class="headerlink" title="购买链接"></a><strong>购买链接</strong></h2>
                  <p>想必很多小伙伴已经等了很久了，之前预售那么久也一直迟迟没有货，发售就有不少网店又售空了，不过现在起不用担心了！</p>
                  <p>书籍现已在京东、天猫、当当等网店上架并全面供应啦，复制链接到浏览器打开或扫描二维码打开即可购买了！</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/京东二维码.png" alt=""></p>
                  <p> 京东商城</p>
                  <p><span class="exturl" data-url="aHR0cHM6Ly9pdGVtLmpkLmNvbS8xMjMzMzU0MC5odG1s">https://item.jd.com/12333540.html<i class="fa fa-external-link-alt"></i></span></p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/天猫二维码.png" alt=""></p>
                  <p> 天猫商城</p>
                  <p><span class="exturl" data-url="aHR0cHM6Ly9kZXRhaWwudG1hbGwuY29tL2l0ZW0uaHRtP2lkPTU2NjY5OTcwMzkxNw==">https://detail.tmall.com/item.htm?id=566699703917<i class="fa fa-external-link-alt"></i></span></p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/当当二维码.png" alt=""></p>
                  <p>当当网</p>
                  <p><span class="exturl" data-url="aHR0cDovL3Byb2R1Y3QuZGFuZ2RhbmcuY29tLzI1MjQ5NjAyLmh0bWw=">http://product.dangdang.com/25249602.html<i class="fa fa-external-link-alt"></i></span></p>
                  <p>欢迎大家购买，谢谢支持！O(∩_∩)O</p>
                  <h2 id="免费预览"><a href="#免费预览" class="headerlink" title="免费预览"></a><strong>免费预览</strong></h2>
                  <p>不放心？想先看看有些啥，没问题！看这里： 免费章节试读（复制粘贴至浏览器打开）： <a href="https://cuiqingcai.com/5052.html">https://cuiqingcai.com/5052.html</a> 将一直免费开放<strong>前7章节</strong>，欢迎大家试读！ 好了，接下来就是我们的福利环节啦~</p>
                  <h2 id="福利一：抽奖送书！！！"><a href="#福利一：抽奖送书！！！" class="headerlink" title="福利一：抽奖送书！！！"></a><strong>福利一：抽奖送书！！！</strong></h2>
                  <p>恭喜你看到这里了！那么接下来的福利时间就到了！后面还有两个福利不容错过哦~ 抽奖送书活动第二波来袭（后面还有很多波哦），公众号抽奖送 30 本作者亲笔签名书籍！！！ 活动流程（重要，请一定认真阅读）： <strong>公众号进击的Coder回复 “抽奖” 获取抽奖码，2018.6.24 22:00 截止，逾期参与无效，请记住您的抽奖码，活动结束后会从参与活动的小伙伴中根据幸运值按照权重比例抽取 30 位并在微信公众号公布，届时请关注公众号抽奖结果的公布！获奖的小伙伴会获得作者亲笔签名的《Python3网络爬虫开发实战》一本。</strong></p>
                  <h2 id="福利二：独家优惠！！！"><a href="#福利二：独家优惠！！！" class="headerlink" title="福利二：独家优惠！！！"></a><strong>福利二：独家优惠！！！</strong></h2>
                  <p>等等，你以为这就是全部福利吗？当然不是！除了抽奖送书，我们还拿到了拨号VPS知名品牌云立方的独家优惠，在公众号（进击的Coder ）中回复：“优惠券”，即可免费领取云立方50元主机优惠券，数量有限，先到先得！优惠券可在云立方官网（www.yunlifang.cn）购买动态IP拨号VPS时抵扣现金，有了它，爬虫代理易如反掌！ 你问我动态拨号VPS能做什么？应该怎么用在爬虫里？来这里了解一下： <span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3M/X19iaXo9TXpJek56QTRORGszTnc9PSZhbXA7bWlkPTI0NTc3MzU3MzQmYW1wO2lkeD0xJmFtcDtzbj1jYTBkMDY2ZDc2NzU3MDIwNWRhYTk0NzVlMzFjYmMxZiZhbXA7c2NlbmU9MjEjd2VjaGF0X3JlZGlyZWN0">轻松获得海量稳定代理！ADSL拨号代理的搭建<i class="fa fa-external-link-alt"></i></span></p>
                  <h2 id="福利三：视频课程！！！"><a href="#福利三：视频课程！！！" class="headerlink" title="福利三：视频课程！！！"></a><strong>福利三：视频课程！！！</strong></h2>
                  <p>当然除了书籍，也有配套的视频课程，作者同样是崔庆才，二者结合学习效果更佳！限时优惠折扣中！扫描下图中二维码即可了解详情！ <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/课程宣传图.png" alt=""> 最后也是最重要的就是参与活动的地址了！！！快来扫码回复领取属于你的福利吧！！！</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/gzh.jpg" alt=""></p>
                  <h2 id="特别致谢"><a href="#特别致谢" class="headerlink" title="特别致谢"></a>特别致谢</h2>
                  <p>最后特别感谢云立方、天善智能对本活动的大力支持！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-06-12 01:42:51" itemprop="dateCreated datePublished" datetime="2018-06-12T01:42:51+08:00">2018-06-12</time>
                </span>
                <span id="/6110.html" class="post-meta-item leancloud_visitors" data-flag-title="《Python3网络爬虫开发实战》第二波抽奖赠书活动来了！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6101.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6101.html" class="post-title-link" itemprop="url">自然语言处理中句子相似度计算的几种方法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在做自然语言处理的过程中，我们经常会遇到需要找出相似语句的场景，或者找出句子的近似表达，这时候我们就需要把类似的句子归到一起，这里面就涉及到句子相似度计算的问题，那么本节就来了解一下怎么样来用 Python 实现句子相似度的计算。</p>
                  <h2 id="基本方法"><a href="#基本方法" class="headerlink" title="基本方法"></a>基本方法</h2>
                  <p>句子相似度计算我们一共归类了以下几种方法：</p>
                  <ul>
                    <li>编辑距离计算</li>
                    <li>杰卡德系数计算</li>
                    <li>TF 计算</li>
                    <li>TFIDF 计算</li>
                    <li>Word2Vec 计算</li>
                  </ul>
                  <p>下面我们来一一了解一下这几种算法的原理和 Python 实现。</p>
                  <h2 id="编辑距离计算"><a href="#编辑距离计算" class="headerlink" title="编辑距离计算"></a>编辑距离计算</h2>
                  <p>编辑距离，英文叫做 Edit Distance，又称 Levenshtein 距离，是指两个字串之间，由一个转成另一个所需的最少编辑操作次数，如果它们的距离越大，说明它们越是不同。许可的编辑操作包括将一个字符替换成另一个字符，插入一个字符，删除一个字符。 例如我们有两个字符串：string 和 setting，如果我们想要把 string 转化为 setting，需要这么两步：</p>
                  <ul>
                    <li>第一步，在 s 和 t 之间加入字符 e。</li>
                    <li>第二步，把 r 替换成 t。</li>
                  </ul>
                  <p>所以它们的编辑距离差就是 2，这就对应着二者要进行转化所要改变（添加、替换、删除）的最小步数。 那么用 Python 怎样来实现呢，我们可以直接使用 distance 库：</p>
                  <figure class="highlight mipsasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import <span class="keyword">distance</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">def </span>edit_distance(<span class="built_in">s1</span>, <span class="built_in">s2</span>):</span><br><span class="line">    return <span class="keyword">distance.levenshtein(s1, </span><span class="built_in">s2</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">s1</span> = <span class="string">'string'</span></span><br><span class="line"><span class="built_in">s2</span> = <span class="string">'setting'</span></span><br><span class="line">print(edit_distance(<span class="built_in">s1</span>, <span class="built_in">s2</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们直接使用 distance 库的 levenshtein() 方法，传入两个字符串，即可获取两个字符串的编辑距离了。 运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的 distance 库我们可以直接使用 pip3 来安装：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> distance</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样如果我们想要获取相似的文本的话可以直接设定一个编辑距离的阈值来实现，如设置编辑距离为 2，下面是一个样例：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> distance</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit_distance</span><span class="params">(s1, s2)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> distance.levenshtein(s1, s2)</span><br><span class="line"></span><br><span class="line">strings = [</span><br><span class="line">    <span class="string">'你在干什么'</span>,</span><br><span class="line">    <span class="string">'你在干啥子'</span>,</span><br><span class="line">    <span class="string">'你在做什么'</span>,</span><br><span class="line">    <span class="string">'你好啊'</span>,</span><br><span class="line">    <span class="string">'我喜欢吃香蕉'</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">target = <span class="string">'你在干啥'</span></span><br><span class="line">results = list(filter(<span class="keyword">lambda</span> x: edit_distance(x, target) &lt;= <span class="number">2</span>, strings))</span><br><span class="line">print(results)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们定义了一些字符串，然后定义了一个目标字符串，然后用编辑距离 2 的阈值进行设定，最后得到的结果就是编辑距离在 2 及以内的结果，运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'你在干什么</span>', <span class="symbol">'你在干啥子</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过这种方式我们可以大致筛选出类似的句子，但是发现一些句子例如“你在做什么” 就没有被识别出来，但他们的意义确实是相差不大的，因此，编辑距离并不是一个好的方式，但是简单易用。</p>
                  <h2 id="杰卡德系数计算"><a href="#杰卡德系数计算" class="headerlink" title="杰卡德系数计算"></a>杰卡德系数计算</h2>
                  <p>杰卡德系数，英文叫做 Jaccard index, 又称为 Jaccard 相似系数，用于比较有限样本集之间的相似性与差异性。Jaccard 系数值越大，样本相似度越高。 实际上它的计算方式非常简单，就是两个样本的交集除以并集得到的数值，当两个样本完全一致时，结果为 1，当两个样本完全不同时，结果为 0。 算法非常简单，就是交集除以并集，下面我们用 Python 代码来实现一下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">jaccard_similarity</span><span class="params">(s1, s2)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_space</span><span class="params">(s)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">' '</span>.join(list(s))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 将字中间加入空格</span></span><br><span class="line">    s1, s2 = add_space(s1), add_space(s2)</span><br><span class="line">    <span class="comment"># 转化为TF矩阵</span></span><br><span class="line">    cv = CountVectorizer(tokenizer=<span class="keyword">lambda</span> s: s.split())</span><br><span class="line">    corpus = [s1, s2]</span><br><span class="line">    vectors = cv.fit_transform(corpus).toarray()</span><br><span class="line">    <span class="comment"># 求交集</span></span><br><span class="line">    numerator = np.sum(np.min(vectors, axis=<span class="number">0</span>))</span><br><span class="line">    <span class="comment"># 求并集</span></span><br><span class="line">    denominator = np.sum(np.max(vectors, axis=<span class="number">0</span>))</span><br><span class="line">    <span class="comment"># 计算杰卡德系数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1.0</span> * numerator / denominator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s1 = <span class="string">'你在干嘛呢'</span></span><br><span class="line">s2 = <span class="string">'你在干什么呢'</span></span><br><span class="line">print(jaccard_similarity(s1, s2))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们使用了 Sklearn 库中的 CountVectorizer 来计算句子的 TF 矩阵，然后利用 Numpy 来计算二者的交集和并集，随后计算杰卡德系数。 这里值得学习的有 CountVectorizer 的用法，通过它的 fit_transform() 方法我们可以将字符串转化为词频矩阵，例如这里有两句话“你在干嘛呢”和“你在干什么呢”，首先 CountVectorizer 会计算出不重复的有哪些字，会得到一个字的列表，结果为：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'么</span>', <span class="symbol">'什</span>', <span class="symbol">'你</span>', <span class="symbol">'呢</span>', <span class="symbol">'嘛</span>', <span class="symbol">'在</span>', <span class="symbol">'干</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个其实可以通过如下代码来获取，就是获取词表内容：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">cv</span><span class="selector-class">.get_feature_names</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来通过转化之后，vectors 变量就变成了：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[[<span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>]</span><br><span class="line"> [<span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span>]]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>它对应的是两个句子对应词表的词频统计，这里是两个句子，所以结果是一个长度为 2 的二维数组，比如第一句话“你在干嘛呢”中不包含“么”字，那么第一个“么”字对应的结果就是0，即数量为 0，依次类推。 后面我们使用了 np.min() 方法并传入了 axis 为 0，实际上就是获取了每一列的最小值，这样实际上就是取了交集，np.max() 方法是获取了每一列的最大值，实际上就是取了并集。 二者分别取和即是交集大小和并集大小，然后作商即可，结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">0.5714285714285714</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个数值越大，代表两个字符串越接近，否则反之，因此我们也可以使用这个方法，并通过设置一个相似度阈值来进行筛选。</p>
                  <h2 id="TF-计算"><a href="#TF-计算" class="headerlink" title="TF 计算"></a>TF 计算</h2>
                  <p>第三种方案就是直接计算 TF 矩阵中两个向量的相似度了，实际上就是求解两个向量夹角的余弦值，就是点乘积除以二者的模长，公式如下：</p>
                  <figure class="highlight gherkin">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">cosθ=a·b/|<span class="string">a</span>|<span class="string">*</span>|<span class="string">b</span>|</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上面我们已经获得了 TF 矩阵，下面我们只需要求解两个向量夹角的余弦值就好了，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> scipy.linalg <span class="keyword">import</span> norm</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf_similarity</span><span class="params">(s1, s2)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_space</span><span class="params">(s)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">' '</span>.join(list(s))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 将字中间加入空格</span></span><br><span class="line">    s1, s2 = add_space(s1), add_space(s2)</span><br><span class="line">    <span class="comment"># 转化为TF矩阵</span></span><br><span class="line">    cv = CountVectorizer(tokenizer=<span class="keyword">lambda</span> s: s.split())</span><br><span class="line">    corpus = [s1, s2]</span><br><span class="line">    vectors = cv.fit_transform(corpus).toarray()</span><br><span class="line">    <span class="comment"># 计算TF系数</span></span><br><span class="line">    <span class="keyword">return</span> np.dot(vectors[<span class="number">0</span>], vectors[<span class="number">1</span>]) / (norm(vectors[<span class="number">0</span>]) * norm(vectors[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s1 = <span class="string">'你在干嘛呢'</span></span><br><span class="line">s2 = <span class="string">'你在干什么呢'</span></span><br><span class="line">print(tf_similarity(s1, s2))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在在这里我们使用了 np.dot() 方法获取了向量的点乘积，然后通过 norm() 方法获取了向量的模长，经过计算得到二者的 TF 系数，结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">0.7302967433402214</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="TFIDF-计算"><a href="#TFIDF-计算" class="headerlink" title="TFIDF 计算"></a>TFIDF 计算</h2>
                  <p>另外除了计算 TF 系数我们还可以计算 TFIDF 系数，TFIDF 实际上就是在词频 TF 的基础上再加入 IDF 的信息，IDF 称为逆文档频率，不了解的可以看下阮一峰老师的讲解：<span class="exturl" data-url="aHR0cDovL3d3dy5ydWFueWlmZW5nLmNvbS9ibG9nLzIwMTMvMDMvdGYtaWRmLmh0bWw=">http://www.ruanyifeng.com/blog/2013/03/tf-idf.html<i class="fa fa-external-link-alt"></i></span>，里面对 TFIDF 的讲解也是十分透彻的。 下面我们还是借助于 Sklearn 中的模块 TfidfVectorizer 来实现，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> scipy.linalg <span class="keyword">import</span> norm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tfidf_similarity</span><span class="params">(s1, s2)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_space</span><span class="params">(s)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">' '</span>.join(list(s))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 将字中间加入空格</span></span><br><span class="line">    s1, s2 = add_space(s1), add_space(s2)</span><br><span class="line">    <span class="comment"># 转化为TF矩阵</span></span><br><span class="line">    cv = TfidfVectorizer(tokenizer=<span class="keyword">lambda</span> s: s.split())</span><br><span class="line">    corpus = [s1, s2]</span><br><span class="line">    vectors = cv.fit_transform(corpus).toarray()</span><br><span class="line">    <span class="comment"># 计算TF系数</span></span><br><span class="line">    <span class="keyword">return</span> np.dot(vectors[<span class="number">0</span>], vectors[<span class="number">1</span>]) / (norm(vectors[<span class="number">0</span>]) * norm(vectors[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s1 = <span class="string">'你在干嘛呢'</span></span><br><span class="line">s2 = <span class="string">'你在干什么呢'</span></span><br><span class="line">print(tfidf_similarity(s1, s2))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的 vectors 变量实际上就对应着 TFIDF 值，内容如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[[<span class="number">0.</span>         <span class="number">0.</span>         <span class="number">0.4090901</span>  <span class="number">0.4090901</span>  <span class="number">0.57496187</span> <span class="number">0.4090901</span> <span class="number">0.4090901</span> ]</span><br><span class="line"> [<span class="number">0.49844628</span> <span class="number">0.49844628</span> <span class="number">0.35464863</span> <span class="number">0.35464863</span> <span class="number">0.</span>  <span class="number">0.35464863</span> <span class="number">0.35464863</span>]]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">0.5803329846765686</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所以通过 TFIDF 系数我们也可以进行相似度的计算。</p>
                  <h2 id="Word2Vec-计算"><a href="#Word2Vec-计算" class="headerlink" title="Word2Vec 计算"></a>Word2Vec 计算</h2>
                  <p>Word2Vec，顾名思义，其实就是将每一个词转换为向量的过程。如果不了解的话可以参考：<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l0cGx1cy9hcnRpY2xlL2RldGFpbHMvMzc5Njk1MTk=">https://blog.csdn.net/itplus/article/details/37969519<i class="fa fa-external-link-alt"></i></span>。 这里我们可以直接下载训练好的 Word2Vec 模型，模型的链接地址为：<span class="exturl" data-url="aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMVRaOEdJSTBDRVgzMnlkanNmTWMwenc=">https://pan.baidu.com/s/1TZ8GII0CEX32ydjsfMc0zw<i class="fa fa-external-link-alt"></i></span>，是使用新闻、百度百科、小说数据来训练的 64 维的 Word2Vec 模型，数据量很大，整体效果还不错，我们可以直接下载下来使用，这里我们使用的是 news_12g_baidubaike_20g_novel_90g_embedding_64.bin 数据，然后实现 Sentence2Vec，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> gensim</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> scipy.linalg <span class="keyword">import</span> norm</span><br><span class="line"></span><br><span class="line">model_file = <span class="string">'./word2vec/news_12g_baidubaike_20g_novel_90g_embedding_64.bin'</span></span><br><span class="line">model = gensim.models.KeyedVectors.load_word2vec_format(model_file, binary=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vector_similarity</span><span class="params">(s1, s2)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sentence_vector</span><span class="params">(s)</span>:</span></span><br><span class="line">        words = jieba.lcut(s)</span><br><span class="line">        v = np.zeros(<span class="number">64</span>)</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">            v += model[word]</span><br><span class="line">        v /= len(words)</span><br><span class="line">        <span class="keyword">return</span> v</span><br><span class="line">    </span><br><span class="line">    v1, v2 = sentence_vector(s1), sentence_vector(s2)</span><br><span class="line">    <span class="keyword">return</span> np.dot(v1, v2) / (norm(v1) * norm(v2))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在获取 Sentence Vector 的时候，我们首先对句子进行分词，然后对分好的每一个词获取其对应的 Vector，然后将所有 Vector 相加并求平均，这样就可得到 Sentence Vector 了，然后再计算其夹角余弦值即可。 调用示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">s1 = <span class="string">'你在干嘛'</span></span><br><span class="line">s2 = <span class="string">'你正做什么'</span></span><br><span class="line"><span class="function"><span class="title">vector_similarity</span><span class="params">(s1, s2)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">0.6701133967824016</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时如果我们再回到最初的例子看下效果：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">strings = [</span><br><span class="line">    <span class="string">'你在干什么'</span>,</span><br><span class="line">    <span class="string">'你在干啥子'</span>,</span><br><span class="line">    <span class="string">'你在做什么'</span>,</span><br><span class="line">    <span class="string">'你好啊'</span>,</span><br><span class="line">    <span class="string">'我喜欢吃香蕉'</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">target = <span class="string">'你在干啥'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">string</span> in <span class="built_in">string</span><span class="variable">s:</span></span><br><span class="line">    <span class="keyword">print</span>(<span class="built_in">string</span>, vector_similarity(<span class="built_in">string</span>, target))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>依然是前面的例子，我们看下它们的匹配度结果是多少，运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">你在干什么 <span class="number">0.8785495016487204</span></span><br><span class="line">你在干啥子 <span class="number">0.9789649689827049</span></span><br><span class="line">你在做什么 <span class="number">0.8781992402695274</span></span><br><span class="line">你好啊 <span class="number">0.5174225914249863</span></span><br><span class="line">我喜欢吃香蕉 <span class="number">0.582990841450621</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到相近的语句相似度都能到 0.8 以上，而不同的句子相似度都不足 0.6，这个区分度就非常大了，可以说有了 Word2Vec 我们可以结合一些语义信息来进行一些判断，效果明显也好很多。 所以总体来说，Word2Vec 计算的方式是非常好的。 另外学术界还有一些可能更好的研究成果，这个可以参考知乎上的一些回答：<span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzI5OTc4MjY4L2Fuc3dlci81NDM5OTA2Mg==">https://www.zhihu.com/question/29978268/answer/54399062<i class="fa fa-external-link-alt"></i></span>。 以上便是进行句子相似度计算的基本方法和 Python 实现，本节代码地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FJRGVlcExlYXJuaW5nL1NlbnRlbmNlRGlzdGFuY2U=">https://github.com/AIDeepLearning/SentenceDistance<i class="fa fa-external-link-alt"></i></span>。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-06-08 20:01:51" itemprop="dateCreated datePublished" datetime="2018-06-08T20:01:51+08:00">2018-06-08</time>
                </span>
                <span id="/6101.html" class="post-meta-item leancloud_visitors" data-flag-title="自然语言处理中句子相似度计算的几种方法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>5.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6058.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6058.html" class="post-title-link" itemprop="url">小白进阶之Scrapy第六篇Scrapy-Redis详解</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="Scrapy-Redis-详解"><a href="#Scrapy-Redis-详解" class="headerlink" title="Scrapy-Redis 详解"></a>Scrapy-Redis 详解</h1>
                  <p>通常我们在一个站站点进行采集的时候，如果是小站的话 我们使用scrapy本身就可以满足。 但是如果在面对一些比较大型的站点的时候，单个scrapy就显得力不从心了。 <img src="https://thsheep-wordpress.oss-cn-beijing.aliyuncs.com/6fd6b3659b0e7bc8c3ebcf741e221f3c.jpg" alt=""> 要是我们能够多个Scrapy一起采集该多好啊 人多力量大。 很遗憾Scrapy官方并不支持多个同时采集一个站点，虽然官方给出一个方法： <strong><strong>将一个站点的分割成几部分 交给不同的scrapy去采集</strong></strong> 似乎是个解决办法，但是很麻烦诶！毕竟分割很麻烦的哇 下面就改轮到我们的额主角Scrapy-Redis登场了！ <img src="https://thsheep-wordpress.oss-cn-beijing.aliyuncs.com/9af3afb195a78aa8770204115cc7959d.jpg" alt=""></p>
                  <h2 id="什么？？你这么就登场了？还没说为什么呢？"><a href="#什么？？你这么就登场了？还没说为什么呢？" class="headerlink" title="什么？？你这么就登场了？还没说为什么呢？"></a>什么？？你这么就登场了？还没说为什么呢？</h2>
                  <p>好吧 为了简单起见 就用官方图来简单说明一下： <img src="https://thsheep-wordpress.oss-cn-beijing.aliyuncs.com/62d1dc3038e8b596d6df6f8e8a28258a.jpg" alt=""> 这张图大家相信大家都很熟悉了。重点看一下SCHEDULER 1. 先来看看官方对于SCHEDULER的定义： <strong><strong>SCHEDULER接受来自Engine的Requests,并将它们放入队列（可以按顺序优先级），以便在之后将其提供给Engine</strong></strong> <span class="exturl" data-url="aHR0cHM6Ly9kb2Muc2NyYXB5Lm9yZy9lbi9sYXRlc3QvdG9waWNzL2FyY2hpdGVjdHVyZS5odG1sI2NvbXBvbmVudC1zY2hlZHVsZXI=">点我看文档<i class="fa fa-external-link-alt"></i></span> 2. 现在我们来看看SCHEDULER都提供了些什么功能： 根据官方文档说明 在我们没有没有指定 SCHEDULER 参数时，默认使用：’scrapy.core.scheduler.Scheduler’ 作为SCHEDULER(调度器) scrapy.core.scheduler.py: </p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Scheduler</span>(<span class="title">object</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, dupefilter, jobdir=None, dqclass=None, mqclass=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                 logunser=False, stats=None, pqclass=None)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.df = dupefilter</span><br><span class="line">        <span class="keyword">self</span>.dqdir = <span class="keyword">self</span>._dqdir(jobdir)</span><br><span class="line">        <span class="keyword">self</span>.pqclass = pqclass</span><br><span class="line">        <span class="keyword">self</span>.dqclass = dqclass</span><br><span class="line">        <span class="keyword">self</span>.mqclass = mqclass</span><br><span class="line">        <span class="keyword">self</span>.logunser = logunser</span><br><span class="line">        <span class="keyword">self</span>.stats = stats</span><br><span class="line">        <span class="comment"># 注意在scrpy中优先注意这个方法，此方法是一个钩子 用于访问当前爬虫的配置</span></span><br><span class="line">    @classmethod</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_crawler</span><span class="params">(cls, crawler)</span></span><span class="symbol">:</span></span><br><span class="line">        settings = crawler.settings</span><br><span class="line">        <span class="comment"># 获取去重用的类 默认：scrapy.dupefilters.RFPDupeFilter</span></span><br><span class="line">        dupefilter_cls = load_object(settings[<span class="string">'DUPEFILTER_CLASS'</span>])</span><br><span class="line">        <span class="comment"># 对去重类进行配置from_settings 在 scrapy.dupefilters.RFPDupeFilter 43行</span></span><br><span class="line">        <span class="comment"># 这种调用方式对于IDE跳转不是很好  所以需要自己去找</span></span><br><span class="line">        <span class="comment"># <span class="doctag">@classmethod</span></span></span><br><span class="line">        <span class="comment"># def from_settings(cls, settings):</span></span><br><span class="line">        <span class="comment">#     debug = settings.getbool('DUPEFILTER_DEBUG')</span></span><br><span class="line">        <span class="comment">#     return cls(job_dir(settings), debug)</span></span><br><span class="line">        <span class="comment"># 上面就是from_settings方法 其实就是设置工作目录 和是否开启debug</span></span><br><span class="line">        dupefilter = dupefilter_cls.from_settings(settings)</span><br><span class="line">        <span class="comment"># 获取优先级队列 类对象 默认：queuelib.pqueue.PriorityQueue</span></span><br><span class="line">        pqclass = load_object(settings[<span class="string">'SCHEDULER_PRIORITY_QUEUE'</span>])</span><br><span class="line">        <span class="comment"># 获取磁盘队列 类对象（SCHEDULER使用磁盘存储 重启不会丢失）</span></span><br><span class="line">        dqclass = load_object(settings[<span class="string">'SCHEDULER_DISK_QUEUE'</span>])</span><br><span class="line">        <span class="comment"># 获取内存队列 类对象（SCHEDULER使用内存存储 重启会丢失）</span></span><br><span class="line">        mqclass = load_object(settings[<span class="string">'SCHEDULER_MEMORY_QUEUE'</span>])</span><br><span class="line">        <span class="comment"># 是否开启debug</span></span><br><span class="line">        logunser = settings.getbool(<span class="string">'LOG_UNSERIALIZABLE_REQUESTS'</span>, settings.getbool(<span class="string">'SCHEDULER_DEBUG'</span>))</span><br><span class="line">        <span class="comment"># 将这些参数传递给 __init__方法</span></span><br><span class="line">        <span class="keyword">return</span> cls(dupefilter, jobdir=job_dir(settings), logunser=logunser,</span><br><span class="line">                   stats=crawler.stats, pqclass=pqclass, dqclass=dqclass, mqclass=mqclass)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_pending_requests</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">      <span class="string">""</span><span class="string">"检查是否有没处理的请求"</span><span class="string">""</span></span><br><span class="line">        <span class="keyword">return</span> len(<span class="keyword">self</span>) &gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open</span><span class="params">(<span class="keyword">self</span>, spider)</span></span><span class="symbol">:</span></span><br><span class="line">      <span class="string">""</span><span class="string">"Engine创建完毕之后会调用这个方法"</span><span class="string">""</span></span><br><span class="line">        <span class="keyword">self</span>.spider = spider</span><br><span class="line">        <span class="comment"># 创建一个有优先级的内存队列 实例化对象</span></span><br><span class="line">        <span class="comment"># self.pqclass 默认是：queuelib.pqueue.PriorityQueue</span></span><br><span class="line">        <span class="comment"># self._newmq 会返回一个内存队列的 实例化对象 在110  111 行</span></span><br><span class="line">        <span class="keyword">self</span>.mqs = <span class="keyword">self</span>.pqclass(<span class="keyword">self</span>._newmq)</span><br><span class="line">        <span class="comment"># 如果self.dqdir 有设置 就创建一个磁盘队列 否则self.dqs 为空</span></span><br><span class="line">        <span class="keyword">self</span>.dqs = <span class="keyword">self</span>._dq() <span class="keyword">if</span> <span class="keyword">self</span>.dqdir <span class="keyword">else</span> None</span><br><span class="line">        <span class="comment"># 获得一个去重实例对象 open 方法是从BaseDupeFilter继承的</span></span><br><span class="line">        <span class="comment"># 现在我们可以用self.df来去重啦</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.df.open()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span><span class="params">(<span class="keyword">self</span>, reason)</span></span><span class="symbol">:</span></span><br><span class="line">      <span class="string">""</span><span class="string">"当然Engine关闭时"</span><span class="string">""</span></span><br><span class="line">          <span class="comment"># 如果有磁盘队列 则对其进行dump后保存到active.json文件中</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.<span class="symbol">dqs:</span></span><br><span class="line">            prios = <span class="keyword">self</span>.dqs.close()</span><br><span class="line">            with open(join(<span class="keyword">self</span>.dqdir, <span class="string">'active.json'</span>), <span class="string">'w'</span>) as <span class="symbol">f:</span></span><br><span class="line">                json.dump(prios, f)</span><br><span class="line">        <span class="comment"># 然后关闭去重</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.df.close(reason)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enqueue_request</span><span class="params">(<span class="keyword">self</span>, request)</span></span><span class="symbol">:</span></span><br><span class="line">      <span class="string">""</span><span class="string">"添加一个Requests进调度队列"</span><span class="string">""</span></span><br><span class="line">          <span class="comment"># self.df.request_seen是检查这个Request是否已经请求过了 如果有会返回True</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> request.dont_filter <span class="keyword">and</span> <span class="keyword">self</span>.df.request_seen(request)<span class="symbol">:</span></span><br><span class="line">              <span class="comment"># 如果Request的dont_filter属性没有设置（默认为False）和 已经存在则去重</span></span><br><span class="line">            <span class="comment"># 不push进队列</span></span><br><span class="line">            <span class="keyword">self</span>.df.log(request, <span class="keyword">self</span>.spider)</span><br><span class="line">            <span class="keyword">return</span> False</span><br><span class="line">        <span class="comment"># 先尝试将Request push进磁盘队列</span></span><br><span class="line">        dqok = <span class="keyword">self</span>._dqpush(request)</span><br><span class="line">        <span class="keyword">if</span> <span class="symbol">dqok:</span></span><br><span class="line">              <span class="comment"># 如果成功 则在记录一次状态</span></span><br><span class="line">            <span class="keyword">self</span>.stats.inc_value(<span class="string">'scheduler/enqueued/disk'</span>, spider=<span class="keyword">self</span>.spider)</span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">              <span class="comment"># 不能添加进磁盘队列则会添加进内存队列</span></span><br><span class="line">            <span class="keyword">self</span>._mqpush(request)</span><br><span class="line">            <span class="keyword">self</span>.stats.inc_value(<span class="string">'scheduler/enqueued/memory'</span>, spider=<span class="keyword">self</span>.spider)</span><br><span class="line">        <span class="keyword">self</span>.stats.inc_value(<span class="string">'scheduler/enqueued'</span>, spider=<span class="keyword">self</span>.spider)</span><br><span class="line">        <span class="keyword">return</span> True</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next_request</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">      <span class="string">""</span><span class="string">"从队列中获取一个Request"</span><span class="string">""</span></span><br><span class="line">          <span class="comment"># 优先从内存队列中获取</span></span><br><span class="line">        request = <span class="keyword">self</span>.mqs.pop()</span><br><span class="line">        <span class="keyword">if</span> <span class="symbol">request:</span></span><br><span class="line">            <span class="keyword">self</span>.stats.inc_value(<span class="string">'scheduler/dequeued/memory'</span>, spider=<span class="keyword">self</span>.spider)</span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">              <span class="comment"># 不能获取的时候从磁盘队列队里获取</span></span><br><span class="line">            request = <span class="keyword">self</span>._dqpop()</span><br><span class="line">            <span class="keyword">if</span> <span class="symbol">request:</span></span><br><span class="line">                <span class="keyword">self</span>.stats.inc_value(<span class="string">'scheduler/dequeued/disk'</span>, spider=<span class="keyword">self</span>.spider)</span><br><span class="line">        <span class="keyword">if</span> <span class="symbol">request:</span></span><br><span class="line">            <span class="keyword">self</span>.stats.inc_value(<span class="string">'scheduler/dequeued'</span>, spider=<span class="keyword">self</span>.spider)</span><br><span class="line">        <span class="comment"># 将获取的到Request返回给Engine</span></span><br><span class="line">        <span class="keyword">return</span> request</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> len(<span class="keyword">self</span>.dqs) + len(<span class="keyword">self</span>.mqs) <span class="keyword">if</span> <span class="keyword">self</span>.dqs <span class="keyword">else</span> len(<span class="keyword">self</span>.mqs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_dqpush</span><span class="params">(<span class="keyword">self</span>, request)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.dqs is <span class="symbol">None:</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="symbol">try:</span></span><br><span class="line">            reqd = request_to_dict(request, <span class="keyword">self</span>.spider)</span><br><span class="line">            <span class="keyword">self</span>.dqs.push(reqd, -request.priority)</span><br><span class="line">        except ValueError as <span class="symbol">e:</span>  <span class="comment"># non serializable request</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.<span class="symbol">logunser:</span></span><br><span class="line">                msg = (<span class="string">"Unable to serialize request: %(request)s - reason:"</span></span><br><span class="line">                       <span class="string">" %(reason)s - no more unserializable requests will be"</span></span><br><span class="line">                       <span class="string">" logged (stats being collected)"</span>)</span><br><span class="line">                logger.warning(msg, &#123;<span class="string">'request'</span>: request, <span class="string">'reason'</span>: e&#125;,</span><br><span class="line">                               exc_info=True, extra=&#123;<span class="string">'spider'</span>: <span class="keyword">self</span>.spider&#125;)</span><br><span class="line">                <span class="keyword">self</span>.logunser = False</span><br><span class="line">            <span class="keyword">self</span>.stats.inc_value(<span class="string">'scheduler/unserializable'</span>,</span><br><span class="line">                                 spider=<span class="keyword">self</span>.spider)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">            <span class="keyword">return</span> True</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_mqpush</span><span class="params">(<span class="keyword">self</span>, request)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.mqs.push(request, -request.priority)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_dqpop</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.<span class="symbol">dqs:</span></span><br><span class="line">            d = <span class="keyword">self</span>.dqs.pop()</span><br><span class="line">            <span class="keyword">if</span> <span class="symbol">d:</span></span><br><span class="line">                <span class="keyword">return</span> request_from_dict(d, <span class="keyword">self</span>.spider)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_newmq</span><span class="params">(<span class="keyword">self</span>, priority)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.mqclass()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_newdq</span><span class="params">(<span class="keyword">self</span>, priority)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.dqclass(join(<span class="keyword">self</span>.dqdir, <span class="string">'p%s'</span> % priority))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_dq</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        activef = join(<span class="keyword">self</span>.dqdir, <span class="string">'active.json'</span>)</span><br><span class="line">        <span class="keyword">if</span> exists(activef)<span class="symbol">:</span></span><br><span class="line">            with open(activef) as <span class="symbol">f:</span></span><br><span class="line">                prios = json.load(f)</span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">            prios = ()</span><br><span class="line">        q = <span class="keyword">self</span>.pqclass(<span class="keyword">self</span>._newdq, startprios=prios)</span><br><span class="line">        <span class="keyword">if</span> <span class="symbol">q:</span></span><br><span class="line">            logger.info(<span class="string">"Resuming crawl (%(queuesize)d requests scheduled)"</span>,</span><br><span class="line">                        &#123;<span class="string">'queuesize'</span>: len(q)&#125;, extra=&#123;<span class="string">'spider'</span>: <span class="keyword">self</span>.spider&#125;)</span><br><span class="line">        <span class="keyword">return</span> q</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_dqdir</span><span class="params">(<span class="keyword">self</span>, jobdir)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="symbol">jobdir:</span></span><br><span class="line">            dqdir = join(jobdir, <span class="string">'requests.queue'</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> exists(dqdir)<span class="symbol">:</span></span><br><span class="line">                os.makedirs(dqdir)</span><br><span class="line">            <span class="keyword">return</span> dqdir</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p> 只挑了一些重点的写了一些注释剩下大家自己领会(才不是我懒哦 ) 从上面的代码 我们可以很清楚的知道 SCHEDULER的主要是完成了 push Request pop Request 和 去重的操作。 而且queue 操作是在内存队列中完成的。 大家看queuelib.queue就会发现基于内存的（deque） 那么去重呢？</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RFPDupeFilter</span>(<span class="title">BaseDupeFilter</span>):</span></span><br><span class="line">    <span class="string">""</span><span class="string">"Request Fingerprint duplicates filter"</span><span class="string">""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, path=None, debug=False)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.file = None</span><br><span class="line">        <span class="keyword">self</span>.fingerprints = set()</span><br><span class="line">        <span class="keyword">self</span>.logdupes = True</span><br><span class="line">        <span class="keyword">self</span>.debug = debug</span><br><span class="line">        <span class="keyword">self</span>.logger = logging.getLogger(__name_<span class="number">_</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="symbol">path:</span></span><br><span class="line">              <span class="comment"># 此处可以看到去重其实打开了一个名叫 requests.seen的文件</span></span><br><span class="line">            <span class="comment"># 如果是使用的磁盘的话</span></span><br><span class="line">            <span class="keyword">self</span>.file = open(os.path.join(path, <span class="string">'requests.seen'</span>), <span class="string">'a+'</span>)</span><br><span class="line">            <span class="keyword">self</span>.file.seek(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">self</span>.fingerprints.update(x.rstrip() <span class="keyword">for</span> x <span class="keyword">in</span> <span class="keyword">self</span>.file)</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_settings</span><span class="params">(cls, settings)</span></span><span class="symbol">:</span></span><br><span class="line">        debug = settings.getbool(<span class="string">'DUPEFILTER_DEBUG'</span>)</span><br><span class="line">        <span class="keyword">return</span> cls(job_dir(settings), debug)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request_seen</span><span class="params">(<span class="keyword">self</span>, request)</span></span><span class="symbol">:</span></span><br><span class="line">        fp = <span class="keyword">self</span>.request_fingerprint(request)</span><br><span class="line">        <span class="keyword">if</span> fp <span class="keyword">in</span> <span class="keyword">self</span>.<span class="symbol">fingerprints:</span></span><br><span class="line">              <span class="comment"># 判断我们的请求是否在这个在集合中</span></span><br><span class="line">            <span class="keyword">return</span> True</span><br><span class="line">        <span class="comment"># 没有在集合就添加进去</span></span><br><span class="line">        <span class="keyword">self</span>.fingerprints.add(fp)</span><br><span class="line">        <span class="comment"># 如果用的磁盘队列就写进去记录一下</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.<span class="symbol">file:</span></span><br><span class="line">            <span class="keyword">self</span>.file.write(fp + os.linesep)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <pre><code>  按照正常流程就是大家都会进行重复的采集；我们都知道进程之间内存中的数据不可共享的，那么你在开启多个Scrapy的时候，它们相互之间并不知道对方采集了些什么那些没有没采集。那就大家伙儿自己玩自己的了。完全没没有效率的提升啊！ ![](https://thsheep-wordpress.oss-cn-beijing.aliyuncs.com/7015cb643d0c05854dab5b8457f076af.jpg) 怎么解决呢？ 这就是我们Scrapy-Redis解决的问题了，不能协作不就是因为Request 和 去重这两个 不能共享吗？ 那我把这两个独立出来好了。 将Scrapy中的SCHEDULER组件独立放到大家都能访问的地方不就OK啦！加上scrapy-redis后流程图就应该变成这样了? ![](https://thsheep-wordpress.oss-cn-beijing.aliyuncs.com/0a94645a8f10707fe80610b5ebeb945e.jpg) So············· 这样是不是看起来就清楚多了？？？ 下面我们来看看Scrapy-Redis是怎么处理的? scrapy_redis.scheduler.py：
</code></pre>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">class Scheduler(object):</span><br><span class="line">    <span class="string">""</span><span class="string">"Redis-based scheduler</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Settings</span></span><br><span class="line"><span class="string">    --------</span></span><br><span class="line"><span class="string">    SCHEDULER_PERSIST : bool (default: False)</span></span><br><span class="line"><span class="string">        Whether to persist or clear redis queue.</span></span><br><span class="line"><span class="string">    SCHEDULER_FLUSH_ON_START : bool (default: False)</span></span><br><span class="line"><span class="string">        Whether to flush redis queue on start.</span></span><br><span class="line"><span class="string">    SCHEDULER_IDLE_BEFORE_CLOSE : int (default: 0)</span></span><br><span class="line"><span class="string">        How many seconds to wait before closing if no message is received.</span></span><br><span class="line"><span class="string">    SCHEDULER_QUEUE_KEY : str</span></span><br><span class="line"><span class="string">        Scheduler redis key.</span></span><br><span class="line"><span class="string">    SCHEDULER_QUEUE_CLASS : str</span></span><br><span class="line"><span class="string">        Scheduler queue class.</span></span><br><span class="line"><span class="string">    SCHEDULER_DUPEFILTER_KEY : str</span></span><br><span class="line"><span class="string">        Scheduler dupefilter redis key.</span></span><br><span class="line"><span class="string">    SCHEDULER_DUPEFILTER_CLASS : str</span></span><br><span class="line"><span class="string">        Scheduler dupefilter class.</span></span><br><span class="line"><span class="string">    SCHEDULER_SERIALIZER : str</span></span><br><span class="line"><span class="string">        Scheduler serializer.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line"></span><br><span class="line">    def __init__(self, server,</span><br><span class="line">                 <span class="attribute">persist</span>=<span class="literal">False</span>,</span><br><span class="line">                 <span class="attribute">flush_on_start</span>=<span class="literal">False</span>,</span><br><span class="line">                 <span class="attribute">queue_key</span>=defaults.SCHEDULER_QUEUE_KEY,</span><br><span class="line">                 <span class="attribute">queue_cls</span>=defaults.SCHEDULER_QUEUE_CLASS,</span><br><span class="line">                 <span class="attribute">dupefilter_key</span>=defaults.SCHEDULER_DUPEFILTER_KEY,</span><br><span class="line">                 <span class="attribute">dupefilter_cls</span>=defaults.SCHEDULER_DUPEFILTER_CLASS,</span><br><span class="line">                 <span class="attribute">idle_before_close</span>=0,</span><br><span class="line">                 <span class="attribute">serializer</span>=None):</span><br><span class="line">        <span class="string">""</span><span class="string">"Initialize scheduler.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Parameters</span></span><br><span class="line"><span class="string">        ----------</span></span><br><span class="line"><span class="string">        server : Redis</span></span><br><span class="line"><span class="string">            这是Redis实例</span></span><br><span class="line"><span class="string">        persist : bool</span></span><br><span class="line"><span class="string">            是否在关闭时清空Requests.默认值是False。</span></span><br><span class="line"><span class="string">        flush_on_start : bool</span></span><br><span class="line"><span class="string">            是否在启动时清空Requests。 默认值是False。</span></span><br><span class="line"><span class="string">        queue_key : str</span></span><br><span class="line"><span class="string">            Request队列的Key名字</span></span><br><span class="line"><span class="string">        queue_cls : str</span></span><br><span class="line"><span class="string">            队列的可导入路径（就是使用什么队列）</span></span><br><span class="line"><span class="string">        dupefilter_key : str</span></span><br><span class="line"><span class="string">            去重队列的Key</span></span><br><span class="line"><span class="string">        dupefilter_cls : str</span></span><br><span class="line"><span class="string">            去重类的可导入路径。</span></span><br><span class="line"><span class="string">        idle_before_close : int</span></span><br><span class="line"><span class="string">            等待多久关闭</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        <span class="keyword">if</span> idle_before_close &lt; 0:</span><br><span class="line">            raise TypeError(<span class="string">"idle_before_close cannot be negative"</span>)</span><br><span class="line"></span><br><span class="line">        self.server = server</span><br><span class="line">        self.persist = persist</span><br><span class="line">        self.flush_on_start = flush_on_start</span><br><span class="line">        self.queue_key = queue_key</span><br><span class="line">        self.queue_cls = queue_cls</span><br><span class="line">        self.dupefilter_cls = dupefilter_cls</span><br><span class="line">        self.dupefilter_key = dupefilter_key</span><br><span class="line">        self.idle_before_close = idle_before_close</span><br><span class="line">        self.serializer = serializer</span><br><span class="line">        self.stats = None</span><br><span class="line"></span><br><span class="line">    def __len__(self):</span><br><span class="line">        return len(self.queue)</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def from_settings(cls, settings):</span><br><span class="line">        kwargs = &#123;</span><br><span class="line">            <span class="string">'persist'</span>: settings.getbool(<span class="string">'SCHEDULER_PERSIST'</span>),</span><br><span class="line">            <span class="string">'flush_on_start'</span>: settings.getbool(<span class="string">'SCHEDULER_FLUSH_ON_START'</span>),</span><br><span class="line">            <span class="string">'idle_before_close'</span>: settings.getint(<span class="string">'SCHEDULER_IDLE_BEFORE_CLOSE'</span>),</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # <span class="keyword">If</span> these values are missing, it means we want <span class="keyword">to</span> use the defaults.</span><br><span class="line">        optional = &#123;</span><br><span class="line">            # TODO: Use custom prefixes <span class="keyword">for</span> this<span class="built_in"> settings </span><span class="keyword">to</span><span class="built_in"> note </span>that are</span><br><span class="line">            # specific <span class="keyword">to</span> scrapy-redis.</span><br><span class="line">            <span class="string">'queue_key'</span>: <span class="string">'SCHEDULER_QUEUE_KEY'</span>,</span><br><span class="line">            <span class="string">'queue_cls'</span>: <span class="string">'SCHEDULER_QUEUE_CLASS'</span>,</span><br><span class="line">            <span class="string">'dupefilter_key'</span>: <span class="string">'SCHEDULER_DUPEFILTER_KEY'</span>,</span><br><span class="line">            # We use the<span class="built_in"> default </span>setting name <span class="keyword">to</span> keep compatibility.</span><br><span class="line">            <span class="string">'dupefilter_cls'</span>: <span class="string">'DUPEFILTER_CLASS'</span>,</span><br><span class="line">            <span class="string">'serializer'</span>: <span class="string">'SCHEDULER_SERIALIZER'</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        # 从setting中获取配置组装成dict(具体获取那些配置是optional字典中key)</span><br><span class="line">        <span class="keyword">for</span> name, setting_name <span class="keyword">in</span> optional.items():</span><br><span class="line">            val = settings.<span class="builtin-name">get</span>(setting_name)</span><br><span class="line">            <span class="keyword">if</span> val:</span><br><span class="line">                kwargs[name] = val</span><br><span class="line"></span><br><span class="line">        # Support serializer as a path <span class="keyword">to</span> a module.</span><br><span class="line">        <span class="keyword">if</span> isinstance(kwargs.<span class="builtin-name">get</span>(<span class="string">'serializer'</span>), six.string_types):</span><br><span class="line">            kwargs[<span class="string">'serializer'</span>] = importlib.import_module(kwargs[<span class="string">'serializer'</span>])</span><br><span class="line">                # 或得一个Redis连接</span><br><span class="line">       <span class="built_in"> server </span>= connection.from_settings(settings)</span><br><span class="line">        # Ensure the<span class="built_in"> connection </span>is working.</span><br><span class="line">        server.ping()</span><br><span class="line"></span><br><span class="line">        return cls(<span class="attribute">server</span>=server, **kwargs)</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def from_crawler(cls, crawler):</span><br><span class="line">       <span class="built_in"> instance </span>= cls.from_settings(crawler.settings)</span><br><span class="line">        # FIXME: <span class="keyword">for</span> now, stats are only supported <span class="keyword">from</span> this constructor</span><br><span class="line">        instance.stats = crawler.stats</span><br><span class="line">        return instance</span><br><span class="line"></span><br><span class="line">    def open(self, spider):</span><br><span class="line">        self.spider = spider</span><br><span class="line"></span><br><span class="line">        try:</span><br><span class="line">              # 根据self.queue_cls这个可以导入的类 实例化一个队列</span><br><span class="line">            self.queue = load_object(self.queue_cls)(</span><br><span class="line">                <span class="attribute">server</span>=self.server,</span><br><span class="line">                <span class="attribute">spider</span>=spider,</span><br><span class="line">                <span class="attribute">key</span>=self.queue_key % &#123;<span class="string">'spider'</span>: spider.name&#125;,</span><br><span class="line">                <span class="attribute">serializer</span>=self.serializer,</span><br><span class="line">            )</span><br><span class="line">        except TypeError as e:</span><br><span class="line">            raise ValueError(<span class="string">"Failed to instantiate queue class '%s': %s"</span>,</span><br><span class="line">                             self.queue_cls, e)</span><br><span class="line"></span><br><span class="line">        try:</span><br><span class="line">              # 根据self.dupefilter_cls这个可以导入的类 实例一个去重集合</span><br><span class="line">            # 默认是集合 可以实现自己的去重方式 比如 bool 去重</span><br><span class="line">            self.df = load_object(self.dupefilter_cls)(</span><br><span class="line">                <span class="attribute">server</span>=self.server,</span><br><span class="line">                <span class="attribute">key</span>=self.dupefilter_key % &#123;<span class="string">'spider'</span>: spider.name&#125;,</span><br><span class="line">                <span class="attribute">debug</span>=spider.settings.getbool('DUPEFILTER_DEBUG'),</span><br><span class="line">            )</span><br><span class="line">        except TypeError as e:</span><br><span class="line">            raise ValueError(<span class="string">"Failed to instantiate dupefilter class '%s': %s"</span>,</span><br><span class="line">                             self.dupefilter_cls, e)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.flush_on_start:</span><br><span class="line">            self.flush()</span><br><span class="line">        # notice <span class="keyword">if</span> there are requests already <span class="keyword">in</span> the<span class="built_in"> queue </span><span class="keyword">to</span> resume the crawl</span><br><span class="line">        <span class="keyword">if</span> len(self.queue):</span><br><span class="line">            spider.log(<span class="string">"Resuming crawl (%d requests scheduled)"</span> % len(self.queue))</span><br><span class="line"></span><br><span class="line">    def close(self, reason):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.persist:</span><br><span class="line">            self.flush()</span><br><span class="line"></span><br><span class="line">    def flush(self):</span><br><span class="line">        self.df.clear()</span><br><span class="line">        self.queue.clear()</span><br><span class="line"></span><br><span class="line">    def enqueue_request(self, request):</span><br><span class="line">      <span class="string">""</span><span class="string">"这个和Scrapy本身的一样"</span><span class="string">""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> request.dont_filter <span class="keyword">and</span> self.df.request_seen(request):</span><br><span class="line">            self.df.log(request, self.spider)</span><br><span class="line">            return <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> self.stats:</span><br><span class="line">            self.stats.inc_value(<span class="string">'scheduler/enqueued/redis'</span>, <span class="attribute">spider</span>=self.spider)</span><br><span class="line">        # 向队列里面添加一个Request</span><br><span class="line">        self.queue.push(request)</span><br><span class="line">        return <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    def next_request(self):</span><br><span class="line">      <span class="string">""</span><span class="string">"获取一个Request"</span><span class="string">""</span></span><br><span class="line">        block_pop_timeout = self.idle_before_close</span><br><span class="line">        # block_pop_timeout 是一个等待参数 队列没有东西会等待这个时间  超时就会关闭</span><br><span class="line">        request = self.queue.pop(block_pop_timeout)</span><br><span class="line">        <span class="keyword">if</span> request <span class="keyword">and</span> self.stats:</span><br><span class="line">            self.stats.inc_value(<span class="string">'scheduler/dequeued/redis'</span>, <span class="attribute">spider</span>=self.spider)</span><br><span class="line">        return request</span><br><span class="line"></span><br><span class="line">    def has_pending_requests(self):</span><br><span class="line">        return len(self) &gt; 0</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p> 来先来看看 以上就是Scrapy-Redis中的SCHEDULER模块。下面我们来看看queue和本身的什么不同： scrapy_redis.queue.py 以最常用的优先级队列 PriorityQueue 举例： </p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PriorityQueue</span><span class="params">(Base)</span>:</span></span><br><span class="line">    <span class="string">"""Per-spider priority queue abstraction using redis' sorted set"""</span></span><br><span class="line">        <span class="string">"""其实就是使用Redis的有序集合 来对Request进行排序，这样就可以优先级高的在有序集合的顶层 我们只需要"""</span></span><br><span class="line">    <span class="string">"""从上往下依次获取Request即可"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""Return the length of the queue"""</span></span><br><span class="line">        <span class="keyword">return</span> self.server.zcard(self.key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="string">"""Push a request"""</span></span><br><span class="line">        <span class="string">"""添加一个Request进队列"""</span></span><br><span class="line">        <span class="comment"># self._encode_request 将Request请求进行序列化</span></span><br><span class="line">        data = self._encode_request(request)</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        d = &#123;</span></span><br><span class="line"><span class="string">        'url': to_unicode(request.url),  # urls should be safe (safe_string_url)</span></span><br><span class="line"><span class="string">        'callback': cb,</span></span><br><span class="line"><span class="string">        'errback': eb,</span></span><br><span class="line"><span class="string">        'method': request.method,</span></span><br><span class="line"><span class="string">        'headers': dict(request.headers),</span></span><br><span class="line"><span class="string">        'body': request.body,</span></span><br><span class="line"><span class="string">        'cookies': request.cookies,</span></span><br><span class="line"><span class="string">        'meta': request.meta,</span></span><br><span class="line"><span class="string">        '_encoding': request._encoding,</span></span><br><span class="line"><span class="string">        'priority': request.priority,</span></span><br><span class="line"><span class="string">        'dont_filter': request.dont_filter,</span></span><br><span class="line"><span class="string">        'flags': request.flags,</span></span><br><span class="line"><span class="string">        '_class': request.__module__ + '.' + request.__class__.__name__</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        data就是上面这个字典的序列化</span></span><br><span class="line"><span class="string">        在Scrapy.utils.reqser.py 中的request_to_dict方法中处理</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 在Redis有序集合中数值越小优先级越高(就是会被放在顶层)所以这个位置是取得 相反数</span></span><br><span class="line">        score = -request.priority</span><br><span class="line">        <span class="comment"># We don't use zadd method as the order of arguments change depending on</span></span><br><span class="line">        <span class="comment"># whether the class is Redis or StrictRedis, and the option of using</span></span><br><span class="line">        <span class="comment"># kwargs only accepts strings, not bytes.</span></span><br><span class="line">        <span class="comment"># ZADD 是添加进有序集合</span></span><br><span class="line">        self.server.execute_command(<span class="string">'ZADD'</span>, self.key, score, data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self, timeout=<span class="number">0</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Pop a request</span></span><br><span class="line"><span class="string">        timeout not support in this queue class</span></span><br><span class="line"><span class="string">        有序集合不支持超时所以就木有使用timeout了  这个timeout就是挂羊头卖狗肉</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="string">"""从有序集合中取出一个Request"""</span></span><br><span class="line">        <span class="comment"># use atomic range/remove using multi/exec</span></span><br><span class="line">        <span class="string">"""使用multi的原因是为了将获取Request和删除Request合并成一个操作(原子性的)在获取到一个元素之后 删除它，因为有序集合 不像list 有pop 这种方式啊"""</span></span><br><span class="line">        pipe = self.server.pipeline()</span><br><span class="line">        pipe.multi()</span><br><span class="line">        <span class="comment"># 取出 顶层第一个</span></span><br><span class="line">        <span class="comment"># zrange :返回有序集 key 中，指定区间内的成员。0,0 就是第一个了</span></span><br><span class="line">        <span class="comment"># zremrangebyrank：移除有序集 key 中，指定排名(rank)区间内的所有成员 0，0也就是第一个了</span></span><br><span class="line">        <span class="comment"># 更多请参考Redis官方文档</span></span><br><span class="line">        pipe.zrange(self.key, <span class="number">0</span>, <span class="number">0</span>).zremrangebyrank(self.key, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        results, count = pipe.execute()</span><br><span class="line">        <span class="keyword">if</span> results:</span><br><span class="line">            <span class="keyword">return</span> self._decode_request(results[<span class="number">0</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p> 以上就是SCHEDULER在处理Request的时候做的操作了。 是时候来看看SCHEDULER是怎么处理去重的了！ 只需要注意这个?方法即可：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">request_seen</span><span class="params">(self, request)</span>:</span></span><br><span class="line">  <span class="string">"""Returns True if request was already seen.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Parameters</span></span><br><span class="line"><span class="string">        ----------</span></span><br><span class="line"><span class="string">        request : scrapy.http.Request</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns</span></span><br><span class="line"><span class="string">        -------</span></span><br><span class="line"><span class="string">        bool</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">  <span class="comment"># 通过self.request_fingerprint 会生一个sha1的指纹</span></span><br><span class="line">  fp = self.request_fingerprint(request)</span><br><span class="line">  <span class="comment"># This returns the number of values added, zero if already exists.</span></span><br><span class="line">  <span class="comment"># 添加进一个Redis集合如果self.key这个集合中存在fp这个指纹会返回1  不存在返回0</span></span><br><span class="line">  added = self.server.sadd(self.key, fp)</span><br><span class="line">  <span class="keyword">return</span> added == <span class="number">0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <pre><code>这样大家就都可以访问同一个Redis 获取同一个spider的Request 在同一个位置去重，就不用担心重复啦 大概就像这样：
</code></pre>
                  <ol>
                    <li>spider1：检查一下这个Request是否在Redis去重，如果在就证明其它的spider采集过啦！如果不在就添加进调度队列，等待别 人获取。自己继续干活抓取网页 产生新的Request了 重复之前步骤。</li>
                    <li>spider2：以相同的逻辑执行</li>
                  </ol>
                  <p>可能有些小伙儿会产生疑问了~~！spider2拿到了别人的Request了 怎么能正确的执行呢？逻辑不会错吗？ 这个不用担心啦 因为整Request当中包含了，所有的逻辑，回去看看上面那个序列化的字典。 总结一下：</p>
                  <ol>
                    <li>1. Scrapy-Reids 就是将Scrapy原本在内存中处理的 调度(就是一个队列Queue)、去重、这两个操作通过Redis来实现</li>
                    <li>多个Scrapy在采集同一个站点时会使用相同的redis key（可以理解为队列）添加Request 获取Request 去重Request，这样所有的spider不会进行重复采集。效率自然就嗖嗖的上去了。</li>
                    <li>3. Redis是原子性的，好处不言而喻(一个Request要么被处理 要么没被处理，不存在第三可能)</li>
                  </ol>
                  <p>另外Scrapy-Redis本身不支持Redis-Cluster，大量网站去重的话会给单机很大的压力（就算使用boolfilter 内存也不够整啊！） 改造方式很简单：</p>
                  <ol>
                    <li>使用 <strong><strong>rediscluster</strong></strong> 这个包替换掉本身的Redis连接</li>
                    <li>Redis-Cluster 不支持事务，可以使用lua脚本进行代替（lua脚本是原子性的哦）</li>
                    <li><strong><strong>注意使用lua脚本 不能写占用时间很长的操作</strong></strong>（毕竟一大群人等着操作Redis 你总不能让人家等着吧）</li>
                  </ol>
                  <p>以上！完毕 对于懒人小伙伴儿 看看这个我改好的: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Roc2hlZXAvc2NyYXB5X3JlZGlzX2NsdXN0ZXI=">集群版Scrapy-Redis<i class="fa fa-external-link-alt"></i></span> <strong><strong>PS: 支持Python3.6+ 哦 ！ 其余的版本没测试过</strong></strong> <img src="https://thsheep-wordpress.oss-cn-beijing.aliyuncs.com/4a99cdf73bef5f5aaaa4ec9f61b8d838.jpg" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/哎哟卧槽" class="author" itemprop="url" rel="index">哎哟卧槽</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-06-06 09:10:29" itemprop="dateCreated datePublished" datetime="2018-06-06T09:10:29+08:00">2018-06-06</time>
                </span>
                <span id="/6058.html" class="post-meta-item leancloud_visitors" data-flag-title="小白进阶之Scrapy第六篇Scrapy-Redis详解" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>14k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>13 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6080.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6080.html" class="post-title-link" itemprop="url">Python中logging模块的基本用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在 PyCon 2018 上，Mario Corchero 介绍了在开发过程中如何更方便轻松地记录日志的流程。</p>
                  <p><img src="https://user-gold-cdn.xitu.io/2018/6/3/163c61861faf256f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p>
                  <p>整个演讲的内容包括：</p>
                  <ul>
                    <li>为什么日志记录非常重要</li>
                    <li>日志记录的流程是怎样的</li>
                    <li>怎样来进行日志记录</li>
                    <li>怎样进行日志记录相关配置</li>
                    <li>日志记录使用常见误区</li>
                  </ul>
                  <p>下面我们来梳理一下整个演讲的过程，其实其核心就是介绍了 logging 模块的使用方法和一些配置。</p>
                  <h2 id="日志记录的重要性"><a href="#日志记录的重要性" class="headerlink" title="日志记录的重要性"></a>日志记录的重要性</h2>
                  <p>在开发过程中，如果程序运行出现了问题，我们是可以使用我们自己的 Debug 工具来检测到到底是哪一步出现了问题，如果出现了问题的话，是很容易排查的。但程序开发完成之后，我们会将它部署到生产环境中去，这时候代码相当于是在一个黑盒环境下运行的，我们只能看到其运行的效果，是不能直接看到代码运行过程中每一步的状态的。在这个环境下，运行过程中难免会在某个地方出现问题，甚至这个问题可能是我们开发过程中未曾遇到的问题，碰到这种情况应该怎么办？ 如果我们现在只能得知当前问题的现象，而没有其他任何信息的话，如果我们想要解决掉这个问题的话，那么只能根据问题的现象来试图复现一下，然后再一步步去调试，这恐怕是很难的，很大的概率上我们是无法精准地复现这个问题的，而且 Debug 的过程也会耗费巨多的时间，这样一旦生产环境上出现了问题，修复就会变得非常棘手。但这如果我们当时有做日志记录的话，不论是正常运行还是出现报错，都有相关的时间记录，状态记录，错误记录等，那么这样我们就可以方便地追踪到在当时的运行过程中出现了怎样的状况，从而可以快速排查问题。 因此，日志记录是非常有必要的，任何一款软件如果没有标准的日志记录，都不能算作一个合格的软件。作为开发者，我们需要重视并做好日志记录过程。</p>
                  <h2 id="日志记录的流程框架"><a href="#日志记录的流程框架" class="headerlink" title="日志记录的流程框架"></a>日志记录的流程框架</h2>
                  <p>那么在 Python 中，怎样才能算作一个比较标准的日志记录过程呢？或许很多人会使用 print 语句输出一些运行信息，然后再在控制台观察，运行的时候再将输出重定向到文件输出流保存到文件中，这样其实是非常不规范的，在 Python 中有一个标准的 logging 模块，我们可以使用它来进行标注的日志记录，利用它我们可以更方便地进行日志记录，同时还可以做更方便的级别区分以及一些额外日志信息的记录，如时间、运行模块信息等。 接下来我们先了解一下日志记录流程的整体框架。 <img src="https://user-gold-cdn.xitu.io/2018/6/3/163c618941cfc03f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""> 如图所示，整个日志记录的框架可以分为这么几个部分：</p>
                  <ul>
                    <li>Logger：即 Logger Main Class，是我们进行日志记录时创建的对象，我们可以调用它的方法传入日志模板和信息，来生成一条条日志记录，称作 Log Record。</li>
                    <li>Log Record：就代指生成的一条条日志记录。</li>
                    <li>Handler：即用来处理日志记录的类，它可以将 Log Record 输出到我们指定的日志位置和存储形式等，如我们可以指定将日志通过 FTP 协议记录到远程的服务器上，Handler 就会帮我们完成这些事情。</li>
                    <li>Formatter：实际上生成的 Log Record 也是一个个对象，那么我们想要把它们保存成一条条我们想要的日志文本的话，就需要有一个格式化的过程，那么这个过程就由 Formatter 来完成，返回的就是日志字符串，然后传回给 Handler 来处理。</li>
                    <li>Filter：另外保存日志的时候我们可能不需要全部保存，我们可能只需要保存我们想要的部分就可以了，所以保存前还需要进行一下过滤，留下我们想要的日志，如只保存某个级别的日志，或只保存包含某个关键字的日志等，那么这个过滤过程就交给 Filter 来完成。</li>
                    <li>Parent Handler：Handler 之间可以存在分层关系，以使得不同 Handler 之间共享相同功能的代码。</li>
                  </ul>
                  <p>以上就是整个 logging 模块的基本架构和对象功能，了解了之后我们详细来了解一下 logging 模块的用法。</p>
                  <h2 id="日志记录的相关用法"><a href="#日志记录的相关用法" class="headerlink" title="日志记录的相关用法"></a>日志记录的相关用法</h2>
                  <p>总的来说 logging 模块相比 print 有这么几个优点：</p>
                  <ul>
                    <li>可以在 logging 模块中设置日志等级，在不同的版本（如开发环境、生产环境）上通过设置不同的输出等级来记录对应的日志，非常灵活。</li>
                    <li>print 的输出信息都会输出到标准输出流中，而 logging 模块就更加灵活，可以设置输出到任意位置，如写入文件、写入远程服务器等。</li>
                    <li>logging 模块具有灵活的配置和格式化功能，如配置输出当前模块信息、运行时间等，相比 print 的字符串格式化更加方便易用。</li>
                  </ul>
                  <p>下面我们初步来了解下 logging 模块的基本用法，先用一个实例来感受一下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(<span class="attribute">level</span>=logging.INFO, <span class="attribute">format</span>=<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line">logger.<span class="builtin-name">info</span>(<span class="string">'This is a log info'</span>)</span><br><span class="line">logger.<span class="builtin-name">debug</span>(<span class="string">'Debugging'</span>)</span><br><span class="line">logger.<span class="builtin-name">warning</span>(<span class="string">'Warning exists'</span>)</span><br><span class="line">logger.<span class="builtin-name">info</span>(<span class="string">'Finish'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们首先引入了 logging 模块，然后进行了一下基本的配置，这里通过 basicConfig 配置了 level 信息和 format 信息，这里 level 配置为 INFO 信息，即只输出 INFO 级别的信息，另外这里指定了 format 格式的字符串，包括 asctime、name、levelname、message 四个内容，分别代表运行时间、模块名称、日志级别、日志内容，这样输出内容便是这四者组合而成的内容了，这就是 logging 的全局配置。 接下来声明了一个 Logger 对象，它就是日志输出的主类，调用对象的 info() 方法就可以输出 INFO 级别的日志信息，调用 debug() 方法就可以输出 DEBUG 级别的日志信息，非常方便。在初始化的时候我们传入了模块的名称，这里直接使用 <strong>name</strong> 来代替了，就是模块的名称，如果直接运行这个脚本的话就是 <strong>main</strong>，如果是 import 的模块的话就是被引入模块的名称，这个变量在不同的模块中的名字是不同的，所以一般使用 <strong>name</strong> 来表示就好了，再接下来输出了四条日志信息，其中有两条 INFO、一条 WARNING、一条 DEBUG 信息，我们看下输出结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">13</span>:<span class="number">42</span>:<span class="number">43</span>,<span class="number">526</span> - __main__ - INFO - This <span class="keyword">is</span> a log info</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">13</span>:<span class="number">42</span>:<span class="number">43</span>,<span class="number">526</span> - __main__ - WARNING - Warning exists</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">13</span>:<span class="number">42</span>:<span class="number">43</span>,<span class="number">526</span> - __main__ - INFO - Finish</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到输出结果一共有三条日志信息，每条日志都是对应了指定的格式化内容，另外我们发现 DEBUG 的信息是没有输出的，这是因为我们在全局配置的时候设置了输出为 INFO 级别，所以 DEBUG 级别的信息就被过滤掉了。 这时如果我们将输出的日志级别设置为 DEBUG，就可以看到 DEBUG 级别的日志输出了：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">logging.basic<span class="constructor">Config(<span class="params">level</span>=<span class="params">logging</span>.DEBUG, <span class="params">format</span>='%(<span class="params">asctime</span>)</span>s - %(name)s - %(levelname)s - %(message)s')</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">13</span>:<span class="number">49</span>:<span class="number">22</span>,<span class="number">770</span> - __main__ - INFO - This <span class="keyword">is</span> a log info</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">13</span>:<span class="number">49</span>:<span class="number">22</span>,<span class="number">770</span> - __main__ - DEBUG - Debugging</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">13</span>:<span class="number">49</span>:<span class="number">22</span>,<span class="number">770</span> - __main__ - WARNING - Warning exists</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">13</span>:<span class="number">49</span>:<span class="number">22</span>,<span class="number">770</span> - __main__ - INFO - Finish</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>由此可见，相比 print 来说，通过刚才的代码，我们既可以输出时间、模块名称，又可以输出不同级别的日志信息作区分并加以过滤，是不是灵活多了？ 当然这只是 logging 模块的一小部分功能，接下来我们首先来全面了解一下 basicConfig 的参数都有哪些：</p>
                  <ul>
                    <li>filename：即日志输出的文件名，如果指定了这个信息之后，实际上会启用 FileHandler，而不再是 StreamHandler，这样日志信息便会输出到文件中了。</li>
                    <li>filemode：这个是指定日志文件的写入方式，有两种形式，一种是 w，一种是 a，分别代表清除后写入和追加写入。</li>
                    <li>format：指定日志信息的输出格式，即上文示例所示的参数，详细参数可以参考：<span class="exturl" data-url="aHR0cHM6Ly9saW5rLmp1ZWppbi5pbT90YXJnZXQ9aHR0cHMlM0ElMkYlMkZkb2NzLnB5dGhvbi5vcmclMkYzJTJGbGlicmFyeSUyRmxvZ2dpbmcuaHRtbCUzRmhpZ2hsaWdodCUzRGxvZ2dpbmclMjUyMHRocmVhZG5hbWUlMjNsb2dyZWNvcmQtYXR0cmlidXRlcw==">docs.python.org/3/library/l…<i class="fa fa-external-link-alt"></i></span>，部分参数如下所示：<ul>
                        <li>%(levelno)s：打印日志级别的数值。</li>
                        <li>%(levelname)s：打印日志级别的名称。</li>
                        <li>%(pathname)s：打印当前执行程序的路径，其实就是sys.argv[0]。</li>
                        <li>%(filename)s：打印当前执行程序名。</li>
                        <li>%(funcName)s：打印日志的当前函数。</li>
                        <li>%(lineno)d：打印日志的当前行号。</li>
                        <li>%(asctime)s：打印日志的时间。</li>
                        <li>%(thread)d：打印线程ID。</li>
                        <li>%(threadName)s：打印线程名称。</li>
                        <li>%(process)d：打印进程ID。</li>
                        <li>%(processName)s：打印线程名称。</li>
                        <li>%(module)s：打印模块名称。</li>
                        <li>%(message)s：打印日志信息。</li>
                      </ul>
                    </li>
                    <li>datefmt：指定时间的输出格式。</li>
                    <li>style：如果 format 参数指定了，这个参数就可以指定格式化时的占位符风格，如 %、{、$ 等。</li>
                    <li>level：指定日志输出的类别，程序会输出大于等于此级别的信息。</li>
                    <li>stream：在没有指定 filename 的时候会默认使用 StreamHandler，这时 stream 可以指定初始化的文件流。</li>
                    <li>handlers：可以指定日志处理时所使用的 Handlers，必须是可迭代的。</li>
                  </ul>
                  <p>下面我们再用一个实例来感受一下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(<span class="attribute">level</span>=logging.DEBUG,</span><br><span class="line">                    <span class="attribute">filename</span>=<span class="string">'output.log'</span>,</span><br><span class="line">                    <span class="attribute">datefmt</span>=<span class="string">'%Y/%m/%d %H:%M:%S'</span>,</span><br><span class="line">                    <span class="attribute">format</span>=<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(lineno)d - %(module)s - %(message)s'</span>)</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line">logger.<span class="builtin-name">info</span>(<span class="string">'This is a log info'</span>)</span><br><span class="line">logger.<span class="builtin-name">debug</span>(<span class="string">'Debugging'</span>)</span><br><span class="line">logger.<span class="builtin-name">warning</span>(<span class="string">'Warning exists'</span>)</span><br><span class="line">logger.<span class="builtin-name">info</span>(<span class="string">'Finish'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们指定了输出文件的名称为 output.log，另外指定了日期的输出格式，其中年月日的格式变成了 %Y/%m/%d，另外输出的 format 格式增加了 lineno、module 这两个信息，运行之后便会生成一个 output.log 的文件，内容如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2018</span>/<span class="number">06</span>/<span class="number">03</span> <span class="number">14</span>:<span class="number">43</span>:<span class="number">26</span> - __main__ - INFO - <span class="number">9</span> - demo3 - This <span class="keyword">is</span> a log info</span><br><span class="line"><span class="number">2018</span>/<span class="number">06</span>/<span class="number">03</span> <span class="number">14</span>:<span class="number">43</span>:<span class="number">26</span> - __main__ - DEBUG - <span class="number">10</span> - demo3 - Debugging</span><br><span class="line"><span class="number">2018</span>/<span class="number">06</span>/<span class="number">03</span> <span class="number">14</span>:<span class="number">43</span>:<span class="number">26</span> - __main__ - WARNING - <span class="number">11</span> - demo3 - Warning exists</span><br><span class="line"><span class="number">2018</span>/<span class="number">06</span>/<span class="number">03</span> <span class="number">14</span>:<span class="number">43</span>:<span class="number">26</span> - __main__ - INFO - <span class="number">12</span> - demo3 - Finish</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到日志便会输出到文件中，同时输出了行号、模块名称等信息。 以上我们通过 basicConfig 来进行了一些全局的配置，我们同样可以使用 Formatter、Handler 进行更灵活的处理，下面我们来了解一下。</p>
                  <h3 id="Level"><a href="#Level" class="headerlink" title="Level"></a>Level</h3>
                  <p>首先我们来了解一下输出日志的等级信息，logging 模块共提供了如下等级，每个等级其实都对应了一个数值，列表如下：</p>
                  <p>等级</p>
                  <p>数值</p>
                  <p>CRITICAL</p>
                  <p>50</p>
                  <p>FATAL</p>
                  <p>50</p>
                  <p>ERROR</p>
                  <p>40</p>
                  <p>WARNING</p>
                  <p>30</p>
                  <p>WARN</p>
                  <p>30</p>
                  <p>INFO</p>
                  <p>20</p>
                  <p>DEBUG</p>
                  <p>10</p>
                  <p>NOTSET</p>
                  <p>0</p>
                  <p>这里最高的等级是 CRITICAL 和 FATAL，两个对应的数值都是 50，另外对于 WARNING 还提供了简写形式 WARN，两个对应的数值都是 30。 我们设置了输出 level，系统便只会输出 level 数值大于或等于该 level 的的日志结果，例如我们设置了输出日志 level 为 INFO，那么输出级别大于等于 INFO 的日志，如 WARNING、ERROR 等，DEBUG 和 NOSET 级别的不会输出。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(<span class="attribute">level</span>=logging.WARN)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Log</span></span><br><span class="line">logger.<span class="builtin-name">debug</span>(<span class="string">'Debugging'</span>)</span><br><span class="line">logger.critical(<span class="string">'Critical Something'</span>)</span><br><span class="line">logger.<span class="builtin-name">error</span>(<span class="string">'Error Occurred'</span>)</span><br><span class="line">logger.<span class="builtin-name">warning</span>(<span class="string">'Warning exists'</span>)</span><br><span class="line">logger.<span class="builtin-name">info</span>(<span class="string">'Finished'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们设置了输出级别为 WARN，然后对应输出了五种不同级别的日志信息，运行结果如下：</p>
                  <figure class="highlight subunit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Critical Something</span><br><span class="line"><span class="keyword">Error </span>Occurred</span><br><span class="line">Warning exists</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到只有 CRITICAL、ERROR、WARNING 信息输出了，DEBUG、INFO 信息没有输出。</p>
                  <h3 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h3>
                  <p>下面我们先来了解一下 Handler 的用法，看下面的实例：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(<span class="attribute">level</span>=logging.INFO)</span><br><span class="line">handler = logging.FileHandler(<span class="string">'output.log'</span>)</span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line">handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(handler)</span><br><span class="line"></span><br><span class="line">logger.<span class="builtin-name">info</span>(<span class="string">'This is a log info'</span>)</span><br><span class="line">logger.<span class="builtin-name">debug</span>(<span class="string">'Debugging'</span>)</span><br><span class="line">logger.<span class="builtin-name">warning</span>(<span class="string">'Warning exists'</span>)</span><br><span class="line">logger.<span class="builtin-name">info</span>(<span class="string">'Finish'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们没有再使用 basicConfig 全局配置，而是先声明了一个 Logger 对象，然后指定了其对应的 Handler 为 FileHandler 对象，然后 Handler 对象还单独指定了 Formatter 对象单独配置输出格式，最后给 Logger 对象添加对应的 Handler 即可，最后可以发现日志就会被输出到 output.log 中，内容如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">14</span>:<span class="number">53</span>:<span class="number">36</span>,<span class="number">467</span> - __main__ - INFO - This <span class="keyword">is</span> a log info</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">14</span>:<span class="number">53</span>:<span class="number">36</span>,<span class="number">468</span> - __main__ - WARNING - Warning exists</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">14</span>:<span class="number">53</span>:<span class="number">36</span>,<span class="number">468</span> - __main__ - INFO - Finish</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外我们还可以使用其他的 Handler 进行日志的输出，logging 模块提供的 Handler 有：</p>
                  <ul>
                    <li>StreamHandler：logging.StreamHandler；日志输出到流，可以是 sys.stderr，sys.stdout 或者文件。</li>
                    <li>FileHandler：logging.FileHandler；日志输出到文件。</li>
                    <li>BaseRotatingHandler：logging.handlers.BaseRotatingHandler；基本的日志回滚方式。</li>
                    <li>RotatingHandler：logging.handlers.RotatingHandler；日志回滚方式，支持日志文件最大数量和日志文件回滚。</li>
                    <li>TimeRotatingHandler：logging.handlers.TimeRotatingHandler；日志回滚方式，在一定时间区域内回滚日志文件。</li>
                    <li>SocketHandler：logging.handlers.SocketHandler；远程输出日志到TCP/IP sockets。</li>
                    <li>DatagramHandler：logging.handlers.DatagramHandler；远程输出日志到UDP sockets。</li>
                    <li>SMTPHandler：logging.handlers.SMTPHandler；远程输出日志到邮件地址。</li>
                    <li>SysLogHandler：logging.handlers.SysLogHandler；日志输出到syslog。</li>
                    <li>NTEventLogHandler：logging.handlers.NTEventLogHandler；远程输出日志到Windows NT/2000/XP的事件日志。</li>
                    <li>MemoryHandler：logging.handlers.MemoryHandler；日志输出到内存中的指定buffer。</li>
                    <li>HTTPHandler：logging.handlers.HTTPHandler；通过”GET”或者”POST”远程输出到HTTP服务器。</li>
                  </ul>
                  <p>下面我们使用三个 Handler 来实现日志同时输出到控制台、文件、HTTP 服务器：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line"><span class="keyword">from</span> logging.handlers import HTTPHandler</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(<span class="attribute">level</span>=logging.DEBUG)</span><br><span class="line"></span><br><span class="line"><span class="comment"># StreamHandler</span></span><br><span class="line">stream_handler = logging.StreamHandler(sys.stdout)</span><br><span class="line">stream_handler.setLevel(<span class="attribute">level</span>=logging.DEBUG)</span><br><span class="line">logger.addHandler(stream_handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># FileHandler</span></span><br><span class="line">file_handler = logging.FileHandler(<span class="string">'output.log'</span>)</span><br><span class="line">file_handler.setLevel(<span class="attribute">level</span>=logging.INFO)</span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line">file_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(file_handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTPHandler</span></span><br><span class="line">http_handler = HTTPHandler(<span class="attribute">host</span>=<span class="string">'localhost:8001'</span>, <span class="attribute">url</span>=<span class="string">'log'</span>, <span class="attribute">method</span>=<span class="string">'POST'</span>)</span><br><span class="line">logger.addHandler(http_handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Log</span></span><br><span class="line">logger.<span class="builtin-name">info</span>(<span class="string">'This is a log info'</span>)</span><br><span class="line">logger.<span class="builtin-name">debug</span>(<span class="string">'Debugging'</span>)</span><br><span class="line">logger.<span class="builtin-name">warning</span>(<span class="string">'Warning exists'</span>)</span><br><span class="line">logger.<span class="builtin-name">info</span>(<span class="string">'Finish'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行之前我们需要先启动 HTTP Server，并运行在 8001 端口，其中 log 接口是用来接收日志的接口。 运行之后控制台输出会输出如下内容：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">This <span class="keyword">is</span> a <span class="keyword">log</span> <span class="keyword">info</span></span><br><span class="line">Debugging</span><br><span class="line"><span class="built_in">Warning</span> <span class="keyword">exists</span></span><br><span class="line">Finish</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>output.log 文件会写入如下内容：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">15</span>:<span class="number">13</span>:<span class="number">44</span>,<span class="number">895</span> - __main__ - INFO - This <span class="keyword">is</span> a log info</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">15</span>:<span class="number">13</span>:<span class="number">44</span>,<span class="number">947</span> - __main__ - WARNING - Warning exists</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">15</span>:<span class="number">13</span>:<span class="number">44</span>,<span class="number">949</span> - __main__ - INFO - Finish</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>HTTP Server 会收到控制台输出的信息。 这样一来，我们就通过设置多个 Handler 来控制了日志的多目标输出。 另外值得注意的是，在这里 StreamHandler 对象我们没有设置 Formatter，因此控制台只输出了日志的内容，而没有包含时间、模块等信息，而 FileHandler 我们通过 setFormatter() 方法设置了一个 Formatter 对象，因此输出的内容便是格式化后的日志信息。 另外每个 Handler 还可以设置 level 信息，最终输出结果的 level 信息会取 Logger 对象的 level 和 Handler 对象的 level 的交集。</p>
                  <h3 id="Formatter"><a href="#Formatter" class="headerlink" title="Formatter"></a>Formatter</h3>
                  <p>在进行日志格式化输出的时候，我们可以不借助于 basicConfig 来全局配置格式化输出内容，可以借助于 Formatter 来完成，下面我们再来单独看下 Formatter 的用法：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(<span class="attribute">level</span>=logging.WARN)</span><br><span class="line">formatter = logging.Formatter(<span class="attribute">fmt</span>=<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>, <span class="attribute">datefmt</span>=<span class="string">'%Y/%m/%d %H:%M:%S'</span>)</span><br><span class="line">handler = logging.StreamHandler()</span><br><span class="line">handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Log</span></span><br><span class="line">logger.<span class="builtin-name">debug</span>(<span class="string">'Debugging'</span>)</span><br><span class="line">logger.critical(<span class="string">'Critical Something'</span>)</span><br><span class="line">logger.<span class="builtin-name">error</span>(<span class="string">'Error Occurred'</span>)</span><br><span class="line">logger.<span class="builtin-name">warning</span>(<span class="string">'Warning exists'</span>)</span><br><span class="line">logger.<span class="builtin-name">info</span>(<span class="string">'Finished'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们指定了一个 Formatter，并传入了 fmt 和 datefmt 参数，这样就指定了日志结果的输出格式和时间格式，然后 handler 通过 setFormatter() 方法设置此 Formatter 对象即可，输出结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2018</span>/<span class="number">06</span>/<span class="number">03</span> <span class="number">15</span>:<span class="number">47</span>:<span class="number">15</span> - __main__ - CRITICAL - Critical Something</span><br><span class="line"><span class="number">2018</span>/<span class="number">06</span>/<span class="number">03</span> <span class="number">15</span>:<span class="number">47</span>:<span class="number">15</span> - __main__ - ERROR - Error Occurred</span><br><span class="line"><span class="number">2018</span>/<span class="number">06</span>/<span class="number">03</span> <span class="number">15</span>:<span class="number">47</span>:<span class="number">15</span> - __main__ - WARNING - Warning exists</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们可以每个 Handler 单独配置输出的格式，非常灵活。</p>
                  <h3 id="捕获-Traceback"><a href="#捕获-Traceback" class="headerlink" title="捕获 Traceback"></a>捕获 Traceback</h3>
                  <p>如果遇到错误，我们更希望报错时出现的详细 Traceback 信息，便于调试，利用 logging 模块我们可以非常方便地实现这个记录，我们用一个实例来感受一下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(<span class="attribute">level</span>=logging.DEBUG)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Formatter</span></span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># FileHandler</span></span><br><span class="line">file_handler = logging.FileHandler(<span class="string">'result.log'</span>)</span><br><span class="line">file_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(file_handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># StreamHandler</span></span><br><span class="line">stream_handler = logging.StreamHandler()</span><br><span class="line">stream_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(stream_handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Log</span></span><br><span class="line">logger.<span class="builtin-name">info</span>(<span class="string">'Start'</span>)</span><br><span class="line">logger.<span class="builtin-name">warning</span>(<span class="string">'Something maybe fail.'</span>)</span><br><span class="line">try:</span><br><span class="line">    result = 10 / 0</span><br><span class="line">except Exception:</span><br><span class="line">    logger.<span class="builtin-name">error</span>(<span class="string">'Faild to get result'</span>, <span class="attribute">exc_info</span>=<span class="literal">True</span>)</span><br><span class="line">logger.<span class="builtin-name">info</span>(<span class="string">'Finished'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们在 error() 方法中添加了一个参数，将 exc_info 设置为了 True，这样我们就可以输出执行过程中的信息了，即完整的 Traceback 信息。 运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">16</span>:<span class="number">00</span>:<span class="number">15</span>,<span class="number">382</span> - __main__ - INFO - Start print log</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">16</span>:<span class="number">00</span>:<span class="number">15</span>,<span class="number">382</span> - __main__ - DEBUG - Do something</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">16</span>:<span class="number">00</span>:<span class="number">15</span>,<span class="number">382</span> - __main__ - WARNING - Something maybe fail.</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">16</span>:<span class="number">00</span>:<span class="number">15</span>,<span class="number">382</span> - __main__ - ERROR - Faild to <span class="keyword">get</span> result</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/private/var/books/aicodes/loggingtest/demo8.py"</span>, line <span class="number">23</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    result = <span class="number">10</span> / <span class="number">0</span></span><br><span class="line">ZeroDivisionError: division by zero</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">16</span>:<span class="number">00</span>:<span class="number">15</span>,<span class="number">383</span> - __main__ - INFO - Finished</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到这样我们就非常方便地记录下来了报错的信息，一旦出现了错误，我们也能非常方便地排查。</p>
                  <h3 id="配置共享"><a href="#配置共享" class="headerlink" title="配置共享"></a>配置共享</h3>
                  <p>在写项目的时候，我们肯定会将许多配置放置在许多模块下面，这时如果我们每个文件都来配置 logging 配置那就太繁琐了，logging 模块提供了父子模块共享配置的机制，会根据 Logger 的名称来自动加载父模块的配置。 例如我们这里首先定义一个 main.py 文件：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line">import core</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">'main'</span>)</span><br><span class="line">logger.setLevel(<span class="attribute">level</span>=logging.DEBUG)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Handler</span></span><br><span class="line">handler = logging.FileHandler(<span class="string">'result.log'</span>)</span><br><span class="line">handler.setLevel(logging.INFO)</span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line">handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(handler)</span><br><span class="line"></span><br><span class="line">logger.<span class="builtin-name">info</span>(<span class="string">'Main Info'</span>)</span><br><span class="line">logger.<span class="builtin-name">debug</span>(<span class="string">'Main Debug'</span>)</span><br><span class="line">logger.<span class="builtin-name">error</span>(<span class="string">'Main Error'</span>)</span><br><span class="line">core.<span class="builtin-name">run</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们配置了日志的输出格式和文件路径，同时定义了 Logger 的名称为 main，然后引入了另外一个模块 core，最后调用了 core 的 run() 方法。 接下来我们定义 core.py，内容如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">'main.core'</span>)</span><br><span class="line"></span><br><span class="line">def <span class="builtin-name">run</span>():</span><br><span class="line">    logger.<span class="builtin-name">info</span>(<span class="string">'Core Info'</span>)</span><br><span class="line">    logger.<span class="builtin-name">debug</span>(<span class="string">'Core Debug'</span>)</span><br><span class="line">    logger.<span class="builtin-name">error</span>(<span class="string">'Core Error'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们定义了 Logger 的名称为 main.core，注意这里开头是 main，即刚才我们在 main.py 里面的 Logger 的名称，这样 core.py 里面的 Logger 就会复用 main.py 里面的 Logger 配置，而不用再去配置一次了。 运行之后会生成一个 result.log 文件，内容如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">56</span>,<span class="number">259</span> - main - INFO - Main Info</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">56</span>,<span class="number">259</span> - main - ERROR - Main Error</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">56</span>,<span class="number">259</span> - main.core - INFO - Core Info</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">56</span>,<span class="number">259</span> - main.core - ERROR - Core Error</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到父子模块都使用了同样的输出配置。 如此一来，我们只要在入口文件里面定义好 logging 模块的输出配置，子模块只需要在定义 Logger 对象时名称使用父模块的名称开头即可共享配置，非常方便。</p>
                  <h3 id="文件配置"><a href="#文件配置" class="headerlink" title="文件配置"></a>文件配置</h3>
                  <p>在开发过程中，将配置在代码里面写死并不是一个好的习惯，更好的做法是将配置写在配置文件里面，我们可以将配置写入到配置文件，然后运行时读取配置文件里面的配置，这样是更方便管理和维护的，下面我们以一个实例来说明一下，首先我们定义一个 yaml 配置文件：</p>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">version</span>: <span class="number">1</span></span><br><span class="line"><span class="attribute">formatters</span>:</span><br><span class="line">  <span class="attribute">brief</span>:</span><br><span class="line">    <span class="attribute">format</span>: <span class="string">"%(asctime)s - %(message)s"</span></span><br><span class="line">  <span class="attribute">simple</span>:</span><br><span class="line">    <span class="attribute">format</span>: <span class="string">"%(asctime)s - %(name)s - %(levelname)s - %(message)s"</span></span><br><span class="line"><span class="attribute">handlers</span>:</span><br><span class="line">  <span class="attribute">console</span>:</span><br><span class="line">    <span class="attribute">class </span>: logging.StreamHandler</span><br><span class="line">    <span class="attribute">formatter</span>: brief</span><br><span class="line">    <span class="attribute">level   </span>: INFO</span><br><span class="line">    <span class="attribute">stream  </span>: <span class="attribute">ext</span>:<span class="comment">//sys.stdout</span></span><br><span class="line">  <span class="attribute">file</span>:</span><br><span class="line">    <span class="attribute">class </span>: logging.FileHandler</span><br><span class="line">    <span class="attribute">formatter</span>: simple</span><br><span class="line">    <span class="attribute">level</span>: DEBUG</span><br><span class="line">    <span class="attribute">filename</span>: debug.log</span><br><span class="line">  <span class="attribute">error</span>:</span><br><span class="line">    <span class="attribute">class</span>: logging.handlers.RotatingFileHandler</span><br><span class="line">    <span class="attribute">level</span>: ERROR</span><br><span class="line">    <span class="attribute">formatter</span>: simple</span><br><span class="line">    <span class="attribute">filename</span>: error.log</span><br><span class="line">    <span class="attribute">maxBytes</span>: <span class="number">10485760</span></span><br><span class="line">    <span class="attribute">backupCount</span>: <span class="number">20</span></span><br><span class="line">    <span class="attribute">encoding</span>: utf8</span><br><span class="line"><span class="attribute">loggers</span>:</span><br><span class="line">  main.<span class="attribute">core</span>:</span><br><span class="line">    <span class="attribute">level</span>: DEBUG</span><br><span class="line">    <span class="attribute">handlers</span>: [console, file, error]</span><br><span class="line"><span class="attribute">root</span>:</span><br><span class="line">  <span class="attribute">level</span>: DEBUG</span><br><span class="line">  <span class="attribute">handlers</span>: [console]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们定义了 formatters、handlers、loggers、root 等模块，实际上对应的就是各个 Formatter、Handler、Logger 的配置，参数和它们的构造方法都是相同的。 接下来我们定义一个主入口文件，main.py，内容如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line">import core</span><br><span class="line">import yaml</span><br><span class="line">import logging.config</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def setup_logging(<span class="attribute">default_path</span>=<span class="string">'config.yaml'</span>, <span class="attribute">default_level</span>=logging.INFO):</span><br><span class="line">    path = default_path</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(path):</span><br><span class="line">        with open(path, <span class="string">'r'</span>, <span class="attribute">encoding</span>=<span class="string">'utf-8'</span>) as f:</span><br><span class="line">           <span class="built_in"> config </span>= yaml.load(f)</span><br><span class="line">            logging.config.dictConfig(config)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        logging.basicConfig(<span class="attribute">level</span>=default_level)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def log():</span><br><span class="line">    logging.<span class="builtin-name">debug</span>(<span class="string">'Start'</span>)</span><br><span class="line">    logging.<span class="builtin-name">info</span>(<span class="string">'Exec'</span>)</span><br><span class="line">    logging.<span class="builtin-name">info</span>(<span class="string">'Finished'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    yaml_path = <span class="string">'config.yaml'</span></span><br><span class="line">    setup_logging(yaml_path)</span><br><span class="line">    log()</span><br><span class="line">    core.<span class="builtin-name">run</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们定义了一个 setup_logging() 方法，里面读取了 yaml 文件的配置，然后通过 dictConfig() 方法将配置项传给了 logging 模块进行全局初始化。 另外这个模块还引入了另外一个模块 core，所以我们定义 core.py 如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">'main.core'</span>)</span><br><span class="line"></span><br><span class="line">def <span class="builtin-name">run</span>():</span><br><span class="line">    logger.<span class="builtin-name">info</span>(<span class="string">'Core Info'</span>)</span><br><span class="line">    logger.<span class="builtin-name">debug</span>(<span class="string">'Core Debug'</span>)</span><br><span class="line">    logger.<span class="builtin-name">error</span>(<span class="string">'Core Error'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个文件的内容和上文是没有什么变化的。 观察配置文件，主入口文件 main.py 实际上对应的是 root 一项配置，它指定了 handlers 是 console，即只输出到控制台。另外在 loggers 一项配置里面，我们定义了 main.core 模块，handlers 是 console、file、error 三项，即输出到控制台、输出到普通文件和回滚文件。 这样运行之后，我们便可以看到所有的运行结果输出到了控制台：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">727</span> - Exec</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">727</span> - Finished</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">727</span> - Core Info</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">727</span> - Core Info</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">728</span> - Core Error</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">728</span> - Core Error</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在 debug.log 文件中则包含了 core.py 的运行结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">727</span> - main.core - INFO - Core Info</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">727</span> - main.core - DEBUG - Core Debug</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">728</span> - main.core - ERROR - Core Error</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，通过配置文件，我们可以非常灵活地定义 Handler、Formatter、Logger 等配置，同时也显得非常直观，也非常容易维护，在实际项目中，推荐使用此种方式进行配置。 以上便是 logging 模块的基本使用方法，有了它，我们可以方便地进行日志管理和维护，会给我们的工作带来极大的方便。</p>
                  <h2 id="日志记录使用常见误区"><a href="#日志记录使用常见误区" class="headerlink" title="日志记录使用常见误区"></a>日志记录使用常见误区</h2>
                  <p>在日志输出的时候经常我们会用到字符串拼接的形式，很多情况下我们可能会使用字符串的 format() 来构造一个字符串，但这其实并不是一个好的方法，因为还有更好的方法，下面我们对比两个例子：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(<span class="attribute">level</span>=logging.DEBUG, <span class="attribute">format</span>=<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># bad</span></span><br><span class="line">logging.<span class="builtin-name">debug</span>(<span class="string">'Hello &#123;0&#125;, &#123;1&#125;!'</span>.format(<span class="string">'World'</span>, <span class="string">'Congratulations'</span>))</span><br><span class="line"><span class="comment"># good</span></span><br><span class="line">logging.<span class="builtin-name">debug</span>(<span class="string">'Hello %s, %s!'</span>, <span class="string">'World'</span>, <span class="string">'Congratulations'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里有两种打印 Log 的方法，第一种使用了字符串的 format() 的方法进行构造，传给 logging 的只用到了第一个参数，实际上 logging 模块提供了字符串格式化的方法，我们只需要在第一个参数写上要打印输出的模板，占位符用 %s、%d 等表示即可，然后在后续参数添加对应的值就可以了，推荐使用这种方法。 运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">22</span>:<span class="number">27</span>:<span class="number">51</span>,<span class="number">220</span> - root - DEBUG - Hello World, Congratulations!</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">22</span>:<span class="number">27</span>:<span class="number">51</span>,<span class="number">220</span> - root - DEBUG - Hello World, Congratulations!</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><img src="https://user-gold-cdn.xitu.io/2018/6/3/163c618ce73174a9?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p>
                  <p>另外在进行异常处理的时候，通常我们会直接将异常进行字符串格式化，但其实可以直接指定一个参数将 traceback 打印出来，示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(<span class="attribute">level</span>=logging.DEBUG, <span class="attribute">format</span>=<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    result = 5 / 0</span><br><span class="line">except Exception as e:</span><br><span class="line">    # bad</span><br><span class="line">    logging.<span class="builtin-name">error</span>(<span class="string">'Error: %s'</span>, e)</span><br><span class="line">    # good</span><br><span class="line">    logging.<span class="builtin-name">error</span>(<span class="string">'Error'</span>, <span class="attribute">exc_info</span>=<span class="literal">True</span>)</span><br><span class="line">    # good</span><br><span class="line">    logging.exception(<span class="string">'Error'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果我们直接使用字符串格式化的方法将错误输出的话，是不会包含 Traceback 信息的，但如果我们加上 exc_info 参数或者直接使用 exception() 方法打印的话，那就会输出 Traceback 信息了。 运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">22</span>:<span class="number">24</span>:<span class="number">31</span>,<span class="number">927</span> - root - ERROR - Error: division by zero</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">22</span>:<span class="number">24</span>:<span class="number">31</span>,<span class="number">927</span> - root - ERROR - Error</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/private/var/books/aicodes/loggingtest/demo9.py"</span>, line <span class="number">6</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    result = <span class="number">5</span> / <span class="number">0</span></span><br><span class="line">ZeroDivisionError: division by zero</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">22</span>:<span class="number">24</span>:<span class="number">31</span>,<span class="number">928</span> - root - ERROR - Error</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/private/var/books/aicodes/loggingtest/demo9.py"</span>, line <span class="number">6</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    result = <span class="number">5</span> / <span class="number">0</span></span><br><span class="line">ZeroDivisionError: division by zero</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><img src="https://user-gold-cdn.xitu.io/2018/6/3/163c618f69092989?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p>
                  <p>以上便是整个对 logging 模块的介绍。嗯，是时候抛弃 print 了，开始体验下 logging 的便利吧！</p>
                  <h2 id="参考内容"><a href="#参考内容" class="headerlink" title="参考内容"></a>参考内容</h2>
                  <ul>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy9saWJyYXJ5L2xvZ2dpbmcuaHRtbA==">https://docs.python.org/3/library/logging.html<i class="fa fa-external-link-alt"></i></span> * <span class="exturl" data-url="aHR0cDovL3d3dy5jbmJsb2dzLmNvbS9kYWh1LWRhcWluZy9wLzcwNDA3NjQuaHRtbA==">http://www.cnblogs.com/dahu-daqing/p/7040764.html<i class="fa fa-external-link-alt"></i></span></li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-06-03 23:38:38" itemprop="dateCreated datePublished" datetime="2018-06-03T23:38:38+08:00">2018-06-03</time>
                </span>
                <span id="/6080.html" class="post-meta-item leancloud_visitors" data-flag-title="Python中logging模块的基本用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>16k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>14 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6009.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6009.html" class="post-title-link" itemprop="url">《Python3网络爬虫开发实战》来了！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="2022-年最新第二版《Python3-网络爬虫开发实战》"><a href="#2022-年最新第二版《Python3-网络爬虫开发实战》" class="headerlink" title="2022 年最新第二版《Python3 网络爬虫开发实战》"></a>2022 年最新第二版《Python3 网络爬虫开发实战》</h2>
                  <p>现在《Python3 网络爬虫开发实战（第二版）》已经在 2021 年底正式上市了～<br>之前第一版的爬虫书《Python3 网络爬虫开发实战》在 2018 年出版，上市三年来，一直处于市面上所有爬虫书的<strong>销冠</strong>位置，豆瓣评分 9.0 分，销量 10w 册。</p>
                  <p>如今，这本书现在又进一步做了升级，第二版将案例进行了全面升级，自建了案例平台防止代码过期，同时增加了非常多的新技术、新知识的介绍，比如异步爬虫、JavaScript 逆向、安卓逆向、Kubernetes、智能解析。</p>
                  <blockquote>
                    <p>可以说，目前市面上的爬虫书，其他的书跟这本书相比，内容方面这本书的算是最全的，<strong>没有之一</strong>。能将最前沿的爬虫技术比如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、Kubernetes 等技术都涵盖的，目前应该就是本新发布的《Python3 网络爬虫开发实战（第二版）》了。</p>
                  </blockquote>
                  <p>就是这本：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/qat62.jpg" alt=""></p>
                  <p>2018 年 5 月《Python3 网络爬虫开发实战》的第一版出版了，从上市到现在三年多销量约 10w 册。后来，由于一些技术更迭，第二版书开始策划中。</p>
                  <p>2021 年 11 月，这本书历经各种反复修改、审稿等阶段，到今天终于上架了！</p>
                  <h2 id="第二版更新内容"><a href="#第二版更新内容" class="headerlink" title="第二版更新内容"></a>第二版更新内容</h2>
                  <p>大家第一个问题可能就会问，第二版比第一版更新了哪些内容？</p>
                  <p>因为技术总是在不断发展和进步的，爬虫技术也是一样，它在爬虫和反爬虫不断斗争的过程中也在不断演进。比如现在越来越多的网页采取了各种防护措施，比如前端代码的压缩和混淆、API 的参数加密、WebDriver 的检测，要做到高效的数据爬取，我们就需要懂得一些 JavaScript 逆向分析相关技术。App 也是一样，App 的抓包防护、加壳保护、Native 化、风控检测使得越来越多的 App 数据难以爬取，所以我们也不得不了解一些逆向相关技术，如 Xposed、Frida、IDA Pro 等工具的使用。除此之外，近几年深度学习和人工智能发展得也是如火如荼，所以爬虫也可以和人工智能结合起来，比如基于深度学习的验证码识别、网页内容的智能化解析和提取等技术我们也可以进行学习和了解。另外，一些大规模爬虫的管理和运维技术也在不断发展，当前 Kubernetes、Docker、Prometheus 等云原生技术也非常火爆，基于 Kubernetes 等云原生技术的爬虫管理和运维解决方案也已经很受青睐。然而，之前第一版书对以上提到的这些新兴技术几乎没有提及。</p>
                  <p>除此之外，第一版书在讲解数据爬取的过程中引用了很多案例和服务，比如猫眼电影网站、淘宝网站、代理服务网站，然而几年过去了，有些案例网站和服务早已经改版或者停止维护，这就导致第一版书中的很多案例已经不能正常运行了。这其实是一个很大的问题，因为程序运行不通会大大降低学习的积极性和成就感，而且会浪费不少时间。另外，即使案例对应的爬虫代码及时更新了，那我们也不知道这些案例网站和服务什么时候会再次改版，因为这都是不可控的。所以，为了彻底解决这个问题，我花费了近半年的时间构建了一个爬虫案例平台（<span class="exturl" data-url="aHR0cHM6Ly9zY3JhcGUuY2VudGVy">https://scrape.center<i class="fa fa-external-link-alt"></i></span>），平台包含了几十个爬虫案例，包括服务端渲染（SSR）网站、单页面应用（SPA）网站、各类反爬网站、验证码网站、模拟登录网站、各类 App 等，覆盖了现在爬虫和反爬虫相关的大多数技术，整个平台都是我来维护的，书中几乎所有案例都是从案例平台来的，从而解决了页面改版的问题。</p>
                  <p>所以，本书相比第一版来说，更新的内容主要如下：</p>
                  <ul>
                    <li>
                      <p>绝大多数都迁移到了自建的案例平台，以后再也不用担心案例有过期或改版问题。</p>
                    </li>
                    <li>
                      <p>替换了原本第一章环境安装的章节，将环境配置的部分全部汇总并迁移到案例平台（<span class="exturl" data-url="aHR0cHM6Ly9zZXR1cC5zY3JhcGUuY2VudGVy">https://setup.scrape.center<i class="fa fa-external-link-alt"></i></span>）并在书中以外链的形式附上，以确保环境的配置和安装说明能够被及时更新。</p>
                    </li>
                    <li>
                      <p>增加了一些新的请求库、解析库、存储库等的介绍，如 httpx、parsel、Elasticsearch 等库的介绍。</p>
                    </li>
                    <li>
                      <p>增加了异步爬虫的介绍，如协程的基本原理、aiohttp 的使用和爬取实战介绍。</p>
                    </li>
                    <li>
                      <p>增加了一些新兴自动化工具的介绍，如 Pyppeteer、Playwright 的介绍。</p>
                    </li>
                    <li>
                      <p>增加了深度学习相关内容，如图形验证码、滑动验证码的识别方案。</p>
                    </li>
                    <li>
                      <p>丰富了模拟登录章节的内容，如增加了 JWT 模拟登录的介绍和实战、大规模账号池的优化。</p>
                    </li>
                    <li>
                      <p>增加了 JavaScript 逆向的章节，包括网站加密和混淆技术、JavaScript 逆向调试技巧、JavaScript 的各种模拟执行方式、AST 还原混淆代码、WebAssembly 等相关技术的介绍。</p>
                    </li>
                    <li>
                      <p>丰富了 App 自动化爬取技术的章节，如新兴框架 Airtest 的介绍、手机群控和云手机技术的介绍。</p>
                    </li>
                    <li>
                      <p>增加了 Android 逆向章节，如反编译、反汇编、Hook、脱壳、so 文件分析和模拟执行等技术的介绍。</p>
                    </li>
                    <li>
                      <p>增加了网页智能化解析章节，包括列表页、详情页内容提取算法和分类算法。</p>
                    </li>
                    <li>
                      <p>丰富了 Scrapy 相关章节的介绍，如 Pyppeteer 的对接、RabbitMQ 的对接、Prometheus 的对接等。</p>
                    </li>
                    <li>
                      <p>增加了基于 Kubernetes、Docker、Prometheus、Grafana 等云原生技术爬虫管理和运维解决方案的介绍。</p>
                    </li>
                  </ul>
                  <p>以上就是第二版的主要更新内容。</p>
                  <h2 id="章节介绍"><a href="#章节介绍" class="headerlink" title="章节介绍"></a>章节介绍</h2>
                  <p>为了让大家更直接地了解到全书的内容，这里就直接放目录了：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/r21da.png" alt=""></p>
                  <p><img src="https://qiniu.cuiqingcai.com/sjp39.png" alt=""></p>
                  <p>没错！全书一共 900 多页，量了下有 4.3 厘米厚，定价是 139.8 元。</p>
                  <h2 id="可以直接看第二版吗？"><a href="#可以直接看第二版吗？" class="headerlink" title="可以直接看第二版吗？"></a>可以直接看第二版吗？</h2>
                  <p>当然，有朋友也会担心，我需不需要先学习第一版，然后才能学第二版呢？</p>
                  <p>答案是：可以直接学第二版，第二版书爬虫的内容知识体系是完整的，一些旧的技术已经在第一版中移除，第二版的书籍是对所有爬虫知识体系的全新升级。</p>
                  <h2 id="没有基础可以学吗？"><a href="#没有基础可以学吗？" class="headerlink" title="没有基础可以学吗？"></a>没有基础可以学吗？</h2>
                  <p>有朋友也可能会问，没有爬虫或者 Python 基础可以学吗？</p>
                  <p>答案是：可以，本书就是专为零爬虫基础的朋友准备的，本书从最基础的环境配置、基础知识的讲解开始，循序渐进地对爬虫的各个知识点进行介绍，所以完全不用担心没有爬虫基础学不会的问题。如果没有 Python 基础，那也没关系（当然有会更好），书中也会提及 Python 环境的配置并附上一些 Python 入门学习资料（链接），同时也会通过各个 Python 代码片段来进行讲解，很多案例也很简单易懂，学爬虫的时候 Python 也就会逐渐掌握了。</p>
                  <h2 id="大咖推荐"><a href="#大咖推荐" class="headerlink" title="大咖推荐"></a>大咖推荐</h2>
                  <p>这本书同时还获得了 Python 之父的推荐（没错就是 Python 的创始人，Guido van Rossum）。另外我还有幸获得了微软亚洲互联网工程院副院长曾文峰、知名爬虫专家梁斌 penny、中国人民大学高瓴人工智能学院长聘副教授宋睿华的推荐。</p>
                  <p>下面是推荐语的内容：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/dpw4v.png" alt=""></p>
                  <h2 id="宣传彩页"><a href="#宣传彩页" class="headerlink" title="宣传彩页"></a>宣传彩页</h2>
                  <p>另外编辑还为本书制作了几张宣传彩页，是对整本书的一个宣传介绍，大家可以看下：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/vliby.png" alt=""></p>
                  <h2 id="有没有电子版？"><a href="#有没有电子版？" class="headerlink" title="有没有电子版？"></a>有没有电子版？</h2>
                  <p>看到这里，大家可能也会问了，有没有电子版呢？可能有的朋友习惯用电子版书籍来学习，有的朋友可能在海外也不方便购买，所以想要电子版。</p>
                  <p>但还是很遗憾地说：没有电子版。</p>
                  <p>因为你知道的，如果出了电子版，那么马上就会有各种盗版袭来，网上也会造成各种恶意传播。</p>
                  <p>所以，为了保护版权，这本书是没有上电子版的。</p>
                  <h2 id="购买链接"><a href="#购买链接" class="headerlink" title="购买链接"></a>购买链接</h2>
                  <p>是的，最后就是大家最关心的部分了，到哪里能够买到呢？</p>
                  <p>购买链接：<span class="exturl" data-url="aHR0cHM6Ly9pdGVtLmpkLmNvbS8xMzUyNzIyMi5odG1s">https://item.jd.com/13527222.html<i class="fa fa-external-link-alt"></i></span></p>
                  <p>为了方便购买，我把这个链接转成了二维码，大家可以直接扫码购买：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/1rhg8.png" alt=""></p>
                  <p>谢谢大家支持！</p>
                  <h2 id="2018-年第一版爬虫书"><a href="#2018-年第一版爬虫书" class="headerlink" title="2018 年第一版爬虫书"></a>2018 年第一版爬虫书</h2>
                  <p>以下是 2018 年第一版《Python3 网络爬虫开发实战》简介。</p>
                  <p>嗨~ 给大家重磅推荐一本新书！还未上市前就已经重印 3 次的 Python 爬虫书！那么它就是由静觅博客博主崔庆才所作的《Python3 网络爬虫开发实战》！！！ <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/05/Python-3网格爬虫开发实战-立体图-857x1100-857x1100.jpg" alt=""></p>
                  <h2 id="书籍介绍"><a href="#书籍介绍" class="headerlink" title="书籍介绍"></a><strong>书籍介绍</strong></h2>
                  <p>本书<strong>《Python3 网络爬虫开发实战》</strong>全面介绍了利用 Python3 开发网络爬虫的知识，书中首先详细介绍了各种类型的环境配置过程和爬虫基础知识，还讨论了 urllib、requests 等请求库和 Beautiful Soup、XPath、pyquery 等解析库以及文本和各类数据库的存储方法，另外本书通过多个真实新鲜案例介绍了分析 Ajax 进行数据爬取，Selenium 和 Splash 进行动态网站爬取的过程，接着又分享了一些切实可行的爬虫技巧，比如使用代理爬取和维护动态代理池的方法、ADSL 拨号代理的使用、各类验证码（图形、极验、点触、宫格等）的破解方法、模拟登录网站爬取的方法及 Cookies 池的维护等等。 此外，本书的内容还远远不止这些，作者还结合移动互联网的特点探讨了使用 Charles、mitmdump、Appium 等多种工具实现 App 抓包分析、加密参数接口爬取、微信朋友圈爬取的方法。此外本书还详细介绍了 pyspider 框架、Scrapy 框架的使用和分布式爬虫的知识，另外对于优化及部署工作，本书还包括 Bloom Filter 效率优化、Docker 和 Scrapyd 爬虫部署、分布式爬虫管理框架 Gerapy 的分享。 全书共 604 页，足足两斤重呢~ 定价为 99 元！</p>
                  <h2 id="作者介绍"><a href="#作者介绍" class="headerlink" title="作者介绍"></a><strong>作者介绍</strong></h2>
                  <p>看书就先看看谁写的嘛，我们来了解一下~ 崔庆才，静觅博客博主（<span class="exturl" data-url="aHR0cHM6Ly9jdWlxaW5nY2FpLmNvbe+8ie+8jOWNmuWuog==">https://cuiqingcai.com），博客<i class="fa fa-external-link-alt"></i></span> Python 爬虫博文已过百万，北京航空航天大学硕士，微软小冰大数据工程师，有多个大型分布式爬虫项目经验，乐于技术分享，文章通俗易懂 ^<em>^ 附皂片一张 ~(@^</em>^@)~ <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/WechatIMG785-825x1100.jpeg" alt=""></p>
                  <h2 id="图文介绍"><a href="#图文介绍" class="headerlink" title="图文介绍"></a><strong>图文介绍</strong></h2>
                  <p>呕心沥血设计的宣传图也得放一下~ <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/WechatIMG556.jpeg" alt=""></p>
                  <h2 id="专家评论"><a href="#专家评论" class="headerlink" title="专家评论"></a><strong>专家评论</strong></h2>
                  <p>书是好是坏，得让专家看评一评呀，那么下面就是几位专家的精彩评论，快来看看吧~ 在互联网软件开发工程师的分类中，爬虫工程师是非常重要的。爬虫工作往往是一个公司核心业务开展的基础，数据抓取下来，才有后续的加工处理和最终展现。此时数据的抓取规模、稳定性、实时性、准确性就显得非常重要。早期的互联网充分开放互联，数据获取的难度很小。随着各大公司对数据资产日益看重，反爬水平也在不断提高，各种新技术不断给爬虫软件提出新的课题。本书作者对爬虫的各个领域都有深刻研究，书中探讨了 Ajax 数据的抓取、动态渲染页面的抓取、验证码识别、模拟登录等高级话题，同时也结合移动互联网的特点探讨了 App 的抓取等。更重要的是，本书提供了大量源码，可以帮助读者更好地理解相关内容。强烈推荐给各位技术爱好者阅读！</p>
                  <p><strong>——梁斌</strong>，八友科技总经理</p>
                  <p>数据既是当今大数据分析的前提，也是各种人工智能应用场景的基础。得数据者得天下，会爬虫者走遍天下也不怕！一册在手，让小白到老司机都能有所收获！</p>
                  <p><strong>——李舟军</strong>，北京航空航天大学教授，博士生导师</p>
                  <p>本书从爬虫入门到分布式抓取，详细介绍了爬虫技术的各个要点，并针对不同的场景提出了对应的解决方案。另外，书中通过大量的实例来帮助读者更好地学习爬虫技术，通俗易懂，干货满满。强烈推荐给大家！</p>
                  <p><strong>——宋睿华</strong>，微软小冰首席科学家</p>
                  <p>有人说中国互联网的带宽全给各种爬虫占据了，这说明网络爬虫的重要性以及中国互联网数据封闭垄断的现状。爬是一种能力，爬是为了不爬。</p>
                  <p><strong>——施水才</strong>，北京拓尔思信息技术股份有限公司总裁</p>
                  <h2 id="全书目录"><a href="#全书目录" class="headerlink" title="全书目录"></a><strong>全书目录</strong></h2>
                  <p>书的目录也有~ 看这里！</p>
                  <ul>
                    <li><strong>1-开发环境配置</strong></li>
                    <li>1.1-Python3 的安装</li>
                    <li>1.2-请求库的安装</li>
                    <li>1.3-解析库的安装</li>
                    <li>1.4-数据库的安装</li>
                    <li>1.5-存储库的安装</li>
                    <li>1.6-Web 库的安装</li>
                    <li>1.7-App 爬取相关库的安装</li>
                    <li>1.8-爬虫框架的安装</li>
                    <li>1.9-部署相关库的安装</li>
                    <li><strong>2-爬虫基础</strong></li>
                    <li>2.1-HTTP 基本原理</li>
                    <li>2.2-网页基础</li>
                    <li>2.3-爬虫的基本原理</li>
                    <li>2.4-会话和 Cookies</li>
                    <li>2.5-代理的基本原理</li>
                    <li><strong>3-基本库的使用</strong></li>
                    <li>3.1-使用 urllib</li>
                    <li>3.1.1-发送请求</li>
                    <li>3.1.2-处理异常</li>
                    <li>3.1.3-解析链接</li>
                    <li>3.1.4-分析 Robots 协议</li>
                    <li>3.2-使用 requests</li>
                    <li>3.2.1-基本用法</li>
                    <li>3.2.2-高级用法</li>
                    <li>3.3-正则表达式</li>
                    <li>3.4-抓取猫眼电影排行</li>
                    <li><strong>4-解析库的使用</strong></li>
                    <li>4.1-使用 XPath</li>
                    <li>4.2-使用 Beautiful Soup</li>
                    <li>4.3-使用 pyquery</li>
                    <li><strong>5-数据存储</strong></li>
                    <li>5.1-文件存储</li>
                    <li>5.1.1-TXT 文本存储</li>
                    <li>5.1.2-JSON 文件存储</li>
                    <li>5.1.3-CSV 文件存储</li>
                    <li>5.2-关系型数据库存储</li>
                    <li>5.2.1-MySQL 存储</li>
                    <li>5.3-非关系型数据库存储</li>
                    <li>5.3.1-MongoDB 存储</li>
                    <li>5.3.2-Redis 存储</li>
                    <li><strong>6-Ajax 数据爬取</strong></li>
                    <li>6.1-什么是 Ajax</li>
                    <li>6.2-Ajax 分析方法</li>
                    <li>6.3-Ajax 结果提取</li>
                    <li>6.4-分析 Ajax 爬取今日头条街拍美图</li>
                    <li><strong>7-动态渲染页面爬取</strong></li>
                    <li>7.1-Selenium 的使用</li>
                    <li>7.2-Splash 的使用</li>
                    <li>7.3-Splash 负载均衡配置</li>
                    <li>7.4-使用 Selenium 爬取淘宝商品</li>
                    <li><strong>8-验证码的识别</strong></li>
                    <li>8.1-图形验证码的识别</li>
                    <li>8.2-极验滑动验证码的识别</li>
                    <li>8.3-点触验证码的识别</li>
                    <li>8.4-微博宫格验证码的识别</li>
                    <li><strong>9-代理的使用</strong></li>
                    <li>9.1-代理的设置</li>
                    <li>9.2-代理池的维护</li>
                    <li>9.3-付费代理的使用</li>
                    <li>9.4-ADSL 拨号代理</li>
                    <li>9.5-使用代理爬取微信公众号文章</li>
                    <li><strong>10-模拟登录</strong></li>
                    <li>10.1-模拟登录并爬取 GitHub</li>
                    <li>10.2-Cookies 池的搭建</li>
                    <li><strong>11-App 的爬取</strong></li>
                    <li>11.1-Charles 的使用</li>
                    <li>11.2-mitmproxy 的使用</li>
                    <li>11.3-mitmdump 爬取“得到”App 电子书信息</li>
                    <li>11.4-Appium 的基本使用</li>
                    <li>11.5-Appium 爬取微信朋友圈</li>
                    <li>11.6-Appium+mitmdump 爬取京东商品</li>
                    <li><strong>12-pyspider 框架的使用</strong></li>
                    <li>12.1-pyspider 框架介绍</li>
                    <li>12.2-pyspider 的基本使用</li>
                    <li>12.3-pyspider 用法详解</li>
                    <li><strong>13-Scrapy 框架的使用</strong></li>
                    <li>13.1-Scrapy 框架介绍</li>
                    <li>13.2-Scrapy 入门</li>
                    <li>13.3-Selector 的用法</li>
                    <li>13.4-Spider 的用法</li>
                    <li>13.5-Downloader Middleware 的用法</li>
                    <li>13.6-Spider Middleware 的用法</li>
                    <li>13.7-Item Pipeline 的用法</li>
                    <li>13.8-Scrapy 对接 Selenium</li>
                    <li>13.9-Scrapy 对接 Splash</li>
                    <li>13.10-Scrapy 通用爬虫</li>
                    <li>13.11-Scrapyrt 的使用</li>
                    <li>13.12-Scrapy 对接 Docker</li>
                    <li>13.13-Scrapy 爬取新浪微博</li>
                    <li><strong>14-分布式爬虫</strong></li>
                    <li>14.1-分布式爬虫原理</li>
                    <li>14.2-Scrapy-Redis 源码解析</li>
                    <li>14.3-Scrapy 分布式实现</li>
                    <li>14.4-Bloom Filter 的对接</li>
                    <li><strong>15-分布式爬虫的部署</strong></li>
                    <li>15.1-Scrapyd 分布式部署</li>
                    <li>15.2-Scrapyd-Client 的使用</li>
                    <li>15.3-Scrapyd 对接 Docker</li>
                    <li>15.4-Scrapyd 批量部署</li>
                    <li>15.5-Gerapy 分布式管理</li>
                  </ul>
                  <h2 id="购买链接-1"><a href="#购买链接-1" class="headerlink" title="购买链接"></a><strong>购买链接</strong></h2>
                  <p>想必很多小伙伴已经等了很久了，之前预售那么久也一直迟迟没有货，发售就有不少网店又售空了，不过现在起不用担心了！</p>
                  <p>书籍现已在京东、天猫、当当等网店上架并全面供应啦，复制链接到浏览器打开或扫描二维码打开即可购买了！</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/京东二维码.png" alt=""></p>
                  <p>京东商城</p>
                  <p><span class="exturl" data-url="aHR0cHM6Ly9pdGVtLmpkLmNvbS8xMjMzMzU0MC5odG1s">https://item.jd.com/12333540.html<i class="fa fa-external-link-alt"></i></span></p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/天猫二维码.png" alt=""></p>
                  <p>天猫商城</p>
                  <p><span class="exturl" data-url="aHR0cHM6Ly9kZXRhaWwudG1hbGwuY29tL2l0ZW0uaHRtP2lkPTU2NjY5OTcwMzkxNw==">https://detail.tmall.com/item.htm?id=566699703917<i class="fa fa-external-link-alt"></i></span></p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/当当二维码.png" alt=""></p>
                  <p>当当网</p>
                  <p><span class="exturl" data-url="aHR0cDovL3Byb2R1Y3QuZGFuZ2RhbmcuY29tLzI1MjQ5NjAyLmh0bWw=">http://product.dangdang.com/25249602.html<i class="fa fa-external-link-alt"></i></span></p>
                  <p>欢迎大家购买，谢谢支持！O(∩_∩)O</p>
                  <h2 id="免费预览"><a href="#免费预览" class="headerlink" title="免费预览"></a><strong>免费预览</strong></h2>
                  <p>不放心？想先看看有些啥，没问题！看这里： 免费章节试读（复制粘贴至浏览器打开）： <a href="https://cuiqingcai.com/5052.html">https://cuiqingcai.com/5052.html</a> 将一直免费开放<strong>前 7 章节</strong>，欢迎大家试读！</p>
                  <h2 id="视频教程"><a href="#视频教程" class="headerlink" title="视频教程"></a>视频教程</h2>
                  <p>当然除了书籍，也有配套的视频课程，作者同样是崔庆才，二者结合学习效果更佳！限时优惠折扣中！扫描下图中二维码即可了解详情！ <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/%E8%AF%BE%E7%A8%8B%E5%AE%A3%E4%BC%A0%E5%9B%BE.png" alt=""> 视频教程链接： <span class="exturl" data-url="aHR0cHM6Ly9lZHUuaGVsbG9iaS5jb20vY291cnNlLzE1Nw==">https://edu.hellobi.com/course/157<i class="fa fa-external-link-alt"></i></span> <span class="exturl" data-url="aHR0cDovL3N0dWR5LjE2My5jb20vY291cnNlL2NvdXJzZU1haW4uaHRtP2NvdXJzZUlkPTEwMDM4MjcwMzk=">http://study.163.com/course/courseMain.htm?courseId=1003827039<i class="fa fa-external-link-alt"></i></span> 感谢大家支持！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-05-04 21:36:24" itemprop="dateCreated datePublished" datetime="2018-05-04T21:36:24+08:00">2018-05-04</time>
                </span>
                <span id="/6009.html" class="post-meta-item leancloud_visitors" data-flag-title="《Python3网络爬虫开发实战》来了！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5984.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5984.html" class="post-title-link" itemprop="url">Flask 静态文件缓存问题</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="大家好，今天才发现很多学习Flask的小伙伴都有这么一个问题，清理缓存好麻烦啊，今天就教大家怎么解决。"><a href="#大家好，今天才发现很多学习Flask的小伙伴都有这么一个问题，清理缓存好麻烦啊，今天就教大家怎么解决。" class="headerlink" title="大家好，今天才发现很多学习Flask的小伙伴都有这么一个问题，清理缓存好麻烦啊，今天就教大家怎么解决。"></a>大家好，今天才发现很多学习Flask的小伙伴都有这么一个问题，清理缓存好麻烦啊，今天就教大家怎么解决。</h1>
                  <p>大家在使用Flask静态文件的时候，每次更新，发现CSS或是Js或者其他的文件不会更新。 这是因为浏览器的缓存问题。 普遍大家是这几步解决办法。</p>
                  <ul>
                    <li><strong>清理浏览器缓存</strong></li>
                    <li><strong>设置浏览器不缓存</strong></li>
                    <li>也有以下这么写的</li>
                  </ul>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">@app.context_processor</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">override_url_for</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> dict(url_for=dated_url_for)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dated_url_for</span><span class="params">(endpoint, **values)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> endpoint == <span class="string">'static'</span>:</span><br><span class="line">        filename = values.get(<span class="string">'filename'</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">if</span> filename:</span><br><span class="line">        file_path = os.path.join(app.root_path, endpoint, filename)</span><br><span class="line">        values[<span class="string">'q'</span>] = int(os.stat(file_path).st_mtime)</span><br><span class="line">        <span class="keyword">return</span> url_for(endpoint, **values)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果是我，我不会这么做，效率很低。 <img src="https://note.youdao.com/yws/api/personal/file/WEB509e95a33af9869430a40426c0ebf665?method=download&amp;shareKey=be706f1bce4b10e5d615e902e712b2d0" alt=""> 这是 Flask的 <strong><code>config</code></strong> 的源码，里面可以看到，有设置缓存最大时间 <strong><code>SEND_FILE_MAX_AGE_DEFAULT</code></strong> 可以看到，它是一个 <strong>temedelta</strong> 的值 <strong>我们去更改配置。</strong> <img src="https://note.youdao.com/yws/api/personal/file/WEB2929bc40de12a0530fcad5b9bdd8e2bc?method=download&amp;shareKey=72db34d3085f531add452f0ae8517041" alt=""> 第2行: <strong>我们引入了<code>datetime</code>的<code>timedelta</code>对象</strong> 第6行: <strong>我们配置缓存最大时间</strong> <strong>这样就解决了缓存问题，不用去写多余的代码，不用去清理浏览器的缓存。</strong> <strong>一定要学着去看官方文档和框架的源代码！！</strong> </p>
                  <p><strong>有什么问题请联系</strong></p>
                  <p>[caption id=”attachment_5953” align=”aligncenter” width=”320”]<img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/04/WechatIMG1-1-320x320.jpeg" alt=""> 微信二维码[/caption]</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/蒋翔宇" class="author" itemprop="url" rel="index">蒋翔宇</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-04-15 12:19:10" itemprop="dateCreated datePublished" datetime="2018-04-15T12:19:10+08:00">2018-04-15</time>
                </span>
                <span id="/5984.html" class="post-meta-item leancloud_visitors" data-flag-title="Flask 静态文件缓存问题" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>751</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5876.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Linux <i class="label-arrow"></i>
                  </a>
                  <a href="/5876.html" class="post-title-link" itemprop="url">SSH反向隧道搭建过程</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>现在我们有一台内网主机 A，在局域网内是可以访问的，但是如果我们现在不处在局域网内，可以选择 VPN 连接，但这样其实并不太方便，所以本节我们来说明一下利用 SSH 反向隧道来实现访问内网主机的方法。</p>
                  <h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2>
                  <p>首先我们需要有一台公网主机作为跳板，这台主机是可以公网访问的，我们将其命名为 B，它的 IP 假设为 10.10.10.10。 所以两台机器网络配置如下：</p>
                  <h3 id="A-内网机器"><a href="#A-内网机器" class="headerlink" title="A 内网机器"></a>A 内网机器</h3>
                  <ul>
                    <li>IP：192.168.1.2</li>
                    <li>SSH端口： 22</li>
                    <li>用户名：usera</li>
                    <li>密码：passworda</li>
                    <li>内网配置端口：22（即配置 SSH 端口的反向隧道）</li>
                  </ul>
                  <h3 id="B-公网机器"><a href="#B-公网机器" class="headerlink" title="B 公网机器"></a>B 公网机器</h3>
                  <ul>
                    <li>IP：10.10.10.10</li>
                    <li>SSH端口： 22</li>
                    <li>用户名：userb</li>
                    <li>密码：passwordb</li>
                    <li>公网端口：22001（即用 B 的 22001 端口连到 A 的 SSH 22 端口）</li>
                  </ul>
                  <h2 id="配置SSH秘钥"><a href="#配置SSH秘钥" class="headerlink" title="配置SSH秘钥"></a>配置SSH秘钥</h2>
                  <p>首先我们需要在 A 主机上生成 SSH 秘钥，和 B 用 SSH 建立认证。 首先在主机 A 上执行如下命令生成 SSH 秘钥：</p>
                  <figure class="highlight excel">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ssh-keygen -<span class="built_in">t</span> rsa -C <span class="string">"your@email.com"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>命令里面的邮箱需要自行更换。 然后利用如下命令将 A 的 SSH 秘钥添加到 B 的 authorized_keys 里面：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ssh-copy-id <span class="symbol">userb@</span><span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>执行后会提示输入主机 B 的密码，执行完毕之后，我们登录到 B，就发现 authorized_keys 里面就多了 A 的 SSH 公钥了，成功建立 SSH 认证。</p>
                  <h2 id="B-主机配置"><a href="#B-主机配置" class="headerlink" title="B 主机配置"></a>B 主机配置</h2>
                  <p>B 主机需要更改 /etc/ssh/sshd_config 文件，修改如下一行：</p>
                  <figure class="highlight nginx">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">GatewayPorts</span> <span class="literal">yes</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样可以把监听的端口绑定到任意IP 0.0.0.0上，否则只有本机 127.0.0.1 可以访问。 然后重启 sshd 服务：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo<span class="built_in"> service </span>sshd restart</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="A-主机配置"><a href="#A-主机配置" class="headerlink" title="A 主机配置"></a>A 主机配置</h2>
                  <p>主机 A 再安装一个 AutoSSH，以 Ubuntu 为例，命令如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install autossh</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后执行如下命令即可完成反向 SSH 配置：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">auto</span>ssh -M <span class="number">55555</span> -NfR <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">22001</span>:localhost:<span class="number">22</span> <span class="symbol">userb@</span><span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 -M 后面任意填写一个可用端口即可，-N 代表只建立连接，不打开shell ，-f 代表建立成功后在后台运行，-R 代表指定端口映射。 这里是将 A 主机的 22 端口映射到 B 主机的 22001 端口，这样就完成了配置。 主要我们再访问 B 主机的 22001 端口，就会自动转发到 A 主机的 22 端口了，即可以公网访问了。</p>
                  <h2 id="连接测试"><a href="#连接测试" class="headerlink" title="连接测试"></a>连接测试</h2>
                  <p>接下来 SSH 测试连接 A 主机即可：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ssh <span class="symbol">usera@</span><span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span> -p <span class="number">22001</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输入密码，完成连接。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-03-26 02:39:00" itemprop="dateCreated datePublished" datetime="2018-03-26T02:39:00+08:00">2018-03-26</time>
                </span>
                <span id="/5876.html" class="post-meta-item leancloud_visitors" data-flag-title="SSH反向隧道搭建过程" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5873.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5873.html" class="post-title-link" itemprop="url">Attention原理及TensorFlow AttentionWrapper源码解析</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本节来详细说明一下 Seq2Seq 模型中一个非常有用的 Attention 的机制，并结合 TensorFlow 中的 AttentionWrapper 来剖析一下其代码实现。</p>
                  <h2 id="Seq2Seq"><a href="#Seq2Seq" class="headerlink" title="Seq2Seq"></a><a href="https://github.com/Germey/AI/blob/master/Attention%E5%8E%9F%E7%90%86%E5%8F%8ATensorFlow%20AttentionWrapper%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.md#seq2seq" target="_blank" rel="noopener"></a>Seq2Seq</h2>
                  <p>首先来简单说明一下 Seq2Seq 模型，如果搞过深度学习，想必一定听说过 Seq2Seq 模型，Seq2Seq 其实就是 Sequence to Sequence，也简称 S2S，也可以称之为 Encoder-Decoder 模型，这个模型的核心就是编码器（Encoder）和解码器（Decoder）组成的，架构雏形是在 2014 年由论文 <span class="exturl" data-url="aHR0cHM6Ly9hcnhpdi5vcmcvYWJzLzE0MDYuMTA3OA==">Learning Phrase Representations using RNN Encoder-Decoder for Statistical Machine Translation, Cho et al<i class="fa fa-external-link-alt"></i></span> 提出的，后来 <span class="exturl" data-url="aHR0cHM6Ly9hcnhpdi5vcmcvYWJzLzE0MDkuMzIxNQ==">Sequence to Sequence Learning with Neural Networks, Sutskever et al<i class="fa fa-external-link-alt"></i></span> 算是比较正式地提出了 Sequence to Sequence 的架构，后来 <span class="exturl" data-url="aHR0cHM6Ly9hcnhpdi5vcmcvYWJzLzE0MDkuMDQ3Mw==">Neural Machine Translation by Jointly Learning to Align and Translate, Bahdanau et al<i class="fa fa-external-link-alt"></i></span> 又提出了 Attention 机制，将 Seq2Seq 模型推上神坛，并横扫了非常多的任务，现在也非常广泛地用于机器翻译、对话生成、文本摘要生成等各种任务上，并取得了非常好的效果。 下面的图示意了 Seq2Seq 模型的基本架构： <a href="https://github.com/Germey/AI/blob/master/assets/2018-03-23-16-34-19.jpg" target="_blank" rel="noopener"><img src="https://github.com/Germey/AI/raw/master/assets/2018-03-23-16-34-19.jpg" alt=""></a> 可以看到图中有一个中间状态 $ c $ 向量，在 $ c $ 向量左侧的我们可以称之为编码器（Encoder），编码器这里示意的是 RNN 序列，另外 RNN 单元还可以使用 LSTM、GRU 等变体， 在编码器下方输入了 $ x_1 $、$ x_2 $、$ x_3 $、$ x_4 $，代表模型的输入内容，例如在翻译模型中可以分别代表“我爱中国”这四个字，这样经过序列处理，它就会得到最后的输出，我们将其表示为 $ c $ 向量，这样编码器的工作就完成了。在图中 $ c $ 向量的右侧部分我们可以称之为解码器（Decoder），它拿到编码器生成的 $ c $ 向量，然后再进行序列解码，得到输出结果 $ y_1 $、$ y_2 $、$ y_3 $，例如刚才输入的“我爱中国”四个字便被解码成了 “I love China”，这样就实现了翻译任务，以上就是最基本的 Seq2Seq 模型原理。 另外还有一种变体，$ c $ 向量在每次解码的时候都会作为解码器的输入，其实原理都是类似的，如图所示： <a href="https://github.com/Germey/AI/blob/master/assets/2018-03-23-19-42-16.jpg" target="_blank" rel="noopener"><img src="https://github.com/Germey/AI/raw/master/assets/2018-03-23-19-42-16.jpg" alt=""></a> 这种模型架构是通用的，所以它的适用场景也非常广泛。如机器翻译、对话生成、文本摘要、阅读理解、语音识别，也可以用在一些趣味场景中，如诗词生成、对联生成、代码生成、评论生成等等，效果都很不错。</p>
                  <h2 id="Attention"><a href="#Attention" class="headerlink" title="Attention"></a><a href="https://github.com/Germey/AI/blob/master/Attention%E5%8E%9F%E7%90%86%E5%8F%8ATensorFlow%20AttentionWrapper%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.md#attention" target="_blank" rel="noopener"></a>Attention</h2>
                  <p>通过上图我们可以发现，Encoder 把所有的输入序列编码成了一个 $ c $ 向量，然后使用 $ c $ 向量来进行解码，因此，$ c $ 向量中必须包含了原始序列中的所有信息，所以它的压力其实是很大的，而且由于 RNN 容易把前面的信息“忘记”掉，所以基本的 Seq2Seq 模型，对于较短的输入来说，效果还是可以接受的，但是在输入序列比较长的时候，$ c $ 向量存不下那么多信息，就会导致生成效果大大折扣。 Attention 机制解决了这个问题，它可以使得在输入文本长的时候精确率也不会有明显下降，它是怎么做的呢？既然一个 $ c $ 向量存不了，那么就引入多个 $ c $ 向量，称之为 $ c<em>1 $、$ c_2 $、…、$ c_i $，在解码的时候，这里的 $ i $ 对应着 Decoder 的解码位次，每次解码就利用对应的 $ c_i $ 向量来解码，如图所示： <a href="https://github.com/Germey/AI/blob/master/assets/2018-03-23-17-38-45.jpg" target="_blank" rel="noopener"><img src="https://github.com/Germey/AI/raw/master/assets/2018-03-23-17-38-45.jpg" alt=""></a> 这里的每个 $ c_i $ 向量其实包含了当前所输出与输入序列各个部分重要性的相关的信息。不同的 $ c_i $ 向量里面包含的输入信息各部分的权重是不同的，先放一个示意图： <a href="https://github.com/Germey/AI/blob/master/assets/2018-03-23-19-35-28.jpg" target="_blank" rel="noopener"><img src="https://github.com/Germey/AI/raw/master/assets/2018-03-23-19-35-28.jpg" alt=""></a> 还是上面的例子，例如输入信息是“我爱中国”，输出的的理想结果应该是“I love China”，在解码的时候，应该首先需要解码出 “I” 这个字符，这时候会用到 $ c_1 $ 向量，而 $ c_1 $ 向量包含的信息中，“我”这个字的重要性更大，因此它便倾向解码输出 “I”，当解码第二个字的时候，会用到 $ c_2 $ 向量，而 $ c_2 $ 向量包含的信息中，“爱” 这个字的重要性更大，因此会解码输出 “love”，在解码第三个字的时候，会用到 $ c_3 $ 向量，而 $ c_3 $向量包含的信息中，”中国” 这两个字的权重都比较大，因此会解码输出 “China”。所以其实，Attention 注意力机制中的 $ c_i $ 向量记录了不同解码时刻应该更关注于哪部分输入数据，也实现了编码解码过程的对齐。经过实验发现，这种机制可以有效解决输入信息过长时导致信息解码效果不理想的问题，另外解码生成效果同时也有提升。 下面我们以 Bahdanau 提出的 Attention 为例来详细剖析一下 Attention 机制。 在没有引入 Attention 之前，Decoder 在某个时刻解码的时候实际上是依赖于三个部分的，首先我们知道 RNN 中，每次输出结果会依赖于隐层和输入，在 Seq2Seq 模型中，还需要依赖于 $ c $ 向量，所以这里我们设在 $ i $ 时刻，解码器解码的内容是 $ y_i $，上一次解码结果是 $ y</em>{i-1} $，隐层输出是 $ s<em>t $，所以它们满足这样的关系： $$ y_i = g(y</em>{i-1}, s<em>i, c) <script type="math/tex">同时 $ s_i $ 和 $ c $ 还满足这样的关系：</script> s_i = f(s</em>{i-1}, y<em>{i-1}, c) <script type="math/tex">即每次的隐层输出是上一个隐层和上一个输出结果和 $ c $ 向量共同计算得出的。 但是刚才说了，这样会带来一些问题，$ c $ 向量不足以包含输入内容的所有信息，尤其是在输入序列特别长的情况下，所以这里我们不再使用一个 $ c $ 向量，而是每一个解码过程对应一个 $ c_i $ 向量，所以公式改写如下：</script> y_i = g(y</em>{i-1}, s<em>i, c_i) <script type="math/tex">同时 $ s_i $ 的计算方式也变为如下公式：</script> s_i = f(s</em>{i-1}, y<em>{i-1}, c_i) $$ 所以，这里每次解码得出 $ y_i $ 时，都有与之对应的 $ c_i $ 向量。那么这个 $ c_i $ 向量又是怎么来的呢？实际上它是由编码器端每个时刻的隐含状态加权平均得到的，这里假设编码器端的的序列长度为 $ T_x $，序列位次用 $ j $ 来表示，编码器段每个时刻的隐含状态即为 $ h_1 $、$ h_2 $、…、$ h_j $、…、$ h</em>{T<em>x} $，对于解码器的第 $ i $ 时刻，对应的 $ c_i $ 表示如下： $$ c_i = \sum</em>{j=1}^{T<em>x} \alpha</em>{ij}h<em>j $$ 编码器输出的结果中，$ h_j $ 中包含了输入序列中的第 $ j $ 个词及前面的一些信息，如果是用了双向 RNN 的话，则包含的是第 $ j $ 个词即前后的一些词的信息，这里 $ \alpha</em>{ij} $ 代表了分配的权重，这代表在生成第 i 个结果的时候，对于输入信息的各个阶段的 $ hj $ 的注意力分配是不同的。 当 $ a<em>{ij} $ 的值越高，表示第 $ i $ 个输出在第 $ j $ 个输入上分配的注意力越多，这样就会导致在生成第 $ i $ 个输出的时候，受第 $ j $ 个输入的影响也就越大。 那么 $ a</em>{ij} $ 又是怎么得来的呢？其实它就又关系到第 $ i-1 $ 个输出隐藏状态 $ s<em>{i-1} $ 以及输入中的各个隐含状态 $ h_j $，公式表示如下： $$ \alpha</em>{ij} = \frac {exp(e<em>{ij})} {\sum</em>{k=1}^{T<em>x} exp(e</em>{ik})} <script type="math/tex">同时 $ e_{ij} $ 又表示为：</script> e<em>{ij} = a(s</em>{i-1}, h<em>j) = {v_a}^Ttanh(W_as</em>{i-1} + U<em>ah_j) $$ 这也就是说，这个权重就是 $ s</em>{i-1} $ 和 $ h<em>j $ 分别计算得到一个数值，然后再过一个 softmax 函数得到的，结果就是 $ \alpha</em>{ij} $。 因此 $ c<em>i $ 就可以表示为： $$ c_i = \sum</em>{j=1}^{T<em>x} softmax(a(s</em>{i-1}, h_j)) \cdot h_j $$ 以上便是整个 Attention 机制的推导过程。</p>
                  <h2 id="TensorFlow-AttentionWrapper"><a href="#TensorFlow-AttentionWrapper" class="headerlink" title="TensorFlow AttentionWrapper"></a><a href="https://github.com/Germey/AI/blob/master/Attention%E5%8E%9F%E7%90%86%E5%8F%8ATensorFlow%20AttentionWrapper%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.md#tensorflow-attentionwrapper" target="_blank" rel="noopener"></a>TensorFlow AttentionWrapper</h2>
                  <p>我们了解了基本原理，但真正离程序实现出来其实还是有很大差距的，接下来我们就结合 TensorFlow 框架来了解一下 Attention 的实现机制。 在 TensorFlow 中，Attention 的相关实现代码是在 tensorflow/contrib/seq2seq/python/ops/attention_wrapper.py 文件中，这里面实现了两种 Attention 机制，分别是 BahdanauAttention 和 LuongAttention，其实现论文分别如下：</p>
                  <ul>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9hcnhpdi5vcmcvYWJzLzE0MDkuMDQ3Mw==">Neural Machine Translation by Jointly Learning to Align and Translate, Bahdanau, et al<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9hcnhpdi5vcmcvYWJzLzE1MDguMDQwMjU=">Effective Approaches to Attention-based Neural Machine Translation, Luong, et al<i class="fa fa-external-link-alt"></i></span></li>
                  </ul>
                  <p>整个 attention_wrapper.py 文件中主要包含几个类，我们主要关注其中几个：</p>
                  <ul>
                    <li>AttentionMechanism、_BaseAttentionMechanism、LuongAttention、BahdanauAttention 实现了 Attention 机制的逻辑。<ul>
                        <li>AttentionMechanism 是 Attention 类的父类，继承了 object 类，内部没有任何实现。</li>
                        <li>_BaseAttentionMechanism 继承自 AttentionMechanism 类，定义了 Attention 机制的一些公共方法实现和属性。</li>
                        <li>LuongAttention、BahdanauAttention 均继承 _BaseAttentionMechanism 类，分别实现了上面两篇论文的 Attention 机制。</li>
                      </ul>
                    </li>
                    <li>AttentionWrapperState 用来存储整个计算过程中的 state，和 RNN 中的 state 类似，只不过这里额外还存储了 attention、time 等信息。</li>
                    <li>AttentionWrapper 主要用于对封装 RNNCell，继承自 RNNCell，封装后依然是 RNNCell 的实例，可以构建一个带有 Attention 机制的 Decoder。</li>
                    <li>另外还有一些公共方法，例如 hardmax、safe_cumpord 等。</li>
                  </ul>
                  <p>下面我们以 BahdanauAttention 为例来说明 Attention 机制及 AttentionWrapper 的实现。</p>
                  <h3 id="BahdanauAttention"><a href="#BahdanauAttention" class="headerlink" title="BahdanauAttention"></a><a href="https://github.com/Germey/AI/blob/master/Attention%E5%8E%9F%E7%90%86%E5%8F%8ATensorFlow%20AttentionWrapper%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.md#bahdanauattention" target="_blank" rel="noopener"></a>BahdanauAttention</h3>
                  <p>首先我们来介绍 BahdanauAttention 类的具体原理。 首先我们来看下它的初始化方法：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def __init__(self,</span><br><span class="line">    num_units,</span><br><span class="line">    memory,</span><br><span class="line">    <span class="attribute">memory_sequence_length</span>=None,</span><br><span class="line">    <span class="attribute">normalize</span>=<span class="literal">False</span>,</span><br><span class="line">    <span class="attribute">probability_fn</span>=None,</span><br><span class="line">    <span class="attribute">score_mask_value</span>=None,</span><br><span class="line">    <span class="attribute">dtype</span>=None,</span><br><span class="line">    <span class="attribute">name</span>=<span class="string">"BahdanauAttention"</span>):</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里一共接受八个参数，下面一一进行说明：</p>
                  <ul>
                    <li>num<em>units：神经元节点数，我们知道在计算 $ e</em>{ij} $ 的时候，需要使用 $ s_{i-1} $ 和 $ h_j $ 来进行计算，而二者的维度可能并不是统一的，需要进行变换和统一，所以这里就有了 $ W_a $ 和 $ U_a $ 这两个系数，所以在代码中就是用 num_units 来声明了一个全连接 Dense 网络，用于统一二者的维度，以便于下一步的计算：</li>
                  </ul>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">query_layer</span>=layers_core.Dense(num_units, <span class="attribute">name</span>=<span class="string">"query_layer"</span>, <span class="attribute">use_bias</span>=<span class="literal">False</span>, <span class="attribute">dtype</span>=dtype)</span><br><span class="line"><span class="attribute">memory_layer</span>=layers_core.Dense(num_units, <span class="attribute">name</span>=<span class="string">"memory_layer"</span>, <span class="attribute">use_bias</span>=<span class="literal">False</span>, <span class="attribute">dtype</span>=dtype)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们可以看到声明了一个 query<em>layer 和 memory_layer，分别和 $ s</em>{i-1} $ 及 $ h_j $ 做全连接变换，统一维度。</p>
                  <ul>
                    <li>memory：The memory to query; usually the output of an RNN encoder. 即解码时用到的上文信息，维度需要是 [batch_size, max_time, context_dim]。这时我们观察一下父类 _BaseAttentionMechanism 的初始化方法，实现如下：</li>
                  </ul>
                  <figure class="highlight gml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">with</span> ops.name_scope(</span><br><span class="line">    name, <span class="string">"BaseAttentionMechanismInit"</span>, nest.flatten(memory)):</span><br><span class="line">  <span class="literal">self</span>._values = _prepare_memory(</span><br><span class="line">      memory, memory_sequence_length,</span><br><span class="line">      check_inner_dims_defined=check_inner_dims_defined)</span><br><span class="line">  <span class="literal">self</span>._keys = (</span><br><span class="line">      <span class="literal">self</span>.memory_layer(<span class="literal">self</span>._values) <span class="keyword">if</span> <span class="literal">self</span>.memory_layer</span><br><span class="line">      <span class="keyword">else</span> <span class="literal">self</span>._values)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里通过 _prepare_memory() 方法对 memory 进行处理，然后调用 memory_layer 对 memory 进行全连接维度变换，变换成 [batch_size, max_time, num_units]。</p>
                  <ul>
                    <li>memory_sequence_length：Sequence lengths for the batch entries in memory. 即 memory 变量的长度信息，类似于 dynamic_rnn 中的 sequence_length，被 _prepare_memory() 方法调用处理 memory 变量，进行 mask 操作：</li>
                  </ul>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">seq_len_mask = <span class="built_in">array</span>_ops.sequence_mask(</span><br><span class="line">    memory_sequence_length,</span><br><span class="line">    maxlen=<span class="built_in">array</span>_ops.shape(nest.flatten(memory)[<span class="number">0</span>])[<span class="number">1</span>],</span><br><span class="line">    dtype=nest.flatten(memory)[<span class="number">0</span>].dtype)</span><br><span class="line">seq_len_batch_size = (</span><br><span class="line">    memory_sequence_length.shape[<span class="number">0</span>].value</span><br><span class="line">    <span class="keyword">or</span> <span class="built_in">array</span>_ops.shape(memory_sequence_length)[<span class="number">0</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>normalize：Whether to normalize the energy term. 即是否要实现标准化，方法出自论文：<span class="exturl" data-url="aHR0cHM6Ly9hcnhpdi5vcmcvYWJzLzE2MDIuMDc4Njg=">Weight Normalization: A Simple Reparameterization to Accelerate Training of Deep Neural Networks, Salimans, et al<i class="fa fa-external-link-alt"></i></span>。</li>
                    <li>probability_fn：A callable function which converts the score to probabilities. 计算概率时的函数，必须是一个可调用的函数，默认使用 softmax()，还可以指定 hardmax() 等函数。</li>
                    <li>score_mask_value：The mask value for score before passing into probability_fn. The default is -inf. Only used if memory_sequence_length is not None. 在使用 probability_fn 计算概率之前，对 score 预先进行 mask 使用的值，默认是负无穷。但这个只有在 memory_sequence_length 参数定义的时候有效。</li>
                    <li>dtype：The data type for the query and memory layers of the attention mechanism. 数据类型，默认是 float32。</li>
                    <li>name：Name to use when creating ops，自定义名称。</li>
                  </ul>
                  <p>接下来类里面定义了一个 <strong>call</strong>() 方法：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def <span class="constructor">__call__(<span class="params">self</span>, <span class="params">query</span>, <span class="params">previous_alignments</span>)</span>:</span><br><span class="line">    <span class="keyword">with</span> variable_scope.variable<span class="constructor">_scope(None, <span class="string">"bahdanau_attention"</span>, [<span class="params">query</span>])</span>:</span><br><span class="line">      processed_query = self.query<span class="constructor">_layer(<span class="params">query</span>)</span> <span class="keyword">if</span> self.query_layer <span class="keyword">else</span> query</span><br><span class="line">      score = <span class="constructor">_bahdanau_score(<span class="params">processed_query</span>, <span class="params">self</span>.<span class="params">_keys</span>, <span class="params">self</span>.<span class="params">_normalize</span>)</span></span><br><span class="line">    alignments = self.<span class="constructor">_probability_fn(<span class="params">score</span>, <span class="params">previous_alignments</span>)</span></span><br><span class="line">    return alignments</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先定义了 processed_query，这里也是通过 query_layer 过了一个全连接网络，将最后一维统一成 num_units，然后调用了 bahdanau_score() 方法，这个方法是比较重要的，主要用来计算公式中的 $ e{ij} $，传入的参数是 processed_query 以及上文中提及的 keys 变量，二者一个代表了 $ s{i-1} $，一个代表了 $ h_j $，_bahdanau_score() 方法实现如下：</p>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def _bahdanau_score(processed_query, keys, normalize):</span><br><span class="line">    <span class="attr">dtype</span> = processed_query.dtype</span><br><span class="line">    <span class="comment"># Get the number of hidden units from the trailing dimension of keys</span></span><br><span class="line">    <span class="attr">num_units</span> = keys.shape[<span class="number">2</span>].value <span class="literal">or</span> array_ops.shape(keys)[<span class="number">2</span>]</span><br><span class="line">    <span class="comment"># Reshape from [batch_size, ...] to [batch_size, 1, ...] for broadcasting.</span></span><br><span class="line">    <span class="attr">processed_query</span> = array_ops.expand_dims(processed_query, <span class="number">1</span>)</span><br><span class="line">    <span class="attr">v</span> = variable_scope.get_variable(</span><br><span class="line">      <span class="string">"attention_v"</span>, [num_units], <span class="attr">dtype=dtype)</span></span><br><span class="line">    <span class="keyword">if</span> normalize:</span><br><span class="line">        <span class="comment"># Scalar used in weight normalization</span></span><br><span class="line">        <span class="attr">g</span> = variable_scope.get_variable(</span><br><span class="line">            <span class="string">"attention_g"</span>, <span class="attr">dtype=dtype,</span></span><br><span class="line">            <span class="attr">initializer=math.sqrt((1.</span> / num_units)))</span><br><span class="line">        <span class="comment"># Bias added prior to the nonlinearity</span></span><br><span class="line">        <span class="attr">b</span> = variable_scope.get_variable(</span><br><span class="line">            <span class="string">"attention_b"</span>, [num_units], <span class="attr">dtype=dtype,</span></span><br><span class="line">            <span class="attr">initializer=init_ops.zeros_initializer())</span></span><br><span class="line">        <span class="comment"># normed_v = g * v / ||v||</span></span><br><span class="line">        <span class="attr">normed_v</span> = g * v * math_ops.rsqrt(</span><br><span class="line">            math_ops.reduce_sum(math_ops.square(v)))</span><br><span class="line">        return math_ops.reduce_sum(normed_v * math_ops.tanh(keys + processed_query + b), [<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        return math_ops.reduce_sum(v * math_ops.tanh(keys + processed_query), [<span class="number">2</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里其实就是实现了 keys 和 processed<em>query 的加和，如果指定了 normalize 的话还需要进行额外的 normalize，结果就是公式中的 $ e</em>{ij} $，在 TensorFlow 中常用 score 变量表示。 接下来再回到 <strong>call</strong>() 方法中，这里得到了 score 变量，接下来可以对齐求 softmax() 操作，得到 $ \alpha_{ij} $：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">alignments = self.<span class="constructor">_probability_fn(<span class="params">score</span>, <span class="params">previous_alignments</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这就代表了在 $ i $ 时刻，Decoder 的时候对 Encoder 得到的每个 $ hj $ 的权重大小比例，在 TensorFlow 中常用 alignments 变量表示。 所以综上所述，BahdanauAttention 就是初始化时传入 num_units 以及 Encoder Outputs，然后调时传入 query 用即可得到权重变量 alignments。</p>
                  <h3 id="AttentionWrapperState"><a href="#AttentionWrapperState" class="headerlink" title="AttentionWrapperState"></a><a href="https://github.com/Germey/AI/blob/master/Attention%E5%8E%9F%E7%90%86%E5%8F%8ATensorFlow%20AttentionWrapper%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.md#attentionwrapperstate" target="_blank" rel="noopener"></a>AttentionWrapperState</h3>
                  <p>接下来我们再看下 AttentionWrapperState 这个类，这个类其实比较简单，就是定义了 Attention 过程中可能需要保存的变量，如 cell_state、attention、time、alignments 等内容，同时也便于后期的可视化呈现，代码实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AttentionWrapperState</span><span class="params">(</span></span></span><br><span class="line"><span class="class"><span class="params">    collections.namedtuple<span class="params">(<span class="string">"AttentionWrapperState"</span>,</span></span></span></span><br><span class="line"><span class="class"><span class="params"><span class="params">                           <span class="params">(<span class="string">"cell_state"</span>, <span class="string">"attention"</span>, <span class="string">"time"</span>, <span class="string">"alignments"</span>,</span></span></span></span></span><br><span class="line"><span class="class"><span class="params"><span class="params"><span class="params">                            <span class="string">"alignment_history"</span>)</span>)</span>)</span>:</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可见它就是继承了 namedtuple 这个数据结构，其实整个 AttentionWrapperState 就像声明了一个结构体，可以传入需要的字段生成这个对象。</p>
                  <h3 id="AttentionWrapper"><a href="#AttentionWrapper" class="headerlink" title="AttentionWrapper"></a><a href="https://github.com/Germey/AI/blob/master/Attention%E5%8E%9F%E7%90%86%E5%8F%8ATensorFlow%20AttentionWrapper%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.md#attentionwrapper" target="_blank" rel="noopener"></a>AttentionWrapper</h3>
                  <p>了解了 Attention 机制及 BahdanauAttention 的原理之后，最后我们再来了解一下 AttentionWrapper，可能你用过很多其他的 Wrapper，如 DropoutWrapper、ResidualWrapper 等等，它们其实都是 RNNCell 的实例，其实 AttentionWrapper 也不例外，它对 RNNCell 进行了封装，封装后依然还是 RNNCell 的实例。一个普通的 RNN 模型，你要加入 Attention，只需要在 RNNCell 外面套一层 AttentionWrapper 并指定 AttentionMechanism 的实例就好了。而且如果要更换 AttentionMechanism，只需要改变 AttentionWrapper 的参数就好了，这可谓对 Attention 的实现架构完全解耦，配置非常灵活，TF 大法好！ 接下来我们首先来看下它的初始化方法，其参数是这样的：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def __init__(self,</span><br><span class="line">    cell,</span><br><span class="line">    attention_mechanism,</span><br><span class="line">    <span class="attribute">attention_layer_size</span>=None,</span><br><span class="line">    <span class="attribute">alignment_history</span>=<span class="literal">False</span>,</span><br><span class="line">    <span class="attribute">cell_input_fn</span>=None,</span><br><span class="line">    <span class="attribute">output_attention</span>=<span class="literal">True</span>,</span><br><span class="line">    <span class="attribute">initial_cell_state</span>=None,</span><br><span class="line">    <span class="attribute">name</span>=None):</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>下面对参数进行一一说明：</p>
                  <ul>
                    <li>cell：An instance of RNNCell. RNNCell 的实例，这里可以是单个的 RNNCell，也可以是多个 RNNCell 组成的 MultiRNNCell。</li>
                    <li>attention_mechanism：即 AttentionMechanism 的实例，如 BahdanauAttention 对象，另外可以是多个 AttentionMechanism 组成的列表。</li>
                    <li>attention_layer_size：是数字或者数字做成的列表，如果是 None（默认），直接使用加权计算后得到的 Attention 作为输出，如果不是 None，那么 Attention 结果还会和 Output 进行拼接并做线性变换再输出。其代码实现如下：</li>
                  </ul>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">if</span> attention_layer_size is not None:</span><br><span class="line">    attention_layer_sizes = tuple(attention_layer_size <span class="keyword">if</span> isinstance(attention_layer_size, (<span class="built_in">list</span>, tuple)) <span class="keyword">else</span> (attention_layer_size,))</span><br><span class="line">    <span class="keyword">if</span> len(attention_layer_sizes) != len(attention_mechanisms):</span><br><span class="line">        raise <span class="constructor">ValueError(<span class="string">"If provided, attention_layer_size must contain exactly one integer per attention_mechanism, saw: %d vs %d"</span> % (<span class="params">len</span>(<span class="params">attention_layer_sizes</span>)</span>, len(attention_mechanisms)))</span><br><span class="line">    self._attention_layers = tuple(layers_core.<span class="constructor">Dense(<span class="params">attention_layer_size</span>, <span class="params">name</span>=<span class="string">"attention_layer"</span>, <span class="params">use_bias</span>=False, <span class="params">dtype</span>=<span class="params">attention_mechanisms</span>[<span class="params">i</span>].<span class="params">dtype</span>)</span> for i, attention_layer_size <span class="keyword">in</span> enumerate(attention_layer_sizes))</span><br><span class="line">    self._attention_layer_size = sum(attention_layer_sizes)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    self._attention_layers = None</span><br><span class="line">    self._attention_layer_size = sum(attention_mechanism.values.get<span class="constructor">_shape()</span><span class="literal">[-<span class="number">1</span>]</span>.value for attention_mechanism <span class="keyword">in</span> attention_mechanisms) </span><br><span class="line">    </span><br><span class="line">for i, attention_mechanism <span class="keyword">in</span> enumerate(self._attention_mechanisms):</span><br><span class="line">    attention, alignments = <span class="constructor">_compute_attention(<span class="params">attention_mechanism</span>, <span class="params">cell_output</span>, <span class="params">previous_alignments</span>[<span class="params">i</span>], <span class="params">self</span>.<span class="params">_attention_layers</span>[<span class="params">i</span>] <span class="params">if</span> <span class="params">self</span>.<span class="params">_attention_layers</span> <span class="params">else</span> None)</span></span><br><span class="line">    alignment_history = previous_alignment_history<span class="literal">[<span class="identifier">i</span>]</span>.write(state.time, alignments) <span class="keyword">if</span> self._alignment_history <span class="keyword">else</span> <span class="literal">()</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>alignment_history：即是否将之前的 alignments 存储到 state 中，以便于后期进行可视化展示。</li>
                    <li>cell_input_fn：将 Input 进行处理的方式，默认会将上一步的 Attention 进行 拼接操作，以免造成重复关注同样的内容。代码调用如下：</li>
                  </ul>
                  <figure class="highlight pf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">cell_inputs = <span class="literal">self</span>._cell_input_fn(inputs, <span class="keyword">state</span>.attention)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>output_attention：是否将 Attention 返回，如果是 False 则返回 Output，否则返回 Attention，默认是 True。</li>
                    <li>initial_cell_state：计算时的初始状态。</li>
                    <li>name：自定义名称。</li>
                  </ul>
                  <p>AttentionWrapper 的核心方法在它的 call() 方法，即类似于 RNNCell 的 call() 方法，AttentionWrapper 类对其进行了重载，代码实现如下：</p>
                  <figure class="highlight pf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def call(<span class="literal">self</span>, inputs, <span class="keyword">state</span>):</span><br><span class="line">    <span class="comment"># Step 1</span></span><br><span class="line">    cell_inputs = <span class="literal">self</span>._cell_input_fn(inputs, <span class="keyword">state</span>.attention)</span><br><span class="line">    <span class="comment"># Step 2</span></span><br><span class="line">    cell_state = <span class="keyword">state</span>.cell_state</span><br><span class="line">    cell_output, next_cell_state = <span class="literal">self</span>._cell(cell_inputs, cell_state)</span><br><span class="line">    <span class="comment"># Step 3</span></span><br><span class="line">    if <span class="literal">self</span>._is_multi:</span><br><span class="line">        previous_alignments = <span class="keyword">state</span>.alignments</span><br><span class="line">        previous_alignment_history = <span class="keyword">state</span>.alignment_history</span><br><span class="line">    else:</span><br><span class="line">        previous_alignments = [<span class="keyword">state</span>.alignments]</span><br><span class="line">        previous_alignment_history = [<span class="keyword">state</span>.alignment_history]</span><br><span class="line">    all_alignments = []</span><br><span class="line">    all_attentions = []</span><br><span class="line">    all_histories = []</span><br><span class="line">    <span class="keyword">for</span> i, attention_mechanism <span class="keyword">in</span> enumerate(<span class="literal">self</span>._attention_mechanisms):</span><br><span class="line">        attention, alignments = _compute_attention(attention_mechanism, cell_output, previous_alignments[i], <span class="literal">self</span>._attention_layers[i] if <span class="literal">self</span>._attention_layers else None)</span><br><span class="line">        alignment_history = previous_alignment_history[i].write(<span class="keyword">state</span>.time, alignments) if <span class="literal">self</span>._alignment_history else ()</span><br><span class="line">        all_alignments.append(alignments)</span><br><span class="line">        all_histories.append(alignment_history)</span><br><span class="line">        all_attentions.append(attention)</span><br><span class="line">    <span class="comment"># Step 4</span></span><br><span class="line">    attention = array_ops.concat(all_attentions, <span class="number">1</span>)</span><br><span class="line">    <span class="comment"># Step 5</span></span><br><span class="line">    next_state = AttentionWrapperState(</span><br><span class="line">        time=<span class="keyword">state</span>.time + <span class="number">1</span>,</span><br><span class="line">        cell_state=next_cell_state,</span><br><span class="line">        attention=attention,</span><br><span class="line">        alignments=<span class="literal">self</span>._item_or_tuple(all_alignments),</span><br><span class="line">        alignment_history=<span class="literal">self</span>._item_or_tuple(all_histories))</span><br><span class="line">    <span class="comment"># Step 6</span></span><br><span class="line">    if <span class="literal">self</span>._output_attention:</span><br><span class="line">        return attention, next_state</span><br><span class="line">    else:</span><br><span class="line">        return cell_output, next_state</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里将一些异常判断代码去除了，以便于结构看得更清晰。 首先在第一步中，调用了 _cell_input_fn() 方法，对 inputs 和 state.attention 变量进行处理，默认是使用 concat() 函数拼接，作为当前时间步的输入。因为可能前一步的 Attention 可能对当前 Attention 有帮助，以免让模型连续两次将注意力放在同一个地方。 在第二步中，其实就是调用了普通的 RNNCell 的 call() 方法，得到输出和下一步的状态。 第三步中，这时得到的输出其实并没有用上 AttentionMechanism 中的 alignments 信息，所以当前的输出信息中我们并没有跟 Encoder 的信息做 Attention，所以这里还需要调用 _compute_attention() 方法进行权重的计算，其方法实现如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def <span class="constructor">_compute_attention(<span class="params">attention_mechanism</span>, <span class="params">cell_output</span>, <span class="params">previous_alignments</span>, <span class="params">attention_layer</span>)</span>:</span><br><span class="line">    alignments = attention<span class="constructor">_mechanism(<span class="params">cell_output</span>, <span class="params">previous_alignments</span>=<span class="params">previous_alignments</span>)</span></span><br><span class="line">    expanded_alignments = array_ops.expand<span class="constructor">_dims(<span class="params">alignments</span>, 1)</span></span><br><span class="line">    context = math_ops.matmul(expanded_alignments, attention_mechanism.values)</span><br><span class="line">    context = array_ops.squeeze(context, <span class="literal">[<span class="number">1</span>]</span>)</span><br><span class="line">    <span class="keyword">if</span> attention_layer is not None:</span><br><span class="line">        attention = attention<span class="constructor">_layer(<span class="params">array_ops</span>.<span class="params">concat</span>([<span class="params">cell_output</span>, <span class="params">context</span>], 1)</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        attention = context</span><br><span class="line">    return attention, alignments</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个方法接收四个参数，其中 attention<em>mechanism 就是 AttentionMechanism 的实例，cell_output 就是当前 Output，previous_alignments 是上步的 alignments 信息，调用 attention_mechanism 计算之后就会得到当前步的 alignments 信息了，即 $ \alpha</em>{ij} $。接下来再利用 alignments 信息进行加权运算，得到 attention 信息，即 $ c_{i} $，最后将二者返回。 在第四步中，就是将 attention 结果每个时间步进行 concat，得到 attention vector。 第五步中，声明 AttentionWrapperState 作为下一步的状态。 第六步，判断是否要输出 Attention，如果是，输出 Attention 及下一步状态，否则输出 Outputs 及下一步状态。 好，以上便是整个 AttentionWrapper 源码解析过程，了解了源码之后，再做模型优化的话就非常得心应手了。</p>
                  <h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a><a href="https://github.com/Germey/AI/blob/master/Attention%E5%8E%9F%E7%90%86%E5%8F%8ATensorFlow%20AttentionWrapper%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.md#%E5%8F%82%E8%80%83%E6%9D%A5%E6%BA%90" target="_blank" rel="noopener"></a>参考来源</h2>
                  <ul>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9hcnhpdi5vcmcvYWJzLzE0MDYuMTA3OA==">Learning Phrase Representations using RNN Encoder-Decoder for Statistical Machine Translation, Cho et al<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9hcnhpdi5vcmcvYWJzLzE0MDkuMzIxNQ==">Sequence to Sequence Learning with Neural Networks, Sutskever et al<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9hcnhpdi5vcmcvYWJzLzE0MDkuMDQ3Mw==">Neural Machine Translation by Jointly Learning to Align and Translate, Bahdanau et al<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9hcnhpdi5vcmcvYWJzLzE1MDguMDQwMjU=">Effective Approaches to Attention-based Neural Machine Translation, Luong, et al<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9hcnhpdi5vcmcvYWJzLzE2MDIuMDc4Njg=">Weight Normalization: A Simple Reparameterization to Accelerate Training of Deep Neural Networks, Salimans, et al<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cDovL25ld3MuaWZlbmcuY29tL2EvMjAxNzA5MDEvNTE4NDI0MTFfMC5zaHRtbA==">http://news.ifeng.com/a/20170901/51842411_0.shtml<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FzY3pzZTk0MzA2MjcxMC9hcnRpY2xlL2RldGFpbHMvNzk1MzkwMDU=">https://blog.csdn.net/qsczse943062710/article/details/79539005<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zNDM5MzAyOA==">https://zhuanlan.zhihu.com/p/34393028<i class="fa fa-external-link-alt"></i></span></li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-03-25 01:41:33" itemprop="dateCreated datePublished" datetime="2018-03-25T01:41:33+08:00">2018-03-25</time>
                </span>
                <span id="/5873.html" class="post-meta-item leancloud_visitors" data-flag-title="Attention原理及TensorFlow AttentionWrapper源码解析" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>14k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>13 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5846.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5846.html" class="post-title-link" itemprop="url">Requests库作者另一神器Pipenv的用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
                  <p>我们在运行 Python 项目的时候经常会遇到一些版本问题，例如 A 项目依赖于 Django 1.5，而 B 项目又依赖 Django 2.0，而我们的系统却只有一个 Python 解释器，我们所有的包都被装在了 Python 安装目录的 site-packages 目录下，所以 Django 只能是某个特定的版本，所以这样就会导致运行的时候导致 A 或 B 项目出现兼容问题。为了解决这个问题，我们可能会使用 virtualenv 来为项目创建一套独立的 Python 运行环境，或者我们可能会使用 Docker 容器来实现不同项目的隔离运行，但总的来说，它们使用起来其实并没有那么方便。另外在进行 Python 包管理时，requirements.txt 这样的包依赖标识文件也显得很鸡肋，在某些情况下可能会带来一些麻烦。为了解决这些问题，一个更加使用方便的包管理工具诞生了，叫做 Pipenv，接下来就让我们一起来了解一下它的用法。</p>
                  <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2>
                  <p>Pipenv，它的项目简介为 Python Development Workflow for Humans，是 Python 著名的 requests 库作者 kennethreitz 写的一个包管理工具，它可以为我们的项目自动创建和管理虚拟环境并非常方便地管理 Python 包，现在它也已经是 Python 官方推荐的包管理工具。 Pipenv 我们可以简单理解为 pip 和 virtualenv 的集合体，它可以为我们的项目自动创建和管理一个虚拟环境。virtualenv 在使用时我们需要手动创建一个虚拟环境然后激活，Pipenv 会自动创建。另外我们之前可能使用 requirements.txt 文件来标识项目所需要的依赖，但是这样会带来一些问题，如有的 requirements.txt 中只是将库名列出来了，没有严格指定版本号，这样就可能会导致不同时间安装的库版本是不同的，如 requirements.txt 文件中对 Django 的依赖只写了一个 django，可能在 2016 年的时候运行安装会安装 Django 的 1.x 版本，到了 2017 年就会安装 Django 的 2.x 版本，所以可能导致一些麻烦。为了解决这个问题，Pipenv 直接弃用了 requirements.txt，会同时它会使用一个叫做 Pipfile 和 Pipfile.lock 的文件来管理项目所需的依赖包，而不再是简单地使用 requirements.txt 文件来记录项目所需要的依赖。 总的来说，Pipenv 可以解决如下问题：</p>
                  <ul>
                    <li>我们不需要再手动创建虚拟环境，Pipenv 会自动为我们创建，它会在某个特定的位置创建一个 virtualenv 环境，然后调用 pipenv shell 命令切换到虚拟环境。</li>
                    <li>使用 requirements.txt 可能会导致一些问题，所以 Pipenv 使用 Pipfile 和 Pipfile.lock 来替代之，而且 Pipfile 如果不存在的话会自动创建，而且在安装、升级、移除依赖包的时候会自动更新 Pipfile 和 Pipfile.lock 文件。</li>
                    <li>广泛使用 Hash 校验，保证安全性。</li>
                    <li>可以更清晰地查看 Python 包及其关系，调用 pipenv graph 即可呈现，结果简单明了。</li>
                    <li>可通过自动加载 .env 读取环境变量，简化开发流程。</li>
                  </ul>
                  <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2>
                  <p>本文内容基于 Python 3.6 说明，默认的 Python 解释器命令为 python3，包管理工具命令为 pip3。 Pipenv 是基于 Python 开发的包，所以可以直接用 pip 来安装，命令如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> pipenv</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外还有多种安装方式，如 Pipsi、Nix、Homebrew，安装方式可以参考：<span class="exturl" data-url="aHR0cDovL3BpcGVudi5yZWFkdGhlZG9jcy5pby9lbi9sYXRlc3QvI2luc3RhbGwtcGlwZW52LXRvZGF5">http://pipenv.readthedocs.io/en/latest/#install-pipenv-today<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2>
                  <p>首先我们可以新建一个项目，例如叫做 PipenvTest，然后新建一个 Python 脚本，例如叫 main.py，内容为：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import django</span><br><span class="line">print(<span class="name">django</span>.get_version())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>直接用系统的 Python3 运行此脚本：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">python3</span> main.<span class="keyword">py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">1.11</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们可以看到系统安装的 Django 版本是 1.11。但是我们想要本项目基于 Django 2.x 开发，当然我们可以选择将系统的 Django 版本升级，但这样又可能会影响其他的项目的运行，所以这并不是一个好的选择。为了不影响系统环境的 Django 版本，所以我们可以用 Pipenv 来创建一个虚拟环境。 在该目录下，输入 pipenv 命令即可查看命令的完整用法：</p>
                  <figure class="highlight">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">Usage</span>: pipenv [OPTIONS] COMMAND [ARGS]...</span><br><span class="line"></span><br><span class="line"><span class="attribute">Options:</span></span><br><span class="line">  --update         Update Pipenv &amp; pip to latest.</span><br><span class="line">  --where          Output project home information.</span><br><span class="line">  --venv           Output virtualenv information.</span><br><span class="line">  --py             Output Python interpreter information.</span><br><span class="line">  --envs           Output Environment Variable options.</span><br><span class="line">  --rm             Remove the virtualenv.</span><br><span class="line">  --bare           Minimal output.</span><br><span class="line">  --completion     Output completion (to be eval'd).</span><br><span class="line">  --man            Display manpage.</span><br><span class="line">  --three / --two  Use Python 3/2 when creating virtualenv.</span><br><span class="line">  --python TEXT    Specify which version of Python virtualenv should use.</span><br><span class="line">  --site-packages  Enable site-packages for the virtualenv.</span><br><span class="line">  --jumbotron      An easter egg, effectively.</span><br><span class="line">  --version        Show the version and exit.</span><br><span class="line">  -h, --help       Show this message and exit.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Usage Examples:</span><br><span class="line">   Create a new project using Python 3.6, specifically:</span><br><span class="line">   $ pipenv --python 3.6</span><br><span class="line"></span><br><span class="line">   Install all dependencies for a project (including dev):</span><br><span class="line">   $ pipenv install --dev</span><br><span class="line"></span><br><span class="line">   Create a lockfile containing pre-releases:</span><br><span class="line">   $ pipenv lock --pre</span><br><span class="line"></span><br><span class="line">   Show a graph of your installed dependencies:</span><br><span class="line">   $ pipenv graph</span><br><span class="line"></span><br><span class="line">   Check your installed dependencies for security vulnerabilities:</span><br><span class="line">   $ pipenv check</span><br><span class="line"></span><br><span class="line">   Install a local setup.py into your virtual environment/Pipfile:</span><br><span class="line">   $ pipenv install -e .</span><br><span class="line"></span><br><span class="line"><span class="attribute">Commands:</span></span><br><span class="line">  check      Checks for security vulnerabilities and against PEP 508 markers</span><br><span class="line">             provided in Pipfile.</span><br><span class="line">  graph      Displays currently–installed dependency graph information.</span><br><span class="line">  install    Installs provided packages and adds them to Pipfile, or (if none</span><br><span class="line">             is given), installs all packages.</span><br><span class="line">  lock       Generates Pipfile.lock.</span><br><span class="line">  open       View a given module in your editor.</span><br><span class="line">  run        Spawns a command installed into the virtualenv.</span><br><span class="line">  shell      Spawns a shell within the virtualenv.</span><br><span class="line">  uninstall  Un-installs a provided package and removes it from Pipfile.</span><br><span class="line">  update     Uninstalls all packages, and re-installs package(s) in [packages]</span><br><span class="line">             to latest compatible versions.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们首先验证一下当前的项目是没有创建虚拟环境的，调用如下命令：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pipenv <span class="comment">--venv</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight gradle">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">No virtualenv has been created <span class="keyword">for</span> <span class="keyword">this</span> <span class="keyword">project</span> yet!</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这说明当前的项目尚未创建虚拟环境，接下来我们利用 Pipenv 来创建一个虚拟环境：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pipenv <span class="comment">--three</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pipenv <span class="comment">--python 3.6</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>都可以创建一个 Python3 的虚拟环境，—three 代表创建一个 Python3 版本的虚拟环境，—python 则可以指定特定的 Python 版本，当然 —two 则创建一个 Python2 版本的虚拟环境，但前提你的系统必须装有该版本的 Python 才可以。 执行完毕之后，样例输出如下：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Warning: the environment variable LANG is not <span class="keyword">set</span>!</span><br><span class="line">We recommend setting this <span class="keyword">in</span> ~/.profile (<span class="keyword">or</span> equivalent) <span class="keyword">for</span> proper expected behavior.</span><br><span class="line">Creating a virtualenv <span class="keyword">for</span> this <span class="keyword">project</span>…</span><br><span class="line"><span class="keyword">Using</span> /usr/<span class="keyword">local</span>/<span class="keyword">bin</span>/python3 <span class="keyword">to</span> <span class="keyword">create</span> virtualenv…</span><br><span class="line">⠋Running virtualenv <span class="keyword">with</span> interpreter /usr/<span class="keyword">local</span>/<span class="keyword">bin</span>/python3</span><br><span class="line"><span class="keyword">Using</span> base prefix <span class="string">'/usr/local/Cellar/python3/3.6.1/Frameworks/Python.framework/Versions/3.6'</span></span><br><span class="line"><span class="keyword">New</span> python executable <span class="keyword">in</span> /<span class="keyword">Users</span>/CQC/.local/<span class="keyword">share</span>/virtualenvs/PipenvTest-VSTVh89E/<span class="keyword">bin</span>/python3<span class="number">.6</span></span><br><span class="line">Also creating executable <span class="keyword">in</span> /<span class="keyword">Users</span>/CQC/.local/<span class="keyword">share</span>/virtualenvs/PipenvTest-VSTVh89E/<span class="keyword">bin</span>/python</span><br><span class="line">Installing setuptools, pip, wheel...done.</span><br><span class="line">Virtualenv location: /<span class="keyword">Users</span>/CQC/.local/<span class="keyword">share</span>/virtualenvs/PipenvTest-VSTVh89E</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里显示 Pipenv 利用 /usr/local/bin/python3 作为 virtualenv 的解释器，然后在 /Users/CQC/.local/share/virtualenvs/PipenvTest-VSTVh89E/bin 目录下创建了一个新的 Python3 解释器，同时还创建了两个可执行文件别名 python3.6 和 python，另外我们还可以发现目录下多了一个 Pipfile 文件，这时虚拟环境就创建完成了。 我们切换到 PipenvTest-VSTVh89E/bin 目录查看一下文件结构，可以看到这里面包含了 pip、pip3、pip3.6、python、python3、python3.6 等可执行文件，实际上目录结构和使用 virtualenv 时是完全一样的，只不过文件夹的位置不同而已。 接下来我们可以切换到该虚拟环境下执行命令，执行如下命令即可：</p>
                  <figure class="highlight dockerfile">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pipenv <span class="keyword">shell</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>执行完毕之后样例输出如下：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Spawning environment shell (/bin/zsh). <span class="keyword">Use</span> <span class="string">'exit'</span> <span class="keyword">to</span> leave.</span><br><span class="line"><span class="keyword">source</span> /<span class="keyword">Users</span>/CQC/.local/<span class="keyword">share</span>/virtualenvs/PipenvTest-VSTVh89E/<span class="keyword">bin</span>/<span class="keyword">activate</span>                                                            </span><br><span class="line">CQC-MAC% <span class="keyword">source</span> /<span class="keyword">Users</span>/CQC/.local/<span class="keyword">share</span>/virtualenvs/PipenvTest-VSTVh89E/<span class="keyword">bin</span>/<span class="keyword">activate</span></span><br><span class="line">(PipenvTest-VSTVh89E) CQC-MAC%</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>实际上这也和 virtualenv 激活的流程一样，也是调用了类似 source venv/bin/activate 方法将这个路径加到全局环境变量最前面，这样就会优先调用该路径下的 python、python3、python3.6 可执行文件了。 这时候我们会发现命令行的样子就变了，前面多了一个 (PipenvTest-VSTVh89E) 的标识，代表当前我们已经切换到了虚拟环境下。 这时我们用 which 或 where 命令查看一下 Python 可执行文件的路径，命令如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(PipenvTest-VSTVh89E) CQC-MAC% which python3</span><br><span class="line"><span class="regexp">/Users/</span>CQC<span class="regexp">/.local/</span>share<span class="regexp">/virtualenvs/</span>PipenvTest-VSTVh89E<span class="regexp">/bin/</span>python3</span><br><span class="line">(PipenvTest-VSTVh89E) CQC-MAC% which python3.<span class="number">6</span></span><br><span class="line"><span class="regexp">/Users/</span>CQC<span class="regexp">/.local/</span>share<span class="regexp">/virtualenvs/</span>PipenvTest-VSTVh89E<span class="regexp">/bin/</span>python3.<span class="number">6</span></span><br><span class="line">(PipenvTest-VSTVh89E) CQC-MAC% which python</span><br><span class="line"><span class="regexp">/Users/</span>CQC<span class="regexp">/.local/</span>share<span class="regexp">/virtualenvs/</span>PipenvTest-VSTVh89E<span class="regexp">/bin/</span>python</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现当前的 Python 可执行路径都被切换到了 PipenvTest-VSTVh89E/bin 目录下，调用的是虚拟环境中的 Python 解释器，这时我们重新执行刚才的脚本，命令如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(PipenvTest-VSTVh89E) CQC-MAC% <span class="keyword">python3</span> main.<span class="keyword">py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时我们可以发现报了如下错误：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"main.py"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;<span class="keyword">module</span>&gt;</span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line">ModuleNotFoundError: <span class="keyword">No</span> <span class="keyword">module</span> named <span class="string">'django'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这其实是因为新的虚拟环境没有安装任何的 Python 第三方包，实际上如果直接使用 virtualenv 时也是这样的结果。这是因为新的虚拟环境是一个全新的 Python 环境，它默认只包含了 Python 内置的包以及 pip、wheel、setuptools 包，其他的第三方包都没有安装。 这时我们可以使用 Pipenv 来安装 django 包，命令如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pipenv <span class="keyword">install</span> django</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行后输出结果如下：</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">Installing</span> <span class="string">django…</span></span><br><span class="line"><span class="attr">Collecting</span> <span class="string">django</span></span><br><span class="line">  <span class="attr">Downloading</span> <span class="string">Django-2.0.2-py3-none-any.whl (7.1MB)</span></span><br><span class="line"><span class="attr">Collecting</span> <span class="string">pytz (from django)</span></span><br><span class="line">  <span class="attr">Downloading</span> <span class="string">pytz-2018.3-py2.py3-none-any.whl (509kB)</span></span><br><span class="line"><span class="attr">Installing</span> <span class="string">collected packages: pytz, django</span></span><br><span class="line"><span class="attr">Successfully</span> <span class="string">installed django-2.0.2 pytz-2018.3</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Adding</span> <span class="string">django to Pipfile's [packages]…</span></span><br><span class="line"><span class="attr">Locking</span> <span class="string">[dev-packages] dependencies…</span></span><br><span class="line"><span class="attr">Locking</span> <span class="string">[packages] dependencies…</span></span><br><span class="line"><span class="attr">Updated</span> <span class="string">Pipfile.lock (e101fb)!</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果有这样的输出结果就代表成功安装了 Django，可以看到此时安装的 Django 版本为 2.0，代表我们的虚拟环境成功安装了 Django 2.0 版本。 同时我们还注意到它输出了一句话叫做 Updated Pipfile.lock，这时我们可以发现项目路径下又生成了一个 Pipfile.lock 文件，内容如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"_meta"</span>: &#123;</span><br><span class="line">        <span class="attr">"hash"</span>: &#123;</span><br><span class="line">            <span class="attr">"sha256"</span>: <span class="string">"7b9623243d9c22b1f333ee710aff70d0cbcdf1dd7e0aac69230dc76855d27270"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"host-environment-markers"</span>: &#123;</span><br><span class="line">            <span class="attr">"implementation_name"</span>: <span class="string">"cpython"</span>,</span><br><span class="line">            <span class="attr">"implementation_version"</span>: <span class="string">"3.6.1"</span>,</span><br><span class="line">            <span class="attr">"os_name"</span>: <span class="string">"posix"</span>,</span><br><span class="line">            <span class="attr">"platform_machine"</span>: <span class="string">"x86_64"</span>,</span><br><span class="line">            <span class="attr">"platform_python_implementation"</span>: <span class="string">"CPython"</span>,</span><br><span class="line">            <span class="attr">"platform_release"</span>: <span class="string">"17.4.0"</span>,</span><br><span class="line">            <span class="attr">"platform_system"</span>: <span class="string">"Darwin"</span>,</span><br><span class="line">            <span class="attr">"platform_version"</span>: <span class="string">"Darwin Kernel Version 17.4.0: Sun Dec 17 09:19:54 PST 2017; root:xnu-4570.41.2~1/RELEASE_X86_64"</span>,</span><br><span class="line">            <span class="attr">"python_full_version"</span>: <span class="string">"3.6.1"</span>,</span><br><span class="line">            <span class="attr">"python_version"</span>: <span class="string">"3.6"</span>,</span><br><span class="line">            <span class="attr">"sys_platform"</span>: <span class="string">"darwin"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"pipfile-spec"</span>: <span class="number">6</span>,</span><br><span class="line">        <span class="attr">"requires"</span>: &#123;&#125;,</span><br><span class="line">        <span class="attr">"sources"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>: <span class="string">"pypi"</span>,</span><br><span class="line">                <span class="attr">"url"</span>: <span class="string">"https://pypi.python.org/simple"</span>,</span><br><span class="line">                <span class="attr">"verify_ssl"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"default"</span>: &#123;</span><br><span class="line">        <span class="attr">"django"</span>: &#123;</span><br><span class="line">            <span class="attr">"hashes"</span>: [</span><br><span class="line">                <span class="string">"sha256:af18618ce3291be5092893d8522fe3919661bf3a1fb60e3858ae74865a4f07c2"</span>,</span><br><span class="line">                <span class="string">"sha256:9614851d4a7ff8cbd32b73c6076441f377c45a5bbff7e771798fb02c43c31f47"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"version"</span>: <span class="string">"==2.0.2"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"pytz"</span>: &#123;</span><br><span class="line">            <span class="attr">"hashes"</span>: [</span><br><span class="line">                <span class="string">"sha256:ed6509d9af298b7995d69a440e2822288f2eca1681b8cce37673dbb10091e5fe"</span>,</span><br><span class="line">                <span class="string">"sha256:f93ddcdd6342f94cea379c73cddb5724e0d6d0a1c91c9bdef364dc0368ba4fda"</span>,</span><br><span class="line">                <span class="string">"sha256:61242a9abc626379574a166dc0e96a66cd7c3b27fc10868003fa210be4bff1c9"</span>,</span><br><span class="line">                <span class="string">"sha256:ba18e6a243b3625513d85239b3e49055a2f0318466e0b8a92b8fb8ca7ccdf55f"</span>,</span><br><span class="line">                <span class="string">"sha256:07edfc3d4d2705a20a6e99d97f0c4b61c800b8232dc1c04d87e8554f130148dd"</span>,</span><br><span class="line">                <span class="string">"sha256:3a47ff71597f821cd84a162e71593004286e5be07a340fd462f0d33a760782b5"</span>,</span><br><span class="line">                <span class="string">"sha256:5bd55c744e6feaa4d599a6cbd8228b4f8f9ba96de2c38d56f08e534b3c9edf0d"</span>,</span><br><span class="line">                <span class="string">"sha256:887ab5e5b32e4d0c86efddd3d055c1f363cbaa583beb8da5e22d2fa2f64d51ef"</span>,</span><br><span class="line">                <span class="string">"sha256:410bcd1d6409026fbaa65d9ed33bf6dd8b1e94a499e32168acfc7b332e4095c0"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"version"</span>: <span class="string">"==2018.3"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"develop"</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到里面标识了 Python 环境基本信息，以及依赖包的版本及 hashes 值。 另外我们还可以注意到 Pipfile 文件内容也有更新，[packages] 部分多了一句 django = “<em>“，标识了本项目依赖于 Django，这个其实类似于 requirements.txt 文件。 那么到这里有小伙伴可能就会问了， Pipfile 和 Pipfile.lock 有什么用呢？ Pipfile 其实一个 TOML 格式的文件，标识了该项目依赖包的基本信息，还区分了生产环境和开发环境的包标识，作用上类似 requirements.txt 文件，但是功能更为强大。Pipfile.lock 详细标识了该项目的安装的包的精确版本信息、最新可用版本信息和当前库文件的 hash 值，顾明思义，它起了版本锁的作用，可以注意到当前 Pipfile.lock 文件中的 Django 版本标识为 ==2.0.2，意思是当前我们开发时使用的就是 2.0.2 版本，它可以起到版本锁定的功能。 举个例子，刚才我们安装了 Django 2.0.2 的版本，即目前（2018.2.27）的最新版本。但可能 Django 以后还会有更新，比如某一天 Django 更新到了 2.1 版本，这时如果我们想要重新部署本项目到另一台机器上，假如此时不存在 Pipfile.lock 文件，只存在 Pipfile文件，由于 Pipfile 文件中标识的 Django 依赖为 django = “</em>“，即没有版本限制，它会默认安装最新版本的 Django，即 2.1，但由于 Pipfile.lock 文件的存在，它会根据 Pipfile.lock 来安装，还是会安装 Django 2.0.2，这样就会避免一些库版本更新导致不兼容的问题。 请记住：任何情况下都不要手动修改 Pipfile.lock 文件！ 好，接下来我们再回归正题，现在已经安装好了 Django 了，那么我们重新运行此脚本便可以成功输出 Django 版本信息了：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(PipenvTest-VSTVh89E) CQC-MAC% <span class="keyword">python3</span> main.<span class="keyword">py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2.0</span><span class="number">.2</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就成功安装了 Django 2.x 了，和系统的 Django 1.11 没有任何冲突。 在此模式的命令行下，我们就可以使用虚拟环境下的 Python 解释器，而且所安装的依赖包对外部系统没有任何影响，而且使用 Pipfile 和 Pipfile.lock 来管理项目的依赖更加方便和健壮。 如果想要退出虚拟环境，只需要输入 exit 命令即可：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(PipenvTest-VSTVh89E) CQC-MAC% <span class="keyword">exit</span></span><br><span class="line">➜  PipenvTest python3 main.py </span><br><span class="line"><span class="number">1.11</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输入退出命令之后，我们重新再运行此脚本，就会重新使用系统的 Python 解释器，Django 版本又重新回到了 1.11。 由此可以看来，有了 Pipenv，我们可以使用 Pipfile 和 Pipfile.lock 来方便地管理和维护项目的依赖包，而且可以实现虚拟环境运行，避免了包冲突问题，可谓一举两得。</p>
                  <h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2>
                  <p>上文我们介绍了 Pipenv 的基本操作，下面我们再介绍一下它的一些常用命令。</p>
                  <h3 id="虚拟环境路径"><a href="#虚拟环境路径" class="headerlink" title="虚拟环境路径"></a>虚拟环境路径</h3>
                  <p>我们可以使用 —venv 参数来获得虚拟环境路径：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pipenv <span class="comment">--venv</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>样例输出如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="regexp">/Users/</span>CQC<span class="regexp">/.local/</span>share<span class="regexp">/virtualenvs/</span>PipenvTest-VSTVh89E</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可见这个路径是一个标准的路径，Pipenv 会把虚拟环境统一放到 virtualenvs 文件夹下，而不是本项目路径下。</p>
                  <h3 id="Python-解释器路径"><a href="#Python-解释器路径" class="headerlink" title="Python 解释器路径"></a>Python 解释器路径</h3>
                  <p>要获取虚拟环境 Python 解释器路径，可以使用 —py 参数：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pipenv <span class="comment">--py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>样例输出如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="regexp">/Users/</span>CQC<span class="regexp">/.local/</span>share<span class="regexp">/virtualenvs/</span>PipenvTest-VSTVh89E<span class="regexp">/bin/</span>python</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="加载系统-Python-包"><a href="#加载系统-Python-包" class="headerlink" title="加载系统 Python 包"></a>加载系统 Python 包</h3>
                  <p>默认情况下，新创建的虚拟环境是不包含任何第三方包的，但我们也可以开启加载系统 Python 包功能，使用 —site-packages 即可：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pipenv <span class="comment">--site-packages</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样创建的虚拟环境便可以使用系统已安装的 Python 包了。</p>
                  <h3 id="开启虚拟环境"><a href="#开启虚拟环境" class="headerlink" title="开启虚拟环境"></a>开启虚拟环境</h3>
                  <p>要开启虚拟环境只需要执行如下命令：</p>
                  <figure class="highlight dockerfile">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pipenv <span class="keyword">shell</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就可以进入虚拟环境，此时运行的 python、python3 命令都是虚拟环境下的。</p>
                  <h3 id="安装-Python-包"><a href="#安装-Python-包" class="headerlink" title="安装 Python 包"></a>安装 Python 包</h3>
                  <p>安装 Python 包我们不再需要 pip 来安装，直接使用 Pipenv 也可安装，如安装 requests，命令如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pipenv <span class="keyword">install</span> requests</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装完成之后会同时更新项目目录下的 Pipfile 和 Pipfile.lock 文件。 有时候一些 Python 包是仅仅开发环境需要的，如 pytest，这时候我们通过添加 —dev 参数即可，命令如下：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pipenv <span class="keyword">install</span> pytest <span class="comment">--dev</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时候，pytest 的依赖便会记录在 Pipfile 的 [dev-packages] 区域：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="section">[dev-packages]</span></span><br><span class="line"><span class="attr">pytest</span> = <span class="string">"*"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="获取包依赖"><a href="#获取包依赖" class="headerlink" title="获取包依赖"></a>获取包依赖</h3>
                  <p>我们可以使用命令来清晰地呈现出当前安装的 Python 包版本及之间的依赖关系，命令如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">pipenv graph</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>样例结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Django==<span class="number">2.0</span><span class="number">.2</span></span><br><span class="line">  - pytz [required: Any, installed: <span class="number">2018.3</span>]</span><br><span class="line">pytest==<span class="number">3.4</span><span class="number">.1</span></span><br><span class="line">  - attrs [required: &gt;=<span class="number">17.2</span><span class="number">.0</span>, installed: <span class="number">17.4</span><span class="number">.0</span>]</span><br><span class="line">  - pluggy [required: &lt;<span class="number">0.7</span>,&gt;=<span class="number">0.5</span>, installed: <span class="number">0.6</span><span class="number">.0</span>]</span><br><span class="line">  - py [required: &gt;=<span class="number">1.5</span><span class="number">.0</span>, installed: <span class="number">1.5</span><span class="number">.2</span>]</span><br><span class="line">  - setuptools [required: Any, installed: <span class="number">38.5</span><span class="number">.1</span>]</span><br><span class="line">  - six [required: &gt;=<span class="number">1.10</span><span class="number">.0</span>, installed: <span class="number">1.11</span><span class="number">.0</span>]</span><br><span class="line">requests==<span class="number">2.18</span><span class="number">.4</span></span><br><span class="line">  - certifi [required: &gt;=<span class="number">2017.4</span><span class="number">.17</span>, installed: <span class="number">2018.1</span><span class="number">.18</span>]</span><br><span class="line">  - chardet [required: &gt;=<span class="number">3.0</span><span class="number">.2</span>,&lt;<span class="number">3.1</span><span class="number">.0</span>, installed: <span class="number">3.0</span><span class="number">.4</span>]</span><br><span class="line">  - idna [required: &lt;<span class="number">2.7</span>,&gt;=<span class="number">2.5</span>, installed: <span class="number">2.6</span>]</span><br><span class="line">  - urllib3 [required: &lt;<span class="number">1.23</span>,&gt;=<span class="number">1.21</span><span class="number">.1</span>, installed: <span class="number">1.22</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到结果非常清晰，Django 当前安装了 2.0.2版本，依赖于 pytz 任何版本，已经安装了 2018.3 版本；pytest 已经安装了 3.4.1 版本，依赖 attrs&gt;=17.2.0 版本，已经安装了 17.4.0 版本，另外还依赖 pluggy、py、setuptools、six 这些库。总之包的依赖关系一目了然。</p>
                  <h3 id="卸载-Python-包"><a href="#卸载-Python-包" class="headerlink" title="卸载 Python 包"></a>卸载 Python 包</h3>
                  <p>卸载 Python 包也非常简单，如卸载 requests 包，命令如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">pipenv uninstall requests</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>卸载完成之后，Pipfile 和 Pipfile.lock 文件同样会更新。 如果要卸载全部 Python 包，可以添加 —all 参数：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pipenv <span class="keyword">uninstall</span> <span class="comment">--all</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="产生-Pipfile-lock"><a href="#产生-Pipfile-lock" class="headerlink" title="产生 Pipfile.lock"></a>产生 Pipfile.lock</h3>
                  <p>有时候可能 Pipfile.lock 文件不存在或被删除了，这时候我们可以使用如下命令生成：</p>
                  <figure class="highlight cos">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pipenv <span class="keyword">lock</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便是一些常用的 Pipenv 命令，如果要查看更多用法可以参考其官方文档：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnBpcGVudi5vcmcvI3BpcGVudi11c2FnZQ==">https://docs.pipenv.org/#pipenv-usage<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>本文介绍了 Pipenv 的基本用法，作为 pip 和 virtualenv 的结合体，我们可以利用它更方便地创建和管理 Python 虚拟环境，还可以用更加科学的方式管理 Python 包，一举两得。 嗯，是时候抛弃 virtualenv 和 pip 了！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-03-15 21:39:41" itemprop="dateCreated datePublished" datetime="2018-03-15T21:39:41+08:00">2018-03-15</time>
                </span>
                <span id="/5846.html" class="post-meta-item leancloud_visitors" data-flag-title="Requests库作者另一神器Pipenv的用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>12k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>10 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5844.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5844.html" class="post-title-link" itemprop="url">中文分词原理及工具</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2>
                  <p>中文分词，即 Chinese Word Segmentation，即将一个汉字序列进行切分，得到一个个单独的词。表面上看，分词其实就是那么回事，但分词效果好不好对信息检索、实验结果还是有很大影响的，同时分词的背后其实是涉及各种各样的算法的。 中文分词与英文分词有很大的不同，对英文而言，一个单词就是一个词，而汉语是以字为基本的书写单位，词语之间没有明显的区分标记，需要人为切分。根据其特点，可以把分词算法分为四大类：</p>
                  <ul>
                    <li>基于规则的分词方法</li>
                    <li>基于统计的分词方法</li>
                    <li>基于语义的分词方法</li>
                    <li>基于理解的分词方法</li>
                  </ul>
                  <p>下面我们对这几种方法分别进行总结。</p>
                  <h3 id="基于规则的分词方法"><a href="#基于规则的分词方法" class="headerlink" title="基于规则的分词方法"></a>基于规则的分词方法</h3>
                  <p>这种方法又叫作机械分词方法、基于字典的分词方法，它是按照一定的策略将待分析的汉字串与一个“充分大的”机器词典中的词条进行匹配。若在词典中找到某个字符串，则匹配成功。该方法有三个要素，即分词词典、文本扫描顺序和匹配原则。文本的扫描顺序有正向扫描、逆向扫描和双向扫描。匹配原则主要有最大匹配、最小匹配、逐词匹配和最佳匹配。</p>
                  <ul>
                    <li>最大匹配法（MM）。基本思想是：假设自动分词词典中的最长词条所含汉字的个数为 i，则取被处理材料当前字符串序列中的前 i 个字符作为匹配字段，查找分词词典，若词典中有这样一个 i 字词，则匹配成功，匹配字段作为一个词被切分出来；若词典中找不到这样的一个 i 字词，则匹配失败，匹配字段去掉最后一个汉字，剩下的字符作为新的匹配字段，再进行匹配，如此进行下去，直到匹配成功为止。统计结果表明，该方法的错误率 为 1/169。</li>
                    <li>逆向最大匹配法（RMM）。该方法的分词过程与 MM 法相同，不同的是从句子（或文章）末尾开始处理，每次匹配不成功时去掉的是前面的一个汉字。统计结果表明，该方法的错误率为 1/245。</li>
                    <li>逐词遍历法。把词典中的词按照由长到短递减的顺序逐字搜索整个待处理的材料，一直到把全部的词切分出来为止。不论分词词典多大，被处理的材料多么小，都得把这个分词词典匹配一遍。</li>
                    <li>设立切分标志法。切分标志有自然和非自然之分。自然切分标志是指文章中出现的非文字符号，如标点符号等；非自然标志是利用词缀和不构成词的词（包 括单音词、复音节词以及象声词等）。设立切分标志法首先收集众多的切分标志，分词时先找出切分标志，把句子切分为一些较短的字段，再用 MM、RMM 或其它的方法进行细加工。这种方法并非真正意义上的分词方法，只是自动分词的一种前处理方式而已，它要额外消耗时间扫描切分标志，增加存储空间存放那些非 自然切分标志。</li>
                    <li>最佳匹配法（OM）。此法分为正向的最佳匹配法和逆向的最佳匹配法，其出发点是：在词典中按词频的大小顺序排列词条，以求缩短对分词词典的检索时 间，达到最佳效果，从而降低分词的时间复杂度，加快分词速度。实质上，这种方法也不是一种纯粹意义上的分词方法，它只是一种对分词词典的组织方式。OM 法的分词词典每条词的前面必须有指明长度的数据项，所以其空间复杂度有所增加，对提高分词精度没有影响，分词处理的时间复杂度有所降低。</li>
                  </ul>
                  <p>此种方法优点是简单，易于实现。但缺点有很多：匹配速度慢；存在交集型和组合型歧义切分问题；词本身没有一个标准的定义，没有统一标准的词集；不同词典产生的歧义也不同；缺乏自学习的智能性。</p>
                  <h3 id="基于统计的分词方法"><a href="#基于统计的分词方法" class="headerlink" title="基于统计的分词方法"></a>基于统计的分词方法</h3>
                  <p>该方法的主要思想：词是稳定的组合，因此在上下文中，相邻的字同时出现的次数越多，就越有可能构成一个词。因此字与字相邻出现的概率或频率能较好地反映成词的可信度。可以对训练文本中相邻出现的各个字的组合的频度进行统计，计算它们之间的互现信息。互现信息体现了汉字之间结合关系的紧密程度。当紧密程 度高于某一个阈值时，便可以认为此字组可能构成了一个词。该方法又称为无字典分词。 该方法所应用的主要的统计模型有：N 元文法模型（N-gram）、隐马尔可夫模型（Hiden Markov Model，HMM）、最大熵模型（ME）、条件随机场模型（Conditional Random Fields，CRF）等。 在实际应用中此类分词算法一般是将其与基于词典的分词方法结合起来，既发挥匹配分词切分速度快、效率高的特点，又利用了无词典分词结合上下文识别生词、自动消除歧义的优点。</p>
                  <h3 id="基于语义的分词方法"><a href="#基于语义的分词方法" class="headerlink" title="基于语义的分词方法"></a>基于语义的分词方法</h3>
                  <p>语义分词法引入了语义分析，对自然语言自身的语言信息进行更多的处理，如扩充转移网络法、知识分词语义分析法、邻接约束法、综合匹配法、后缀分词法、特征词库法、矩阵约束法、语法分析法等。</p>
                  <ul>
                    <li>扩充转移网络法。该方法以有限状态机概念为基础。有限状态机只能识别正则语言，对有限状态机作的第一次扩充使其具有递归能力，形成递归转移网络 （RTN）。在RTN 中，弧线上的标志不仅可以是终极符（语言中的单词）或非终极符（词类），还可以调用另外的子网络名字分非终极符（如字或字串的成词条件）。这样，计算机在 运行某个子网络时，就可以调用另外的子网络，还可以递归调用。词法扩充转移网络的使用， 使分词处理和语言理解的句法处理阶段交互成为可能，并且有效地解决了汉语分词的歧义。</li>
                    <li>矩阵约束法。其基本思想是：先建立一个语法约束矩阵和一个语义约束矩阵， 其中元素分别表明具有某词性的词和具有另一词性的词相邻是否符合语法规则， 属于某语义类的词和属于另一词义类的词相邻是否符合逻辑，机器在切分时以之约束分词结果。</li>
                  </ul>
                  <h3 id="基于理解的分词方法"><a href="#基于理解的分词方法" class="headerlink" title="基于理解的分词方法"></a>基于理解的分词方法</h3>
                  <p>基于理解的分词方法是通过让计算机模拟人对句子的理解，达到识别词的效果。其基本思想就是在分词的同时进行句法、语义分析，利用句法信息和语义信息来处理歧义现象。它通常包括三个部分：分词子系统、句法语义子系统、总控部分。在总控部分的协调下，分词子系统可以获得有关词、句子等的句法和语义信息来对分词歧义进行判断，即它模拟了人对句子的理解过程。这种分词方法需要使用大量的语言知识和信息。目前基于理解的分词方法主要有专家系统分词法和神经网络分词法等。</p>
                  <ul>
                    <li>专家系统分词法。从专家系统角度把分词的知识（包括常识性分词知识与消除歧义切分的启发性知识即歧义切分规则）从实现分词过程的推理机中独立出来，使知识库的维护与推理机的实现互不干扰，从而使知识库易于维护和管理。它还具有发现交集歧义字段和多义组合歧义字段的能力和一定的自学习功能。</li>
                    <li>神经网络分词法。该方法是模拟人脑并行，分布处理和建立数值计算模型工作的。它将分词知识所分散隐式的方法存入神经网络内部，通过自学习和训练修改内部权值，以达到正确的分词结果，最后给出神经网络自动分词结果，如使用 LSTM、GRU 等神经网络模型等。</li>
                    <li>神经网络专家系统集成式分词法。该方法首先启动神经网络进行分词，当神经网络对新出现的词不能给出准确切分时，激活专家系统进行分析判断，依据知识库进行推理，得出初步分析，并启动学习机制对神经网络进行训练。该方法可以较充分发挥神经网络与专家系统二者优势，进一步提高分词效率。</li>
                  </ul>
                  <p>以上便是对分词算法的基本介绍，接下来我们再介绍几个比较实用的分词 Python 库及它们的使用方法。</p>
                  <h2 id="分词工具"><a href="#分词工具" class="headerlink" title="分词工具"></a>分词工具</h2>
                  <p>在这里介绍几个比较有代表性的支持分词的 Python 库，主要有：</p>
                  <h3 id="1-jieba"><a href="#1-jieba" class="headerlink" title="1. jieba"></a>1. jieba</h3>
                  <p>专用于分词的 Python 库，GitHub：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Z4c2p5L2ppZWJh">https://github.com/fxsjy/jieba<i class="fa fa-external-link-alt"></i></span>，分词效果较好。 支持三种分词模式：</p>
                  <ul>
                    <li>精确模式，试图将句子最精确地切开，适合文本分析。</li>
                    <li>全模式，将句子中所有的可能成词的词语都扫描出来，速度非常快，但是不能解决歧义。</li>
                    <li>搜索引擎模式：在精确模式的基础上，对长词再次切分，提高召回率，适用于搜索引擎分词。</li>
                  </ul>
                  <p>另外 jieba 支持繁体分词，支持自定义词典。 其使用的算法是基于统计的分词方法，主要有如下几种：</p>
                  <ul>
                    <li>基于前缀词典实现高效的词图扫描，生成句子中汉字所有可能成词情况所构成的有向无环图 (DAG)</li>
                    <li>采用了动态规划查找最大概率路径, 找出基于词频的最大切分组合</li>
                    <li>对于未登录词，采用了基于汉字成词能力的 HMM 模型，使用了 Viterbi 算法</li>
                  </ul>
                  <h4 id="精确模式分词"><a href="#精确模式分词" class="headerlink" title="精确模式分词"></a>精确模式分词</h4>
                  <p>首先我们来看下精确模式分词，使用 lcut() 方法，类似 cut() 方法，其参数和 cut() 是一致的，只不过返回结果是列表而不是生成器，默认使用精确模式，代码如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import jieba</span><br><span class="line"><span class="keyword">string</span> = <span class="string">'这个把手该换了，我不喜欢日本和服，别把手放在我的肩膀上，工信处女干事每月经过下属科室都要亲口交代24口交换机等技术性器件的安装工作'</span></span><br><span class="line"><span class="built_in">result</span> = jieba.lcut(<span class="keyword">string</span>)</span><br><span class="line">print(<span class="built_in">len</span>(<span class="built_in">result</span>), <span class="string">'/'</span>.join(<span class="built_in">result</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">38</span> 这个<span class="regexp">/把手/</span>该换<span class="regexp">/了/</span>，<span class="regexp">/我/</span>不<span class="regexp">/喜欢/</span>日本<span class="regexp">/和服/</span>，<span class="regexp">/别/</span>把手<span class="regexp">/放在/</span>我<span class="regexp">/的/</span>肩膀<span class="regexp">/上/</span>，<span class="regexp">/工信处/</span>女干事<span class="regexp">/每月/</span>经过<span class="regexp">/下属/</span>科室<span class="regexp">/都/</span>要<span class="regexp">/亲口/</span>交代<span class="regexp">/24/</span>口<span class="regexp">/交换机/</span>等<span class="regexp">/技术性/</span>器件<span class="regexp">/的/</span>安装<span class="regexp">/工作</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可见分词效果还是不错的。</p>
                  <h4 id="全模式分词"><a href="#全模式分词" class="headerlink" title="全模式分词"></a>全模式分词</h4>
                  <p>使用全模式分词需要添加 cut_all 参数，将其设置为 True，代码如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">result</span> = jieba.lcut(<span class="keyword">string</span>, cut_all=True)</span><br><span class="line">print(<span class="built_in">len</span>(<span class="built_in">result</span>), <span class="string">'/'</span>.join(<span class="built_in">result</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">51</span> 这个<span class="regexp">/把手/</span>该换<span class="regexp">/了/</span><span class="regexp">//</span>我<span class="regexp">/不/</span>喜欢<span class="regexp">/日本/</span>和服<span class="regexp">//</span><span class="regexp">/别/</span>把手<span class="regexp">/放在/</span>我<span class="regexp">/的/</span>肩膀<span class="regexp">/上/</span><span class="regexp">//</span>工信处<span class="regexp">/处女/</span>女干事<span class="regexp">/干事/</span>每月<span class="regexp">/月经/</span>经过<span class="regexp">/下属/</span>科室<span class="regexp">/都/</span>要<span class="regexp">/亲口/</span>口交<span class="regexp">/交代/</span><span class="number">24</span><span class="regexp">/口交/</span>交换<span class="regexp">/交换机/</span>换机<span class="regexp">/等/</span>技术<span class="regexp">/技术性/</span>性器<span class="regexp">/器件/</span>的<span class="regexp">/安装/</span>安装工<span class="regexp">/装工/</span>工作</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h4 id="搜索引擎模式分词"><a href="#搜索引擎模式分词" class="headerlink" title="搜索引擎模式分词"></a>搜索引擎模式分词</h4>
                  <p>使用搜索引擎模式分词需要调用 cut_for_search() 方法，代码如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">result</span> = jieba.lcut_for_search(<span class="keyword">string</span>)</span><br><span class="line">print(<span class="built_in">len</span>(<span class="built_in">result</span>), <span class="string">'/'</span>.join(<span class="built_in">result</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">42</span> 这个<span class="regexp">/把手/</span>该换<span class="regexp">/了/</span>，<span class="regexp">/我/</span>不<span class="regexp">/喜欢/</span>日本<span class="regexp">/和服/</span>，<span class="regexp">/别/</span>把手<span class="regexp">/放在/</span>我<span class="regexp">/的/</span>肩膀<span class="regexp">/上/</span>，<span class="regexp">/工信处/</span>干事<span class="regexp">/女干事/</span>每月<span class="regexp">/经过/</span>下属<span class="regexp">/科室/</span>都<span class="regexp">/要/</span>亲口<span class="regexp">/交代/</span><span class="number">24</span><span class="regexp">/口/</span>交换<span class="regexp">/换机/</span>交换机<span class="regexp">/等/</span>技术<span class="regexp">/技术性/</span>器件<span class="regexp">/的/</span>安装<span class="regexp">/工作</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外可以加入自定义词典，如我们想把 日本和服 作为一个整体，可以把它添加到词典中，代码如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">jieba.add_word(<span class="string">'日本和服'</span>)</span><br><span class="line"><span class="built_in">result</span> = jieba.lcut(<span class="keyword">string</span>)</span><br><span class="line">print(<span class="built_in">len</span>(<span class="built_in">result</span>), <span class="string">'/'</span>.join(<span class="built_in">result</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">37</span> 这个<span class="regexp">/把手/</span>该换<span class="regexp">/了/</span>，<span class="regexp">/我/</span>不<span class="regexp">/喜欢/</span>日本和服<span class="regexp">/，/</span>别<span class="regexp">/把手/</span>放在<span class="regexp">/我/</span>的<span class="regexp">/肩膀/</span>上<span class="regexp">/，/</span>工信处<span class="regexp">/女干事/</span>每月<span class="regexp">/经过/</span>下属<span class="regexp">/科室/</span>都<span class="regexp">/要/</span>亲口<span class="regexp">/交代/</span><span class="number">24</span><span class="regexp">/口/</span>交换机<span class="regexp">/等/</span>技术性<span class="regexp">/器件/</span>的<span class="regexp">/安装/</span>工作</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到切分结果中，日本和服 四个字就作为一个整体出现在结果中了，分词数量比精确模式少了一个。</p>
                  <h4 id="词性标注"><a href="#词性标注" class="headerlink" title="词性标注"></a>词性标注</h4>
                  <p>另外 jieba 还支持词性标注，可以输出分词后每个词的词性，实例如下：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">words</span> = pseg.lcut(<span class="built_in">string</span>)</span><br><span class="line">print(<span class="built_in">list</span>(map(lambda x: <span class="built_in">list</span>(x), <span class="built_in">words</span>)))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[[<span class="symbol">'这个</span>', <span class="symbol">'r</span>'], [<span class="symbol">'把手</span>', <span class="symbol">'v</span>'], [<span class="symbol">'该</span>', <span class="symbol">'r</span>'], [<span class="symbol">'换</span>', <span class="symbol">'v</span>'], [<span class="symbol">'了</span>', <span class="symbol">'ul</span>'], [<span class="symbol">'，</span>', <span class="symbol">'x</span>'], [<span class="symbol">'我</span>', <span class="symbol">'r</span>'], [<span class="symbol">'不</span>', <span class="symbol">'d</span>'], [<span class="symbol">'喜欢</span>', <span class="symbol">'v</span>'], [<span class="symbol">'日本和服</span>', <span class="symbol">'x</span>'], [<span class="symbol">'，</span>', <span class="symbol">'x</span>'], [<span class="symbol">'别</span>', <span class="symbol">'r</span>'], [<span class="symbol">'把手</span>', <span class="symbol">'v</span>'], [<span class="symbol">'放在</span>', <span class="symbol">'v</span>'], [<span class="symbol">'我</span>', <span class="symbol">'r</span>'], [<span class="symbol">'的</span>', <span class="symbol">'uj</span>'], [<span class="symbol">'肩膀</span>', <span class="symbol">'n</span>'], [<span class="symbol">'上</span>', <span class="symbol">'f</span>'], [<span class="symbol">'，</span>', <span class="symbol">'x</span>'], [<span class="symbol">'工信处</span>', <span class="symbol">'n</span>'], [<span class="symbol">'女干事</span>', <span class="symbol">'n</span>'], [<span class="symbol">'每月</span>', <span class="symbol">'r</span>'], [<span class="symbol">'经过</span>', <span class="symbol">'p</span>'], [<span class="symbol">'下属</span>', <span class="symbol">'v</span>'], [<span class="symbol">'科室</span>', <span class="symbol">'n</span>'], [<span class="symbol">'都</span>', <span class="symbol">'d</span>'], [<span class="symbol">'要</span>', <span class="symbol">'v</span>'], [<span class="symbol">'亲口</span>', <span class="symbol">'n</span>'], [<span class="symbol">'交代</span>', <span class="symbol">'n</span>'], [<span class="symbol">'24</span>', <span class="symbol">'m</span>'], [<span class="symbol">'口</span>', <span class="symbol">'n</span>'], [<span class="symbol">'交换机</span>', <span class="symbol">'n</span>'], [<span class="symbol">'等</span>', <span class="symbol">'u</span>'], [<span class="symbol">'技术性</span>', <span class="symbol">'n</span>'], [<span class="symbol">'器件</span>', <span class="symbol">'n</span>'], [<span class="symbol">'的</span>', <span class="symbol">'uj</span>'], [<span class="symbol">'安装</span>', <span class="symbol">'v</span>'], [<span class="symbol">'工作</span>', <span class="symbol">'vn</span>']]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>关于词性的说明可以参考：<span class="exturl" data-url="aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vbHV3MjAwNy82MDE2OTMx">https://gist.github.com/luw2007/6016931<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h3 id="2-SnowNLP"><a href="#2-SnowNLP" class="headerlink" title="2. SnowNLP"></a>2. SnowNLP</h3>
                  <p>SnowNLP: Simplified Chinese Text Processing，可以方便的处理中文文本内容，是受到了 TextBlob 的启发而写的，由于现在大部分的自然语言处理库基本都是针对英文的，于是写了一个方便处理中文的类库，并且和 TextBlob 不同的是，这里没有用 NLTK，所有的算法都是自己实现的，并且自带了一些训练好的字典。GitHub地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2lzbm93Znkvc25vd25scA==">https://github.com/isnowfy/snownlp<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h4 id="分词"><a href="#分词" class="headerlink" title="分词"></a>分词</h4>
                  <p>这里的分词是基于 Character-Based Generative Model 来实现的，论文地址：<span class="exturl" data-url="aHR0cDovL2FjbHdlYi5vcmcvYW50aG9sb2d5Ly9ZL1kwOS9ZMDktMjA0Ny5wZGY=">http://aclweb.org/anthology//Y/Y09/Y09-2047.pdf<i class="fa fa-external-link-alt"></i></span>，我们还是以上面的例子说明，相关使用说明如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">from</span> snownlp import SnowNLP</span><br><span class="line"></span><br><span class="line"><span class="keyword">string</span> = <span class="string">'这个把手该换了，我不喜欢日本和服，别把手放在我的肩膀上，工信处女干事每月经过下属科室都要亲口交代24口交换机等技术性器件的安装工作'</span></span><br><span class="line">s = SnowNLP(<span class="keyword">string</span>)</span><br><span class="line"><span class="built_in">result</span> = s.<span class="keyword">words</span></span><br><span class="line">print(<span class="built_in">len</span>(<span class="built_in">result</span>), <span class="string">'/'</span>.join(<span class="built_in">result</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">40</span> 这个<span class="regexp">/把手/</span>该<span class="regexp">/换/</span>了<span class="regexp">/，/</span>我<span class="regexp">/不/</span>喜欢<span class="regexp">/日本/</span>和<span class="regexp">/服/</span>，<span class="regexp">/别把手/</span>放在<span class="regexp">/我/</span>的<span class="regexp">/肩膀/</span>上<span class="regexp">/，/</span>工<span class="regexp">/信处女/</span>干事<span class="regexp">/每月/</span>经过<span class="regexp">/下属/</span>科室<span class="regexp">/都/</span>要<span class="regexp">/亲口/</span>交代<span class="regexp">/24/</span>口<span class="regexp">/交换机/</span>等<span class="regexp">/技术性/</span>器件<span class="regexp">/的/</span>安装<span class="regexp">/工作</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过观察，可以发现分词效果其实不怎么理想，和服 被分开了，工信处 也被分开了，女干事 也被分开了。 另外 SnowNLP 还支持很多功能，例如词性标注（HMM）、情感分析、拼音转换（Trie树）、关键词和摘要生成（TextRank）。 我们简单看一个实例：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'Tags:'</span>, list(s.tags)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'Sentiments:'</span>, s.sentiments)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'Pinyin:'</span>, s.pinyin)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">Tags</span>: <span class="selector-attr">[(<span class="string">'这个'</span>, <span class="string">'r'</span>), (<span class="string">'把手'</span>, <span class="string">'Ng'</span>), (<span class="string">'该'</span>, <span class="string">'r'</span>), (<span class="string">'换'</span>, <span class="string">'v'</span>), (<span class="string">'了'</span>, <span class="string">'y'</span>), (<span class="string">'，'</span>, <span class="string">'w'</span>), (<span class="string">'我'</span>, <span class="string">'r'</span>), (<span class="string">'不'</span>, <span class="string">'d'</span>), (<span class="string">'喜欢'</span>, <span class="string">'v'</span>), (<span class="string">'日本'</span>, <span class="string">'ns'</span>), (<span class="string">'和'</span>, <span class="string">'c'</span>), (<span class="string">'服'</span>, <span class="string">'v'</span>), (<span class="string">'，'</span>, <span class="string">'w'</span>), (<span class="string">'别把手'</span>, <span class="string">'ad'</span>), (<span class="string">'放在'</span>, <span class="string">'v'</span>), (<span class="string">'我'</span>, <span class="string">'r'</span>), (<span class="string">'的'</span>, <span class="string">'u'</span>), (<span class="string">'肩膀'</span>, <span class="string">'n'</span>), (<span class="string">'上'</span>, <span class="string">'f'</span>), (<span class="string">'，'</span>, <span class="string">'w'</span>), (<span class="string">'工'</span>, <span class="string">'j'</span>), (<span class="string">'信处女'</span>, <span class="string">'j'</span>), (<span class="string">'干事'</span>, <span class="string">'n'</span>), (<span class="string">'每月'</span>, <span class="string">'r'</span>), (<span class="string">'经过'</span>, <span class="string">'p'</span>), (<span class="string">'下属'</span>, <span class="string">'v'</span>), (<span class="string">'科室'</span>, <span class="string">'n'</span>), (<span class="string">'都'</span>, <span class="string">'d'</span>), (<span class="string">'要'</span>, <span class="string">'v'</span>), (<span class="string">'亲口'</span>, <span class="string">'d'</span>), (<span class="string">'交代'</span>, <span class="string">'v'</span>), (<span class="string">'24'</span>, <span class="string">'m'</span>), (<span class="string">'口'</span>, <span class="string">'q'</span>), (<span class="string">'交换机'</span>, <span class="string">'n'</span>), (<span class="string">'等'</span>, <span class="string">'u'</span>), (<span class="string">'技术性'</span>, <span class="string">'n'</span>), (<span class="string">'器件'</span>, <span class="string">'n'</span>), (<span class="string">'的'</span>, <span class="string">'u'</span>), (<span class="string">'安装'</span>, <span class="string">'vn'</span>), (<span class="string">'工作'</span>, <span class="string">'vn'</span>)]</span></span><br><span class="line"><span class="selector-tag">Sentiments</span>: 0<span class="selector-class">.015678817603646866</span></span><br><span class="line"><span class="selector-tag">Pinyin</span>: <span class="selector-attr">[<span class="string">'zhe'</span>, <span class="string">'ge'</span>, <span class="string">'ba'</span>, <span class="string">'shou'</span>, <span class="string">'gai'</span>, <span class="string">'huan'</span>, <span class="string">'liao'</span>, <span class="string">'，'</span>, <span class="string">'wo'</span>, <span class="string">'bu'</span>, <span class="string">'xi'</span>, <span class="string">'huan'</span>, <span class="string">'ri'</span>, <span class="string">'ben'</span>, <span class="string">'he'</span>, <span class="string">'fu'</span>, <span class="string">'，'</span>, <span class="string">'bie'</span>, <span class="string">'ba'</span>, <span class="string">'shou'</span>, <span class="string">'fang'</span>, <span class="string">'zai'</span>, <span class="string">'wo'</span>, <span class="string">'de'</span>, <span class="string">'jian'</span>, <span class="string">'bang'</span>, <span class="string">'shang'</span>, <span class="string">'，'</span>, <span class="string">'gong'</span>, <span class="string">'xin'</span>, <span class="string">'chu'</span>, <span class="string">'nv'</span>, <span class="string">'gan'</span>, <span class="string">'shi'</span>, <span class="string">'mei'</span>, <span class="string">'yue'</span>, <span class="string">'jing'</span>, <span class="string">'guo'</span>, <span class="string">'xia'</span>, <span class="string">'shu'</span>, <span class="string">'ke'</span>, <span class="string">'shi'</span>, <span class="string">'dou'</span>, <span class="string">'yao'</span>, <span class="string">'qin'</span>, <span class="string">'kou'</span>, <span class="string">'jiao'</span>, <span class="string">'dai'</span>, <span class="string">'24'</span>, <span class="string">'kou'</span>, <span class="string">'jiao'</span>, <span class="string">'huan'</span>, <span class="string">'ji'</span>, <span class="string">'deng'</span>, <span class="string">'ji'</span>, <span class="string">'shu'</span>, <span class="string">'xing'</span>, <span class="string">'qi'</span>, <span class="string">'jian'</span>, <span class="string">'de'</span>, <span class="string">'an'</span>, <span class="string">'zhuang'</span>, <span class="string">'gong'</span>, <span class="string">'zuo'</span>]</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="3-THULAC"><a href="#3-THULAC" class="headerlink" title="3. THULAC"></a>3. THULAC</h3>
                  <p>THULAC（THU Lexical Analyzer for Chinese）由清华大学自然语言处理与社会人文计算实验室研制推出的一套中文词法分析工具包，GitHub 链接：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RodW5scC9USFVMQUMtUHl0aG9u">https://github.com/thunlp/THULAC-Python<i class="fa fa-external-link-alt"></i></span>，具有中文分词和词性标注功能。THULAC具有如下几个特点：</p>
                  <ul>
                    <li>能力强。利用集成的目前世界上规模最大的人工分词和词性标注中文语料库（约含5800万字）训练而成，模型标注能力强大。</li>
                    <li>准确率高。该工具包在标准数据集Chinese Treebank（CTB5）上分词的F1值可达97.3％，词性标注的F1值可达到92.9％，与该数据集上最好方法效果相当。</li>
                    <li>速度较快。同时进行分词和词性标注速度为300KB/s，每秒可处理约15万字。只进行分词速度可达到1.3MB/s。</li>
                  </ul>
                  <p>我们用一个实例看一下分词效果：</p>
                  <figure class="highlight go">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> thulac</span><br><span class="line"></span><br><span class="line"><span class="keyword">string</span> = <span class="string">'这个把手该换了，我不喜欢日本和服，别把手放在我的肩膀上，工信处女干事每月经过下属科室都要亲口交代24口交换机等技术性器件的安装工作'</span></span><br><span class="line">t = thulac.thulac()</span><br><span class="line">result = t.cut(<span class="keyword">string</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[[<span class="symbol">'这个</span>', <span class="symbol">'r</span>'], [<span class="symbol">'把手</span>', <span class="symbol">'n</span>'], [<span class="symbol">'该</span>', <span class="symbol">'v</span>'], [<span class="symbol">'换</span>', <span class="symbol">'v</span>'], [<span class="symbol">'了</span>', <span class="symbol">'u</span>'], [<span class="symbol">'，</span>', <span class="symbol">'w</span>'], [<span class="symbol">'我</span>', <span class="symbol">'r</span>'], [<span class="symbol">'不</span>', <span class="symbol">'d</span>'], [<span class="symbol">'喜欢</span>', <span class="symbol">'v</span>'], [<span class="symbol">'日本</span>', <span class="symbol">'ns</span>'], [<span class="symbol">'和服</span>', <span class="symbol">'n</span>'], [<span class="symbol">'，</span>', <span class="symbol">'w</span>'], [<span class="symbol">'别把手</span>', <span class="symbol">'n</span>'], [<span class="symbol">'放</span>', <span class="symbol">'v</span>'], [<span class="symbol">'在</span>', <span class="symbol">'p</span>'], [<span class="symbol">'我</span>', <span class="symbol">'r</span>'], [<span class="symbol">'的</span>', <span class="symbol">'u</span>'], [<span class="symbol">'肩膀</span>', <span class="symbol">'n</span>'], [<span class="symbol">'上</span>', <span class="symbol">'f</span>'], [<span class="symbol">'，</span>', <span class="symbol">'w</span>'], [<span class="symbol">'工信处</span>', <span class="symbol">'n</span>'], [<span class="symbol">'女</span>', <span class="symbol">'a</span>'], [<span class="symbol">'干事</span>', <span class="symbol">'n</span>'], [<span class="symbol">'每月</span>', <span class="symbol">'r</span>'], [<span class="symbol">'经过</span>', <span class="symbol">'p</span>'], [<span class="symbol">'下属</span>', <span class="symbol">'v</span>'], [<span class="symbol">'科室</span>', <span class="symbol">'n</span>'], [<span class="symbol">'都</span>', <span class="symbol">'d</span>'], [<span class="symbol">'要</span>', <span class="symbol">'v</span>'], [<span class="symbol">'亲口</span>', <span class="symbol">'d</span>'], [<span class="symbol">'交代</span>', <span class="symbol">'v</span>'], [<span class="symbol">'24</span>', <span class="symbol">'m</span>'], [<span class="symbol">'口</span>', <span class="symbol">'q</span>'], [<span class="symbol">'交换机</span>', <span class="symbol">'n</span>'], [<span class="symbol">'等</span>', <span class="symbol">'u</span>'], [<span class="symbol">'技术性</span>', <span class="symbol">'n</span>'], [<span class="symbol">'器件</span>', <span class="symbol">'n</span>'], [<span class="symbol">'的</span>', <span class="symbol">'u</span>'], [<span class="symbol">'安装</span>', <span class="symbol">'v</span>'], [<span class="symbol">'工作</span>', <span class="symbol">'v</span>']]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="4-NLPIR"><a href="#4-NLPIR" class="headerlink" title="4. NLPIR"></a>4. NLPIR</h3>
                  <p>NLPIR 分词系统，前身为2000年发布的 ICTCLAS 词法分析系统，GitHub 链接：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL05MUElSLXRlYW0vTkxQSVI=">https://github.com/NLPIR-team/NLPIR<i class="fa fa-external-link-alt"></i></span>，是由北京理工大学张华平博士研发的中文分词系统，经过十余年的不断完善，拥有丰富的功能和强大的性能。NLPIR是一整套对原始文本集进行处理和加工的软件，提供了中间件处理效果的可视化展示，也可以作为小规模数据的处理加工工具。主要功能包括：中文分词，词性标注，命名实体识别，用户词典、新词发现与关键词提取等功能。另外对于分词功能，它有 Python 实现的版本，GitHub 链接：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Rzcm90ZW4vcHlubHBpcg==">https://github.com/tsroten/pynlpir<i class="fa fa-external-link-alt"></i></span>。 使用方法如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pynlpir</span><br><span class="line"></span><br><span class="line">pynlpir.<span class="built_in">open</span>()</span><br><span class="line"><span class="keyword">string</span> = <span class="string">'这个把手该换了，我不喜欢日本和服，别把手放在我的肩膀上，工信处女干事每月经过下属科室都要亲口交代24口交换机等技术性器件的安装工作'</span></span><br><span class="line"><span class="built_in">result</span> = pynlpir.<span class="keyword">segment</span>(<span class="keyword">string</span>)</span><br><span class="line">print(<span class="built_in">result</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[(<span class="symbol">'这个</span>', <span class="symbol">'pronoun</span>'), (<span class="symbol">'把</span>', <span class="symbol">'preposition</span>'), (<span class="symbol">'手</span>', <span class="symbol">'noun</span>'), (<span class="symbol">'该</span>', <span class="symbol">'pronoun</span>'), (<span class="symbol">'换</span>', <span class="symbol">'verb</span>'), (<span class="symbol">'了</span>', <span class="symbol">'modal</span> particle'), (<span class="symbol">'，</span>', <span class="symbol">'punctuation</span> mark'), (<span class="symbol">'我</span>', <span class="symbol">'pronoun</span>'), (<span class="symbol">'不</span>', <span class="symbol">'adverb</span>'), (<span class="symbol">'喜欢</span>', <span class="symbol">'verb</span>'), (<span class="symbol">'日本</span>', <span class="symbol">'noun</span>'), (<span class="symbol">'和</span>', <span class="symbol">'conjunction</span>'), (<span class="symbol">'服</span>', <span class="symbol">'verb</span>'), (<span class="symbol">'，</span>', <span class="symbol">'punctuation</span> mark'), (<span class="symbol">'别</span>', <span class="symbol">'adverb</span>'), (<span class="symbol">'把</span>', <span class="symbol">'preposition</span>'), (<span class="symbol">'手</span>', <span class="symbol">'noun</span>'), (<span class="symbol">'放</span>', <span class="symbol">'verb</span>'), (<span class="symbol">'在</span>', <span class="symbol">'preposition</span>'), (<span class="symbol">'我</span>', <span class="symbol">'pronoun</span>'), (<span class="symbol">'的</span>', <span class="symbol">'particle</span>'), (<span class="symbol">'肩膀</span>', <span class="symbol">'noun</span>'), (<span class="symbol">'上</span>', <span class="symbol">'noun</span> of locality'), (<span class="symbol">'，</span>', <span class="symbol">'punctuation</span> mark'), (<span class="symbol">'工</span>', <span class="symbol">'noun</span>'), (<span class="symbol">'信</span>', <span class="symbol">'noun</span>'), (<span class="symbol">'处女</span>', <span class="symbol">'noun</span>'), (<span class="symbol">'干事</span>', <span class="symbol">'noun</span>'), (<span class="symbol">'每月</span>', <span class="symbol">'pronoun</span>'), (<span class="symbol">'经过</span>', <span class="symbol">'preposition</span>'), (<span class="symbol">'下属</span>', <span class="symbol">'verb</span>'), (<span class="symbol">'科室</span>', <span class="symbol">'noun</span>'), (<span class="symbol">'都</span>', <span class="symbol">'adverb</span>'), (<span class="symbol">'要</span>', <span class="symbol">'verb</span>'), (<span class="symbol">'亲口</span>', <span class="symbol">'adverb</span>'), (<span class="symbol">'交代</span>', <span class="symbol">'verb</span>'), (<span class="symbol">'24</span>', <span class="symbol">'numeral</span>'), (<span class="symbol">'口</span>', <span class="symbol">'classifier</span>'), (<span class="symbol">'交换机</span>', <span class="symbol">'noun</span>'), (<span class="symbol">'等</span>', <span class="symbol">'particle</span>'), (<span class="symbol">'技术性</span>', <span class="symbol">'noun</span>'), (<span class="symbol">'器件</span>', <span class="symbol">'noun</span>'), (<span class="symbol">'的</span>', <span class="symbol">'particle</span>'), (<span class="symbol">'安装</span>', <span class="symbol">'verb</span>'), (<span class="symbol">'工作</span>', <span class="symbol">'verb</span>')]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 把手 和 和服 也被分开了。</p>
                  <h3 id="5-NLTK"><a href="#5-NLTK" class="headerlink" title="5. NLTK"></a>5. NLTK</h3>
                  <p>NLTK，Natural Language Toolkit，是一个自然语言处理的包工具，各种多种 NLP 处理相关功能，GitHub 链接：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL25sdGsvbmx0aw==">https://github.com/nltk/nltk<i class="fa fa-external-link-alt"></i></span>。 但是 NLTK 对于中文分词是不支持的，示例如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">from</span> <span class="variable">nltk</span> <span class="variable">import</span> <span class="variable">word_tokenize</span></span><br><span class="line"></span><br><span class="line"><span class="variable">string</span> = <span class="string">'这个把手该换了，我不喜欢日本和服，别把手放在我的肩膀上，工信处女干事每月经过下属科室都要亲口交代24口交换机等技术性器件的安装工作'</span></span><br><span class="line"><span class="variable"><span class="class">result</span></span> = <span class="function"><span class="title">word_tokenize</span>(<span class="variable">string</span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable"><span class="class">result</span></span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'这个把手该换了，我不喜欢日本和服，别把手放在我的肩膀上，工信处女干事每月经过下属科室都要亲口交代24口交换机等技术性器件的安装工作</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果要用中文分词的话，可以使用 FoolNLTK，它使用 Bi-LSTM 训练而成，包含分词、词性标注、实体识别等功能，同时支持自定义词典，可以训练自己的模型，可以进行批量处理。 使用方法如下：</p>
                  <figure class="highlight go">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> fool</span><br><span class="line"></span><br><span class="line"><span class="keyword">string</span> = <span class="string">'这个把手该换了，我不喜欢日本和服，别把手放在我的肩膀上，工信处女干事每月经过下属科室都要亲口交代24口交换机等技术性器件的安装工作'</span></span><br><span class="line">result = fool.cut(<span class="keyword">string</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[[<span class="symbol">'这个</span>', <span class="symbol">'把手</span>', <span class="symbol">'该</span>', <span class="symbol">'换</span>', <span class="symbol">'了</span>', <span class="symbol">'，</span>', <span class="symbol">'我</span>', <span class="symbol">'不</span>', <span class="symbol">'喜欢</span>', <span class="symbol">'日本</span>', <span class="symbol">'和服</span>', <span class="symbol">'，</span>', <span class="symbol">'别</span>', <span class="symbol">'把</span>', <span class="symbol">'手</span>', <span class="symbol">'放</span>', <span class="symbol">'在</span>', <span class="symbol">'我</span>', <span class="symbol">'的</span>', <span class="symbol">'肩膀</span>', <span class="symbol">'上</span>', <span class="symbol">'，</span>', <span class="symbol">'工信处</span>', <span class="symbol">'女</span>', <span class="symbol">'干事</span>', <span class="symbol">'每月</span>', <span class="symbol">'经过</span>', <span class="symbol">'下属</span>', <span class="symbol">'科室</span>', <span class="symbol">'都</span>', <span class="symbol">'要</span>', <span class="symbol">'亲</span>', <span class="symbol">'口</span>', <span class="symbol">'交代</span>', <span class="symbol">'24</span>', <span class="symbol">'口</span>', <span class="symbol">'交换机</span>', <span class="symbol">'等</span>', <span class="symbol">'技术性</span>', <span class="symbol">'器件</span>', <span class="symbol">'的</span>', <span class="symbol">'安装</span>', <span class="symbol">'工作</span>']]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到这个分词效果还是不错的。 另外还可以进行词性标注，实体识别：</p>
                  <figure class="highlight gauss">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">result = fool.pos_cut(<span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">print</span>(result)</span><br><span class="line">_, ners = fool.analysis(<span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">print</span>(ners)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[[(<span class="symbol">'这个</span>', <span class="symbol">'r</span>'), (<span class="symbol">'把手</span>', <span class="symbol">'n</span>'), (<span class="symbol">'该</span>', <span class="symbol">'r</span>'), (<span class="symbol">'换</span>', <span class="symbol">'v</span>'), (<span class="symbol">'了</span>', <span class="symbol">'y</span>'), (<span class="symbol">'，</span>', <span class="symbol">'wd</span>'), (<span class="symbol">'我</span>', <span class="symbol">'r</span>'), (<span class="symbol">'不</span>', <span class="symbol">'d</span>'), (<span class="symbol">'喜欢</span>', <span class="symbol">'vi</span>'), (<span class="symbol">'日本</span>', <span class="symbol">'ns</span>'), (<span class="symbol">'和服</span>', <span class="symbol">'n</span>'), (<span class="symbol">'，</span>', <span class="symbol">'wd</span>'), (<span class="symbol">'别</span>', <span class="symbol">'d</span>'), (<span class="symbol">'把</span>', <span class="symbol">'pba</span>'), (<span class="symbol">'手</span>', <span class="symbol">'n</span>'), (<span class="symbol">'放</span>', <span class="symbol">'v</span>'), (<span class="symbol">'在</span>', <span class="symbol">'p</span>'), (<span class="symbol">'我</span>', <span class="symbol">'r</span>'), (<span class="symbol">'的</span>', <span class="symbol">'ude</span>'), (<span class="symbol">'肩膀</span>', <span class="symbol">'n</span>'), (<span class="symbol">'上</span>', <span class="symbol">'f</span>'), (<span class="symbol">'，</span>', <span class="symbol">'wd</span>'), (<span class="symbol">'工信处</span>', <span class="symbol">'ns</span>'), (<span class="symbol">'女</span>', <span class="symbol">'b</span>'), (<span class="symbol">'干事</span>', <span class="symbol">'n</span>'), (<span class="symbol">'每月</span>', <span class="symbol">'r</span>'), (<span class="symbol">'经过</span>', <span class="symbol">'p</span>'), (<span class="symbol">'下属</span>', <span class="symbol">'v</span>'), (<span class="symbol">'科室</span>', <span class="symbol">'n</span>'), (<span class="symbol">'都</span>', <span class="symbol">'d</span>'), (<span class="symbol">'要</span>', <span class="symbol">'v</span>'), (<span class="symbol">'亲</span>', <span class="symbol">'a</span>'), (<span class="symbol">'口</span>', <span class="symbol">'n</span>'), (<span class="symbol">'交代</span>', <span class="symbol">'v</span>'), (<span class="symbol">'24</span>', <span class="symbol">'m</span>'), (<span class="symbol">'口</span>', <span class="symbol">'q</span>'), (<span class="symbol">'交换机</span>', <span class="symbol">'n</span>'), (<span class="symbol">'等</span>', <span class="symbol">'udeng</span>'), (<span class="symbol">'技术性</span>', <span class="symbol">'n</span>'), (<span class="symbol">'器件</span>', <span class="symbol">'n</span>'), (<span class="symbol">'的</span>', <span class="symbol">'ude</span>'), (<span class="symbol">'安装</span>', <span class="symbol">'n</span>'), (<span class="symbol">'工作</span>', <span class="symbol">'n</span>')]]</span><br><span class="line">[[(<span class="name">12</span>, <span class="number">15</span>, <span class="symbol">'location</span>', <span class="symbol">'日本</span>')]]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="6-LTP"><a href="#6-LTP" class="headerlink" title="6. LTP"></a>6. LTP</h3>
                  <p>语言技术平台（Language Technology Platform，LTP）是哈工大社会计算与信息检索研究中心历时十年开发的一整套中文语言处理系统。LTP制定了基于XML的语言处理结果表示，并在此基础上提供了一整套自底向上的丰富而且高效的中文语言处理模块（包括词法、句法、语义等6项中文处理核心技术），以及基于动态链接库（Dynamic Link Library, DLL）的应用程序接口、可视化工具，并且能够以网络服务（Web Service）的形式进行使用。 LTP 有 Python 版本，GitHub地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0hJVC1TQ0lSL3B5bHRw">https://github.com/HIT-SCIR/pyltp<i class="fa fa-external-link-alt"></i></span>，另外运行的时候需要下载模型，模型还比较大，下载地址：<span class="exturl" data-url="aHR0cDovL2x0cC5haS9kb3dubG9hZC5odG1s">http://ltp.ai/download.html<i class="fa fa-external-link-alt"></i></span>。 示例代码如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">from</span> <span class="variable">pyltp</span> <span class="variable">import</span> <span class="variable">Segmentor</span></span><br><span class="line"></span><br><span class="line"><span class="variable">string</span> = <span class="string">'这个把手该换了，我不喜欢日本和服，别把手放在我的肩膀上，工信处女干事每月经过下属科室都要亲口交代24口交换机等技术性器件的安装工作'</span></span><br><span class="line"><span class="variable">segmentor</span> = <span class="function"><span class="title">Segmentor</span>()</span></span><br><span class="line"><span class="variable">segmentor.load</span>(<span class="string">'./cws.model'</span>)</span><br><span class="line"><span class="variable"><span class="class">result</span></span> = <span class="function"><span class="title">list</span>(<span class="variable">segmentor.segment</span>(<span class="variable">string</span>))</span></span><br><span class="line"><span class="variable">segmentor.release</span>()</span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable"><span class="class">result</span></span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">41</span> 这个<span class="regexp">/把手/</span>该<span class="regexp">/换/</span>了<span class="regexp">/，/</span>我<span class="regexp">/不/</span>喜欢<span class="regexp">/日本/</span>和服<span class="regexp">/，/</span>别<span class="regexp">/把/</span>手<span class="regexp">/放在/</span>我<span class="regexp">/的/</span>肩膀<span class="regexp">/上/</span>，<span class="regexp">/工信/</span>处女<span class="regexp">/干事/</span>每月<span class="regexp">/经过/</span>下属<span class="regexp">/科室/</span>都<span class="regexp">/要/</span>亲口<span class="regexp">/交代/</span><span class="number">24</span><span class="regexp">/口/</span>交换机<span class="regexp">/等/</span>技术性<span class="regexp">/器件/</span>的<span class="regexp">/安装/</span>工作</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现 工信处、女干事 没有正确分开。 以上便是一些分词库的基本使用，个人比较推荐的有 jieba、THULAC、FoolNLTK。</p>
                  <h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2>
                  <ul>
                    <li><span class="exturl" data-url="aHR0cDovL202MzU2NzQ2MDguaXRleWUuY29tL2Jsb2cvMjI5ODgzMw==">http://m635674608.iteye.com/blog/2298833<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZmx5c2t5MTk5MS9hcnRpY2xlL2RldGFpbHMvNzM5NDg5NzE=">http://blog.csdn.net/flysky1991/article/details/73948971<i class="fa fa-external-link-alt"></i></span></li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-03-15 21:32:47" itemprop="dateCreated datePublished" datetime="2018-03-15T21:32:47+08:00">2018-03-15</time>
                </span>
                <span id="/5844.html" class="post-meta-item leancloud_visitors" data-flag-title="中文分词原理及工具" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>11k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>10 分钟</span>
                </span>
              </div>
            </article>
            <script>
              document.querySelectorAll('.random').forEach(item => item.src = "https://picsum.photos/id/" + Math.floor(Math.random() * Math.floor(300)) + "/200/133")

            </script>
            <nav class="pagination">
              <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
            </nav>
          </div>
          <script>
            window.addEventListener('tabs:register', () =>
            {
              let
              {
                activeClass
              } = CONFIG.comments;
              if (CONFIG.comments.storage)
              {
                activeClass = localStorage.getItem('comments_active') || activeClass;
              }
              if (activeClass)
              {
                let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
                if (activeTab)
                {
                  activeTab.click();
                }
              }
            });
            if (CONFIG.comments.storage)
            {
              window.addEventListener('tabs:click', event =>
              {
                if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
                let commentClass = event.target.classList[1];
                localStorage.setItem('comments_active', commentClass);
              });
            }

          </script>
        </div>
        <div class="toggle sidebar-toggle">
          <span class="toggle-line toggle-line-first"></span>
          <span class="toggle-line toggle-line-middle"></span>
          <span class="toggle-line toggle-line-last"></span>
        </div>
        <aside class="sidebar">
          <div class="sidebar-inner">
            <ul class="sidebar-nav motion-element">
              <li class="sidebar-nav-toc"> 文章目录 </li>
              <li class="sidebar-nav-overview"> 站点概览 </li>
            </ul>
            <!--noindex-->
            <div class="post-toc-wrap sidebar-panel">
            </div>
            <!--/noindex-->
            <div class="site-overview-wrap sidebar-panel">
              <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <img class="site-author-image" itemprop="image" alt="崔庆才" src="/images/avatar.png">
                <p class="site-author-name" itemprop="name">崔庆才</p>
                <div class="site-description" itemprop="description">静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。</div>
              </div>
              <div class="site-state-wrap motion-element">
                <nav class="site-state">
                  <div class="site-state-item site-state-posts">
                    <a href="/archives/">
                      <span class="site-state-item-count">667</span>
                      <span class="site-state-item-name">日志</span>
                    </a>
                  </div>
                  <div class="site-state-item site-state-categories">
                    <a href="/categories/">
                      <span class="site-state-item-count">27</span>
                      <span class="site-state-item-name">分类</span></a>
                  </div>
                  <div class="site-state-item site-state-tags">
                    <a href="/tags/">
                      <span class="site-state-item-count">226</span>
                      <span class="site-state-item-name">标签</span></a>
                  </div>
                </nav>
              </div>
              <div class="links-of-author motion-element">
                <span class="links-of-author-item">
                  <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dlcm1leQ==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Germey"><i class="fab fa-github fa-fw"></i>GitHub</span>
                </span>
                <span class="links-of-author-item">
                  <span class="exturl" data-url="bWFpbHRvOmNxY0BjdWlxaW5nY2FpLmNvbS5jb20=" title="邮件 → mailto:cqc@cuiqingcai.com.com"><i class="fa fa-envelope fa-fw"></i>邮件</span>
                </span>
                <span class="links-of-author-item">
                  <span class="exturl" data-url="aHR0cHM6Ly93ZWliby5jb20vY3VpcWluZ2NhaQ==" title="微博 → https:&#x2F;&#x2F;weibo.com&#x2F;cuiqingcai"><i class="fab fa-weibo fa-fw"></i>微博</span>
                </span>
                <span class="links-of-author-item">
                  <span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9HZXJtZXk=" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;Germey"><i class="fa fa-magic fa-fw"></i>知乎</span>
                </span>
              </div>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/ei5og.jpg" style=" width: 100%;">
              </a>
            </div>
            <div class="sidebar-panel sidebar-panel-categories sidebar-panel-active">
              <h4 class="name"> 分类 </h4>
              <div class="content">
                <ul class="category-list">
                  <li class="category-list-item"><a class="category-list-link" href="/categories/C-C/">C/C++</a><span class="category-list-count">23</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><span class="category-list-count">14</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">5</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">26</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">15</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Net/">Net</a><span class="category-list-count">4</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a><span class="category-list-count">39</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">27</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Paper/">Paper</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">302</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/TypeScript/">TypeScript</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E5%B1%95%E7%A4%BA/">个人展示</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E6%97%A5%E8%AE%B0/">个人日记</a><span class="category-list-count">9</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E8%AE%B0%E5%BD%95/">个人记录</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94/">个人随笔</a><span class="category-list-count">21</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">安装配置</a><span class="category-list-count">59</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/">技术杂谈</a><span class="category-list-count">92</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a><span class="category-list-count">4</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E7%AC%94%E8%AE%B0/">生活笔记</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A6%8F%E5%88%A9%E4%B8%93%E5%8C%BA/">福利专区</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E8%81%8C%E4%BD%8D%E6%8E%A8%E8%8D%90/">职位推荐</a><span class="category-list-count">2</span></li>
                </ul>
              </div>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="http://www.ipidea.net/?utm-source=cqc&utm-keyword=?cqc" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/0ywun.png" style=" width: 100%;">
              </a>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://tutorial.lengyue.video/?coupon=12ef4b1a-a3db-11ea-bb37-0242ac130002_cqx_850" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/bco2a.png" style=" width: 100%;">
              </a>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://www.tianqiip.com/?did=OP6kGa" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/bv71c.png" style=" width: 100%;">
              </a>
            </div>
            <div class="sidebar-panel sidebar-panel-friends sidebar-panel-active">
              <h4 class="name"> 友情链接 </h4>
              <ul class="friends">
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/j2dub.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.findhao.net/" target="_blank" rel="noopener">FindHao</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/6apxu.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.51dev.com/" target="_blank" rel="noopener">IT技术社区</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/bqlbs.png">
                  </span>
                  <span class="link">
                    <a href="http://www.urselect.com/" target="_blank" rel="noopener">优社电商</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/8s88c.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yuanrenxue.com/" target="_blank" rel="noopener">猿人学</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/2wgg5.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yunlifang.cn/" target="_blank" rel="noopener">云立方</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/shwr6.png">
                  </span>
                  <span class="link">
                    <a href="http://lanbing510.info/" target="_blank" rel="noopener">冰蓝</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/blvoh.jpg">
                  </span>
                  <span class="link">
                    <a href="https://lengyue.me/" target="_blank" rel="noopener">冷月</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="http://qianxunclub.com/favicon.png">
                  </span>
                  <span class="link">
                    <a href="http://qianxunclub.com/" target="_blank" rel="noopener">千寻啊千寻</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/0044u.jpg">
                  </span>
                  <span class="link">
                    <a href="http://kodcloud.com/" target="_blank" rel="noopener">可道云</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ygnpn.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.kunkundashen.cn/" target="_blank" rel="noopener">坤坤大神</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.503error.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.503error.com/" target="_blank" rel="noopener">张志明个人博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/x714o.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.hubwiz.com/" target="_blank" rel="noopener">汇智网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.xiongge.club/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.xiongge.club/" target="_blank" rel="noopener">熊哥club</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/3w4fe.png">
                  </span>
                  <span class="link">
                    <a href="https://zerlong.com/" target="_blank" rel="noopener">知语</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/44hxf.png">
                  </span>
                  <span class="link">
                    <a href="http://redstonewill.com/" target="_blank" rel="noopener">红色石头</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/8g1fk.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.laodong.me/" target="_blank" rel="noopener">老董博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/wkaus.jpg">
                  </span>
                  <span class="link">
                    <a href="https://zhaoshuai.me/" target="_blank" rel="noopener">碎念</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/pgo0r.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.chenwenguan.com/" target="_blank" rel="noopener">陈文管的博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/kk82a.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.lxlinux.net/" target="_blank" rel="noopener">良许Linux教程网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/lj0t2.jpg">
                  </span>
                  <span class="link">
                    <a href="https://tanqingbo.cn/" target="_blank" rel="noopener">IT码农</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/i8cdr.png">
                  </span>
                  <span class="link">
                    <a href="https://junyiseo.com/" target="_blank" rel="noopener">均益个人博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/chwv2.png">
                  </span>
                  <span class="link">
                    <a href="https://brucedone.com/" target="_blank" rel="noopener">大鱼的鱼塘</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/2y43o.png">
                  </span>
                  <span class="link">
                    <a href="http://bbs.nightteam.cn/" target="_blank" rel="noopener">夜幕爬虫安全论坛</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/zvc3w.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.weishidong.com/" target="_blank" rel="noopener">韦世东的技术专栏</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ebudy.jpg">
                  </span>
                  <span class="link">
                    <a href="https://chuanjiabing.com/" target="_blank" rel="noopener">穿甲兵技术社区</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ala4d.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.91vps.com/" target="_blank" rel="noopener">91VPS</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/8y8y4.png">
                  </span>
                  <span class="link">
                    <a href="https://www.qg.net/" target="_blank" rel="noopener">青果网络</a>
                  </span>
                </li>
              </ul>
            </div>
            <div class="sidebar-panel sidebar-panel-tags sidebar-panel-active">
              <h4 class="name"> 标签云 </h4>
              <div class="content">
                <a href="/tags/2022/" style="font-size: 19px;">2022</a> <a href="/tags/2048/" style="font-size: 10px;">2048</a> <a href="/tags/ADSL/" style="font-size: 10px;">ADSL</a> <a href="/tags/API/" style="font-size: 13px;">API</a> <a href="/tags/Ajax/" style="font-size: 12px;">Ajax</a> <a href="/tags/Bootstrap/" style="font-size: 11px;">Bootstrap</a> <a href="/tags/Bug/" style="font-size: 10px;">Bug</a> <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/CQC/" style="font-size: 10px;">CQC</a> <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/CSS-%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 10px;">CSS 反爬虫</a> <a href="/tags/CV/" style="font-size: 10px;">CV</a> <a href="/tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/Eclipse/" style="font-size: 11px;">Eclipse</a> <a href="/tags/Elasticsearch/" style="font-size: 10px;">Elasticsearch</a> <a href="/tags/FTP/" style="font-size: 10px;">FTP</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/GitHub/" style="font-size: 13px;">GitHub</a> <a href="/tags/HTML5/" style="font-size: 10px;">HTML5</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Hook/" style="font-size: 10px;">Hook</a> <a href="/tags/IT/" style="font-size: 10px;">IT</a> <a href="/tags/JSON/" style="font-size: 10px;">JSON</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/JavaScript/" style="font-size: 14px;">JavaScript</a> <a href="/tags/K8s/" style="font-size: 10px;">K8s</a> <a href="/tags/LOGO/" style="font-size: 10px;">LOGO</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MIUI/" style="font-size: 10px;">MIUI</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/MongoDB/" style="font-size: 11px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/NBA/" style="font-size: 10px;">NBA</a> <a href="/tags/OCR/" style="font-size: 10px;">OCR</a> <a href="/tags/OpenCV/" style="font-size: 10px;">OpenCV</a> <a href="/tags/PHP/" style="font-size: 11px;">PHP</a> <a href="/tags/PPT/" style="font-size: 10px;">PPT</a> <a href="/tags/PS/" style="font-size: 10px;">PS</a> <a href="/tags/Pathlib/" style="font-size: 10px;">Pathlib</a> <a href="/tags/PhantomJS/" style="font-size: 10px;">PhantomJS</a> <a href="/tags/Playwright/" style="font-size: 10px;">Playwright</a> <a href="/tags/Python/" style="font-size: 16px;">Python</a> <a href="/tags/Python-%E7%88%AC%E8%99%AB/" style="font-size: 17px;">Python 爬虫</a> <a href="/tags/Python3/" style="font-size: 11px;">Python3</a> <a href="/tags/Python3%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/" style="font-size: 12px;">Python3爬虫教程</a> <a href="/tags/Pythonic/" style="font-size: 10px;">Pythonic</a> <a href="/tags/Python%E7%88%AC%E8%99%AB/" style="font-size: 18px;">Python爬虫</a> <a href="/tags/Python%E7%88%AC%E8%99%AB%E4%B9%A6/" style="font-size: 12px;">Python爬虫书</a> <a href="/tags/Python%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/" style="font-size: 15px;">Python爬虫教程</a> <a href="/tags/QQ/" style="font-size: 10px;">QQ</a> <a href="/tags/RabbitMQ/" style="font-size: 10px;">RabbitMQ</a> <a href="/tags/ReCAPTCHA/" style="font-size: 10px;">ReCAPTCHA</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SAE/" style="font-size: 10px;">SAE</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/SVG/" style="font-size: 10px;">SVG</a> <a href="/tags/Scrapy-redis/" style="font-size: 10px;">Scrapy-redis</a> <a href="/tags/Scrapy%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">Scrapy分布式</a> <a href="/tags/Selenium/" style="font-size: 11px;">Selenium</a> <a href="/tags/Session/" style="font-size: 10px;">Session</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/TKE/" style="font-size: 10px;">TKE</a> <a href="/tags/TXT/" style="font-size: 10px;">TXT</a> <a href="/tags/Terminal/" style="font-size: 10px;">Terminal</a> <a href="/tags/Ubuntu/" style="font-size: 11px;">Ubuntu</a> <a href="/tags/VS-Code/" style="font-size: 10px;">VS Code</a> <a href="/tags/Vs-Code/" style="font-size: 10px;">Vs Code</a> <a href="/tags/Vue/" style="font-size: 11px;">Vue</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/Web%E7%BD%91%E9%A1%B5/" style="font-size: 10px;">Web网页</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/Winpcap/" style="font-size: 10px;">Winpcap</a> <a href="/tags/WordPress/" style="font-size: 13px;">WordPress</a> <a href="/tags/XPath/" style="font-size: 12px;">XPath</a> <a href="/tags/Youtube/" style="font-size: 11px;">Youtube</a> <a href="/tags/aiohttp/" style="font-size: 10px;">aiohttp</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/cocos2d-x/" style="font-size: 10px;">cocos2d-x</a> <a href="/tags/dummy-change/" style="font-size: 10px;">dummy change</a> <a href="/tags/e6/" style="font-size: 10px;">e6</a> <a href="/tags/fitvids/" style="font-size: 10px;">fitvids</a> <a href="/tags/git/" style="font-size: 11px;">git</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/js%E9%80%86%E5%90%91/" style="font-size: 10px;">js逆向</a> <a href="/tags/kubernetes/" style="font-size: 10px;">kubernetes</a> <a href="/tags/log/" style="font-size: 10px;">log</a> <a href="/tags/log4j/" style="font-size: 10px;">log4j</a> <a href="/tags/logging/" style="font-size: 10px;">logging</a> <a href="/tags/matlab/" style="font-size: 11px;">matlab</a> <a href="/tags/parsel/" style="font-size: 10px;">parsel</a> <a href="/tags/pymongo/" style="font-size: 10px;">pymongo</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/pytube/" style="font-size: 11px;">pytube</a> <a href="/tags/pywin32/" style="font-size: 10px;">pywin32</a> <a href="/tags/requests/" style="font-size: 10px;">requests</a>
              </div>
              <script>
                const tagsColors = ['#00a67c', '#5cb85c', '#d9534f', '#567e95', '#b37333', '#f4843d', '#15a287']
                const tagsElements = document.querySelectorAll('.sidebar-panel-tags .content a')
                tagsElements.forEach((item) =>
                {
                  item.style.backgroundColor = tagsColors[Math.floor(Math.random() * tagsColors.length)]
                })

              </script>
            </div>
          </div>
        </aside>
        <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
        <div class="copyright">
          <span class="author" itemprop="copyrightHolder">崔庆才丨静觅</span> &copy; <span itemprop="copyrightYear">2022</span>
          <span class="with-love">
            <i class="fa fa-heart"></i>
          </span>
          <a href="https://cuiqingcai.com/sitemap.xml" style="display:none" title="爬虫教程" target="_blank"><strong>爬虫教程</strong></a>
          <a href="https://cuiqingcai.com/sitemap.html" style="display:none" title="爬虫教程" target="_blank"><strong>爬虫教程</strong></a>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-chart-area"></i>
          </span>
          <span title="站点总字数">3.1m</span>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-coffee"></i>
          </span>
          <span title="站点阅读时长">47:25</span>
        </div>
        <div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl theme-link" data-url="aHR0cHM6Ly9waXNjZXMudGhlbWUtbmV4dC5vcmc=">NexT.Pisces</span> 强力驱动 </div>
        <div class="beian"><span class="exturl" data-url="aHR0cHM6Ly9iZWlhbi5taWl0Lmdvdi5jbg==">京ICP备18015597号-1 </span>
        </div>
        <script>
          (function ()
          {
            function leancloudSelector(url)
            {
              url = encodeURI(url);
              return document.getElementById(url).querySelector('.leancloud-visitors-count');
            }

            function addCount(Counter)
            {
              var visitors = document.querySelector('.leancloud_visitors');
              var url = decodeURI(visitors.id);
              var title = visitors.dataset.flagTitle;
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                if (results.length > 0)
                {
                  var counter = results[0];
                  leancloudSelector(url).innerText = counter.time + 1;
                  Counter('put', '/classes/Counter/' + counter.objectId,
                  {
                    time:
                    {
                      '__op': 'Increment',
                      'amount': 1
                    }
                  }).catch(error =>
                  {
                    console.error('Failed to save visitor count', error);
                  });
                }
                else
                {
                  Counter('post', '/classes/Counter',
                  {
                    title,
                    url,
                    time: 1
                  }).then(response => response.json()).then(() =>
                  {
                    leancloudSelector(url).innerText = 1;
                  }).catch(error =>
                  {
                    console.error('Failed to create', error);
                  });
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }

            function showTime(Counter)
            {
              var visitors = document.querySelectorAll('.leancloud_visitors');
              var entries = [...visitors].map(element =>
              {
                return decodeURI(element.id);
              });
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url:
                {
                  '$in': entries
                }
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                for (let url of entries)
                {
                  let target = results.find(item => item.url === url);
                  leancloudSelector(url).innerText = target ? target.time : 0;
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }
            let
            {
              app_id,
              app_key,
              server_url
            } = {
              "enable": true,
              "app_id": "6X5dRQ0pnPWJgYy8SXOg0uID-gzGzoHsz",
              "app_key": "ziLDVEy73ne5HtFTiGstzHMS",
              "server_url": "https://6x5drq0p.lc-cn-n1-shared.com",
              "security": false
            };

            function fetchData(api_server)
            {
              var Counter = (method, url, data) =>
              {
                return fetch(`${api_server}/1.1${url}`,
                {
                  method,
                  headers:
                  {
                    'X-LC-Id': app_id,
                    'X-LC-Key': app_key,
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(data)
                });
              };
              if (CONFIG.page.isPost)
              {
                if (CONFIG.hostname !== location.hostname) return;
                addCount(Counter);
              }
              else if (document.querySelectorAll('.post-title-link').length >= 1)
              {
                showTime(Counter);
              }
            }
            let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;
            if (api_server)
            {
              fetchData(api_server);
            }
            else
            {
              fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id).then(response => response.json()).then((
              {
                api_server
              }) =>
              {
                fetchData('https://' + api_server);
              });
            }
          })();

        </script>
      </div>
      <div class="footer-stat">
        <span id="cnzz_stat_icon_1279355174"></span>
        <script type="text/javascript">
          document.write(unescape("%3Cspan id='cnzz_stat_icon_1279355174'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1279355174%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));

        </script>
      </div>
    </footer>
  </div>
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/js/utils.js"></script>
  <script src="/.js"></script>
  <script src="/js/schemes/pisces.js"></script>
  <script src="/.js"></script>
  <script src="/js/next-boot.js"></script>
  <script src="/.js"></script>
  <script>
    (function ()
    {
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x = document.getElementsByTagName("link");
      //Find the last canonical URL
      if (x.length > 0)
      {
        for (i = 0; i < x.length; i++)
        {
          if (x[i].rel.toLowerCase() == 'canonical' && x[i].href)
          {
            canonicalURL = x[i].href;
          }
        }
      }
      //Get protocol
      if (!canonicalURL)
      {
        curProtocol = window.location.protocol.split(':')[0];
      }
      else
      {
        curProtocol = canonicalURL.split(':')[0];
      }
      //Get current URL if the canonical URL does not exist
      if (!canonicalURL) canonicalURL = window.location.href;
      //Assign script content. Replace current URL with the canonical URL
      ! function ()
      {
        var e = /([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,
          r = canonicalURL,
          t = document.referrer;
        if (!e.test(r))
        {
          var n = (String(curProtocol).toLowerCase() === 'https') ? "https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif" : "//api.share.baidu.com/s.gif";
          t ? (n += "?r=" + encodeURIComponent(document.referrer), r && (n += "&l=" + r)) : r && (n += "?l=" + r);
          var i = new Image;
          i.src = n
        }
      }(window);
    })();

  </script>
  <script src="/js/local-search.js"></script>
  <script src="/.js"></script>
</body>

</html>
