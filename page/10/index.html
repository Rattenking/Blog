<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
  <meta name="theme-color" content="#222">
  <meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>
  <script id="hexo-configurations">
    var NexT = window.NexT ||
    {};
    var CONFIG = {
      "hostname": "cuiqingcai.com",
      "root": "/",
      "scheme": "Pisces",
      "version": "7.8.0",
      "exturl": true,
      "sidebar":
      {
        "position": "right",
        "width": 360,
        "display": "post",
        "padding": 18,
        "offset": 12,
        "onmobile": false,
        "widgets": [
          {
            "type": "image",
            "name": "阿布云",
            "enable": false,
            "url": "https://www.abuyun.com/http-proxy/introduce.html",
            "src": "https://qiniu.cuiqingcai.com/88au8.jpg",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "爬虫书",
            "url": "https://item.jd.com/13527222.html",
            "src": "https://qiniu.cuiqingcai.com/ei5og.jpg",
            "width": "100%",
            "enable": true
      },
          {
            "type": "categories",
            "name": "分类",
            "enable": true
      },
          {
            "type": "image",
            "name": "IPIDEA",
            "url": "http://www.ipidea.net/?utm-source=cqc&utm-keyword=?cqc",
            "src": "https://qiniu.cuiqingcai.com/0ywun.png",
            "width": "100%",
            "enable": true
      },
          {
            "type": "image",
            "name": "深度学习课",
            "enable": true,
            "url": "https://tutorial.lengyue.video/?coupon=12ef4b1a-a3db-11ea-bb37-0242ac130002_cqx_850",
            "src": "https://qiniu.cuiqingcai.com/bco2a.png",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "TianQiIP",
            "enable": true,
            "url": "https://www.tianqiip.com/?did=OP6kGa",
            "src": "https://qiniu.cuiqingcai.com/bv71c.png",
            "width": "100%"
      },
          {
            "type": "friends",
            "name": "友情链接",
            "enable": true
      },
          {
            "type": "hot",
            "name": "猜你喜欢",
            "enable": true
      },
          {
            "type": "tags",
            "name": "标签云",
            "enable": true
      }]
      },
      "copycode":
      {
        "enable": true,
        "show_result": true,
        "style": "mac"
      },
      "back2top":
      {
        "enable": true,
        "sidebar": false,
        "scrollpercent": true
      },
      "bookmark":
      {
        "enable": false,
        "color": "#222",
        "save": "auto"
      },
      "fancybox": false,
      "mediumzoom": false,
      "lazyload": false,
      "pangu": true,
      "comments":
      {
        "style": "tabs",
        "active": "gitalk",
        "storage": true,
        "lazyload": false,
        "nav": null,
        "activeClass": "gitalk"
      },
      "algolia":
      {
        "hits":
        {
          "per_page": 10
        },
        "labels":
        {
          "input_placeholder": "Search for Posts",
          "hits_empty": "We didn't find any results for the search: ${query}",
          "hits_stats": "${hits} results found in ${time} ms"
        }
      },
      "localsearch":
      {
        "enable": true,
        "trigger": "auto",
        "top_n_per_article": 10,
        "unescape": false,
        "preload": false
      },
      "motion":
      {
        "enable": false,
        "async": false,
        "transition":
        {
          "post_block": "bounceDownIn",
          "post_header": "slideDownIn",
          "post_body": "slideDownIn",
          "coll_header": "slideLeftIn",
          "sidebar": "slideUpIn"
        }
      },
      "path": "search.xml"
    };

  </script>
  <meta name="keywords" content="爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书,静觅,崔庆才">
  <meta name="robots" content="index,follow">
  <meta name="GOOGLEBOT" content="index,follow">
  <meta name="author" content="静觅丨崔庆才的个人站点">
  <meta name="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  <meta property="og:type" content="website">
  <meta property="og:title" content="静觅">
  <meta property="og:url" content="https://cuiqingcai.com/page/10/index.html">
  <meta property="og:site_name" content="静觅">
  <meta property="og:description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  <meta property="og:locale" content="zh_CN">
  <meta property="article:author" content="崔庆才">
  <meta property="article:tag" content="爬虫教程">
  <meta property="article:tag" content="爬虫">
  <meta property="article:tag" content="Python">
  <meta property="article:tag" content="Python爬虫">
  <meta property="article:tag" content="Python爬虫教程">
  <meta property="article:tag" content="爬虫书">
  <meta property="article:tag" content="静觅">
  <meta property="article:tag" content="崔庆才">
  <meta name="twitter:card" content="summary">
  <link rel="canonical" href="https://cuiqingcai.com/page/10/">
  <script id="page-configurations">
    // https://hexo.io/docs/variables.html
    CONFIG.page = {
      sidebar: "",
      isHome: true,
      isPost: false,
      lang: 'zh-CN'
    };

  </script>
  <title>静觅丨崔庆才的个人站点 - Python爬虫教程</title>
  <meta name="google-site-verification" content="p_bIcnvirkFzG2dYKuNDivKD8-STet5W7D-01woA2fc" />
  <meta name="sogou_site_verification" content="kBOV53NQqT" />
  <noscript>
    <style>
      .use-motion .brand,
      .use-motion .menu-item,
      .sidebar-inner,
      .use-motion .post-block,
      .use-motion .pagination,
      .use-motion .comments,
      .use-motion .post-header,
      .use-motion .post-body,
      .use-motion .collection-header
      {
        opacity: initial;
      }

      .use-motion .site-title,
      .use-motion .site-subtitle
      {
        opacity: initial;
        top: initial;
      }

      .use-motion .logo-line-before i
      {
        left: initial;
      }

      .use-motion .logo-line-after i
      {
        right: initial;
      }

    </style>
  </noscript>
  <link rel="alternate" href="/atom.xml" title="静觅" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner">
        <div class="site-brand-container">
          <div class="site-nav-toggle">
            <div class="toggle" aria-label="切换导航栏">
              <span class="toggle-line toggle-line-first"></span>
              <span class="toggle-line toggle-line-middle"></span>
              <span class="toggle-line toggle-line-last"></span>
            </div>
          </div>
          <div class="site-meta">
            <a href="/" class="brand" rel="start">
              <span class="logo-line-before"><i></i></span>
              <h1 class="site-title">静觅 <span class="site-subtitle"> 崔庆才的个人站点 - Python爬虫教程 </span>
              </h1>
              <span class="logo-line-after"><i></i></span>
            </a>
          </div>
          <div class="site-nav-right">
            <div class="toggle popup-trigger">
              <i class="fa fa-search fa-fw fa-lg"></i>
            </div>
          </div>
        </div>
        <nav class="site-nav">
          <ul id="menu" class="main-menu menu">
            <li class="menu-item menu-item-home">
              <a href="/" rel="section">首页</a>
            </li>
            <li class="menu-item menu-item-archives">
              <a href="/archives/" rel="section">文章列表</a>
            </li>
            <li class="menu-item menu-item-tags">
              <a href="/tags/" rel="section">文章标签</a>
            </li>
            <li class="menu-item menu-item-categories">
              <a href="/categories/" rel="section">文章分类</a>
            </li>
            <li class="menu-item menu-item-about">
              <a href="/about/" rel="section">关于博主</a>
            </li>
            <li class="menu-item menu-item-message">
              <a href="/message/" rel="section">给我留言</a>
            </li>
            <li class="menu-item menu-item-search">
              <a role="button" class="popup-trigger">搜索 </a>
            </li>
          </ul>
        </nav>
        <div class="search-pop-overlay">
          <div class="popup search-popup">
            <div class="search-header">
              <span class="search-icon">
                <i class="fa fa-search"></i>
              </span>
              <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
              </div>
              <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
              </span>
            </div>
            <div id="search-result">
              <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span>0%</span>
    </div>
    <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content index posts-expand">
            <div class="carousel">
              <div id="wowslider-container">
                <div class="ws_images">
                  <ul>
                    <li><a target="_blank" href="https://item.jd.com/13527222.html"><img title="Python3网络爬虫开发实战（第二版）上市了！" src="https://qiniu.cuiqingcai.com/prwgs.png" /></a></li>
                    <li><a target="_blank" href="https://t.lagou.com/fRCBRsRCSN6FA"><img title="52讲轻松搞定网络爬虫" src="https://qiniu.cuiqingcai.com/fqq5e.png" /></a></li>
                    <li><a target="_blank" href="https://brightdata.grsm.io/cuiqingcai"><img title="亮网络解锁器" src="https://qiniu.cuiqingcai.com/6qnb7.png" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/4320.html"><img title="Python3网络爬虫开发视频教程" src="https://qiniu.cuiqingcai.com/bjrny.jpg" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/5094.html"><img title="爬虫代理哪家强？十大付费代理详细对比评测出炉！" src="https://qiniu.cuiqingcai.com/nifs6.jpg" /></a></li>
                  </ul>
                </div>
                <div class="ws_thumbs">
                  <div>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/prwgs.png" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/fqq5e.png" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/6qnb7.png" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/bjrny.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/nifs6.jpg" /></a>
                  </div>
                </div>
                <div class="ws_shadow"></div>
              </div>
            </div>
            <link rel="stylesheet" href="/lib/wowslide/slide.css">
            <script src="/lib/wowslide/jquery.min.js"></script>
            <script src="/lib/wowslide/slider.js"></script>
            <script>
              jQuery("#wowslider-container").wowSlider(
              {
                effect: "cube",
                prev: "",
                next: "",
                duration: 20 * 100,
                delay: 100 * 100,
                width: 716,
                height: 297,
                autoPlay: true,
                playPause: true,
                stopOnHover: false,
                loop: false,
                bullets: 0,
                caption: true,
                captionEffect: "slide",
                controls: true,
                onBeforeStep: 0,
                images: 0
              });

            </script>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5822.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5822.html" class="post-title-link" itemprop="url">深度学习 GPU环境 Ubuntu 16.04 + Nvidia GTX 1080 + Python 3.6 + CUDA 9.0 + cuDNN 7.1 + TensorFlow 1.6 环境配置</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本节详细说明一下深度学习环境配置，Ubuntu 16.04 + Nvidia GTX 1080 + Python 3.6 + CUDA 9.0 + cuDNN 7.1 + TensorFlow 1.6。</p>
                  <h2 id="Python-3-6"><a href="#Python-3-6" class="headerlink" title="Python 3.6"></a>Python 3.6</h2>
                  <p>首先安装 Python 3.6，这里使用 Anaconda 3 来安装，下载地址：<span class="exturl" data-url="aHR0cHM6Ly93d3cuYW5hY29uZGEuY29tL2Rvd25sb2FkLyNsaW51eA==">https://www.anaconda.com/download/#linux<i class="fa fa-external-link-alt"></i></span>，点击 Download 按钮下载即可，这里下载的是 Anaconda 3-5.1 版本，如果下载速度过慢可以选择使用清华镜像：<span class="exturl" data-url="aHR0cHM6Ly9taXJyb3JzLnR1bmEudHNpbmdodWEuZWR1LmNuL2FuYWNvbmRhL2FyY2hpdmUv">https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/<i class="fa fa-external-link-alt"></i></span>。 下载下来之后目录下会出现一个 Anaconda3-5.1.0-Linux-x86_64.sh 文件，然后直接执行即可安装：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">bash</span> <span class="selector-tag">Anaconda3-5</span><span class="selector-class">.1</span><span class="selector-class">.0-Linux-x86_64</span><span class="selector-class">.sh</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>执行完毕之后按照默认设置走下来即可完成安装。 这里默认它会安装到用户目录下，如果想全局安装，可以在这一步输入你要安装的地址：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Anaconda3 will now be installed into <span class="keyword">this</span> <span class="string">location:</span></span><br><span class="line"><span class="regexp">/home/</span>cqc/anaconda3</span><br><span class="line"></span><br><span class="line">  - Press ENTER to confirm the location</span><br><span class="line">  - Press CTRL-C to abort the installation</span><br><span class="line">  - Or specify a different location below</span><br><span class="line"></span><br><span class="line">[<span class="regexp">/home/</span>cqc<span class="regexp">/anaconda3] &gt;&gt;&gt; /</span>usr<span class="regexp">/local/</span>anaconda3</span><br><span class="line">PREFIX=<span class="regexp">/usr/</span>local/anaconda3</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我指定了将其安装到 /usr/local/anaconda3 目录下，全局安装，所有用户共享，当然如果只想本用户使用的话使用默认配置即可。 安装完成之后添加 python3 和 pip3 的软链接：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo ln -s <span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/anaconda3/</span>bin/python3 <span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/sbin/</span>python3</span><br><span class="line">sudo ln -s <span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/anaconda3/</span>bin/pip <span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/sbin/</span>pip3</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里是将软连接其添加到 /usr/local/sbin 目录下了，它默认会存在于环境变量中，因此可以直接调用。 当然也可以选择把 /usr/local/anaconda3/bin 目录添加到环境变量中，可以修改 ~/.bashrc 文件，添加如下内容：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=/usr/local/anaconda3/bin$&#123;PATH:+:<span class="variable">$&#123;PATH&#125;</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后执行：</p>
                  <figure class="highlight bash">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>即可生效，下次登录时也会默认执行 ~/.bashrc 文件，也会生效。 接下来我们验证下 python3、pip3 命令是否都来自 Anaconda，命令如下：</p>
                  <figure class="highlight crystal">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 -V</span><br><span class="line">pip <span class="number">9.0</span>.<span class="number">1</span> from /usr/local/anaconda3/<span class="class"><span class="keyword">lib</span>/<span class="title">python3</span>.6/<span class="title">site</span>-<span class="title">packages</span> (<span class="title">python</span> 3.6)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">which python3</span><br><span class="line">/usr/local/anaconda3/bin/python3</span><br><span class="line">python3</span><br><span class="line">Python 3.6.4 |Anaconda, Inc.| (default, Jan 16 2018, 18:10:19) </span><br><span class="line">[GCC 7.2.0] on linux</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果输入 pip3 和 python3 命令能出现如上类似结果，路径都在 /usr/local/anaconda3，就证明 Python 3 安装成功了。</p>
                  <h2 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h2>
                  <p>首先查看一下自己的电脑需要怎样的驱动，我们可以先到 <span class="exturl" data-url="aHR0cDovL3d3dy5udmlkaWEuY29tL0Rvd25sb2FkL2luZGV4LmFzcHg=">http://www.nvidia.com/Download/index.aspx<i class="fa fa-external-link-alt"></i></span> 查询下我们需要的是怎样的驱动，这里我的显卡是 GTX 1080，所以以此为例说明，勾选好对应的配置： <img src="https://germey.gitbooks.io/ai/content/assets/2018-03-11-18-46-41.jpg" alt=""> 点击 Search，可以看到查询结果如下所示：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">Version:</span>    <span class="number">390.25</span></span><br><span class="line"><span class="attr">Release Date:</span>    <span class="number">2018.1</span><span class="number">.29</span></span><br><span class="line"><span class="attr">Operating System:</span>    <span class="string">Linux</span> <span class="number">64</span><span class="string">-bit</span></span><br><span class="line"><span class="attr">Language:</span>    <span class="string">English</span> <span class="string">(US)</span></span><br><span class="line"><span class="attr">File Size:</span>    <span class="number">77.48</span> <span class="string">MB</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里说明我们需要的版本是 390.25。 接下来如果我们之前安装了驱动的话，可以重新安装一下，如果当前已经安装好了就不必了。 如果要重装，需要首先卸载掉之前的显卡驱动：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> <span class="builtin-name">remove</span> –purge nvidia*</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行之后 NVIDIA 的一些驱动就被卸载了。 这时候 nvidia-smi 等命令已经不能用了，这就证明显卡驱动已经被卸载了。 然后接下来添加一个 PPA 源，命令如下：</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo<span class="built_in"> add-apt-repository </span>ppa:graphics-drivers/ppa</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后更新一下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">update</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>随后重新安装显卡驱动：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install nvidia-390</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>注意这里的 390 就是刚才我们查询出来的版本，以实际查询出来的版本为准。</p>
                  <h2 id="CUDA-9-0"><a href="#CUDA-9-0" class="headerlink" title="CUDA 9.0"></a>CUDA 9.0</h2>
                  <p>如果存在之前的旧版本，可以选择先卸载，以免和新的 CUDA 版本产生冲突，在 /usr/local/cuda/bin 目录下有一个 uninstallcuda*.pl 文件，可以直接运行卸载，命令如下：</p>
                  <figure class="highlight jboss-cli">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo <span class="string">./uninstall_cuda_</span>*<span class="string">.pl</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样即可将 CUDA 全部卸载。 接下来我们再下载 CUDA 9.0，注意 TensorFlow 1.5 和 1.6 版本依然只是兼容 CUDA 9.0，没有兼容 CUDA 9.1，所以不要下载 9.1，CUDA 9.0 的下载地址是：<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubnZpZGlhLmNvbS9jdWRhLTkwLWRvd25sb2FkLWFyY2hpdmU=">https://developer.nvidia.com/cuda-90-download-archive<i class="fa fa-external-link-alt"></i></span>，然后依次勾选好系统的版本，如图所示： <img src="https://germey.gitbooks.io/ai/content/assets/2018-03-11-23-37-55.jpg" alt=""> 这里我们选择 Linux-x86_64-Ubuntu-16.04-runfile 的配置，然后点击 Base Installer 部分的 Download 按钮，下载 CUDA 9.0 安装包。 对应的下载命令是：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">wget https:<span class="regexp">//</span>developer.nvidia.com<span class="regexp">/compute/</span>cuda<span class="regexp">/9.0/</span>Prod<span class="regexp">/local_installers/</span>cuda_9.<span class="number">0.176</span>_384.<span class="number">81</span>_linux-run</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>执行此命令，等待下载完成即可。 接下来执行安装，运行如下命令：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo bash cuda_9<span class="number">.0</span><span class="number">.176</span>_384<span class="number">.81</span>_linux-run</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装过程需要输入一些确认选项，过程如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Description</span><br><span class="line"></span><br><span class="line">The NVIDIA CUDA Toolkit provides command-line <span class="keyword">and</span> graphical</span><br><span class="line">tools <span class="keyword">for</span> building, debugging <span class="keyword">and</span> optimizing the performance</span><br><span class="line"><span class="keyword">Do</span> you accept the previously read EULA?</span><br><span class="line">accept/decline/quit: accept</span><br><span class="line"></span><br><span class="line">Install NVIDIA Accelerated Graphics Driver <span class="keyword">for</span> Linux-x86_64 384.81?</span><br><span class="line">(y)es/(n)o/(q)uit: n</span><br><span class="line"></span><br><span class="line">Install the CUDA 9.0 Toolkit?</span><br><span class="line">(y)es/(n)o/(q)uit: y</span><br><span class="line"></span><br><span class="line">Enter Toolkit Location</span><br><span class="line"> [<span class="built_in"> default </span>is /usr/local/cuda-9.0 ]: </span><br><span class="line"></span><br><span class="line"><span class="keyword">Do</span> you want <span class="keyword">to</span> install a symbolic link at /usr/local/cuda?</span><br><span class="line">(y)es/(n)o/(q)uit: y</span><br><span class="line"></span><br><span class="line">Install the CUDA 9.0 Samples?</span><br><span class="line">(y)es/(n)o/(q)uit: y</span><br><span class="line"></span><br><span class="line">Enter CUDA Samples Location</span><br><span class="line"> [<span class="built_in"> default </span>is /home/cqc ]: </span><br><span class="line"></span><br><span class="line">Installing the CUDA Toolkit <span class="keyword">in</span> /usr/local/cuda-9.0 <span class="built_in">..</span>.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后如果出现这样的提示，就证明 CUDA 安装好了：</p>
                  <figure class="highlight">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">Driver</span>:   Not Selected</span><br><span class="line"><span class="attribute">Toolkit</span>:  Installed in /usr/local/cuda-9.0</span><br><span class="line"><span class="attribute">Samples</span>:  Installed in /home/cqc, but missing recommended libraries</span><br><span class="line"></span><br><span class="line">Please make sure that</span><br><span class="line"> -   PATH includes /usr/local/cuda-9.0/bin</span><br><span class="line"> -   LD_LIBRARY_PATH includes /usr/local/cuda-9.0/lib64, or, add /usr/local/cuda-9.0/lib64 to /etc/ld.so.conf and run ldconfig as root</span><br><span class="line"></span><br><span class="line">To uninstall the CUDA Toolkit, run the uninstall script in /usr/local/cuda-9.0/bin</span><br><span class="line"></span><br><span class="line">Please see CUDA_Installation_Guide_Linux.pdf in /usr/local/cuda-9.0/doc/pdf for detailed information on setting up CUDA.</span><br><span class="line"></span><br><span class="line">***WARNING: Incomplete installation! This installation did not install the CUDA Driver. A driver of version at least 384.00 is required for CUDA 9.0 functionality to work.</span><br><span class="line">To install the driver using this installer, run the following command, replacing &lt;CudaInstaller&gt; with the name of this run file:</span><br><span class="line">    sudo &lt;CudaInstaller&gt;.run -silent -driver</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后我们需要配置一下环境变量，更改 ~/.bashrc 文件，添加如下几行：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=/usr/local/cuda/bin$&#123;PATH:+:<span class="variable">$&#123;PATH&#125;</span>&#125;</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">LD_LIBRARY_PATH</span>=/usr/local/cuda/lib64$&#123;LD_LIBRARY_PATH:+:<span class="variable">$&#123;LD_LIBRARY_PATH&#125;</span>&#125;</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">CUDA_HOME</span>=/usr/local/cuda</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>修改完毕之后执行一下使其生效：</p>
                  <figure class="highlight bash">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时我们输出 CUDA_HOME、LD_LIBRARY_PATH 就可以看到对应的输出了：</p>
                  <figure class="highlight bash">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">echo</span> <span class="variable">$CUDA_HOME</span></span><br><span class="line">/usr/<span class="built_in">local</span>/cuda</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$LD_LIBRARY_PATH</span></span><br><span class="line">/usr/<span class="built_in">local</span>/cuda/lib64</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就代表环境变量生效了，CUDA 安装完成。</p>
                  <h2 id="cuDNN-7-1"><a href="#cuDNN-7-1" class="headerlink" title="cuDNN 7.1"></a>cuDNN 7.1</h2>
                  <p>cuDNN 的全称是 The NVIDIA CUDA® Deep Neural Network library，是专门用来对深度学习加速的库，它支持 Caffe2, MATLAB, Microsoft Cognitive Toolkit, TensorFlow, Theano 及 PyTorch 等深度学习的加速优化，目前最新版本是 cuDNN 7.1，接下来我们来看下它的安装方式。 下载链接：<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubnZpZGlhLmNvbS9yZHAvY3Vkbm4tZG93bmxvYWQ=">https://developer.nvidia.com/rdp/cudnn-download<i class="fa fa-external-link-alt"></i></span>，需要注册之后才能打开，这里我们选择 cuDNN v7.1.1 (Feb 28, 2018), for CUDA 9.0，然后选择 cuDNN v7.1.1 Library for Linux，如图所示： <img src="https://germey.gitbooks.io/ai/content/assets/2018-03-11-23-49-17.jpg" alt=""> 下载下来之后解压安装即可：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">tar -zxvf cudnn<span class="number">-9.0</span>-linux-x64-v7<span class="number">.1</span>.tgz</span><br><span class="line">sudo cp cuda<span class="meta-keyword">/include/</span>cudnn.h <span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/cuda/</span>include/</span><br><span class="line">sudo cp cuda<span class="meta-keyword">/lib64/</span>libcudnn* <span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/cuda/</span>lib64/ -d</span><br><span class="line">sudo chmod a+r <span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/cuda/</span>include/cudnn.h</span><br><span class="line">sudo chmod a+r <span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/cuda/</span>lib64/libcudnn*</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>执行完如上命令之后，cuDNN 就安装好了，这时我们可以发现在 /usr/local/cuda/include 目录下就多了 cudnn.h 头文件。</p>
                  <h2 id="TensorFlow-1-6"><a href="#TensorFlow-1-6" class="headerlink" title="TensorFlow 1.6"></a>TensorFlow 1.6</h2>
                  <p>到现在为止 Python 3.6、CUDA 9.0 和 cuDNN 7.1 就已经安装好了，而且环境变量也配置好了，接下来我们直接安装 TensorFlow 1.6 即可，TensorFlow 1.6 版本针对 CUDA 9 和 cuDNN 7 做了优化，可以预构建二进制文件。 这里需要安装的是 TensorFlow 的 GPU 版本，命令如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 install tensorflow-gpu==<span class="number">1.6</span><span class="number">.0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装完成之后验证一下：</p>
                  <figure class="highlight elm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> tensorflow</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果没有报错，那就证明全部环境配置都成功了。 以上便是 Ubuntu 16.04 + Nvidia GTX 1080 + Python 3.6 + CUDA 9.0 + cuDNN 7.1 + TensorFlow 1.6 完整环境配置过程。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-03-12 15:45:41" itemprop="dateCreated datePublished" datetime="2018-03-12T15:45:41+08:00">2018-03-12</time>
                </span>
                <span id="/5822.html" class="post-meta-item leancloud_visitors" data-flag-title="深度学习 GPU环境 Ubuntu 16.04 + Nvidia GTX 1080 + Python 3.6 + CUDA 9.0 + cuDNN 7.1 + TensorFlow 1.6 环境配置" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>5.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5806.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Linux <i class="label-arrow"></i>
                  </a>
                  <a href="/5806.html" class="post-title-link" itemprop="url">Linux常用命令总结</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h2>
                  <p>查看系统版本：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">cat</span> /proc/<span class="keyword">version</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>实例结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Linux version <span class="number">4.4</span><span class="number">.0</span><span class="number">-112</span>-generic (<span class="symbol">buildd@</span>lgw01-amd64<span class="number">-010</span>) (gcc version <span class="number">5.4</span><span class="number">.0</span> <span class="number">20160609</span> (Ubuntu <span class="number">5.4</span><span class="number">.0</span><span class="number">-6</span>ubuntu1~<span class="number">16.04</span><span class="number">.5</span>) ) #<span class="number">135</span>-Ubuntu SMP Fri Jan <span class="number">19</span> <span class="number">11</span>:<span class="number">48</span>:<span class="number">36</span> UTC <span class="number">2018</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h2>
                  <p>查看CPU信息：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">cat</span> /<span class="meta">proc</span>/cpuinfo</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>示例结果：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">processor       :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">vendor_id       :</span> <span class="string">GenuineIntel</span></span><br><span class="line"><span class="attr">cpu family      :</span> <span class="number">6</span></span><br><span class="line"><span class="attr">model           :</span> <span class="number">63</span></span><br><span class="line"><span class="attr">model name      :</span> <span class="string">Intel(R)</span> <span class="string">Xeon(R)</span> <span class="string">CPU</span> <span class="string">E5-2673</span> <span class="string">v3</span> <span class="string">@</span> <span class="number">2.</span><span class="string">40GHz</span></span><br><span class="line"><span class="attr">stepping        :</span> <span class="number">2</span></span><br><span class="line"><span class="attr">microcode       :</span> <span class="number">0x3a</span></span><br><span class="line"><span class="attr">cpu MHz         :</span> <span class="number">1200.000</span></span><br><span class="line"><span class="attr">cache size      :</span> <span class="number">30720</span> <span class="string">KB</span></span><br><span class="line"><span class="attr">physical id     :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">siblings        :</span> <span class="number">24</span></span><br><span class="line"><span class="attr">core id         :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">cpu cores       :</span> <span class="number">12</span></span><br><span class="line"><span class="attr">apicid          :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">initial apicid  :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">fpu             :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">fpu_exception   :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">cpuid level     :</span> <span class="number">15</span></span><br><span class="line"><span class="attr">wp              :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">flags           :</span> <span class="string">fpu</span> <span class="string">vme</span> <span class="string">de</span> <span class="string">pse</span> <span class="string">tsc</span> <span class="string">msr</span> <span class="string">pae</span> <span class="string">mce</span> <span class="string">cx8</span> <span class="string">apic</span> <span class="string">sep</span> <span class="string">mtrr</span> <span class="string">pge</span> <span class="string">mca</span> <span class="string">cmov</span> <span class="string">pat</span> <span class="string">pse36</span> <span class="string">clflush</span> <span class="string">dts</span> <span class="string">acpi</span> <span class="string">mmx</span> <span class="string">fxsr</span> <span class="string">sse</span> <span class="string">sse2</span> <span class="string">ss</span> <span class="string">ht</span> <span class="string">tm</span> <span class="string">pbe</span> <span class="string">syscall</span> <span class="string">nx</span> <span class="string">pdpe1gb</span> <span class="string">rdtscp</span> <span class="string">lm</span> <span class="string">constant_tsc</span> <span class="string">arch_perfmon</span> <span class="string">pebs</span> <span class="string">bts</span> <span class="string">rep_good</span> <span class="string">nopl</span> <span class="string">xtopology</span> <span class="string">nonstop_tsc</span> <span class="string">aperfmperf</span> <span class="string">eagerfpu</span> <span class="string">pni</span> <span class="string">pclmulqdq</span> <span class="string">dtes64</span> <span class="string">monitor</span> <span class="string">ds_cpl</span> <span class="string">vmx</span> <span class="string">smx</span> <span class="string">est</span> <span class="string">tm2</span> <span class="string">ssse3</span> <span class="string">sdbg</span> <span class="string">fma</span> <span class="string">cx16</span> <span class="string">xtpr</span> <span class="string">pdcm</span> <span class="string">pcid</span> <span class="string">dca</span> <span class="string">sse4_1</span> <span class="string">sse4_2</span> <span class="string">x2apic</span> <span class="string">movbe</span> <span class="string">popcnt</span> <span class="string">tsc_deadline_timer</span> <span class="string">aes</span> <span class="string">xsave</span> <span class="string">avx</span> <span class="string">f16c</span> <span class="string">rdrand</span> <span class="string">lahf_lm</span> <span class="string">abm</span> <span class="string">epb</span> <span class="string">invpcid_single</span> <span class="string">kaiser</span> <span class="string">tpr_shadow</span> <span class="string">vnmi</span> <span class="string">flexpriority</span> <span class="string">ept</span> <span class="string">vpid</span> <span class="string">fsgsbase</span> <span class="string">tsc_adjust</span> <span class="string">bmi1</span> <span class="string">avx2</span> <span class="string">smep</span> <span class="string">bmi2</span> <span class="string">erms</span> <span class="string">invpcid</span> <span class="string">cqm</span> <span class="string">xsaveopt</span> <span class="string">cqm_llc</span> <span class="string">cqm_occup_llc</span> <span class="string">dtherm</span> <span class="string">ida</span> <span class="string">arat</span> <span class="string">pln</span> <span class="string">pts</span></span><br><span class="line"><span class="attr">bugs            :</span></span><br><span class="line"><span class="attr">bogomips        :</span> <span class="number">4800.24</span></span><br><span class="line"><span class="attr">clflush size    :</span> <span class="number">64</span></span><br><span class="line"><span class="attr">cache_alignment :</span> <span class="number">64</span></span><br><span class="line"><span class="attr">address sizes   :</span> <span class="number">46</span> <span class="string">bits</span> <span class="string">physical,</span> <span class="number">48</span> <span class="string">bits</span> <span class="string">virtual</span></span><br><span class="line"><span class="attr">power management:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">processor       :</span> <span class="number">1</span></span><br><span class="line"><span class="attr">vendor_id       :</span> <span class="string">GenuineIntel</span></span><br><span class="line"><span class="attr">cpu family      :</span> <span class="number">6</span></span><br><span class="line"><span class="attr">model           :</span> <span class="number">63</span></span><br><span class="line"><span class="attr">model name      :</span> <span class="string">Intel(R)</span> <span class="string">Xeon(R)</span> <span class="string">CPU</span> <span class="string">E5-2673</span> <span class="string">v3</span> <span class="string">@</span> <span class="number">2.</span><span class="string">40GHz</span></span><br><span class="line"><span class="attr">stepping        :</span> <span class="number">2</span></span><br><span class="line"><span class="attr">microcode       :</span> <span class="number">0x3a</span></span><br><span class="line"><span class="attr">cpu MHz         :</span> <span class="number">1207.687</span></span><br><span class="line"><span class="attr">cache size      :</span> <span class="number">30720</span> <span class="string">KB</span></span><br><span class="line"><span class="attr">physical id     :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">siblings        :</span> <span class="number">24</span></span><br><span class="line"><span class="attr">core id         :</span> <span class="number">1</span></span><br><span class="line"><span class="attr">cpu cores       :</span> <span class="number">12</span></span><br><span class="line"><span class="attr">apicid          :</span> <span class="number">2</span></span><br><span class="line"><span class="attr">initial apicid  :</span> <span class="number">2</span></span><br><span class="line"><span class="attr">fpu             :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">fpu_exception   :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">cpuid level     :</span> <span class="number">15</span></span><br><span class="line"><span class="attr">wp              :</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">flags           :</span> <span class="string">fpu</span> <span class="string">vme</span> <span class="string">de</span> <span class="string">pse</span> <span class="string">tsc</span> <span class="string">msr</span> <span class="string">pae</span> <span class="string">mce</span> <span class="string">cx8</span> <span class="string">apic</span> <span class="string">sep</span> <span class="string">mtrr</span> <span class="string">pge</span> <span class="string">mca</span> <span class="string">cmov</span> <span class="string">pat</span> <span class="string">pse36</span> <span class="string">clflush</span> <span class="string">dts</span> <span class="string">acpi</span> <span class="string">mmx</span> <span class="string">fxsr</span> <span class="string">sse</span> <span class="string">sse2</span> <span class="string">ss</span> <span class="string">ht</span> <span class="string">tm</span> <span class="string">pbe</span> <span class="string">syscall</span> <span class="string">nx</span> <span class="string">pdpe1gb</span> <span class="string">rdtscp</span> <span class="string">lm</span> <span class="string">constant_tsc</span> <span class="string">arch_perfmon</span> <span class="string">pebs</span> <span class="string">bts</span> <span class="string">rep_good</span> <span class="string">nopl</span> <span class="string">xtopology</span> <span class="string">nonstop_tsc</span> <span class="string">aperfmperf</span> <span class="string">eagerfpu</span> <span class="string">pni</span> <span class="string">pclmulqdq</span> <span class="string">dtes64</span> <span class="string">monitor</span> <span class="string">ds_cpl</span> <span class="string">vmx</span> <span class="string">smx</span> <span class="string">est</span> <span class="string">tm2</span> <span class="string">ssse3</span> <span class="string">sdbg</span> <span class="string">fma</span> <span class="string">cx16</span> <span class="string">xtpr</span> <span class="string">pdcm</span> <span class="string">pcid</span> <span class="string">dca</span> <span class="string">sse4_1</span> <span class="string">sse4_2</span> <span class="string">x2apic</span> <span class="string">movbe</span> <span class="string">popcnt</span> <span class="string">tsc_deadline_timer</span> <span class="string">aes</span> <span class="string">xsave</span> <span class="string">avx</span> <span class="string">f16c</span> <span class="string">rdrand</span> <span class="string">lahf_lm</span> <span class="string">abm</span> <span class="string">epb</span> <span class="string">invpcid_single</span> <span class="string">kaiser</span> <span class="string">tpr_shadow</span> <span class="string">vnmi</span> <span class="string">flexpriority</span> <span class="string">ept</span> <span class="string">vpid</span> <span class="string">fsgsbase</span> <span class="string">tsc_adjust</span> <span class="string">bmi1</span> <span class="string">avx2</span> <span class="string">smep</span> <span class="string">bmi2</span> <span class="string">erms</span> <span class="string">invpcid</span> <span class="string">cqm</span> <span class="string">xsaveopt</span> <span class="string">cqm_llc</span> <span class="string">cqm_occup_llc</span> <span class="string">dtherm</span> <span class="string">ida</span> <span class="string">arat</span> <span class="string">pln</span> <span class="string">pts</span></span><br><span class="line"><span class="attr">bugs            :</span></span><br><span class="line"><span class="attr">bogomips        :</span> <span class="number">4800.24</span></span><br><span class="line"><span class="attr">clflush size    :</span> <span class="number">64</span></span><br><span class="line"><span class="attr">cache_alignment :</span> <span class="number">64</span></span><br><span class="line"><span class="attr">address sizes   :</span> <span class="number">46</span> <span class="string">bits</span> <span class="string">physical,</span> <span class="number">48</span> <span class="string">bits</span> <span class="string">virtual</span></span><br><span class="line"><span class="attr">power management:</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h2>
                  <p>查看内存及用量（M为单位）：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">free</span> -m</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>示例结果：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">              <span class="string">total</span>        <span class="string">used</span>        <span class="string">free</span>      <span class="string">shared</span>  <span class="string">buff/cache</span>   <span class="string">available</span></span><br><span class="line"><span class="attr">Mem:</span>         <span class="number">128806</span>        <span class="number">7115</span>      <span class="number">115910</span>          <span class="number">77</span>        <span class="number">5780</span>      <span class="number">120877</span></span><br><span class="line"><span class="attr">Swap:</span>             <span class="number">0</span>           <span class="number">0</span>           <span class="number">0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>查看内存及用量（G为单位）：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">free</span> -g</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>示例结果：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">              <span class="string">total</span>        <span class="string">used</span>        <span class="string">free</span>      <span class="string">shared</span>  <span class="string">buff/cache</span>   <span class="string">available</span></span><br><span class="line"><span class="attr">Mem:</span>            <span class="number">125</span>           <span class="number">6</span>         <span class="number">113</span>           <span class="number">0</span>           <span class="number">5</span>         <span class="number">118</span></span><br><span class="line"><span class="attr">Swap:</span>             <span class="number">0</span>           <span class="number">0</span>           <span class="number">0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="硬盘用量"><a href="#硬盘用量" class="headerlink" title="硬盘用量"></a>硬盘用量</h2>
                  <p>查看各分区使用情况：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">df -h</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>示例结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">udev             <span class="number">63</span>G     <span class="number">0</span>   <span class="number">63</span>G   <span class="number">0</span>% /dev</span><br><span class="line">tmpfs            <span class="number">13</span>G   <span class="number">66</span>M   <span class="number">13</span>G   <span class="number">1</span>% /run</span><br><span class="line">/dev/sda1       <span class="number">224</span>G  <span class="number">101</span>G  <span class="number">113</span>G  <span class="number">48</span>% /</span><br><span class="line">tmpfs            <span class="number">63</span>G  <span class="number">352</span>K   <span class="number">63</span>G   <span class="number">1</span>% /dev/shm</span><br><span class="line">tmpfs           <span class="number">5.0</span>M  <span class="number">4.0</span>K  <span class="number">5.0</span>M   <span class="number">1</span>% /run/lock</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>查看当前目录文件及文件夹大小：</p>
                  <figure class="highlight mipsasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">du -<span class="keyword">sh </span>*</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>示例结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">6.9</span>G    anaconda3</span><br><span class="line"><span class="number">213</span>M    cuda_samples</span><br><span class="line"><span class="number">7.9</span>M    Desktop</span><br><span class="line"><span class="number">8.0</span>K    Documents</span><br><span class="line"><span class="number">7.1</span>G    Downloads</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="GPU"><a href="#GPU" class="headerlink" title="GPU"></a>GPU</h2>
                  <p>查看 GPU 使用情况：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">nvidia-smi</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>示例结果：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Sun Mar 11 15:34:14 2018       </span><br><span class="line"><span class="code">+-----------------------------------------------------------------------------+</span></span><br><span class="line">| NVIDIA-SMI 384.111                Driver Version: 384.111                   |</span><br><span class="line">|-------------------------------<span class="code">+----------------------+</span>----------------------+</span><br><span class="line">| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|===============================<span class="code">+======================+</span>======================|</span><br><span class="line">|   0  GeForce GTX 1080    Off  | 00000000:02:00.0  On |                  N/A |</span><br><span class="line">|  0%   36C    P8    15W / 320W |    224MiB /  8105MiB |      0%      Default |</span><br><span class="line"><span class="code">+-------------------------------+</span>----------------------<span class="code">+----------------------+</span></span><br><span class="line"><span class="code">                                                                               </span></span><br><span class="line"><span class="code">+-----------------------------------------------------------------------------+</span></span><br><span class="line">| Processes:                                                       GPU Memory |</span><br><span class="line">|  GPU       PID   Type   Process name                             Usage      |</span><br><span class="line">|=============================================================================|</span><br><span class="line">|    0      1322      G   /usr/lib/xorg/Xorg                           178MiB |</span><br><span class="line">|    0      1880      G   compiz                                        43MiB |</span><br><span class="line"><span class="code">+-----------------------------------------------------------------------------+</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2>
                  <p>查看所有进程：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">ps -ef</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>示例结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         <span class="number">1</span>     <span class="number">0</span>  <span class="number">0</span> Feb09 ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">15</span> /sbin/init splash</span><br><span class="line">root         <span class="number">2</span>     <span class="number">0</span>  <span class="number">0</span> Feb09 ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> [kthreadd]</span><br><span class="line">root         <span class="number">3</span>     <span class="number">2</span>  <span class="number">0</span> Feb09 ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">05</span> [ksoftirqd/<span class="number">0</span>]</span><br><span class="line">root         <span class="number">5</span>     <span class="number">2</span>  <span class="number">0</span> Feb09 ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> [kworker/<span class="number">0</span>:<span class="number">0</span>H]</span><br><span class="line">root         <span class="number">6</span>     <span class="number">2</span>  <span class="number">0</span> Feb09 ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">01</span> [kworker/u96:<span class="number">0</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>筛选进程：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">ps</span> -ef | <span class="keyword">grep</span> <span class="keyword">python</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>示例结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">chen      <span class="number">6466</span> <span class="number">44495</span>  <span class="number">0</span> Mar09 ?        <span class="number">00</span>:<span class="number">01</span>:<span class="number">56</span> /usr/bin/python2 -m ipykernel_launcher -f /run/user/<span class="number">1000</span>/jupyter/kernel<span class="number">-218926</span>a1-f3b9<span class="number">-4410</span>-bffb<span class="number">-1</span>de1341732be.json</span><br><span class="line">chen     <span class="number">11630</span> <span class="number">44495</span>  <span class="number">0</span> Mar09 ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">13</span> /home/chen/anaconda3/bin/python -m ipykernel_launcher -f /run/user/<span class="number">1000</span>/jupyter/kernel-c2942b7d-d73c<span class="number">-420</span>a-b6be<span class="number">-78f</span>0169e68c9.json</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>根据名称强制杀死进程：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ps -ef | grep python | cut -c <span class="number">9</span><span class="number">-15</span> | xargs kill <span class="number">-9</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h2>
                  <p>添加用户：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">sudo</span> <span class="keyword">adduser </span>username</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>添加用户并设置目录：</p>
                  <figure class="highlight arduino">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo adduser username --<span class="built_in">home</span> /<span class="built_in">home</span>/username</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>将用户设置超级用户组（如添加到 sudo 用户组）：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo usermod -aG sudo username</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>查看所有用户组：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">groups</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>查看某个用户组下所有用户：</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">sudo</span> <span class="string">apt-get install members</span></span><br><span class="line"><span class="attr">members</span> <span class="string">sudo</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-03-11 15:35:40" itemprop="dateCreated datePublished" datetime="2018-03-11T15:35:40+08:00">2018-03-11</time>
                </span>
                <span id="/5806.html" class="post-meta-item leancloud_visitors" data-flag-title="Linux常用命令总结" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5788.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5788.html" class="post-title-link" itemprop="url">正则表达式中零宽断言的用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>了解了正则表达式，想必一般情况下的匹配都不会出现什么问题，但是如果一些特殊情况，可能需要用到一些更高级的正则表达式匹配操作，本节我们来说明一下正则表达式的一个较常用又比较重要的知识点——零宽断言。</p>
                  <h2 id="实例引入"><a href="#实例引入" class="headerlink" title="实例引入"></a>实例引入</h2>
                  <p>首先我们来看一个例子，这里有一段问答对话：</p>
                  <blockquote>
                    <p>问：我用的是Windows XP+Service Pack 2，为什么无法安装输入卡号和密码的控件？ 答：在Windows XP+Service Pack 2、Windows 2003等操作系统中，用户可以自己选择是否安装控件。 问：为什么我看到的卡号输入框显示为*符号？ 答：您的浏览器禁止下载执行ActiveX控件 , 对于这种情况 , 您必须打开浏览器的ActiveX的相关权限。 操作方法：在浏览器菜单中选择“工具”|“Internet选项”，在弹出的对话框中选择”安全” |”Internet”|”自定义级别”，在弹出的对话框中选择”重置为 安全级-中” , 点”重置”按钮，确定。 问：看了以上几个问题，还是不能登录，怎么办？ 答：您的浏览器由于其他原因不能安装招商银行登录控件， 请下载并安装招商银行登录控件下载版。 问：无法出现个人网上银行大众版登录界面。 答：这种情况是由于您的机器无法和我行服务器建立安全连接，通常是因为代理服务器设置错误引起。如果您是拨号上网，请不要使用代理服务器；如果您过去安装过我行SSL安全代理，请调用“添加-删除程序”删除SSL安全代理；如果您是经过代理访问Internet，请联系您所在网的网络管理员设置代理服务器。IE5.0浏览器设置代理服务器的步骤： Internet选项—&gt;连接—&gt;局域网设置—&gt;使用代理服务器—&gt;高级。 问：我在输入账号和卡号时，总出错，该怎样输？ 答：存折账号为10位，按存折本上的账号输入， 密码为6位。如果一卡通是12位卡号的，只需输入地区码后面的8位卡号，不需要输入前面4位的地区码，密码为6位。如果一卡通是16位卡号的，请将16位卡号全部输入，密码为6位。 问：我的存折没有设密码，怎样在个人网上银行大众版中查询余额？ 答：存折必须设有密码方可在 个人网上银行大众版 中查询，因此请您到存折开户行给您的存折设置密码。 注：网上个人银行是招商银行为个人客户提供的网上银行。 本页面内容仅供参考，部分业务以当地网点的公告与具体规定为准。</p>
                  </blockquote>
                  <p>我们需要将这段对话中的问题和答案对提取出来，即提取出如下内容：</p>
                  <blockquote>
                    <p>Q：我用的是Windows XP+Service Pack 2，为什么无法安装输入卡号和密码的控件？ A：在Windows XP+Service Pack 2、Windows 2003等操作系统中，用户可以自己选择是否安装控件。 Q：为什么我看到的卡号输入框显示为*符号？ A：您的浏览器禁止下载执行ActiveX控件 , 对于这种情况 , 您必须打开浏览器的ActiveX的相关权限。 操作方法：在浏览器菜单中选择“工具”|“Internet选项”，在弹出的对话框中选择”安全” |”Internet”|”自定义级别”，在弹出的对话框中选择”重置为 安全级-中” , 点”重置”按钮，确定。 …</p>
                  </blockquote>
                  <p>如果要用 Python 实现的话，那么我们很可能自然而然想到 split() 或 findall() 方法，如果用 split() 方法，我们可能会这么写：</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line">results = re.<span class="keyword">split</span>(<span class="string">'问：| 答：'</span>, text)</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">index</span>, result in enumerate(results[<span class="number">1</span>:]):</span><br><span class="line">    <span class="keyword">print</span>((<span class="string">'Q'</span> <span class="keyword">if</span> <span class="keyword">index</span>%2 == <span class="number">0</span> <span class="keyword">else</span> <span class="string">'A'</span>) + <span class="string">': '</span> + result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 split() 方法的第一个参数传入了 <code>问：| 答：</code> 这个正则表达式，意思是将这段话用 <code>问：</code> 或者 <code>答：</code> 分开，这个功能是正则表达式对字符串进行分割的方法，相比直接字符串的 split() 方法功能更为强大。这里其实得到的结果是一个列表，长度是一个奇数，如果我们把 results 打印出来，结果是这样的：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">['', <span class="symbol">'我用的是Windows</span> XP+Service Pack <span class="number">2</span>，为什么无法安装输入卡号和密码的控件？', <span class="symbol">'在Windows</span> XP+Service Pack <span class="number">2</span>、Windows <span class="number">2003</span>等操作系统中，用户可以自己选择是否安装控件。 ', <span class="symbol">'为什么我看到的卡号输入框显示为*符号？</span>', <span class="symbol">'您的浏览器禁止下载执行ActiveX控件</span> , 对于这种情况 , 您必须打开浏览器的ActiveX的相关权限。 操作方法：在浏览器菜单中选择“工具”|“Internet选项”，在弹出的对话框中选择<span class="string">"安全"</span> |<span class="string">"Internet"</span>|<span class="string">"自定义级别"</span>，在弹出的对话框中选择<span class="string">"重置为 安全级-中"</span> , 点<span class="string">"重置"</span>按钮，确定。 ', <span class="symbol">'看了以上几个问题，还是不能登录，怎么办？</span>', <span class="symbol">'您的浏览器由于其他原因不能安装招商银行登录控件，</span> 请下载并安装招商银行登录控件下载版。 ', <span class="symbol">'无法出现个人网上银行大众版登录界面。</span>', <span class="symbol">'这种情况是由于您的机器无法和我行服务器建立安全连接，通常是因为代理服务器设置错误引起。如果您是拨号上网，请不要使用代理服务器；如果您过去安装过我行SSL安全代理，请调用“添加-删除程序”删除SSL安全代理；如果您是经过代理访问Internet，请联系您所在网的网络管理员设置代理服务器。IE5.0浏览器设置代理服务器的步骤：</span> Internet选项--&gt;连接--&gt;局域网设置--&gt;使用代理服务器--&gt;高级。 ', <span class="symbol">'我在输入账号和卡号时，总出错，该怎样输？</span>', <span class="symbol">'存折账号为10位，按存折本上的账号输入，</span> 密码为6位。如果一卡通是12位卡号的，只需输入地区码后面的8位卡号，不需要输入前面4位的地区码，密码为6位。如果一卡通是16位卡号的，请将16位卡号全部输入，密码为6位。 ', <span class="symbol">'我的存折没有设密码，怎样在个人网上银行大众版中查询余额？</span>', <span class="symbol">'存折必须设有密码方可在</span> 个人网上银行大众版 中查询，因此请您到存折开户行给您的存折设置密码。 注：网上个人银行是招商银行为个人客户提供的网上银行。 本页面内容仅供参考，部分业务以当地网点的公告与具体规定为准。 ']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这是因为我们分割使用的字符本身就处于整个文本的字符，所以一上来就找到了分割的标志 <code>问：</code>，所以它左侧的结果就是空字符串了，所以最终得到的结果第一个内容就是空字符串，后续的内容便是正常的一问一答的短句。所以这里我们还需要对结果进行切片操作，去除第一个元素，然后将其遍历打印输出，最终结果如下：</p>
                  <figure class="highlight avrasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">Q:</span> 我用的是Windows XP+Service Pack <span class="number">2</span>，为什么无法安装输入卡号和密码的控件？</span><br><span class="line"><span class="symbol">A:</span> 在Windows XP+Service Pack <span class="number">2</span>、Windows <span class="number">2003</span>等操作系统中，用户可以自己选择是否安装控件。 </span><br><span class="line"><span class="symbol">Q:</span> 为什么我看到的卡号输入框显示为*符号？</span><br><span class="line"><span class="symbol">A:</span> 您的浏览器禁止下载执行ActiveX控件 , 对于这种情况 , 您必须打开浏览器的ActiveX的相关权限。 操作方法：在浏览器菜单中选择“工具”|“Internet选项”，在弹出的对话框中选择<span class="string">"安全"</span> |<span class="string">"Internet"</span>|<span class="string">"自定义级别"</span>，在弹出的对话框中选择<span class="string">"重置为 安全级-中"</span> , 点<span class="string">"重置"</span>按钮，确定。 </span><br><span class="line"><span class="symbol">Q:</span> 看了以上几个问题，还是不能登录，怎么办？</span><br><span class="line"><span class="symbol">A:</span> 您的浏览器由于其他原因不能安装招商银行登录控件， 请下载并安装招商银行登录控件下载版。 </span><br><span class="line"><span class="symbol">Q:</span> 无法出现个人网上银行大众版登录界面。</span><br><span class="line"><span class="symbol">A:</span> 这种情况是由于您的机器无法和我行服务器建立安全连接，通常是因为代理服务器设置错误引起。如果您是拨号上网，请不要使用代理服务器；如果您过去安装过我行SSL安全代理，请调用“添加-删除程序”删除SSL安全代理；如果您是经过代理访问Internet，请联系您所在网的网络管理员设置代理服务器。IE5<span class="number">.0</span>浏览器设置代理服务器的步骤： Internet选项--&gt;连接--&gt;局域网设置--&gt;使用代理服务器--&gt;高级。 </span><br><span class="line"><span class="symbol">Q:</span> 我在输入账号和卡号时，总出错，该怎样输？</span><br><span class="line"><span class="symbol">A:</span> 存折账号为<span class="number">10</span>位，按存折本上的账号输入， 密码为<span class="number">6</span>位。如果一卡通是<span class="number">12</span>位卡号的，只需输入地区码后面的<span class="number">8</span>位卡号，不需要输入前面<span class="number">4</span>位的地区码，密码为<span class="number">6</span>位。如果一卡通是<span class="number">16</span>位卡号的，请将<span class="number">16</span>位卡号全部输入，密码为<span class="number">6</span>位。 </span><br><span class="line"><span class="symbol">Q:</span> 我的存折没有设密码，怎样在个人网上银行大众版中查询余额？</span><br><span class="line"><span class="symbol">A:</span> 存折必须设有密码方可在 个人网上银行大众版 中查询，因此请您到存折开户行给您的存折设置密码。 注：网上个人银行是招商银行为个人客户提供的网上银行。 本页面内容仅供参考，部分业务以当地网点的公告与具体规定为准。</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样确实没问题，我们可以顺利地提取出来，但是总感觉这个解法并不那么优雅，因为我们这里是将问题和答案的内容都单独切出来了，并没有将问答对一块提取，而且 split() 方法返回的结果的第一个元素还不是我们想要的结果，所以还需要进行一些切片操作来去除，所以整个写法感觉实现起来并不完美。 所以我们又想到了 findall() 方法，这时我们会这么写：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line">results = re.findall(<span class="string">'问：(.*?) 答：(.*?)'</span>, <span class="keyword">text</span>, re.S)</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">result</span> <span class="keyword">in</span> results:</span><br><span class="line">    print(<span class="string">'Q: '</span> + <span class="built_in">result</span>[<span class="number">0</span>], <span class="string">'A: '</span> + <span class="built_in">result</span>[<span class="number">1</span>], sep=<span class="string">'\n'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>表面上看似乎是把问题答案对用正则表示出来了，而且使用了非贪婪匹配，但是很明显，在末尾我们并没有指定匹配的终点，所以整个的结果就会导致回答是完全匹配不到的，运行结果如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">Q:</span> <span class="string">我用的是Windows</span> <span class="string">XP+Service</span> <span class="string">Pack</span> <span class="number">2</span><span class="string">，为什么无法安装输入卡号和密码的控件？</span></span><br><span class="line"><span class="attr">A:</span> </span><br><span class="line"><span class="attr">Q:</span> <span class="string">为什么我看到的卡号输入框显示为*符号？</span></span><br><span class="line"><span class="attr">A:</span> </span><br><span class="line"><span class="attr">Q:</span> <span class="string">看了以上几个问题，还是不能登录，怎么办？</span></span><br><span class="line"><span class="attr">A:</span> </span><br><span class="line"><span class="attr">Q:</span> <span class="string">无法出现个人网上银行大众版登录界面。</span></span><br><span class="line"><span class="attr">A:</span> </span><br><span class="line"><span class="attr">Q:</span> <span class="string">我在输入账号和卡号时，总出错，该怎样输？</span></span><br><span class="line"><span class="attr">A:</span> </span><br><span class="line"><span class="attr">Q:</span> <span class="string">我的存折没有设密码，怎样在个人网上银行大众版中查询余额？</span></span><br><span class="line"><span class="attr">A:</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，那么我们加上匹配的终点吧，以下一个的 <code>问：</code> 作为我们正则表达式匹配的终点总可以了吧？所以我们可能会改写成这样子：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line">results = re.findall(<span class="string">'问：(.*?) 答：(.*?)问：'</span>, <span class="keyword">text</span>, re.S)</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">result</span> <span class="keyword">in</span> results:</span><br><span class="line">    print(<span class="string">'Q: '</span> + <span class="built_in">result</span>[<span class="number">0</span>], <span class="string">'A: '</span> + <span class="built_in">result</span>[<span class="number">1</span>], sep=<span class="string">'\n'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样写似乎看起来是可以了，但结果却是这样的：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Q: 我用的是Windows XP+Service Pack <span class="number">2</span>，为什么无法安装输入卡号和密码的控件？</span><br><span class="line">A: 在Windows XP+Service Pack <span class="number">2</span>、Windows <span class="number">2003</span>等操作系统中，用户可以自己选择是否安装控件。 </span><br><span class="line">Q: 看了以上几个问题，还是不能登录，怎么办？</span><br><span class="line">A: 您的浏览器由于其他原因不能安装招商银行登录控件， 请下载并安装招商银行登录控件下载版。 </span><br><span class="line">Q: 我在输入账号和卡号时，总出错，该怎样输？</span><br><span class="line">A: 存折账号为<span class="number">10</span>位，按存折本上的账号输入， 密码为<span class="number">6</span>位。如果一卡通是<span class="number">12</span>位卡号的，只需输入地区码后面的<span class="number">8</span>位卡号，不需要输入前面<span class="number">4</span>位的地区码，密码为<span class="number">6</span>位。如果一卡通是<span class="number">16</span>位卡号的，请将<span class="number">16</span>位卡号全部输入，密码为<span class="number">6</span>位。</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果只剩三个问题答案对了，有三个问答对被“吃”掉了，其实这是因为我们的正则表达式最后加了 <code>问:</code>的缘故，findall() 方法它会查找所有符合正则表达式的结果，但其中匹配的时候它内部也是有一个查找索引在扫描的。在查找第一个符合要求的结果时，由于我们是根据正则表达式结尾的 <code>问：</code>来作为结束标志，所以在找到第一个符合要求的结果时，我们的查找索引就已经移动到了第二个问答对开头的 <code>问：</code> 上面，即查找索引就已经进入到了第二个问答对的位置了，而在下一次查找符合要求的结果时，索引会继续往后移动进行扫描，所以它是从第二个问答对的 <code>问：</code> 后面继续扫描的，所以对于第二个问答对，实际上已经被割裂了，所以它只能查找到第三个问答对的时候才可以发现符合正则表达式的内容。因此，我们可以观察到，返回的结果只是第一、三、五三个问答对。 所以，如果我们想要用该方法找到完整的留个问答对，就需要用到零宽断言了。 解法如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line">results = re.findall(<span class="string">'问：(.*?) 答：(.*?)(?=问：|\Z)'</span>, <span class="keyword">text</span>, re.S)</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">result</span> <span class="keyword">in</span> results:</span><br><span class="line">    print(<span class="string">'Q: '</span> + <span class="built_in">result</span>[<span class="number">0</span>], <span class="string">'A: '</span> + <span class="built_in">result</span>[<span class="number">1</span>], sep=<span class="string">'\n'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight avrasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">Q:</span> 我用的是Windows XP+Service Pack <span class="number">2</span>，为什么无法安装输入卡号和密码的控件？</span><br><span class="line"><span class="symbol">A:</span> 在Windows XP+Service Pack <span class="number">2</span>、Windows <span class="number">2003</span>等操作系统中，用户可以自己选择是否安装控件。 </span><br><span class="line"><span class="symbol">Q:</span> 为什么我看到的卡号输入框显示为*符号？</span><br><span class="line"><span class="symbol">A:</span> 您的浏览器禁止下载执行ActiveX控件 , 对于这种情况 , 您必须打开浏览器的ActiveX的相关权限。 操作方法：在浏览器菜单中选择“工具”|“Internet选项”，在弹出的对话框中选择<span class="string">"安全"</span> |<span class="string">"Internet"</span>|<span class="string">"自定义级别"</span>，在弹出的对话框中选择<span class="string">"重置为 安全级-中"</span> , 点<span class="string">"重置"</span>按钮，确定。 </span><br><span class="line"><span class="symbol">Q:</span> 看了以上几个问题，还是不能登录，怎么办？</span><br><span class="line"><span class="symbol">A:</span> 您的浏览器由于其他原因不能安装招商银行登录控件， 请下载并安装招商银行登录控件下载版。 </span><br><span class="line"><span class="symbol">Q:</span> 无法出现个人网上银行大众版登录界面。</span><br><span class="line"><span class="symbol">A:</span> 这种情况是由于您的机器无法和我行服务器建立安全连接，通常是因为代理服务器设置错误引起。如果您是拨号上网，请不要使用代理服务器；如果您过去安装过我行SSL安全代理，请调用“添加-删除程序”删除SSL安全代理；如果您是经过代理访问Internet，请联系您所在网的网络管理员设置代理服务器。IE5<span class="number">.0</span>浏览器设置代理服务器的步骤： Internet选项--&gt;连接--&gt;局域网设置--&gt;使用代理服务器--&gt;高级。 </span><br><span class="line"><span class="symbol">Q:</span> 我在输入账号和卡号时，总出错，该怎样输？</span><br><span class="line"><span class="symbol">A:</span> 存折账号为<span class="number">10</span>位，按存折本上的账号输入， 密码为<span class="number">6</span>位。如果一卡通是<span class="number">12</span>位卡号的，只需输入地区码后面的<span class="number">8</span>位卡号，不需要输入前面<span class="number">4</span>位的地区码，密码为<span class="number">6</span>位。如果一卡通是<span class="number">16</span>位卡号的，请将<span class="number">16</span>位卡号全部输入，密码为<span class="number">6</span>位。 </span><br><span class="line"><span class="symbol">Q:</span> 我的存折没有设密码，怎样在个人网上银行大众版中查询余额？</span><br><span class="line"><span class="symbol">A:</span> 存折必须设有密码方可在 个人网上银行大众版 中查询，因此请您到存折开户行给您的存折设置密码。 注：网上个人银行是招商银行为个人客户提供的网上银行。 本页面内容仅供参考，部分业务以当地网点的公告与具体规定为准。</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们实际上是使用了 <code>(?=)</code>这样的形式来构建了整个表达式，等号后面的内容是 <code>问：</code>或者结束符 <code>\\Z</code>，这样其实就保证了在匹配的时候，查找索引不会继续向后移，但这也同时标志了结束标志，因此它就可以查找到完整的内容了。</p>
                  <h2 id="零宽断言"><a href="#零宽断言" class="headerlink" title="零宽断言"></a>零宽断言</h2>
                  <p>零宽断言，顾名思义，是一种零宽度的匹配，它匹配的内容不会保存到匹配结果中，表达式的匹配内容只是代表了一个位置而已，如标明某个字符的右边界是怎样的构造。 在前面我们使用了 <code>?=</code>来进行了实例讲解，这是其中一个用法，另外还有 <code>?&lt;=</code>、<code>?!</code>、<code>?&lt;!</code>，下面我们来依次进行讲解说明。</p>
                  <ul>
                    <li><code>?=</code>代表零宽度正预测先行断言，它断言自身出现的位置的后面可以匹配后面跟的表达式。</li>
                    <li><code>?&lt;=</code>代表零宽度正回顾后发断言，它断言自身出现的位置的前面可以匹配后面跟的表达式。</li>
                    <li><code>?!</code>代表零宽度负预测先行断言，它断言自身出现的位置的后面不可以匹配后面跟的表达式。</li>
                    <li><code>?&lt;!</code>代表零宽度负回顾后发断言，它断言自身出现的位置的后面不可以匹配后面跟的表达式。</li>
                  </ul>
                  <h3 id=""><a href="#" class="headerlink" title="?="></a>?=</h3>
                  <p>首先我们来看下 <code>?=</code>的用法，它断言自身出现的位置的后面可以匹配后面跟的表达式。 比如我们这里有这样的一个字符串：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">str</span> = <span class="string">'我的个人邮箱是cqc@cuiqingcai.com，个人博客是cuiqingcai.com，个人公众号是进击的Coder'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们想把我的个人邮箱这句话和个人邮箱单独摘出来，假如我们不使用零宽断言的话，我们需要给个人邮箱后面这一句加一个结束标识符或者单独匹配邮箱作为标识符，我们可能会这么写：</p>
                  <figure class="highlight axapta">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"><span class="keyword">str</span> = <span class="string">'我的个人邮箱是cqc@cuiqingcai.com，个人博客是cuiqingcai.com，个人公众号是进击的Coder'</span></span><br><span class="line">result = re.search(<span class="string">'我的个人邮箱是(.*?)，个人博客'</span>, <span class="keyword">str</span>)</span><br><span class="line">print(<span class="string">'整句结果：'</span> + result.<span class="keyword">group</span>(), <span class="string">'第一个匹配结果：'</span> + result.<span class="keyword">group</span>(<span class="number">1</span>), sep=<span class="string">'\n'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在正则表达式的最后我们加了<code>，个人博客</code>作为匹配的结束符，然后邮箱部分用非贪婪匹配的模式进行匹配，我们看下运行结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">整句结果：我的个人邮箱是<span class="symbol">cqc@</span>cuiqingcai.com，个人博客</span><br><span class="line">第一个匹配结果：<span class="symbol">cqc@</span>cuiqingcai.com</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们可以看到第一个匹配结果成功得到了邮箱信息，但是我们看整句结果缺并不理想，它多匹配了我们加入的结尾标识，并没有得到正常的一句话。 这时候如果我们改用 <code>?=</code>来匹配，结果就不会带有此标识符了，改写如下：</p>
                  <figure class="highlight axapta">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"><span class="keyword">str</span> = <span class="string">'我的个人邮箱是cqc@cuiqingcai.com，个人博客是cuiqingcai.com，个人公众号是进击的Coder'</span></span><br><span class="line">result = re.search(<span class="string">'我的个人邮箱是(.*?)(?=，个人博客)'</span>, <span class="keyword">str</span>)</span><br><span class="line">print(<span class="string">'整句结果：'</span> + result.<span class="keyword">group</span>(), <span class="string">'第一个匹配结果：'</span> + result.<span class="keyword">group</span>(<span class="number">1</span>), sep=<span class="string">'\n'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们将结尾标识符改成了 <code>(?=，个人博客)</code> ，这样就将此部分内容作为零宽度匹配，它代表后面需要跟 <code>，个人博客</code>，但是它不会出现在匹配结果中。 运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">整句结果：我的个人邮箱是<span class="symbol">cqc@</span>cuiqingcai.com</span><br><span class="line">第一个匹配结果：<span class="symbol">cqc@</span>cuiqingcai.com</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到整句结果中已经没有无用的后缀字符了。</p>
                  <h3 id="lt"><a href="#lt" class="headerlink" title="?&lt;="></a>?&lt;=</h3>
                  <p>接下来我们再看下 <code>?&lt;=</code>的用法，它代表零宽度正回顾后发断言，其实就是匹配前面的标识，比如这里我们还是以上面的例子为例，匹配出个人博客这句话，代码如下：</p>
                  <figure class="highlight axapta">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"><span class="keyword">str</span> = <span class="string">'我的个人邮箱是cqc@cuiqingcai.com，个人博客是cuiqingcai.com，个人公众号是进击的Coder'</span></span><br><span class="line">result = re.search(<span class="string">'(?&lt;=，)个人博客是(.*?)(?=，)'</span>, <span class="keyword">str</span>)</span><br><span class="line">print(<span class="string">'整句结果：'</span> + result.<span class="keyword">group</span>(), <span class="string">'第一个匹配结果：'</span> + result.<span class="keyword">group</span>(<span class="number">1</span>), sep=<span class="string">'\n'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们在<code>个人博客</code> 前面加了一个零宽断言的逗号符号作为开头，使用的就是 <code>?&lt;=</code>，句子结尾是用的 <code>?=</code>，这样前后的标识都不会匹配到了，运行结果如下：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">整句结果：个人博客是<span class="selector-tag">cuiqingcai</span><span class="selector-class">.com</span></span><br><span class="line">第一个匹配结果：<span class="selector-tag">cuiqingcai</span><span class="selector-class">.com</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到得到的整句结果也是完整的一句话。</p>
                  <h3 id="-1"><a href="#-1" class="headerlink" title="?!"></a>?!</h3>
                  <p><code>?!</code>代表代表零宽度负预测先行断言，它断言自身出现的位置的后面不可以匹配后面跟的表达式。也是用来匹配后面的文本，但这里是取反，它指定了后面出现的内容不匹配该标识，我们在前面的例子基础上修改如下：</p>
                  <figure class="highlight axapta">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"><span class="keyword">str</span> = <span class="string">'我的个人邮箱是cqc@cuiqingcai.com，个人博客是cuiqingcai.com，个人公众号是进击的Coder'</span></span><br><span class="line">result = re.search(<span class="string">'我的个人邮箱是(.*?)(?!，个人公众号)(?=，个人博客)'</span>, <span class="keyword">str</span>)</span><br><span class="line">print(<span class="string">'整句结果：'</span> + result.<span class="keyword">group</span>(), <span class="string">'第一个匹配结果：'</span> + result.<span class="keyword">group</span>(<span class="number">1</span>), sep=<span class="string">'\n'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>本来是 <code>(?=，个人博客)</code>的标识符，不过这里我们使用 <code>?!</code>来指定了另一个标识符<code>，个人公众号</code>，这就代表这句话后面跟的需要是<code>(?=，个人博客)</code>而不是<code>，个人公众号</code>，运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">整句结果：我的个人邮箱是<span class="symbol">cqc@</span>cuiqingcai.com</span><br><span class="line">第一个匹配结果：<span class="symbol">cqc@</span>cuiqingcai.com</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="lt-1"><a href="#lt-1" class="headerlink" title="?&lt;!"></a>?&lt;!</h3>
                  <p><code>?&lt;!</code>代表零宽度负回顾后发断言，它断言自身出现的位置的后面不可以匹配后面跟的表达式。我们在前面的例子基础上加以修改：</p>
                  <figure class="highlight axapta">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"><span class="keyword">str</span> = <span class="string">'我的个人邮箱是cqc@cuiqingcai.com，个人博客是cuiqingcai.com，个人公众号是进击的Coder'</span></span><br><span class="line">result = re.search(<span class="string">'(?&lt;=，)(?&lt;!。)个人博客是(.*?)(?=，)'</span>, <span class="keyword">str</span>)</span><br><span class="line">print(<span class="string">'整句结果：'</span> + result.<span class="keyword">group</span>(), <span class="string">'第一个匹配结果：'</span> + result.<span class="keyword">group</span>(<span class="number">1</span>), sep=<span class="string">'\n'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们写了 <code>?&lt;!</code>标识符，后面跟了一个句号，这代表前面不应该出现句号。 运行结果如下：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">整句结果：个人博客是<span class="selector-tag">cuiqingcai</span><span class="selector-class">.com</span></span><br><span class="line">第一个匹配结果：<span class="selector-tag">cuiqingcai</span><span class="selector-class">.com</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="常用用法"><a href="#常用用法" class="headerlink" title="常用用法"></a>常用用法</h2>
                  <p>其实上面的示例中我们使用了 search() 方法进行了内容匹配，其实这并不常用，因为一般我们更关注的是匹配分组结果的内容，其实更多的用法是用在了 findall() 方法上，它用来匹配多个结果，也就类似于我们一开始的实例一样，这里我们还是以刚才的字符串为例，来输出一下个人邮箱、个人博客、个人公众号三个内容，代码如下：</p>
                  <figure class="highlight processing">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="built_in">str</span> = <span class="string">'我的个人邮箱是cqc@cuiqingcai.com，个人博客是cuiqingcai.com，个人公众号是进击的Coder'</span></span><br><span class="line">results = re.findall(<span class="string">'个人(.*?)是(.*?)(?=，|\Z)'</span>, <span class="built_in">str</span>)</span><br><span class="line"><span class="keyword">for</span> result in results:</span><br><span class="line">    <span class="built_in">print</span>(result[<span class="number">0</span>] + <span class="string">': '</span> + result[<span class="number">1</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们匹配了<code>个人</code>二字，然后后面跟了非贪婪匹配，然后加了一个<code>是</code>字，最关键的是结尾标识符，这里必须要使用零宽断言才可以匹配出三个结果，这里匹配的内容是 <code>，|\\Z</code>，意思是匹配逗号或结束符。 运行结果如下：</p>
                  <figure class="highlight makefile">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="section">邮箱: cqc@cuiqingcai.com</span></span><br><span class="line"><span class="section">博客: cuiqingcai.com</span></span><br><span class="line"><span class="section">公众号: 进击的Coder</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就成功输出了邮箱、博客及公众号的内容了，匹配非常顺利方便。</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>通过本节，我们应该大体可以了解了正则表达式中零宽断言的基本用法和适用场景，相信理解了零宽断言之后，我们再做正则匹配时会更加得心应手。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-03-03 05:42:18" itemprop="dateCreated datePublished" datetime="2018-03-03T05:42:18+08:00">2018-03-03</time>
                </span>
                <span id="/5788.html" class="post-meta-item leancloud_visitors" data-flag-title="正则表达式中零宽断言的用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>9.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>8 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5771.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5771.html" class="post-title-link" itemprop="url">机器学习主要术语</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>什么是（监督式）机器学习？简单来说，它的定义如下：</p>
                  <ul>
                    <li>机器学习系统通过学习如何组合输入信息来对从未见过的数据做出有用的预测。</li>
                  </ul>
                  <p>下面我们来了解一下机器学习的基本术语。</p>
                  <h2 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h2>
                  <p>在简单线性回归中，标签是我们要预测的事物，即 y 变量。标签可以是小麦未来的价格、图片中显示的动物品种、音频剪辑的含义或任何事物。</p>
                  <h2 id="特征"><a href="#特征" class="headerlink" title="特征"></a>特征</h2>
                  <p>在简单线性回归中，特征是输入变量，即 x 变量。简单的机器学习项目可能会使用单个特征，而比较复杂的机器学习项目可能会使用数百万个特征，按如下方式指定：</p>
                  <p>{x1,x2,…xN}</p>
                  <p>在垃圾邮件检测器示例中，特征可能包括：</p>
                  <ul>
                    <li>电子邮件文本中的字词</li>
                    <li>发件人的地址</li>
                    <li>发送电子邮件的时段</li>
                    <li>电子邮件中包含“一种奇怪的把戏”这样的短语。</li>
                  </ul>
                  <h2 id="样本"><a href="#样本" class="headerlink" title="样本"></a>样本</h2>
                  <p>样本是指数据的特定实例：x。（我们采用粗体 x 表示它是一个矢量。）我们将样本分为以下两类：</p>
                  <ul>
                    <li>有标签样本</li>
                    <li>无标签样本</li>
                  </ul>
                  <p>有标签样本同时包含特征和标签。即：</p>
                  <figure class="highlight dockerfile">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">  labeled examples: &#123;features, <span class="keyword">label</span><span class="bash">&#125;: (x, y)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们使用有标签样本来训练模型。在我们的垃圾邮件检测器示例中，有标签样本是用户明确标记为“垃圾邮件”或“非垃圾邮件”的各个电子邮件。 例如，下表显示了从包含加利福尼亚州房价信息的<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jbi9tYWNoaW5lLWxlYXJuaW5nL2NyYXNoLWNvdXJzZS9jYWxpZm9ybmlhLWhvdXNpbmctZGF0YS1kZXNjcmlwdGlvbg==">数据集<i class="fa fa-external-link-alt"></i></span>中抽取的 5 个有标签样本：</p>
                  <p>housingMedianAge （特征）</p>
                  <p>totalRooms （特征）</p>
                  <p>totalBedrooms （特征）</p>
                  <p>medianHouseValue （标签）</p>
                  <p>15</p>
                  <p>5612</p>
                  <p>1283</p>
                  <p>66900</p>
                  <p>19</p>
                  <p>7650</p>
                  <p>1901</p>
                  <p>80100</p>
                  <p>17</p>
                  <p>720</p>
                  <p>174</p>
                  <p>85700</p>
                  <p>14</p>
                  <p>1501</p>
                  <p>337</p>
                  <p>73400</p>
                  <p>20</p>
                  <p>1454</p>
                  <p>326</p>
                  <p>65500</p>
                  <p>无标签样本包含特征，但不包含标签。即：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">  unlabeled <span class="string">examples:</span> &#123;features, ?&#125;: (x, ?)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在使用有标签样本训练了我们的模型之后，我们会使用该模型来预测无标签样本的标签。在垃圾邮件检测器示例中，无标签样本是用户尚未添加标签的新电子邮件。</p>
                  <h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2>
                  <p>模型定义了特征与标签之间的关系。例如，垃圾邮件检测模型可能会将某些特征与“垃圾邮件”紧密联系起来。我们来重点介绍一下模型生命周期的两个阶段：</p>
                  <ul>
                    <li>训练表示创建或学习模型。也就是说，您向模型展示有标签样本，让模型逐渐学习特征与标签之间的关系。</li>
                    <li>推断表示将训练后的模型应用于无标签样本。也就是说，您使用训练后的模型来做出有用的预测 (y’)。例如，在推断期间，您可以针对新的无标签样本预测 medianHouseValue。</li>
                  </ul>
                  <h2 id="回归与分类"><a href="#回归与分类" class="headerlink" title="回归与分类"></a>回归与分类</h2>
                  <p>回归模型可预测连续值。例如，回归模型做出的预测可回答如下问题：</p>
                  <ul>
                    <li>加利福尼亚州一栋房产的价值是多少？</li>
                    <li>用户点击此广告的概率是多少？</li>
                  </ul>
                  <p>分类模型可预测离散值。例如，分类模型做出的预测可回答如下问题：</p>
                  <ul>
                    <li>某个指定电子邮件是垃圾邮件还是非垃圾邮件？</li>
                    <li>这是一张狗、猫还是仓鼠图片？</li>
                  </ul>
                  <h2 id="原文地址"><a href="#原文地址" class="headerlink" title="原文地址"></a>原文地址</h2>
                  <p>本节原文地址：<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jbi9tYWNoaW5lLWxlYXJuaW5nL2NyYXNoLWNvdXJzZS9mcmFtaW5nL21sLXRlcm1pbm9sb2d5">问题构建 (Framing)：机器学习主要术语<i class="fa fa-external-link-alt"></i></span></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-03-01 17:34:10" itemprop="dateCreated datePublished" datetime="2018-03-01T17:34:10+08:00">2018-03-01</time>
                </span>
                <span id="/5771.html" class="post-meta-item leancloud_visitors" data-flag-title="机器学习主要术语" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5737.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Paper <i class="label-arrow"></i>
                  </a>
                  <a href="/5737.html" class="post-title-link" itemprop="url">[论文笔记] Learning Phrase Representations using RNN Encoder–Decoder for Statistical Machine Translation</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>我们知道，Seq2Seq 现在已经成为了机器翻译、对话聊天、文本摘要等工作的重要模型，真正提出 Seq2Seq 的文章是《Sequence to Sequence Learning with Neural Networks》，但本篇《Learning Phrase Representations using RNN Encoder–Decoder for Statistical Machine Translation》比前者更早使用了 Seq2Seq 模型来解决机器翻译的问题，本文是该篇论文的概述。</p>
                  <h2 id="发布信息"><a href="#发布信息" class="headerlink" title="发布信息"></a>发布信息</h2>
                  <p><span class="exturl" data-url="aHR0cHM6Ly9hcnhpdi5vcmcvYWJzLzE0MDYuMTA3OA==">Learning Phrase Representations using RNN Encoder–Decoder for Statistical Machine Translation<i class="fa fa-external-link-alt"></i></span> 2014 年 6 月发布于 Arxiv 上，一作是 Kyunghyun Cho，当时来自蒙特利尔大学，现在在纽约大学任教。</p>
                  <h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2>
                  <p>这篇论文中提出了一种新的模型，叫做 RNN Encoder-Decoder， 并将它用来进行机器翻译和比较不同语言的短语/词组之间的语义近似程度。这个模型由两个 RNN 组成，其中 Encoder 用来将输入的序列表示成一个固定长度的向量，Decoder 则使用这个向量重建出目标序列，另外该论文提出了 GRU 的基本结构，为后来的研究奠定了基础。 因此本文的主要贡献是：</p>
                  <ul>
                    <li>提出了一种类似于 LSTM 的 GRU 结构，并且具有比 LSTM 更少的参数，更不容易过拟合。</li>
                    <li>较早地将 Seq2Seq 应用在了机器翻译领域，并且取得了不错的效果。</li>
                  </ul>
                  <h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2>
                  <p>本文提出的模型结构如下图所示： <img src="https://ws1.sinaimg.cn/large/006tNc79gy1foubbvos97j30iw0i8q4m.jpg" alt=""></p>
                  <p>这里首先对输入上文 x 走一遍 RNN，然后得到一个固定长度的向量 c，作为 Encoder，然后接下来再根据 c 和后续隐状态和输入状态来得到后续状态，Encoder 的行为比较简单，重点在 Decoder 上。</p>
                  <p>Decoder 中 t 时刻的内部状态的 ht 为:</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/WX20180227-003503@2x.png" alt=""></p>
                  <p>该时刻的输出概率则为: <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/WX20180227-003613@2x.png" alt=""> 模型训练时则去最大化给定输入序列 x 时输出序列为 y 的条件概率: <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/WX20180227-003657@2x.png" alt=""> 以上便是核心的公式，上面的这个就是该模型的优化目标。 在机器翻译上，作者用 Moses (一个 SMT 系统) 建立了一个 phrase based 的翻译模型作为 baseline system ，然后对比了以下四个模型的 BLEU 值</p>
                  <ol>
                    <li>Baseline configuration</li>
                    <li>Baseline + RNN</li>
                    <li>Baseline + CSLM + RNN</li>
                    <li>Baseline + CSLM + RNN + Word penalty</li>
                  </ol>
                  <p>四种不同的模型的 BLEU 值如下表所示：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/WX20180227-005725@2x.png" alt=""></p>
                  <p>phrase pair 打分的结果如下： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/WX20180227-005736@2x.png" alt=""> 其中第一栏是输入的英语 phrase ，第二栏是用传统的模型得到的最近似的三个法语 phrase，第三栏是用 Encoder-Decoder 模型得到的最近似的三个 phrase。 另外作者还说明该模型可以学习到一个比较好的效果的 Word Embedding 结果，附图如下： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/WX20180227-003954@2x.png" alt=""> 左上角的图代表全局的 Embedding 结果，另外三个图是局部结果，可以看到类似的名词都被聚到了一起。</p>
                  <h2 id="GRU"><a href="#GRU" class="headerlink" title="GRU"></a>GRU</h2>
                  <p>另外本文的一个主要贡献是提出了 GRU 的门结构，相比 LSTM 更加简洁，而且效果不输 LSTM，关于它的详细公式推导，可以直接参考论文的最后的附录部分，有详细的介绍，在此截图如下： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/WX20180227-004500@2x.png" alt=""> <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/WX20180227-004518@2x.png" alt=""> <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/WX20180227-004547@2x.png" alt=""></p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>本篇论文算是为 Seq2Seq 的研究开了先河，而且其提出的 GRU 结构也为后来的研究做好了铺垫，得到了广泛应用，非常值得一读。</p>
                  <h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2>
                  <ul>
                    <li><span class="exturl" data-url="aHR0cDovL3d3dy56bW9uc3Rlci5tZS9ub3Rlcy9waHJhc2VfcmVwcmVzZW50YXRpb25fdXNpbmdfcm5uX2VuY29kZXJfZGVjb2Rlci5odG1s">http://www.zmonster.me/notes/phrase_representation_using_rnn_encoder_decoder.html<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly95cS5hbGl5dW4uY29tL2FydGljbGVzLzE3NTQ2Nw==">https://yq.aliyun.com/articles/175467<i class="fa fa-external-link-alt"></i></span></li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-02-27 00:52:07" itemprop="dateCreated datePublished" datetime="2018-02-27T00:52:07+08:00">2018-02-27</time>
                </span>
                <span id="/5737.html" class="post-meta-item leancloud_visitors" data-flag-title="[论文笔记] Learning Phrase Representations using RNN Encoder–Decoder for Statistical Machine Translation" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5715.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5715.html" class="post-title-link" itemprop="url">TensorFlow layers模块用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>TensorFlow 中的 layers 模块提供用于深度学习的更高层次封装的 API，利用它我们可以轻松地构建模型，这一节我们就来看下这个模块的 API 的具体用法。</p>
                  <h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2>
                  <p>layers 模块的路径写法为 tf.layers，这个模块定义在 tensorflow/python/layers/layers.py，其官方文档地址为：<span class="exturl" data-url="aHR0cHM6Ly93d3cudGVuc29yZmxvdy5vcmcvYXBpX2RvY3MvcHl0aG9uL3RmL2xheWVycw==">https://www.tensorflow.org/api_docs/python/tf/layers<i class="fa fa-external-link-alt"></i></span>，TensorFlow 版本为 1.5。 这里面提供了多个类和方法以供使用，下面我们分别予以介绍。</p>
                  <h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2>
                  <p>tf.layers 模块提供的方法有：</p>
                  <ul>
                    <li>Input(…): 用于实例化一个输入 Tensor，作为神经网络的输入。</li>
                    <li>average_pooling1d(…): 一维平均池化层</li>
                    <li>average_pooling2d(…): 二维平均池化层</li>
                    <li>average_pooling3d(…): 三维平均池化层</li>
                    <li>batch_normalization(…): 批量标准化层</li>
                    <li>conv1d(…): 一维卷积层</li>
                    <li>conv2d(…): 二维卷积层</li>
                    <li>conv2d_transpose(…): 二维反卷积层</li>
                    <li>conv3d(…): 三维卷积层</li>
                    <li>conv3d_transpose(…): 三维反卷积层</li>
                    <li>dense(…): 全连接层</li>
                    <li>dropout(…): Dropout层</li>
                    <li>flatten(…): Flatten层，即把一个 Tensor 展平</li>
                    <li>max_pooling1d(…): 一维最大池化层</li>
                    <li>max_pooling2d(…): 二维最大池化层</li>
                    <li>max_pooling3d(…): 三维最大池化层</li>
                    <li>separable_conv2d(…): 二维深度可分离卷积层</li>
                  </ul>
                  <h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3>
                  <p>tf.layers.Input() 这个方法是用于输入数据的方法，其实类似于 tf.placeholder，相当于一个占位符的作用，当然也可以通过传入 tensor 参数来进行赋值。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Input(</span><br><span class="line">    <span class="attribute">shape</span>=None,</span><br><span class="line">    <span class="attribute">batch_size</span>=None,</span><br><span class="line">    <span class="attribute">name</span>=None,</span><br><span class="line">    <span class="attribute">dtype</span>=tf.float32,</span><br><span class="line">    <span class="attribute">sparse</span>=<span class="literal">False</span>,</span><br><span class="line">    <span class="attribute">tensor</span>=None</span><br><span class="line">)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>参数说明如下：</p>
                  <ul>
                    <li>shape：可选，默认 None，是一个数字组成的元组或列表，但是这个 shape 比较特殊，它不包含 batch_size，比如传入的 shape 为 [32]，那么它会将 shape 转化为 [?, 32]，这里一定需要注意。</li>
                    <li>batch_size：可选，默认 None，代表输入数据的 batch size，可以是数字或者 None。</li>
                    <li>name：可选，默认 None，输入层的名称。</li>
                    <li>dtype：可选，默认 tf.float32，元素的类型。</li>
                    <li>sparse：可选，默认 False，指定是否以稀疏矩阵的形式来创建 placeholder。</li>
                    <li>tensor：可选，默认 None，如果指定，那么创建的内容便不再是一个 placeholder，会用此 Tensor 初始化。</li>
                  </ul>
                  <p>返回值： 返回一个包含历史 Meta Data 的 Tensor。 我们用一个实例来感受一下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf<span class="selector-class">.layers</span>.Input(shape=[<span class="number">32</span>])</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(x)</span></span></span><br><span class="line">y = tf<span class="selector-class">.layers</span>.dense(x, <span class="number">16</span>, activation=tf<span class="selector-class">.nn</span>.softmax)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(y)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先我们用 Input() 方法初始化了一个 placeholder，这时我们没有传入 tensor 参数，然后调用了 dense() 方法构建了一个全连接网络，激活函数使用 softmax，然后将二者输出，结果如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">Tensor</span><span class="params">(<span class="string">"input_layer_1:0"</span>, shape=(?, <span class="number">32</span>)</span></span>, dtype=float32)</span><br><span class="line"><span class="function"><span class="title">Tensor</span><span class="params">(<span class="string">"dense/Softmax:0"</span>, shape=(?, <span class="number">16</span>)</span></span>, dtype=float32)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时我们发现，shape 它给我们做了转化，本来是 [32]，结果它给转化成了 [?, 32]，即第一维代表 batch_size，所以我们需要注意，在调用此方法的时候不需要去关心 batch_size 这一维。 如果我们在初始化的时候传入一个已有 Tensor，例如：</p>
                  <figure class="highlight haskell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">data</span> = tf.constant([1, 2, 3])</span></span><br><span class="line"><span class="title">x</span> = tf.layers.<span class="type">Input</span>(tensor=<span class="class"><span class="keyword">data</span>)</span></span><br><span class="line"><span class="title">print</span>(x)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="constructor">Tensor(<span class="string">"Const:0"</span>, <span class="params">shape</span>=(3,)</span>, dtype=<span class="built_in">int32</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到它可以自动计算出其 shape 和 dtype。</p>
                  <h3 id="batch-normalization"><a href="#batch-normalization" class="headerlink" title="batch_normalization"></a>batch_normalization</h3>
                  <p>此方法是批量标准化的方法，经过处理之后可以加速训练速度，其定义在 tensorflow/python/layers/normalization.py，论文可以参考：<span class="exturl" data-url="aHR0cDovL2FyeGl2Lm9yZy9hYnMvMTUwMi4wMzE2Nw==">http://arxiv.org/abs/1502.03167<i class="fa fa-external-link-alt"></i></span> “Batch Normalization: Accelerating Deep Network Training by Reducing Internal Covariate Shift”。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">batch_normalization(</span><br><span class="line">    inputs,</span><br><span class="line">    <span class="attribute">axis</span>=-1,</span><br><span class="line">    <span class="attribute">momentum</span>=0.99,</span><br><span class="line">    <span class="attribute">epsilon</span>=0.001,</span><br><span class="line">    <span class="attribute">center</span>=<span class="literal">True</span>,</span><br><span class="line">    <span class="attribute">scale</span>=<span class="literal">True</span>,</span><br><span class="line">    <span class="attribute">beta_initializer</span>=tf.zeros_initializer(),</span><br><span class="line">    <span class="attribute">gamma_initializer</span>=tf.ones_initializer(),</span><br><span class="line">    <span class="attribute">moving_mean_initializer</span>=tf.zeros_initializer(),</span><br><span class="line">    <span class="attribute">moving_variance_initializer</span>=tf.ones_initializer(),</span><br><span class="line">    <span class="attribute">beta_regularizer</span>=None,</span><br><span class="line">    <span class="attribute">gamma_regularizer</span>=None,</span><br><span class="line">    <span class="attribute">beta_constraint</span>=None,</span><br><span class="line">    <span class="attribute">gamma_constraint</span>=None,</span><br><span class="line">    <span class="attribute">training</span>=<span class="literal">False</span>,</span><br><span class="line">    <span class="attribute">trainable</span>=<span class="literal">True</span>,</span><br><span class="line">    <span class="attribute">name</span>=None,</span><br><span class="line">    <span class="attribute">reuse</span>=None,</span><br><span class="line">    <span class="attribute">renorm</span>=<span class="literal">False</span>,</span><br><span class="line">    <span class="attribute">renorm_clipping</span>=None,</span><br><span class="line">    <span class="attribute">renorm_momentum</span>=0.99,</span><br><span class="line">    <span class="attribute">fused</span>=None,</span><br><span class="line">    <span class="attribute">virtual_batch_size</span>=None,</span><br><span class="line">    <span class="attribute">adjustment</span>=None</span><br><span class="line">)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>参数说明如下：</p>
                  <ul>
                    <li>inputs：必需，即输入数据。</li>
                    <li>axis：可选，默认 -1，即进行标注化操作时操作数据的哪个维度。</li>
                    <li>momentum：可选，默认 0.99，即动态均值的动量。</li>
                    <li>epsilon：可选，默认 0.01，大于0的小浮点数，用于防止除0错误。</li>
                    <li>center：可选，默认 True，若设为True，将会将 beta 作为偏置加上去，否则忽略参数 beta</li>
                    <li>scale：可选，默认 True，若设为True，则会乘以gamma，否则不使用gamma。当下一层是线性的时，可以设False，因为scaling的操作将被下一层执行。</li>
                    <li>beta_initializer：可选，默认 zeros_initializer，即 beta 权重的初始方法。</li>
                    <li>gamma_initializer：可选，默认 ones_initializer，即 gamma 的初始化方法。</li>
                    <li>moving_mean_initializer：可选，默认 zeros_initializer，即动态均值的初始化方法。</li>
                    <li>moving_variance_initializer：可选，默认 ones_initializer，即动态方差的初始化方法。</li>
                    <li>beta_regularizer: 可选，默认None，beta 的正则化方法。</li>
                    <li>gamma_regularizer: 可选，默认None，gamma 的正则化方法。</li>
                    <li>beta_constraint: 可选，默认None，加在 beta 上的约束项。</li>
                    <li>gamma_constraint: 可选，默认None，加在 gamma 上的约束项。</li>
                    <li>training：可选，默认 False，返回结果是 training 模式。</li>
                    <li>trainable：可选，默认为 True，布尔类型，如果为 True，则将变量添加 GraphKeys.TRAINABLE_VARIABLES 中。</li>
                    <li>name：可选，默认 None，层名称。</li>
                    <li>reuse：可选，默认 None，根据层名判断是否重复利用。</li>
                    <li>renorm：可选，默认 False，是否要用 Batch Renormalization (<span class="exturl" data-url="aHR0cHM6Ly9hcnhpdi5vcmcvYWJzLzE3MDIuMDMyNzU=">https://arxiv.org/abs/1702.03275<i class="fa fa-external-link-alt"></i></span>)</li>
                    <li>renorm_clipping：可选，默认 None，是否要用 rmax、rmin、dmax 来 scalar Tensor。</li>
                    <li>renorm_momentum，可选，默认 0.99，用来更新动态均值和标准差的 Momentum 值。</li>
                    <li>fused，可选，默认 None，是否使用一个更快的、融合的实现方法。</li>
                    <li>virtual_batch_size，可选，默认 None，是一个 int 数字，指定一个虚拟 batch size。</li>
                    <li>adjustment，可选，默认 None，对标准化后的结果进行适当调整的方法。</li>
                  </ul>
                  <p>最后的一些参数说明不够详尽，更详细的用法参考：<span class="exturl" data-url="aHR0cHM6Ly93d3cudGVuc29yZmxvdy5vcmcvYXBpX2RvY3MvcHl0aG9uL3RmL2xheWVycy9iYXRjaF9ub3JtYWxpemF0aW9u">https://www.tensorflow.org/api_docs/python/tf/layers/batch_normalization<i class="fa fa-external-link-alt"></i></span>。 其用法很简单，在输入数据后面加一层 batch_normalization() 即可：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">x</span> = tf.layers.Input(shape=[<span class="number">32</span>])</span><br><span class="line"><span class="attr">x</span> = tf.layers.batch_normalization(x)</span><br><span class="line"><span class="attr">y</span> = tf.layers.dense(x, <span class="number">20</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="dense"><a href="#dense" class="headerlink" title="dense"></a>dense</h3>
                  <p>dense，即全连接网络，layers 模块提供了一个 dense() 方法来实现此操作，定义在 tensorflow/python/layers/core.py 中，下面我们来说明一下它的用法。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">dense(</span><br><span class="line">    inputs,</span><br><span class="line">    units,</span><br><span class="line">    <span class="attribute">activation</span>=None,</span><br><span class="line">    <span class="attribute">use_bias</span>=<span class="literal">True</span>,</span><br><span class="line">    <span class="attribute">kernel_initializer</span>=None,</span><br><span class="line">    <span class="attribute">bias_initializer</span>=tf.zeros_initializer(),</span><br><span class="line">    <span class="attribute">kernel_regularizer</span>=None,</span><br><span class="line">    <span class="attribute">bias_regularizer</span>=None,</span><br><span class="line">    <span class="attribute">activity_regularizer</span>=None,</span><br><span class="line">    <span class="attribute">kernel_constraint</span>=None,</span><br><span class="line">    <span class="attribute">bias_constraint</span>=None,</span><br><span class="line">    <span class="attribute">trainable</span>=<span class="literal">True</span>,</span><br><span class="line">    <span class="attribute">name</span>=None,</span><br><span class="line">    <span class="attribute">reuse</span>=None</span><br><span class="line">)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>参数说明如下：</p>
                  <ul>
                    <li>inputs：必需，即需要进行操作的输入数据。</li>
                    <li>units：必须，即神经元的数量。</li>
                    <li>activation：可选，默认为 None，如果为 None 则是线性激活。</li>
                    <li>use_bias：可选，默认为 True，是否使用偏置。</li>
                    <li>kernel_initializer：可选，默认为 None，即权重的初始化方法，如果为 None，则使用默认的 Xavier 初始化方法。</li>
                    <li>bias_initializer：可选，默认为零值初始化，即偏置的初始化方法。</li>
                    <li>kernel_regularizer：可选，默认为 None，施加在权重上的正则项。</li>
                    <li>bias_regularizer：可选，默认为 None，施加在偏置上的正则项。</li>
                    <li>activity_regularizer：可选，默认为 None，施加在输出上的正则项。</li>
                    <li>kernel_constraint，可选，默认为 None，施加在权重上的约束项。</li>
                    <li>bias_constraint，可选，默认为 None，施加在偏置上的约束项。</li>
                    <li>trainable：可选，默认为 True，布尔类型，如果为 True，则将变量添加到 GraphKeys.TRAINABLE_VARIABLES 中。</li>
                    <li>name：可选，默认为 None，卷积层的名称。</li>
                    <li>reuse：可选，默认为 None，布尔类型，如果为 True，那么如果 name 相同时，会重复利用。</li>
                  </ul>
                  <p>返回值： 全连接网络处理后的 Tensor。 下面我们用一个实例来感受一下它的用法：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf<span class="selector-class">.layers</span>.Input(shape=[<span class="number">32</span>])</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(x)</span></span></span><br><span class="line">y1 = tf<span class="selector-class">.layers</span>.dense(x, <span class="number">16</span>, activation=tf<span class="selector-class">.nn</span>.relu)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(y1)</span></span></span><br><span class="line">y2 = tf<span class="selector-class">.layers</span>.dense(y1, <span class="number">5</span>, activation=tf<span class="selector-class">.nn</span>.sigmoid)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(y2)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先我们用 Input 定义了 [?, 32] 的输入数据，然后经过第一层全连接网络，此时指定了神经元个数为 16，激活函数为 relu，接着输出结果经过第二层全连接网络，此时指定了神经元个数为 5，激活函数为 sigmoid，最后输出，结果如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">Tensor</span><span class="params">(<span class="string">"input_layer_1:0"</span>, shape=(?, <span class="number">32</span>)</span></span>, dtype=float32)</span><br><span class="line"><span class="function"><span class="title">Tensor</span><span class="params">(<span class="string">"dense/Relu:0"</span>, shape=(?, <span class="number">16</span>)</span></span>, dtype=float32)</span><br><span class="line"><span class="function"><span class="title">Tensor</span><span class="params">(<span class="string">"dense_2/Sigmoid:0"</span>, shape=(?, <span class="number">5</span>)</span></span>, dtype=float32)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到输出结果的最后一维度就等于神经元的个数，这是非常容易理解的。</p>
                  <h3 id="convolution"><a href="#convolution" class="headerlink" title="convolution"></a>convolution</h3>
                  <p>convolution，即卷积，这里提供了多个卷积方法，如 conv1d()、conv2d()、conv3d()，分别代表一维、二维、三维卷积，另外还有 conv2d_transpose()、conv3d_transpose()，分别代表二维和三维反卷积，还有 separable_conv2d() 方法代表二维深度可分离卷积。它们定义在 tensorflow/python/layers/convolutional.py 中，其用法都是类似的，在这里以 conv2d() 方法为例进行说明。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">conv2d(</span><br><span class="line">    inputs,</span><br><span class="line">    filters,</span><br><span class="line">    kernel_size,</span><br><span class="line">    strides=(1, 1),</span><br><span class="line">    <span class="attribute">padding</span>=<span class="string">'valid'</span>,</span><br><span class="line">    <span class="attribute">data_format</span>=<span class="string">'channels_last'</span>,</span><br><span class="line">    dilation_rate=(1, 1),</span><br><span class="line">    <span class="attribute">activation</span>=None,</span><br><span class="line">    <span class="attribute">use_bias</span>=<span class="literal">True</span>,</span><br><span class="line">    <span class="attribute">kernel_initializer</span>=None,</span><br><span class="line">    <span class="attribute">bias_initializer</span>=tf.zeros_initializer(),</span><br><span class="line">    <span class="attribute">kernel_regularizer</span>=None,</span><br><span class="line">    <span class="attribute">bias_regularizer</span>=None,</span><br><span class="line">    <span class="attribute">activity_regularizer</span>=None,</span><br><span class="line">    <span class="attribute">kernel_constraint</span>=None,</span><br><span class="line">    <span class="attribute">bias_constraint</span>=None,</span><br><span class="line">    <span class="attribute">trainable</span>=<span class="literal">True</span>,</span><br><span class="line">    <span class="attribute">name</span>=None,</span><br><span class="line">    <span class="attribute">reuse</span>=None</span><br><span class="line">)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>参数说明如下：</p>
                  <ul>
                    <li>inputs：必需，即需要进行操作的输入数据。</li>
                    <li>filters：必需，是一个数字，代表了输出通道的个数，即 output_channels。</li>
                    <li>kernel_size：必需，卷积核大小，必须是一个数字（高和宽都是此数字）或者长度为 2 的列表（分别代表高、宽）。</li>
                    <li>strides：可选，默认为 (1, 1)，卷积步长，必须是一个数字（高和宽都是此数字）或者长度为 2 的列表（分别代表高、宽）。</li>
                    <li>padding：可选，默认为 valid，padding 的模式，有 valid 和 same 两种，大小写不区分。</li>
                    <li>data_format：可选，默认 channels_last，分为 channels_last 和 channels_first 两种模式，代表了输入数据的维度类型，如果是 channels_last，那么输入数据的 shape 为 (batch, height, width, channels)，如果是 channels_first，那么输入数据的 shape 为 (batch, channels, height, width)。</li>
                    <li>dilation_rate：可选，默认为 (1, 1)，卷积的扩张率，如当扩张率为 2 时，卷积核内部就会有边距，3x3 的卷积核就会变成 5x5。</li>
                    <li>activation：可选，默认为 None，如果为 None 则是线性激活。</li>
                    <li>use_bias：可选，默认为 True，是否使用偏置。</li>
                    <li>kernel_initializer：可选，默认为 None，即权重的初始化方法，如果为 None，则使用默认的 Xavier 初始化方法。</li>
                    <li>bias_initializer：可选，默认为零值初始化，即偏置的初始化方法。</li>
                    <li>kernel_regularizer：可选，默认为 None，施加在权重上的正则项。</li>
                    <li>bias_regularizer：可选，默认为 None，施加在偏置上的正则项。</li>
                    <li>activity_regularizer：可选，默认为 None，施加在输出上的正则项。</li>
                    <li>kernel_constraint，可选，默认为 None，施加在权重上的约束项。</li>
                    <li>bias_constraint，可选，默认为 None，施加在偏置上的约束项。</li>
                    <li>trainable：可选，默认为 True，布尔类型，如果为 True，则将变量添加到 GraphKeys.TRAINABLE_VARIABLES 中。</li>
                    <li>name：可选，默认为 None，卷积层的名称。</li>
                    <li>reuse：可选，默认为 None，布尔类型，如果为 True，那么如果 name 相同时，会重复利用。</li>
                  </ul>
                  <p>返回值： 卷积后的 Tensor。 下面我们用实例感受一下它的用法：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf.layers.Input(shape=[20, 20, 3])</span><br><span class="line">y = tf.layers.conv2d(x, <span class="attribute">filters</span>=6, <span class="attribute">kernel_size</span>=2, <span class="attribute">padding</span>=<span class="string">'same'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(y)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们首先声明了一个 [?, 20, 20, 3] 的输入 x，然后将其传给 conv2d() 方法，filters 设定为 6，即输出通道为 6，kernel_size 为 2，即卷积核大小为 2 x 2，padding 方式设置为 same，那么输出结果的宽高和原来一定是相同的，但是输出通道就变成了 6，结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Tensor(<span class="string">"conv2d/BiasAdd:0"</span>, shape=(?, <span class="number">20</span>, <span class="number">20</span>, <span class="number">6</span>), dtype=<span class="built_in">float</span>32)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但如果我们将 padding 方式不传入，使用默认的 valid 模式，代码改写如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf.layers.Input(shape=[20, 20, 3])</span><br><span class="line">y = tf.layers.conv2d(x, <span class="attribute">filters</span>=6, <span class="attribute">kernel_size</span>=2)</span><br><span class="line"><span class="builtin-name">print</span>(y)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Tensor(<span class="string">"conv2d/BiasAdd:0"</span>, shape=(?, <span class="number">19</span>, <span class="number">19</span>, <span class="number">6</span>), dtype=<span class="built_in">float</span>32)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果就变成了 [?, 19, 19, 6]，这是因为步长默认为 1，卷积核大小为 2 x 2，所以得到的结果的高宽即为 (20 - (2 - 1)) x (20 - (2 - 1)) = 19 x 19。 当然卷积核我们也可以变换大小，传入一个列表形式：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf.layers.Input(shape=[<span class="number">20</span>, <span class="number">20</span>, <span class="number">3</span>])</span><br><span class="line">y = tf.layers.conv2d(x, filters=<span class="number">6</span>, kernel_size=[<span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">print(y)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时我们的卷积核大小变成了 2 x 3，即高为 2，宽为 3，结果就变成了 [?, 19, 18, 6]，这是因为步长默认为 1，卷积核大小为 2 x 2，所以得到的结果的高宽即为 (20 - (2 - 1)) x (20 - (3 - 1)) = 19 x 18。 如果我们将步长也设置一下，也传入列表形式：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf.layers.Input(shape=[<span class="number">20</span>, <span class="number">20</span>, <span class="number">3</span>])</span><br><span class="line">y = tf.layers.conv2d(x, filters=<span class="number">6</span>, kernel_size=[<span class="number">2</span>, <span class="number">3</span>], strides=[<span class="number">2</span>, <span class="number">2</span>])</span><br><span class="line">print(y)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时卷积核大小变成了 2 x 3，步长变成了 2 x 2，所以结果的高宽为 ceil(20 - (2- 1)) / 2 x ceil(20 - (3- 1)) / 2 = 10 x 9，得到的结果即为 [?, 10, 9, 6]。 运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Tensor(<span class="string">"conv2d_4/BiasAdd:0"</span>, shape=(?, <span class="number">10</span>, <span class="number">9</span>, <span class="number">6</span>), dtype=<span class="built_in">float</span>32)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外我们还可以传入激活函数，或者禁用 bias 等操作，实例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf.layers.Input(shape=[20, 20, 3])</span><br><span class="line">y = tf.layers.conv2d(x, <span class="attribute">filters</span>=6, <span class="attribute">kernel_size</span>=2, <span class="attribute">activation</span>=tf.nn.relu, <span class="attribute">use_bias</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="builtin-name">print</span>(y)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就将激活函数改成了 relu，同时禁用了 bias，运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Tensor(<span class="string">"conv2d_5/Relu:0"</span>, shape=(?, <span class="number">19</span>, <span class="number">19</span>, <span class="number">6</span>), dtype=<span class="built_in">float</span>32)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外还有反卷积操作，反卷积顾名思义即卷积的反向操作，即输入卷积的结果，得到卷积前的结果，其参数用法是完全一样的，例如：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf.layers.Input(shape=[20, 20, 3])</span><br><span class="line">y = tf.layers.conv2d_transpose(x, <span class="attribute">filters</span>=6, <span class="attribute">kernel_size</span>=2, <span class="attribute">strides</span>=2)</span><br><span class="line"><span class="builtin-name">print</span>(y)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>例如此处输入的图像高宽为 20 x 20，经过卷积核为 2，步长为 2 的反卷积处理，得到的结果高宽就变为了 40 x 40，结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Tensor(<span class="string">"conv2d_transpose/BiasAdd:0"</span>, shape=(?, <span class="number">40</span>, <span class="number">40</span>, <span class="number">6</span>), dtype=<span class="built_in">float</span>32)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="pooling"><a href="#pooling" class="headerlink" title="pooling"></a>pooling</h3>
                  <p>pooling，即池化，layers 模块提供了多个池化方法，这几个池化方法都是类似的，包括 max_pooling1d()、max_pooling2d()、max_pooling3d()、average_pooling1d()、average_pooling2d()、average_pooling3d()，分别代表一维二维三维最大和平均池化方法，它们都定义在 tensorflow/python/layers/pooling.py 中，这里以 max_pooling2d() 方法为例进行介绍。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">max_pooling2d(</span><br><span class="line">    inputs,</span><br><span class="line">    pool_size,</span><br><span class="line">    strides,</span><br><span class="line">    <span class="attribute">padding</span>=<span class="string">'valid'</span>,</span><br><span class="line">    <span class="attribute">data_format</span>=<span class="string">'channels_last'</span>,</span><br><span class="line">    <span class="attribute">name</span>=None</span><br><span class="line">)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>参数说明如下：</p>
                  <ul>
                    <li>inputs: 必需，即需要池化的输入对象，必须是 4 维的。</li>
                    <li>pool_size：必需，池化窗口大小，必须是一个数字（高和宽都是此数字）或者长度为 2 的列表（分别代表高、宽）。</li>
                    <li>strides：必需，池化步长，必须是一个数字（高和宽都是此数字）或者长度为 2 的列表（分别代表高、宽）。</li>
                    <li>padding：可选，默认 valid，padding 的方法，valid 或者 same，大小写不区分。</li>
                    <li>data_format：可选，默认 channels_last，分为 channels_last 和 channels_first 两种模式，代表了输入数据的维度类型，如果是 channels_last，那么输入数据的 shape 为 (batch, height, width, channels)，如果是 channels_first，那么输入数据的 shape 为 (batch, channels, height, width)。</li>
                    <li>name：可选，默认 None，池化层的名称。</li>
                  </ul>
                  <p>返回值： 经过池化处理后的 Tensor。 下面我们用一个实例来感受一下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf.layers.Input(shape=[20, 20, 3])</span><br><span class="line"><span class="builtin-name">print</span>(x)</span><br><span class="line">y = tf.layers.conv2d(x, <span class="attribute">filters</span>=6, <span class="attribute">kernel_size</span>=3, <span class="attribute">padding</span>=<span class="string">'same'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(y)</span><br><span class="line">p = tf.layers.max_pooling2d(y, <span class="attribute">pool_size</span>=2, <span class="attribute">strides</span>=2)</span><br><span class="line"><span class="builtin-name">print</span>(p)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们首先指定了输入 x，shape 为 [20, 20, 3]，然后对其进行了卷积计算，然后池化，最后得到池化后的结果。结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Tensor(<span class="string">"input_layer_1:0"</span>, shape=(?, <span class="number">20</span>, <span class="number">20</span>, <span class="number">3</span>), dtype=<span class="built_in">float</span>32)</span><br><span class="line">Tensor(<span class="string">"conv2d/BiasAdd:0"</span>, shape=(?, <span class="number">20</span>, <span class="number">20</span>, <span class="number">6</span>), dtype=<span class="built_in">float</span>32)</span><br><span class="line">Tensor(<span class="string">"max_pooling2d/MaxPool:0"</span>, shape=(?, <span class="number">10</span>, <span class="number">10</span>, <span class="number">6</span>), dtype=<span class="built_in">float</span>32)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到这里池化窗口用的是 2，步长也是 2，所以原本卷积后 shape 为 [?, 20, 20, 6] 的结果就变成了 [?, 10, 10, 6]。</p>
                  <h3 id="dropout"><a href="#dropout" class="headerlink" title="dropout"></a>dropout</h3>
                  <p>dropout 是指在深度学习网络的训练过程中，对于神经网络单元，按照一定的概率将其暂时从网络中丢弃，可以用来防止过拟合，layers 模块中提供了 dropout() 方法来实现这一操作，定义在 tensorflow/python/layers/core.py。下面我们来说明一下它的用法。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">dropout(</span><br><span class="line">    inputs,</span><br><span class="line">    <span class="attribute">rate</span>=0.5,</span><br><span class="line">    <span class="attribute">noise_shape</span>=None,</span><br><span class="line">    <span class="attribute">seed</span>=None,</span><br><span class="line">    <span class="attribute">training</span>=<span class="literal">False</span>,</span><br><span class="line">    <span class="attribute">name</span>=None</span><br><span class="line">)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>参数说明如下：</p>
                  <ul>
                    <li>inputs：必须，即输入数据。</li>
                    <li>rate：可选，默认为 0.5，即 dropout rate，如设置为 0.1，则意味着会丢弃 10% 的神经元。</li>
                    <li>noise_shape：可选，默认为 None，int32 类型的一维 Tensor，它代表了 dropout mask 的 shape，dropout mask 会与 inputs 相乘对 inputs 做转换，例如 inputs 的 shape 为 (batch_size, timesteps, features)，但我们想要 droput mask 在所有 timesteps 都是相同的，我们可以设置 noise_shape=[batch_size, 1, features]。</li>
                    <li>seed：可选，默认为 None，即产生随机熟的种子值。</li>
                    <li>training：可选，默认为 False，布尔类型，即代表了是否标志位 training 模式。</li>
                    <li>name：可选，默认为 None，dropout 层的名称。</li>
                  </ul>
                  <p>返回： 经过 dropout 层之后的 Tensor。 我们用一个实例来感受一下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf<span class="selector-class">.layers</span>.Input(shape=[<span class="number">32</span>])</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(x)</span></span></span><br><span class="line">y = tf<span class="selector-class">.layers</span>.dense(x, <span class="number">16</span>, activation=tf<span class="selector-class">.nn</span>.softmax)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(y)</span></span></span><br><span class="line">d = tf<span class="selector-class">.layers</span>.dropout(y, rate=<span class="number">0.2</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(d)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">Tensor</span><span class="params">(<span class="string">"input_layer_1:0"</span>, shape=(?, <span class="number">32</span>)</span></span>, dtype=float32)</span><br><span class="line"><span class="function"><span class="title">Tensor</span><span class="params">(<span class="string">"dense/Softmax:0"</span>, shape=(?, <span class="number">16</span>)</span></span>, dtype=float32)</span><br><span class="line"><span class="function"><span class="title">Tensor</span><span class="params">(<span class="string">"dropout/Identity:0"</span>, shape=(?, <span class="number">16</span>)</span></span>, dtype=float32)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们使用 dropout() 方法实现了 droput 操作，并制定 dropout rate 为 0.2，最后输出结果的 shape 和原来是一致的。</p>
                  <h3 id="flatten"><a href="#flatten" class="headerlink" title="flatten"></a>flatten</h3>
                  <p>flatten() 方法可以对 Tensor 进行展平操作，定义在 tensorflow/python/layers/core.py。</p>
                  <figure class="highlight fortran">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">flatten(</span><br><span class="line">    inputs,</span><br><span class="line">    <span class="keyword">name</span>=<span class="keyword">None</span></span><br><span class="line">)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>参数说明如下：</p>
                  <ul>
                    <li>inputs：必需，即输入数据。</li>
                    <li>name：可选，默认为 None，即该层的名称。</li>
                  </ul>
                  <p>返回结果： 展平后的 Tensor。 下面我们用一个实例来感受一下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf<span class="selector-class">.layers</span>.Input(shape=[<span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(x)</span></span></span><br><span class="line">y = tf<span class="selector-class">.layers</span>.flatten(x)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(y)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">Tensor</span><span class="params">(<span class="string">"input_layer_1:0"</span>, shape=(?, <span class="number">5</span>, <span class="number">6</span>)</span></span>, dtype=float32)</span><br><span class="line"><span class="function"><span class="title">Tensor</span><span class="params">(<span class="string">"flatten/Reshape:0"</span>, shape=(?, <span class="number">30</span>)</span></span>, dtype=float32)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里输入数据的 shape 为 [?, 5, 6]，经过 flatten 层之后，就会变成 [?, 30]，即将除了第一维的数据维度相乘，对原 Tensor 进行展平。 假如第一维是一个已知的数的话，它依然还是同样的处理，示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf.placeholder(shape=[<span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>], dtype=tf.float32)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(x)</span></span></span><br><span class="line">y = tf<span class="selector-class">.layers</span>.flatten(x)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(y)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">Tensor</span><span class="params">(<span class="string">"Placeholder:0"</span>, shape=(<span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>)</span></span>, dtype=float32)</span><br><span class="line"><span class="function"><span class="title">Tensor</span><span class="params">(<span class="string">"flatten_2/Reshape:0"</span>, shape=(<span class="number">5</span>, <span class="number">12</span>)</span></span>, dtype=float32)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2>
                  <p>除了如上的方法，其实我们还可以直接使用类来进行操作，实际上看方法的实现就是实例化了其对应的类，下面我们首先说明一下有哪些类可以使用：</p>
                  <ul>
                    <li>class AveragePooling1D: 一维平均池化层类</li>
                    <li>class AveragePooling2D: 二维平均池化层类</li>
                    <li>class AveragePooling3D: 三维平均池化层类</li>
                    <li>class BatchNormalization: 批量标准化层类</li>
                    <li>class Conv1D: 一维卷积层类</li>
                    <li>class Conv2D: 二维卷积层类</li>
                    <li>class Conv2DTranspose: 二维反卷积层类</li>
                    <li>class Conv3D: 三维卷积层类</li>
                    <li>class Conv3DTranspose: 三维反卷积层类</li>
                    <li>class Dense: 全连接层类</li>
                    <li>class Dropout: Dropout 层类</li>
                    <li>class Flatten: Flatten 层类</li>
                    <li>class InputSpec: Input 层类</li>
                    <li>class Layer: 基类、父类</li>
                    <li>class MaxPooling1D: 一维最大池化层类</li>
                    <li>class MaxPooling2D: 二维最大池化层类</li>
                    <li>class MaxPooling3D: 三维最大池化层类</li>
                    <li>class SeparableConv2D: 二维深度可分离卷积层类</li>
                  </ul>
                  <p>其实类这些类都和上文介绍的方法是一一对应的，关于它的用法我们可以在方法的源码实现里面找到，下面我们以 Dense 类的用法为例来说明一下这些类的具体调用方法：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf.layers.<span class="constructor">Input(<span class="params">shape</span>=[32])</span></span><br><span class="line">dense = tf.layers.<span class="constructor">Dense(16, <span class="params">activation</span>=<span class="params">tf</span>.<span class="params">nn</span>.<span class="params">relu</span>)</span></span><br><span class="line">y = dense.apply(x)</span><br><span class="line">print(y)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们初始化了一个 Dense 类，它只接受一个必须参数，那就是 units，相比 dense() 方法来说它没有了 inputs，因此这个实例化的类和 inputs 是无关的，这样就相当于创建了一个 16 个神经元的全连接层。 但创建了不调用是没有用的，我们要将这个层构建到网络之中，需要调用它的 apply() 方法，而 apply() 方法就接收 inputs 这个参数，返回计算结果，运行结果如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">Tensor</span><span class="params">(<span class="string">"dense/Relu:0"</span>, shape=(?, <span class="number">16</span>)</span></span>, dtype=float32)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>因此我们可以发现，这些类在初始化的时候实际上是比其对应的方法少了 inputs 参数，其他的参数都是完全一致的，另外需要调用 apply() 方法才可以应用该层并将其构建到模型中。 所以其他的类的用法在此就不一一赘述了，初始化的参数可以类比其对应的方法，实例化类之后，调用 apply() 方法，可以达到同样的构建模型的效果。</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>以上便是 TensorFlow layers 模块的详细用法说明，更加详细的用法可以参考官方文档：<span class="exturl" data-url="aHR0cHM6Ly93d3cudGVuc29yZmxvdy5vcmcvYXBpX2RvY3MvcHl0aG9uL3RmL2xheWVycw==">https://www.tensorflow.org/api_docs/python/tf/layers<i class="fa fa-external-link-alt"></i></span>。 本节代码地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FJRGVlcExlYXJuaW5nL1RlbnNvckZsb3dMYXllcnM=">https://github.com/AIDeepLearning/TensorFlowLayers<i class="fa fa-external-link-alt"></i></span>。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-02-23 03:42:58" itemprop="dateCreated datePublished" datetime="2018-02-23T03:42:58+08:00">2018-02-23</time>
                </span>
                <span id="/5715.html" class="post-meta-item leancloud_visitors" data-flag-title="TensorFlow layers模块用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>13k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>12 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5709.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5709.html" class="post-title-link" itemprop="url">TensorFlow验证码识别</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本节我们来用 TensorFlow 来实现一个深度学习模型，用来实现验证码识别的过程，这里我们识别的验证码是图形验证码，首先我们会用标注好的数据来训练一个模型，然后再用模型来实现这个验证码的识别。</p>
                  <h2 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h2>
                  <p>首先我们来看下验证码是怎样的，这里我们使用 Python 的 captcha 库来生成即可，这个库默认是没有安装的，所以这里我们需要先安装这个库，另外我们还需要安装 pillow 库，使用 pip3 即可：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> captcha pillow</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装好之后，我们就可以用如下代码来生成一个简单的图形验证码了：</p>
                  <figure class="highlight sqf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> captcha.<span class="built_in">image</span> import ImageCaptcha</span><br><span class="line"><span class="keyword">from</span> PIL import <span class="built_in">Image</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">text</span> = <span class="string">'1234'</span></span><br><span class="line"><span class="built_in">image</span> = ImageCaptcha()</span><br><span class="line">captcha = <span class="built_in">image</span>.generate(<span class="built_in">text</span>)</span><br><span class="line">captcha_image = <span class="built_in">Image</span>.open(captcha)</span><br><span class="line">captcha_image.show()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行之后便会弹出一张图片，结果如下： <img src="https://germey.gitbooks.io/ai/content/assets/2018-02-20-23-03-18.jpg" alt=""> 可以看到图中的文字正是我们所定义的 text 内容，这样我们就可以得到一张图片和其对应的真实文本，这样我们就可以用它来生成一批训练数据和测试数据了。</p>
                  <h2 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h2>
                  <p>在训练之前肯定是要进行数据预处理了，现在我们首先定义好了要生成的验证码文本内容，这就相当于已经有了 label 了，然后我们再用它来生成验证码，就可以得到输入数据 x 了，在这里我们首先定义好我们的输入词表，由于大小写字母加数字的词表比较庞大，设想我们用含有大小写字母和数字的验证码，一个验证码四个字符，那么一共可能的组合是 (26 + 26 + 10) ^ 4 = 14776336 种组合，这个数量训练起来有点大，所以这里我们精简一下，只使用纯数字的验证码来训练，这样其组合个数就变为 10 ^ 4 = 10000 种，显然少了很多。 所以在这里我们先定义一个词表和其长度变量：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">VOCAB</span> = [<span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>]</span><br><span class="line"><span class="attr">CAPTCHA_LENGTH</span> = <span class="number">4</span></span><br><span class="line"><span class="attr">VOCAB_LENGTH</span> = len(VOCAB)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 VOCAB 就是词表的内容，即 0 到 9 这 10 个数字，验证码的字符个数即 CAPTCHA_LENGTH 是 4，词表长度是 VOCAB 的长度，即 10。 接下来我们定义一个生成验证码数据的方法，流程类似上文，只不过这里我们将返回的数据转为了 Numpy 形式的数组：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> captcha.image <span class="keyword">import</span> ImageCaptcha</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_captcha</span><span class="params">(captcha_text)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    get captcha text and np array</span></span><br><span class="line"><span class="string">    :param captcha_text: source text</span></span><br><span class="line"><span class="string">    :return: captcha image and array</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    image = ImageCaptcha()</span><br><span class="line">    captcha = image.generate(captcha_text)</span><br><span class="line">    captcha_image = Image.open(captcha)</span><br><span class="line">    captcha_array = np.array(captcha_image)</span><br><span class="line">    <span class="keyword">return</span> captcha_array</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样调用此方法，我们就可以得到一个 Numpy 数组了，这个其实是把验证码转化成了每个像素的 RGB，我们调用一下这个方法试试：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">captcha = generate_captcha(<span class="string">'1234'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(captcha, captcha.shape)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>内容如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[[[<span class="number">239</span> <span class="number">244</span> <span class="number">244</span>]</span><br><span class="line">  [<span class="number">239</span> <span class="number">244</span> <span class="number">244</span>]</span><br><span class="line">  [<span class="number">239</span> <span class="number">244</span> <span class="number">244</span>]</span><br><span class="line">  ..., </span><br><span class="line">  ..., </span><br><span class="line">  [<span class="number">239</span> <span class="number">244</span> <span class="number">244</span>]</span><br><span class="line">  [<span class="number">239</span> <span class="number">244</span> <span class="number">244</span>]</span><br><span class="line">  [<span class="number">239</span> <span class="number">244</span> <span class="number">244</span>]]] </span><br><span class="line">(<span class="number">60</span>, <span class="number">160</span>, <span class="number">3</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到它的 shape 是 (60, 160, 3)，这其实代表验证码图片的高度是 60，宽度是 160，是 60 x 160 像素的验证码，每个像素都有 RGB 值，所以最后一维即为像素的 RGB 值。 接下来我们需要定义 label，由于我们需要使用深度学习模型进行训练，所以这里我们的 label 数据最好使用 One-Hot 编码，即如果验证码文本是 1234，那么应该词表索引位置置 1，总共的长度是 40，我们用程序实现一下 One-Hot 编码和文本的互相转换：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">text2vec</span><span class="params">(text)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    text to one-hot vector</span></span><br><span class="line"><span class="string">    :param text: source text</span></span><br><span class="line"><span class="string">    :return: np array</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> len(text) &gt; CAPTCHA_LENGTH:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    vector = np.zeros(CAPTCHA_LENGTH * VOCAB_LENGTH)</span><br><span class="line">    <span class="keyword">for</span> i, c <span class="keyword">in</span> enumerate(text):</span><br><span class="line">        index = i * VOCAB_LENGTH + VOCAB.index(c)</span><br><span class="line">        vector[index] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> vector</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vec2text</span><span class="params">(vector)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    vector to captcha text</span></span><br><span class="line"><span class="string">    :param vector: np array</span></span><br><span class="line"><span class="string">    :return: text</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isinstance(vector, np.ndarray):</span><br><span class="line">        vector = np.asarray(vector)</span><br><span class="line">    vector = np.reshape(vector, [CAPTCHA_LENGTH, <span class="number">-1</span>])</span><br><span class="line">    text = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> vector:</span><br><span class="line">        text += VOCAB[np.argmax(item)]</span><br><span class="line">    <span class="keyword">return</span> text</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 text2vec() 方法就是将真实文本转化为 One-Hot 编码，vec2text() 方法就是将 One-Hot 编码转回真实文本。 例如这里调用一下这两个方法，我们将 1234 文本转换为 One-Hot 编码，然后在将其转回来：</p>
                  <figure class="highlight mel">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">vector</span> = text2vec(<span class="string">'1234'</span>)</span><br><span class="line"><span class="keyword">text</span> = vec2text(<span class="keyword">vector</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">vector</span>, <span class="keyword">text</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[ <span class="number">0.</span>  <span class="number">1.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">1.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span></span><br><span class="line">  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">1.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">1.</span>  <span class="number">0.</span></span><br><span class="line">  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>]</span><br><span class="line"><span class="number">1234</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就可以实现文本到 One-Hot 编码的互转了。 接下来我们就可以构造一批数据了，x 数据就是验证码的 Numpy 数组，y 数据就是验证码的文本的 One-Hot 编码，生成内容如下：</p>
                  <figure class="highlight processing">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> <span class="built_in">random</span></span><br><span class="line">from os.path <span class="keyword">import</span> <span class="built_in">join</span>, exists</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> numpy as np</span><br><span class="line">from os <span class="keyword">import</span> makedirs</span><br><span class="line"></span><br><span class="line">DATA_LENGTH = <span class="number">10000</span></span><br><span class="line">DATA_PATH = <span class="string">'data'</span></span><br><span class="line"></span><br><span class="line">def get_random_text():</span><br><span class="line">    <span class="built_in">text</span> = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i in range(CAPTCHA_LENGTH):</span><br><span class="line">        <span class="built_in">text</span> += <span class="built_in">random</span>.choice(VOCAB)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">text</span></span><br><span class="line"></span><br><span class="line">def generate_data():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'Generating Data...'</span>)</span><br><span class="line">    data_x, data_y = [], []</span><br><span class="line"></span><br><span class="line">    # generate data x and y</span><br><span class="line">    <span class="keyword">for</span> i in range(DATA_LENGTH):</span><br><span class="line">        <span class="built_in">text</span> = get_random_text()</span><br><span class="line">        # <span class="built_in">get</span> captcha array</span><br><span class="line">        captcha_array = generate_captcha(<span class="built_in">text</span>)</span><br><span class="line">        # <span class="built_in">get</span> vector</span><br><span class="line">        vector = text2vec(<span class="built_in">text</span>)</span><br><span class="line">        data_x.<span class="built_in">append</span>(captcha_array)</span><br><span class="line">        data_y.<span class="built_in">append</span>(vector)</span><br><span class="line"></span><br><span class="line">    # write data to pickle</span><br><span class="line">    <span class="keyword">if</span> not exists(DATA_PATH):</span><br><span class="line">        makedirs(DATA_PATH)</span><br><span class="line"></span><br><span class="line">    x = np.asarray(data_x, np.float32)</span><br><span class="line">    y = np.asarray(data_y, np.float32)</span><br><span class="line">    with <span class="built_in">open</span>(<span class="built_in">join</span>(DATA_PATH, <span class="string">'data.pkl'</span>), <span class="string">'wb'</span>) as f:</span><br><span class="line">        pickle.dump(x, f)</span><br><span class="line">        pickle.dump(y, f)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们定义了一个 get_random_text() 方法，可以随机生成验证码文本，然后接下来再利用这个随机生成的文本来产生对应的 x、y 数据，然后我们再将数据写入到 pickle 文件里，这样就完成了预处理的操作。</p>
                  <h2 id="构建模型"><a href="#构建模型" class="headerlink" title="构建模型"></a>构建模型</h2>
                  <p>有了数据之后，我们就开始构建模型吧，这里我们还是利用 train_test_split() 方法将数据分为三部分，训练集、开发集、验证集：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">with</span> <span class="keyword">open</span>('data.pkl', 'rb') <span class="keyword">as</span> f:</span><br><span class="line">    data_x = pickle.load(f)</span><br><span class="line">    data_y = pickle.load(f)</span><br><span class="line">    return standardize(data_x), data_y</span><br><span class="line"></span><br><span class="line">train_x, test_x, train_y, test_y = train<span class="constructor">_test_split(<span class="params">data_x</span>, <span class="params">data_y</span>, <span class="params">test_size</span>=0.4, <span class="params">random_state</span>=40)</span></span><br><span class="line">dev_x, test_x, dev_y, test_y, = train<span class="constructor">_test_split(<span class="params">test_x</span>, <span class="params">test_y</span>, <span class="params">test_size</span>=0.5, <span class="params">random_state</span>=40)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们使用者三个数据集构建三个 Dataset 对象：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># train <span class="keyword">and</span> dev dataset</span><br><span class="line">train_dataset = tf.data.<span class="module-access"><span class="module"><span class="identifier">Dataset</span>.</span></span>from<span class="constructor">_tensor_slices((<span class="params">train_x</span>, <span class="params">train_y</span>)</span>).shuffle(<span class="number">10000</span>)</span><br><span class="line">train_dataset = train_dataset.batch(<span class="module-access"><span class="module"><span class="identifier">FLAGS</span>.</span></span>train_batch_size)</span><br><span class="line"></span><br><span class="line">dev_dataset = tf.data.<span class="module-access"><span class="module"><span class="identifier">Dataset</span>.</span></span>from<span class="constructor">_tensor_slices((<span class="params">dev_x</span>, <span class="params">dev_y</span>)</span>)</span><br><span class="line">dev_dataset = dev_dataset.batch(<span class="module-access"><span class="module"><span class="identifier">FLAGS</span>.</span></span>dev_batch_size)</span><br><span class="line"></span><br><span class="line">test_dataset = tf.data.<span class="module-access"><span class="module"><span class="identifier">Dataset</span>.</span></span>from<span class="constructor">_tensor_slices((<span class="params">test_x</span>, <span class="params">test_y</span>)</span>)</span><br><span class="line">test_dataset = test_dataset.batch(<span class="module-access"><span class="module"><span class="identifier">FLAGS</span>.</span></span>test_batch_size)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后初始化一个迭代器，并绑定到这个数据集上：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># a reinitializable iterator</span><br><span class="line">iterator = tf.data.<span class="module-access"><span class="module"><span class="identifier">Iterator</span>.</span></span>from<span class="constructor">_structure(<span class="params">train_dataset</span>.<span class="params">output_types</span>, <span class="params">train_dataset</span>.<span class="params">output_shapes</span>)</span></span><br><span class="line">train_initializer = iterator.make<span class="constructor">_initializer(<span class="params">train_dataset</span>)</span></span><br><span class="line">dev_initializer = iterator.make<span class="constructor">_initializer(<span class="params">dev_dataset</span>)</span></span><br><span class="line">test_initializer = iterator.make<span class="constructor">_initializer(<span class="params">test_dataset</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来就是关键的部分了，在这里我们使用三层卷积和两层全连接网络进行构造，在这里为了简化写法，直接使用 TensorFlow 的 layers 模块：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># input Layer</span></span><br><span class="line">with tf.variable_scope(<span class="string">'inputs'</span>):</span><br><span class="line">    # x.shape = [-1, 60, 160, 3]</span><br><span class="line">    x, y_label = iterator.get_next()</span><br><span class="line">keep_prob = tf.placeholder(tf.float32, [])</span><br><span class="line">y = tf.cast(x, tf.float32)</span><br><span class="line"><span class="comment"># 3 CNN layers</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(3):</span><br><span class="line">    y = tf.layers.conv2d(y, <span class="attribute">filters</span>=32, <span class="attribute">kernel_size</span>=3, <span class="attribute">padding</span>=<span class="string">'same'</span>, <span class="attribute">activation</span>=tf.nn.relu)</span><br><span class="line">    y = tf.layers.max_pooling2d(y, <span class="attribute">pool_size</span>=2, <span class="attribute">strides</span>=2, <span class="attribute">padding</span>=<span class="string">'same'</span>)</span><br><span class="line">    # y = tf.layers.dropout(y, <span class="attribute">rate</span>=keep_prob)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 dense layers</span></span><br><span class="line">y = tf.layers.flatten(y)</span><br><span class="line">y = tf.layers.dense(y, 1024, <span class="attribute">activation</span>=tf.nn.relu)</span><br><span class="line">y = tf.layers.dropout(y, <span class="attribute">rate</span>=keep_prob)</span><br><span class="line">y = tf.layers.dense(y, VOCAB_LENGTH)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里卷积核大小为 3，padding 使用 SAME 模式，激活函数使用 relu。 经过全连接网络变换之后，y 的 shape 就变成了 [batch_size, n_classes]，我们的 label 是 CAPTCHA_LENGTH 个 One-Hot 向量拼合而成的，在这里我们想使用交叉熵来计算，但是交叉熵计算的时候，label 参数向量最后一维各个元素之和必须为 1，不然计算梯度的时候会出现问题。详情参见 TensorFlow 的官方文档：<span class="exturl" data-url="aHR0cHM6Ly93d3cudGVuc29yZmxvdy5vcmcvYXBpX2RvY3MvcHl0aG9uL3RmL25uL3NvZnRtYXhfY3Jvc3NfZW50cm9weV93aXRoX2xvZ2l0cw==">https://www.tensorflow.org/api_docs/python/tf/nn/softmax_cross_entropy_with_logits<i class="fa fa-external-link-alt"></i></span>：</p>
                  <blockquote>
                    <p>NOTE: While the classes are mutually exclusive, their probabilities need not be. All that is required is that each row of labels is a valid probability distribution. If they are not, the computation of the gradient will be incorrect.</p>
                  </blockquote>
                  <p>但是现在的 label 参数是 CAPTCHA_LENGTH 个 One-Hot 向量拼合而成，所以这里各个元素之和为 CAPTCHA_LENGTH，所以我们需要重新 reshape 一下，确保最后一维各个元素之和为 1：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">y_reshape</span> = tf.reshape(y, [-<span class="number">1</span>, VOCAB_LENGTH])</span><br><span class="line"><span class="attr">y_label_reshape</span> = tf.reshape(y_label, [-<span class="number">1</span>, VOCAB_LENGTH])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就可以确保最后一维是 VOCAB_LENGTH 长度，而它就是一个 One-Hot 向量，所以各元素之和必定为 1。 然后 Loss 和 Accuracy 就好计算了：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># loss</span><br><span class="line">cross_entropy = tf.reduce<span class="constructor">_sum(<span class="params">tf</span>.<span class="params">nn</span>.<span class="params">softmax_cross_entropy_with_logits</span>(<span class="params">logits</span>=<span class="params">y_reshape</span>, <span class="params">labels</span>=<span class="params">y_label_reshape</span>)</span>)</span><br><span class="line"># accuracy</span><br><span class="line">max_index_predict = tf.argmax(y_reshape, axis=-<span class="number">1</span>)</span><br><span class="line">max_index_label = tf.argmax(y_label_reshape, axis=-<span class="number">1</span>)</span><br><span class="line">correct_predict = tf.equal(max_index_predict, max_index_label)</span><br><span class="line">accuracy = tf.reduce<span class="constructor">_mean(<span class="params">tf</span>.<span class="params">cast</span>(<span class="params">correct_predict</span>, <span class="params">tf</span>.<span class="params">float32</span>)</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>再接下来执行训练即可：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># train</span></span><br><span class="line">train_op = tf.train.RMSPropOptimizer(FLAGS.learning_rate).minimize(cross_entropy, <span class="attribute">global_step</span>=global_step)</span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(FLAGS.epoch_num):</span><br><span class="line">    tf.train.global_step(sess, <span class="attribute">global_step_tensor</span>=global_step)</span><br><span class="line">    # train</span><br><span class="line">    sess.<span class="builtin-name">run</span>(train_initializer)</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">step</span> <span class="keyword">in</span> range(int(train_steps)):</span><br><span class="line">        loss, acc, gstep, _ = sess.<span class="builtin-name">run</span>([cross_entropy, accuracy, global_step, train_op],</span><br><span class="line">                                       feed_dict=&#123;keep_prob: FLAGS.keep_prob&#125;)</span><br><span class="line">        # <span class="builtin-name">print</span> log</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">step</span> % FLAGS.steps_per_print == 0:</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">'Global Step'</span>, gstep, <span class="string">'Step'</span>, <span class="keyword">step</span>, <span class="string">'Train Loss'</span>, loss, <span class="string">'Accuracy'</span>, acc)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> epoch % FLAGS.epochs_per_dev == 0:</span><br><span class="line">        # dev</span><br><span class="line">        sess.<span class="builtin-name">run</span>(dev_initializer)</span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">step</span> <span class="keyword">in</span> range(int(dev_steps)):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">step</span> % FLAGS.steps_per_print == 0:</span><br><span class="line">                <span class="builtin-name">print</span>(<span class="string">'Dev Accuracy'</span>, sess.<span class="builtin-name">run</span>(accuracy, feed_dict=&#123;keep_prob: 1&#125;), <span class="string">'Step'</span>, <span class="keyword">step</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们首先初始化 train_initializer，将 iterator 绑定到 Train Dataset 上，然后执行 train_op，获得 loss、acc、gstep 等结果并输出。</p>
                  <h2 id="训练"><a href="#训练" class="headerlink" title="训练"></a>训练</h2>
                  <p>运行训练过程，结果类似如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">...</span><br><span class="line">Dev Accuracy <span class="number">0.9580078</span> Step <span class="number">0</span></span><br><span class="line">Dev Accuracy <span class="number">0.9472656</span> Step <span class="number">2</span></span><br><span class="line">Dev Accuracy <span class="number">0.9501953</span> Step <span class="number">4</span></span><br><span class="line">Dev Accuracy <span class="number">0.9658203</span> Step <span class="number">6</span></span><br><span class="line">Global Step <span class="number">3243</span> Step <span class="number">0</span> Train Loss <span class="number">1.1920928e-06</span> Accuracy <span class="number">1.0</span></span><br><span class="line">Global Step <span class="number">3245</span> Step <span class="number">2</span> Train Loss <span class="number">1.5497207e-06</span> Accuracy <span class="number">1.0</span></span><br><span class="line">Global Step <span class="number">3247</span> Step <span class="number">4</span> Train Loss <span class="number">1.1920928e-06</span> Accuracy <span class="number">1.0</span></span><br><span class="line">Global Step <span class="number">3249</span> Step <span class="number">6</span> Train Loss <span class="number">1.7881392e-06</span> Accuracy <span class="number">1.0</span></span><br><span class="line">...</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>验证集准确率 95% 以上。</p>
                  <h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2>
                  <p>训练过程我们还可以每隔几个 Epoch 保存一下模型：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># save model</span><br><span class="line"><span class="keyword">if</span> epoch % <span class="module-access"><span class="module"><span class="identifier">FLAGS</span>.</span></span>epochs_per_save<span class="operator"> == </span><span class="number">0</span>:</span><br><span class="line">    saver.save(sess, <span class="module-access"><span class="module"><span class="identifier">FLAGS</span>.</span></span>checkpoint_dir, global_step=gstep)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然也可以取验证集上准确率最高的模型进行保存。 验证时我们可以重新 Reload 一下模型，然后进行验证：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># load model</span></span><br><span class="line">ckpt = tf.train.get_checkpoint_state(<span class="string">'ckpt'</span>)</span><br><span class="line"><span class="keyword">if</span> ckpt:</span><br><span class="line">    saver.restore(sess, ckpt.model_checkpoint_path)</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'Restore from'</span>, ckpt.model_checkpoint_path)</span><br><span class="line">    sess.<span class="builtin-name">run</span>(test_initializer)</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">step</span> <span class="keyword">in</span> range(int(test_steps)):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">step</span> % FLAGS.steps_per_print == 0:</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">'Test Accuracy'</span>, sess.<span class="builtin-name">run</span>(accuracy, feed_dict=&#123;keep_prob: 1&#125;), <span class="string">'Step'</span>, <span class="keyword">step</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'No Model Found'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>验证之后其准确率基本是差不多的。 如果要进行新的 Inference 的话，可以替换下 test_x 即可。</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>以上便是使用 TensorFlow 进行验证码识别的过程，代码见：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FJRGVlcExlYXJuaW5nL0NyYWNrQ2FwdGNoYQ==">https://github.com/AIDeepLearning/CrackCaptcha<i class="fa fa-external-link-alt"></i></span>。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-02-21 15:05:35" itemprop="dateCreated datePublished" datetime="2018-02-21T15:05:35+08:00">2018-02-21</time>
                </span>
                <span id="/5709.html" class="post-meta-item leancloud_visitors" data-flag-title="TensorFlow验证码识别" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>8.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5696.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5696.html" class="post-title-link" itemprop="url">利用python库twilio来免费发送短信</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="大家好，我是四毛，最近开通了个人公众号“用Python来编程”，欢迎大家“关注”，这样您就可以收到优质的文章了。"><a href="#大家好，我是四毛，最近开通了个人公众号“用Python来编程”，欢迎大家“关注”，这样您就可以收到优质的文章了。" class="headerlink" title="大家好，我是四毛，最近开通了个人公众号“用Python来编程”，欢迎大家“关注”，这样您就可以收到优质的文章了。"></a>大家好，我是四毛，最近开通了个人公众号<strong>“用Python来编程”</strong>，欢迎大家“<strong>关注”</strong>，这样您就可以收到优质的文章了。</h2>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""></p>
                  <pre><code>         今天跟大家分享的主题是利用python库twilio来免费发送短信。

         先放一张成品图
</code></pre>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/webwxgetmsgimg-10-180x320.png" alt=""></p>
                  <pre><code>    代码放在了本文最后的地址中，欢迎有需要的自取，有任何也可以在评论或者后台直接私聊我。
</code></pre>
                  <p><strong>正文</strong></p>
                  <pre><code>    眼尖的小伙伴已经发现了上面的短信的前缀显示这个短信来自于一个叫Twilio的免费的账户，今天我们用到的库就是twilio，既然是免费的账户，那么肯定是有一些限制的，这个会在后面提到。
</code></pre>
                  <p>另外要注意的是这个网站从国内访问的时候，可能会因为一些你懂得原因没法访问，那就只好学习一下怎么科学上网了。</p>
                  <p><strong>1.Twilio</strong></p>
                  <pre><code>    Twilio是一个做成开放插件的电话跟踪服务（call-tracking service）。美国当地时间2016年6月23日，云通讯公司Twilio在纽约证券交易所上市（来自于百度百科）
</code></pre>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/Selection_064-320x237.png" alt=""></p>
                  <p><strong>2. 安装</strong></p>
                  <pre><code>    官方文档地址：https://www.twilio.com/docs/libraries/python

    同时官方还提供对以下语言的支持
</code></pre>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/Selection_071.png" alt=""></p>
                  <pre><code>    可以看到，还是很丰富的。

    最简单的方式就是通过pip，执行如下命令：
</code></pre>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip <span class="keyword">install</span> twilio</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><strong>3.注册账号</strong></p>
                  <pre><code>    安装好库以后，就需要到官方的网页上进行注册了。

    进入官网：https://www.twilio.com
</code></pre>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/Selection_065.png" alt=""></p>
                  <pre><code>    然后进入注册页面
</code></pre>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/Selection_066.png" alt=""></p>
                  <pre><code>    接着通过了人机认证以后，就会对你的手机号码进行认证，这个就不发图片了。
</code></pre>
                  <p><strong>4.</strong> <strong>进入console</strong></p>
                  <pre><code>    注册好了以后，就可以进入我们自己的面板了
</code></pre>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/Selection_067.png" alt=""></p>
                  <pre><code>    图中箭头所指的两个参数是我们代码中需要的， 可以把两个都复制一下；

    既然是发短信，那么肯定是有一个接收者和一个发送者，发送者的号码可不是我们自己刚刚填的号码，而且twilio给我们分配的一个号码，因为我也是前段时间搞好了，所以不太记得这个号码是不是一开始进去就有的了，如果没有的话，那么就点击Get Stared。

    现在我们点击Manage Numbers
</code></pre>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/Selection_068.png" alt=""></p>
                  <pre><code>    这个时候就可以看到我们的号码了，这是重点，记下来
</code></pre>
                  <p><strong>5. 写代码</strong></p>
                  <pre><code>    根据文档的内容，我们编写了下面的代码：
</code></pre>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author  : ShiMeng</span></span><br><span class="line"><span class="comment"># @File    : send_sms.py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="keyword">from</span> twilio.rest import Client</span><br><span class="line"><span class="comment"># Your Account SID from twilio.com/console</span></span><br><span class="line">account_sid = <span class="string">"your account sid"</span></span><br><span class="line"><span class="comment"># Your Auth Token from twilio.com/console</span></span><br><span class="line">auth_token  = <span class="string">"your token"</span></span><br><span class="line">client = Client(account_sid, auth_token)</span><br><span class="line">message = client.messages.create(</span><br><span class="line"><span class="comment"># 这里中国的号码前面需要加86</span></span><br><span class="line"><span class="attribute">to</span>=<span class="string">"+接收者的号码"</span>,</span><br><span class="line"><span class="attribute">from_</span>=<span class="string">"+twilio给你的号码 "</span>,</span><br><span class="line"><span class="attribute">body</span>=<span class="string">"Hello from Python!"</span>)</span><br><span class="line"><span class="builtin-name">print</span>(message.sid)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <pre><code>    然后执行程序，你应该会碰到下面的错误
</code></pre>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/Selection_069.png" alt=""></p>
                  <pre><code>    可以从报错信息中明显的看到，提示我们说这个号码没有验证，我们可以到验证的网址上验证一下，也可以购买一个高级别的账号来给未验证的号码发送信息。

    而这个就是我一开始提到的免费账号的限制，在这个限制下面如果你想发送信息给一个接收者，这个接收者的号码必须通过验证，语音验证或者短信验证都可以。如果你是想大批量的发那种垃圾信息，那么你不用往下面看了。下面我们就来对号码进行验证。
</code></pre>
                  <p><strong>6. 验证号码</strong></p>
                  <pre><code>    验证网址：https://www.twilio.com/console/phone-numbers/verified
</code></pre>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/Selection_070.png" alt=""></p>
                  <p><strong>7.重新执行代码</strong></p>
                  <pre><code>    这个时候重新执行我们的代码，没有报错的话，接收者就应该收到你的消息了，就像我一开始放的成品图一样。
</code></pre>
                  <p>但是，在我们发送的信息前面，有一段前缀，我查了一下官方的文档，说这个免费的账户，这个前缀是去不掉的。。。。。。</p>
                  <p><strong>8.查看用量</strong></p>
                  <pre><code>    在面板中，点击Usage即可看到我们的用量， 如下图所示
</code></pre>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/Selection_073.png" alt=""></p>
                  <pre><code>    可以看到我们的用量以及花费，这个花费是不需要我们真正的付钱的，官方的解释是：
</code></pre>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/Selection_072.png" alt=""></p>
                  <p><strong>9.打电话</strong></p>
                  <pre><code>    打电话的代码也很简单
</code></pre>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># Download the Python helper library from twilio.com/docs/python/install</span></span><br><span class="line"><span class="keyword">from</span> twilio.rest import Client</span><br><span class="line"><span class="comment"># Your Account Sid and Auth Token from twilio.com/user/account</span></span><br><span class="line">account_sid = <span class="string">"AC8a9ba33072b6a05f2b81126e3e6609b7"</span></span><br><span class="line">auth_token = <span class="string">"f0150d603c1886d93b9d45ff15d84f24"</span></span><br><span class="line">client = Client(account_sid, auth_token)</span><br><span class="line">call = client.calls.create(</span><br><span class="line"><span class="attribute">to</span>=<span class="string">"+接收者号码"</span>,</span><br><span class="line"><span class="attribute">from_</span>=<span class="string">"+你的twilio号码"</span>,</span><br><span class="line"><span class="attribute">url</span>=<span class="string">"http://demo.twilio.com/docs/voice.xml"</span>,</span><br><span class="line"><span class="attribute">method</span>=<span class="string">"GET"</span>,</span><br><span class="line"><span class="attribute">status_callback</span>=<span class="string">"https://www.myapp.com/events"</span>,</span><br><span class="line"><span class="attribute">status_callback_method</span>=<span class="string">"POST"</span>,</span><br><span class="line">status_callback_event=[<span class="string">"initiated"</span>, <span class="string">"ringing"</span>, <span class="string">"answered"</span>, <span class="string">"completed"</span>]</span><br><span class="line">)</span><br><span class="line"><span class="builtin-name">print</span>(call.sid)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <pre><code>    执行程序后，电话也可以接通，但是里面的人会提示你升级账号。。。。。
</code></pre>
                  <p><strong>总结</strong></p>
                  <pre><code>    好了，到这里我们就可以免费的发送短信了。

    通过这个库，我们可以：

    （1）对线上或者线下后台跑的程序进行监控，并及时发送短信报警

    （2）结合树莓派玩一下，可以实现对超多场景的监测

    代码被放在了这里：https://github.com/xiaosimao/wx_code/tree/master/send_sms
</code></pre>
                  <p> <strong>有问题的可以在评论中指出，或者直接在后台发消息给我。</strong></p>
                  <p> <strong>欢迎大家关注我。</strong></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/四毛" class="author" itemprop="url" rel="index">四毛</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-02-12 16:25:53" itemprop="dateCreated datePublished" datetime="2018-02-12T16:25:53+08:00">2018-02-12</time>
                </span>
                <span id="/5696.html" class="post-meta-item leancloud_visitors" data-flag-title="利用python库twilio来免费发送短信" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5678.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5678.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 后续章节</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本书此部分内容属进阶内容，暂不开放。 如需查看更多可以购买书籍查看。 购买地址： <span class="exturl" data-url="aHR0cHM6Ly9pdGVtLmpkLmNvbS8yNjExNDY3NDg0Ny5odG1s">https://item.jd.com/26114674847.html<i class="fa fa-external-link-alt"></i></span> <span class="exturl" data-url="aHR0cHM6Ly9pdGVtLmpkLmNvbS8yNjEyNDQ3MzQ1NS5odG1s">https://item.jd.com/26124473455.html<i class="fa fa-external-link-alt"></i></span> 本书由图灵教育-人民邮电出版社出版发行。 作者：崔庆才 视频学习资源：</p>
                  <ul>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9lZHUuaGVsbG9iaS5jb20vY291cnNlLzE1Nw==">自己动手，丰衣足食！Python3网络爬虫实战案例<i class="fa fa-external-link-alt"></i></span></li>
                    <li><span class="exturl" data-url="aHR0cHM6Ly9lZHUuaGVsbG9iaS5jb20vY291cnNlLzE1Ng==">Python3爬虫三大案例实战分享<i class="fa fa-external-link-alt"></i></span></li>
                  </ul>
                  <p>全书预览图： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/01/Python-3%E7%BD%91%E6%A0%BC%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98-%E7%AB%8B%E4%BD%93%E5%9B%BE-857x1100.jpg" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-02-07 11:34:30" itemprop="dateCreated datePublished" datetime="2018-02-07T11:34:30+08:00">2018-02-07</time>
                </span>
                <span id="/5678.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 后续章节" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>191</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5657.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5657.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 7.4-使用Selenium爬取淘宝商品</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在前一章中，我们已经成功尝试分析Ajax来抓取相关数据，但是并不是所有页面都可以通过分析Ajax来完成抓取。比如，淘宝，它的整个页面数据确实也是通过Ajax获取的，但是这些Ajax接口参数比较复杂，可能会包含加密密钥等，所以如果想自己构造Ajax参数，还是比较困难的。对于这种页面，最方便快捷的抓取方法就是通过Selenium。本节中，我们就用Selenium来模拟浏览器操作，抓取淘宝的商品信息，并将结果保存到MongoDB。</p>
                  <h2 id="1-本节目标"><a href="#1-本节目标" class="headerlink" title="1. 本节目标"></a>1. 本节目标</h2>
                  <p>本节中，我们要利用Selenium抓取淘宝商品并用pyquery解析得到商品的图片、名称、价格、购买人数、店铺名称和店铺所在地信息，并将其保存到MongoDB。</p>
                  <h2 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2. 准备工作"></a>2. 准备工作</h2>
                  <p>本节中，我们首先以Chrome为例来讲解Selenium的用法。在开始之前，请确保已经正确安装好Chrome浏览器并配置好了ChromeDriver；另外，还需要正确安装Python的Selenium库；最后，还对接了PhantomJS和Firefox，请确保安装好PhantomJS和Firefox并配置好了GeckoDriver。如果环境没有配置好，可参考第1章。</p>
                  <h2 id="3-接口分析"><a href="#3-接口分析" class="headerlink" title="3. 接口分析"></a>3. 接口分析</h2>
                  <p>首先，我们来看下淘宝的接口，看看它比一般Ajax多了怎样的内容。</p>
                  <p>打开淘宝页面，搜索商品，比如iPad，此时打开开发者工具，截获Ajax请求，我们可以发现获取商品列表的接口，如图7-19所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-19.png" alt="">图7-19 列表接口</p>
                  <p>它的链接包含了几个GET参数，如果要想构造Ajax链接，直接请求再好不过了，它的返回内容是JSON格式，如图7-20所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-20.jpg" alt="">图7-20 JSON数据</p>
                  <p>但是这个Ajax接口包含几个参数，其中<code>_ksTS</code>、<code>rn</code>参数不能直接发现其规律，如果要去探寻它的生成规律，也不是做不到，但这样相对会比较烦琐，所以如果直接用Selenium来模拟浏览器的话，就不需要再关注这些接口参数了，只要在浏览器里面可以看到的，都可以爬取。这也是我们选用Selenium爬取淘宝的原因。</p>
                  <h2 id="4-页面分析"><a href="#4-页面分析" class="headerlink" title="4. 页面分析"></a>4. 页面分析</h2>
                  <p>本节的目标是爬取商品信息。图7-21是一个商品条目，其中包含商品的基本信息，包括商品图片、名称、价格、购买人数、店铺名称和店铺所在地，我们要做的就是将这些信息都抓取下来。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-21.jpg" alt="">图7-21 商品条目</p>
                  <p>抓取入口就是淘宝的搜索页面，这个链接可以通过直接构造参数访问。例如，如果搜索iPad，就可以直接访问<span class="exturl" data-url="aHR0cHM6Ly9zLnRhb2Jhby5jb20vc2VhcmNoP3E9aVBhZA==">https://s.taobao.com/search?q=iPad<i class="fa fa-external-link-alt"></i></span>，呈现的就是第一页的搜索结果，如图7-22所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-22.png" alt="">图7-22 搜索结果</p>
                  <p>在页面下方，有一个分页导航，其中既包括前5页的链接，也包括下一页的链接，同时还有一个输入任意页码跳转的链接，如图7-23所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-23-1.jpg" alt="">图7-23 分页导航</p>
                  <p>这里商品的搜索结果一般最大都为100页，要获取每一页的内容，只需要将页码从1到100顺序遍历即可，页码数是确定的。所以，直接在页面跳转文本框中输入要跳转的页码，然后点击“确定”按钮即可跳转到页码对应的页面。</p>
                  <p>这里不直接点击“下一页”的原因是：一旦爬取过程中出现异常退出，比如到50页退出了，此时点击“下一页”时，就无法快速切换到对应的后续页面了。此外，在爬取过程中，也需要记录当前的页码数，而且一旦点击“下一页”之后页面加载失败，还需要做异常检测，检测当前页面是加载到了第几页。整个流程相对比较复杂，所以这里我们直接用跳转的方式来爬取页面。</p>
                  <p>当我们成功加载出某一页商品列表时，利用Selenium即可获取页面源代码，然后再用相应的解析库解析即可。这里我们选用pyquery进行解析。下面我们用代码来实现整个抓取过程。</p>
                  <h2 id="5-获取商品列表"><a href="#5-获取商品列表" class="headerlink" title="5. 获取商品列表"></a>5. 获取商品列表</h2>
                  <p>首先，需要构造一个抓取的URL：<span class="exturl" data-url="aHR0cHM6Ly9zLnRhb2Jhby5jb20vc2VhcmNoP3E9aVBhZA==">https://s.taobao.com/search?q=iPad<i class="fa fa-external-link-alt"></i></span>。这个URL非常简洁，参数<code>q</code>就是要搜索的关键字。只要改变这个参数，即可获取不同商品的列表。这里我们将商品的关键字定义成一个变量，然后构造出这样的一个URL。</p>
                  <p>然后，就需要用Selenium进行抓取了。我们实现如下抓取列表页的方法：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">wait = WebDriverWait(browser, <span class="number">10</span>)</span><br><span class="line">KEYWORD = <span class="string">'iPad'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_page</span><span class="params">(page)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    抓取索引页</span></span><br><span class="line"><span class="string">    :param page: 页码</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    print(<span class="string">'正在爬取第'</span>, page, <span class="string">'页'</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = <span class="string">'https://s.taobao.com/search?q='</span> + quote(KEYWORD)</span><br><span class="line">        browser.get(url)</span><br><span class="line">        <span class="keyword">if</span> page &gt; <span class="number">1</span>:</span><br><span class="line">            input = wait.until(</span><br><span class="line">                EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'#mainsrp-pager div.form &gt; input'</span>)))</span><br><span class="line">            submit = wait.until(</span><br><span class="line">                EC.element_to_be_clickable((By.CSS_SELECTOR, <span class="string">'#mainsrp-pager div.form &gt; span.btn.J_Submit'</span>)))</span><br><span class="line">            input.clear()</span><br><span class="line">            input.send_keys(page)</span><br><span class="line">            submit.click()</span><br><span class="line">        wait.until(</span><br><span class="line">            EC.text_to_be_present_in_element((By.CSS_SELECTOR, <span class="string">'#mainsrp-pager li.item.active &gt; span'</span>), str(page)))</span><br><span class="line">        wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'.m-itemlist .items .item'</span>)))</span><br><span class="line">        get_products()</span><br><span class="line">    <span class="keyword">except</span> TimeoutException:</span><br><span class="line">        index_page(page)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先构造了一个<code>WebDriver</code>对象，使用的浏览器是Chrome，然后指定一个关键词，如iPad，接着定义了<code>index_page()</code>方法，用于抓取商品列表页。</p>
                  <p>在该方法里，我们首先访问了搜索商品的链接，然后判断了当前的页码，如果大于1，就进行跳页操作，否则等待页面加载完成。</p>
                  <p>等待加载时，我们使用了<code>WebDriverWait</code>对象，它可以指定等待条件，同时指定一个最长等待时间，这里指定为最长10秒。如果在这个时间内成功匹配了等待条件，也就是说页面元素成功加载出来了，就立即返回相应结果并继续向下执行，否则到了最大等待时间还没有加载出来时，就直接抛出超时异常。</p>
                  <p>比如，我们最终要等待商品信息加载出来，就指定了<code>presence_of_element_located</code>这个条件，然后传入了<code>.m-itemlist .items .item</code>这个选择器，而这个选择器对应的页面内容就是每个商品的信息块，可以到网页里面查看一下。如果加载成功，就会执行后续的<code>get_products()</code>方法，提取商品信息。</p>
                  <p>关于翻页操作，这里首先获取页码输入框，赋值为<code>input</code>，然后获取“确定”按钮，赋值为<code>submit</code>，分别是图7-24中的两个元素。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-24-1.jpg" alt="">图7-24 跳转选项</p>
                  <p>首先，我们清空了输入框，此时调用<code>clear()</code>方法即可。随后，调用<code>send_keys()</code>方法将页码填充到输入框中，然后点击“确定”按钮即可。</p>
                  <p>那么，怎样知道有没有跳转到对应的页码呢？我们可以注意到，成功跳转某一页后，页码都会高亮显示，如图7-25所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-25-1.jpg" alt="">图7-25 页码高亮显示</p>
                  <p>我们只需要判断当前高亮的页码数是当前的页码数即可，所以这里使用了另一个等待条件<code>text_to_be_present_in_element</code>，它会等待指定的文本出现在某一个节点里面时即返回成功。这里我们将高亮的页码节点对应的CSS选择器和当前要跳转的页码通过参数传递给这个等待条件，这样它就会检测当前高亮的页码节点是不是我们传过来的页码数，如果是，就证明页面成功跳转到了这一页，页面跳转成功。</p>
                  <p>这样刚才实现的<code>index_page()</code>方法就可以传入对应的页码，待加载出对应页码的商品列表后，再去调用<code>get_products()</code>方法进行页面解析。</p>
                  <h2 id="6-解析商品列表"><a href="#6-解析商品列表" class="headerlink" title="6. 解析商品列表"></a>6. 解析商品列表</h2>
                  <p>接下来，我们就可以实现<code>get_products()</code>方法来解析商品列表了。这里我们直接获取页面源代码，然后用pyquery进行解析，实现如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pyquery import PyQuery as pq</span><br><span class="line">def get_products():</span><br><span class="line">    <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">    提取商品数据</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    html = browser.page_source</span><br><span class="line">    doc = pq(html)</span><br><span class="line">    items = doc(<span class="string">'#mainsrp-itemlist .items .item'</span>).items()</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        product = &#123;</span><br><span class="line">            <span class="string">'image'</span>: item.<span class="builtin-name">find</span>(<span class="string">'.pic .img'</span>).attr(<span class="string">'data-src'</span>),</span><br><span class="line">            <span class="string">'price'</span>: item.<span class="builtin-name">find</span>(<span class="string">'.price'</span>).text(),</span><br><span class="line">            <span class="string">'deal'</span>: item.<span class="builtin-name">find</span>(<span class="string">'.deal-cnt'</span>).text(),</span><br><span class="line">            <span class="string">'title'</span>: item.<span class="builtin-name">find</span>(<span class="string">'.title'</span>).text(),</span><br><span class="line">            <span class="string">'shop'</span>: item.<span class="builtin-name">find</span>(<span class="string">'.shop'</span>).text(),</span><br><span class="line">            <span class="string">'location'</span>: item.<span class="builtin-name">find</span>(<span class="string">'.location'</span>).text()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="builtin-name">print</span>(product)</span><br><span class="line">        save_to_mongo(product)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先，调用<code>page_source</code>属性获取页码的源代码，然后构造了PyQuery解析对象，接着提取了商品列表，此时使用的CSS选择器是<code>#mainsrp-itemlist .items .item</code>，它会匹配整个页面的每个商品。它的匹配结果是多个，所以这里我们又对它进行了一次遍历，用<code>for</code>循环将每个结果分别进行解析，每次循环把它赋值为<code>item</code>变量，每个<code>item</code>变量都是一个<code>PyQuery</code>对象，然后再调用它的<code>find()</code>方法，传入CSS选择器，就可以获取单个商品的特定内容了。</p>
                  <p>比如，查看一下商品信息的源码，如图7-26所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-26-1.jpg" alt="">图7-26 商品信息源码</p>
                  <p>可以发现，它是一个<code>img</code>节点，包含<code>id</code>、<code>class</code>、<code>data-src</code>、<code>alt</code>和<code>src</code>等属性。这里之所以可以看到这张图片，是因为它的<code>src</code>属性被赋值为图片的URL。把它的<code>src</code>属性提取出来，就可以获取商品的图片了。不过我们还注意<code>data-src</code>属性，它的内容也是图片的URL，观察后发现此URL是图片的完整大图，而<code>src</code>是压缩后的小图，所以这里抓取<code>data-src</code>属性来作为商品的图片。</p>
                  <p>因此，我们需要先利用<code>find()</code>方法找到图片的这个节点，然后再调用<code>attr()</code>方法获取商品的<code>data-src</code>属性，这样就成功提取了商品图片链接。然后用同样的方法提取商品的价格、成交量、名称、店铺和店铺所在地等信息，接着将所有提取结果赋值为一个字典<code>product</code>，随后调用<code>save_to_mongo()</code>将其保存到MongoDB即可。</p>
                  <h2 id="7-保存到MongoDB"><a href="#7-保存到MongoDB" class="headerlink" title="7. 保存到MongoDB"></a>7. 保存到MongoDB</h2>
                  <p>接下来，我们将商品信息保存到MongoDB，实现代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">MONGO_URL = <span class="string">'localhost'</span></span><br><span class="line">MONGO_DB = <span class="string">'taobao'</span></span><br><span class="line">MONGO_COLLECTION = <span class="string">'products'</span></span><br><span class="line">client = pymongo.MongoClient(MONGO_URL)</span><br><span class="line">db = client[MONGO_DB]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_to_mongo</span><span class="params">(result)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    保存至MongoDB</span></span><br><span class="line"><span class="string">    :param result: 结果</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> db[MONGO_COLLECTION].insert(result):</span><br><span class="line">            print(<span class="string">'存储到MongoDB成功'</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        print(<span class="string">'存储到MongoDB失败'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先创建了一个MongoDB的连接对象，然后指定了数据库，随后指定了Collection的名称，接着直接调用<code>insert()</code>方法将数据插入到MongoDB。此处的<code>result</code>变量就是在<code>get_products()</code>方法里传来的<code>product</code>，包含单个商品的信息。</p>
                  <h2 id="8-遍历每页"><a href="#8-遍历每页" class="headerlink" title="8. 遍历每页"></a>8. 遍历每页</h2>
                  <p>刚才我们所定义的<code>get_index()</code>方法需要接收参数<code>page</code>，<code>page</code>代表页码。这里我们实现页码遍历即可，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">MAX_PAGE = <span class="number">100</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    遍历每一页</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, MAX_PAGE + <span class="number">1</span>):</span><br><span class="line">        index_page(i)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其实现非常简单，只需要调用一个<code>for</code>循环即可。这里定义最大的页码数为100，<code>range()</code>方法的返回结果就是1到100的列表，顺序遍历，调用<code>index_page()</code>方法即可。</p>
                  <p>这样我们的淘宝商品爬虫就完成了，最后调用<code>main()</code>方法即可运行。</p>
                  <h2 id="9-运行"><a href="#9-运行" class="headerlink" title="9. 运行"></a>9. 运行</h2>
                  <p>运行代码，可以发现首先会弹出一个Chrome浏览器，然后会访问淘宝页面，接着控制台便会输出相应的提取结果，如图7-27所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-27-1.jpg" alt="">图7-27 运行结果</p>
                  <p>可以发现，这些商品信息的结果都是字典形式，它们被存储到MongoDB里面。</p>
                  <p>再看一下MongoDB中的结果，如图7-28所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-28-1.jpg" alt="">图7-28 保存结果</p>
                  <p>可以看到，所有的信息都保存到MongoDB里了，这说明爬取成功。</p>
                  <h2 id="10-Chrome-Headless模式"><a href="#10-Chrome-Headless模式" class="headerlink" title="10. Chrome Headless模式"></a>10. Chrome Headless模式</h2>
                  <p>从Chrome 59版本开始，已经开始支持Headless模式，也就是无界面模式，这样爬取的时候就不会弹出浏览器了。如果要使用此模式，请把Chrome升级到59版本及以上。启用Headless模式的方式如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">chrome_options = webdriver.<span class="constructor">ChromeOptions()</span></span><br><span class="line">chrome_options.add<span class="constructor">_argument('--<span class="params">headless</span>')</span></span><br><span class="line">browser = webdriver.<span class="constructor">Chrome(<span class="params">chrome_options</span>=<span class="params">chrome_options</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先，创建<code>ChromeOptions</code>对象，接着添加<code>headless</code>参数，然后在初始化Chrome对象的时候通过<code>chrome_options</code>传递这个<code>ChromeOptions</code>对象，这样我们就可以成功启用Chrome的Headless模式了。</p>
                  <h2 id="11-对接Firefox"><a href="#11-对接Firefox" class="headerlink" title="11. 对接Firefox"></a>11. 对接Firefox</h2>
                  <p>要对接Firefox浏览器，非常简单，只需要更改一处即可：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">browser</span> = webdriver.Firefox()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里更改了<code>browser</code>对象的创建方式，这样爬取的时候就会使用Firefox浏览器了。</p>
                  <h2 id="12-对接PhantomJS"><a href="#12-对接PhantomJS" class="headerlink" title="12. 对接PhantomJS"></a>12. 对接PhantomJS</h2>
                  <p>如果不想使用Chrome的Headless模式，还可以使用PhantomJS（它是一个无界面浏览器）来抓取。抓取时，同样不会弹出窗口，还是只需要将<code>WebDriver</code>的声明修改一下即可：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">browser</span> = webdriver.PhantomJS()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外，它还支持命令行配置。比如，可以设置缓存和禁用图片加载的功能，进一步提高爬取效率：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">SERVICE_ARGS</span> = [<span class="string">'--load-images=false'</span>, <span class="string">'--disk-cache=true'</span>]</span><br><span class="line"><span class="attr">browser</span> = webdriver.PhantomJS(service_args=SERVICE_ARGS)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后，给出本节的代码地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1B5dGhvbjNXZWJTcGlkZXIvVGFvYmFvUHJvZHVjdA==">https://github.com/Python3WebSpider/TaobaoProduct<i class="fa fa-external-link-alt"></i></span>。</p>
                  <p>本节中，我们用Selenium演示了淘宝页面的抓取。利用它，我们不用去分析Ajax请求，真正做到可见即可爬。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-31 22:10:36" itemprop="dateCreated datePublished" datetime="2018-01-31T22:10:36+08:00">2018-01-31</time>
                </span>
                <span id="/5657.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 7.4-使用Selenium爬取淘宝商品" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5654.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5654.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 7.3-Splash负载均衡配置</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>用Splash做页面抓取时，如果爬取的量非常大，任务非常多，用一个Splash服务来处理的话，未免压力太大了，此时可以考虑搭建一个负载均衡器来把压力分散到各个服务器上。这相当于多台机器多个服务共同参与任务的处理，可以减小单个Splash服务的压力。</p>
                  <h2 id="1-配置Splash服务"><a href="#1-配置Splash服务" class="headerlink" title="1. 配置Splash服务"></a>1. 配置Splash服务</h2>
                  <p>要搭建Splash负载均衡，首先要有多个Splash服务。假如这里在4台远程主机的8050端口上都开启了Splash服务，它们的服务地址分别为41.159.27.223:8050、41.159.27.221:8050、41.159.27.9:8050和41.159.117.119:8050，这4个服务完全一致，都是通过Docker的Splash镜像开启的。访问其中任何一个服务时，都可以使用Splash服务。</p>
                  <h2 id="2-配置负载均衡"><a href="#2-配置负载均衡" class="headerlink" title="2. 配置负载均衡"></a>2. 配置负载均衡</h2>
                  <p>接下来，可以选用任意一台带有公网IP的主机来配置负载均衡。首先，在这台主机上装好Nginx，然后修改Nginx的配置文件nginx.conf，添加如下内容：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">http &#123;</span><br><span class="line">    upstream splash &#123;</span><br><span class="line">        least_conn;</span><br><span class="line">        server <span class="number">41.159</span><span class="number">.27</span><span class="number">.223</span>:<span class="number">8050</span>;</span><br><span class="line">        server <span class="number">41.159</span><span class="number">.27</span><span class="number">.221</span>:<span class="number">8050</span>;</span><br><span class="line">        server <span class="number">41.159</span><span class="number">.27</span><span class="number">.9</span>:<span class="number">8050</span>;</span><br><span class="line">        server <span class="number">41.159</span><span class="number">.117</span><span class="number">.119</span>:<span class="number">8050</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen <span class="number">8050</span>;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http:<span class="comment">//splash;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们通过<code>upstream</code>字段定义了一个名字叫作<code>splash</code>的服务集群配置。其中<code>least_conn</code>代表最少链接负载均衡，它适合处理请求处理时间长短不一造成服务器过载的情况。</p>
                  <p>当然，我们也可以不指定配置，具体如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">upstream splash &#123;</span><br><span class="line">   <span class="built_in"> server </span>41.159.27.223:8050;</span><br><span class="line">   <span class="built_in"> server </span>41.159.27.221:8050;</span><br><span class="line">   <span class="built_in"> server </span>41.159.27.9:8050;</span><br><span class="line">   <span class="built_in"> server </span>41.159.117.119:8050;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样默认以轮询策略实现负载均衡，每个服务器的压力相同。此策略适合服务器配置相当、无状态且短平快的服务使用。</p>
                  <p>另外，我们还可以指定权重，配置如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">upstream splash &#123;</span><br><span class="line">   <span class="built_in"> server </span>41.159.27.223:8050 <span class="attribute">weight</span>=4;</span><br><span class="line">   <span class="built_in"> server </span>41.159.27.221:8050 <span class="attribute">weight</span>=2;</span><br><span class="line">   <span class="built_in"> server </span>41.159.27.9:8050 <span class="attribute">weight</span>=2;</span><br><span class="line">   <span class="built_in"> server </span>41.159.117.119:8050 <span class="attribute">weight</span>=1;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里<code>weight</code>参数指定各个服务的权重，权重越高，分配到处理的请求越多。假如不同的服务器配置差别比较大的话，可以使用此种配置。</p>
                  <p>最后，还有一种IP散列负载均衡，配置如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">upstream splash &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">   <span class="built_in"> server </span>41.159.27.223:8050;</span><br><span class="line">   <span class="built_in"> server </span>41.159.27.221:8050;</span><br><span class="line">   <span class="built_in"> server </span>41.159.27.9:8050;</span><br><span class="line">   <span class="built_in"> server </span>41.159.117.119:8050;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>服务器根据请求客户端的IP地址进行散列计算，确保使用同一个服务器响应请求，这种策略适合有状态的服务，比如用户登录后访问某个页面的情形。对于Splash来说，不需要应用此设置。</p>
                  <p>我们可以根据不同的情形选用不同的配置，配置完成后重启一下Nginx服务：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo nginx -s reload</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样直接访问Nginx所在服务器的8050端口，即可实现负载均衡了。</p>
                  <h2 id="3-配置认证"><a href="#3-配置认证" class="headerlink" title="3. 配置认证"></a>3. 配置认证</h2>
                  <p>现在Splash是可以公开访问的，如果不想让其公开访问，还可以配置认证，这仍然借助于Nginx。可以在<code>server</code>的<code>location</code>字段中添加<code>auth_basic</code>和<code>auth_basic_user_file</code>字段，具体配置如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">http &#123;</span><br><span class="line">    upstream splash &#123;</span><br><span class="line">        least_conn;</span><br><span class="line">        server <span class="number">41.159</span><span class="number">.27</span><span class="number">.223</span>:<span class="number">8050</span>;</span><br><span class="line">        server <span class="number">41.159</span><span class="number">.27</span><span class="number">.221</span>:<span class="number">8050</span>;</span><br><span class="line">        server <span class="number">41.159</span><span class="number">.27</span><span class="number">.9</span>:<span class="number">8050</span>;</span><br><span class="line">        server <span class="number">41.159</span><span class="number">.117</span><span class="number">.119</span>:<span class="number">8050</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen <span class="number">8050</span>;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http:<span class="comment">//splash;</span></span><br><span class="line">            auth_basic <span class="string">"Restricted"</span>;</span><br><span class="line">            auth_basic_user_file /etc/nginx/conf.d/.htpasswd;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里使用的用户名和密码配置放置在/etc/nginx/conf.d目录下，我们需要使用<code>htpasswd</code>命令创建。例如，创建一个用户名为<code>admin</code>的文件，相关命令如下：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">htpasswd</span> <span class="selector-tag">-c</span> <span class="selector-class">.htpasswd</span> <span class="selector-tag">admin</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来就会提示我们输入密码，输入两次之后，就会生成密码文件，其内容如下：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">cat</span> <span class="selector-class">.htpasswd</span> </span><br><span class="line"><span class="selector-tag">admin</span><span class="selector-pseudo">:5ZBxQr0rCqwbc</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>配置完成后，重启一下Nginx服务：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo nginx -s reload</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样访问认证就成功配置好了。</p>
                  <h2 id="4-测试"><a href="#4-测试" class="headerlink" title="4. 测试"></a>4. 测试</h2>
                  <p>最后，我们可以用代码来测试一下负载均衡的配置，看看到底是不是每次请求会切换IP。利用<span class="exturl" data-url="aHR0cDovL2h0dHBiaW4ub3JnL2dldA==">http://httpbin.org/get<i class="fa fa-external-link-alt"></i></span>测试即可，实现代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse import quote</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">lua = <span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string">function main(splash, args)</span></span><br><span class="line"><span class="string">  local treat = require("treat")</span></span><br><span class="line"><span class="string">  local response = splash:http_get("http://httpbin.org/get")</span></span><br><span class="line"><span class="string">  return treat.as_string(response.body)</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string">'</span><span class="string">''</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://splash:8050/execute?lua_source='</span> + quote(lua)</span><br><span class="line">response = requests.<span class="builtin-name">get</span>(url, auth=(<span class="string">'admin'</span>, <span class="string">'admin'</span>))</span><br><span class="line">ip = re.search(<span class="string">'(\d+\.\d+\.\d+\.\d+)'</span>, response.text).group(1)</span><br><span class="line"><span class="builtin-name">print</span>(ip)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里URL中的splash字符串请自行替换成自己的Nginx服务器IP。这里我修改了Hosts，设置了splash为Nginx服务器IP。</p>
                  <p>多次运行代码之后，可以发现每次请求的IP都会变化，比如第一次的结果：</p>
                  <figure class="highlight accesslog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">41.159.27.223</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>第二次的结果：</p>
                  <figure class="highlight accesslog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">41.159.27.9</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这就说明负载均衡已经成功实现了。</p>
                  <p>本节中，我们成功实现了负载均衡的配置。配置负载均衡后，可以多个Splash服务共同合作，减轻单个服务的负载，这还是比较有用的。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-31 22:07:31" itemprop="dateCreated datePublished" datetime="2018-01-31T22:07:31+08:00">2018-01-31</time>
                </span>
                <span id="/5654.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 7.3-Splash负载均衡配置" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5638.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5638.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 7.2-Splash的使用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>Splash是一个JavaScript渲染服务，是一个带有HTTP API的轻量级浏览器，同时它对接了Python中的Twisted和QT库。利用它，我们同样可以实现动态渲染页面的抓取。</p>
                  <h2 id="1-功能介绍"><a href="#1-功能介绍" class="headerlink" title="1. 功能介绍"></a>1. 功能介绍</h2>
                  <p>利用Splash，我们可以实现如下功能：</p>
                  <ul>
                    <li>异步方式处理多个网页渲染过程；</li>
                    <li>获取渲染后的页面的源代码或截图；</li>
                    <li>通过关闭图片渲染或者使用Adblock规则来加快页面渲染速度；</li>
                    <li>可执行特定的JavaScript脚本；</li>
                    <li>可通过Lua脚本来控制页面渲染过程；</li>
                    <li>获取渲染的详细过程并通过HAR（HTTP Archive）格式呈现。</li>
                  </ul>
                  <p>接下来，我们来了解一下它的具体用法。</p>
                  <h2 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2. 准备工作"></a>2. 准备工作</h2>
                  <p>在开始之前，请确保已经正确安装好了Splash并可以正常运行服务。如果没有安装，可以参考第1章。</p>
                  <h2 id="3-实例引入"><a href="#3-实例引入" class="headerlink" title="3. 实例引入"></a>3. 实例引入</h2>
                  <p>首先，通过Splash提供的Web页面来测试其渲染过程。例如，我们在本机8050端口上运行了Splash服务，打开<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo4MDUwLw==">http://localhost:8050/<i class="fa fa-external-link-alt"></i></span>即可看到其Web页面，如图7-6所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-6.png" alt="">图7-6 Web页面</p>
                  <p>在图7-6右侧，呈现的是一个渲染示例。可以看到，上方有一个输入框，默认是<span class="exturl" data-url="aHR0cDovL2dvb2dsZS5jb20v">http://google.com<i class="fa fa-external-link-alt"></i></span>，这里换成百度测试一下，将内容更改为<span class="exturl" data-url="aHR0cHM6Ly93d3cuYmFpZHUuY29tLw==">https://www.baidu.com<i class="fa fa-external-link-alt"></i></span>，然后点击Render me按钮开始渲染，结果如图7-7所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-7.png" alt="">图7-7 运行结果</p>
                  <p>可以看到，网页的返回结果呈现了渲染截图、HAR加载统计数据、网页的源代码。</p>
                  <p>通过HAR的结果可以看到，Splash执行了整个网页的渲染过程，包括CSS、JavaScript的加载等过程，呈现的页面和我们在浏览器中得到的结果完全一致。</p>
                  <p>那么，这个过程由什么来控制呢？重新返回首页，可以看到实际上是有一段脚本，内容如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">function main(splash, args)</span><br><span class="line">  <span class="keyword">assert</span>(<span class="string">splash:</span>go(args.url))</span><br><span class="line">  <span class="keyword">assert</span>(<span class="string">splash:</span>wait(<span class="number">0.5</span>))</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    html = <span class="string">splash:</span>html(),</span><br><span class="line">    png = <span class="string">splash:</span>png(),</span><br><span class="line">    har = <span class="string">splash:</span>har(),</span><br><span class="line">  &#125;</span><br><span class="line">end</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个脚本实际上是用Lua语言写的脚本。即使不懂这个语言的语法，但从脚本的表面意思，我们也可以大致了解到它首先调用<code>go()</code>方法去加载页面，然后调用<code>wait()</code>方法等待了一定时间，最后返回了页面的源码、截图和HAR信息。</p>
                  <p>到这里，我们大体了解了Splash是通过Lua脚本来控制了页面的加载过程的，加载过程完全模拟浏览器，最后可返回各种格式的结果，如网页源码和截图等。</p>
                  <p>接下来，我们就来了解Lua脚本的写法以及相关API的用法。</p>
                  <h2 id="4-Splash-Lua脚本"><a href="#4-Splash-Lua脚本" class="headerlink" title="4. Splash Lua脚本"></a>4. Splash Lua脚本</h2>
                  <p>Splash可以通过Lua脚本执行一系列渲染操作，这样我们就可以用Splash来模拟类似Chrome、PhantomJS的操作了。</p>
                  <p>首先，我们来了解一下Splash Lua脚本的入口和执行方式。</p>
                  <h3 id="入口及返回值"><a href="#入口及返回值" class="headerlink" title="入口及返回值"></a>入口及返回值</h3>
                  <p>首先，来看一个基本实例：</p>
                  <figure class="highlight maxima">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">function main(splash, <span class="built_in">args</span>)</span><br><span class="line">  splash:<span class="built_in">go</span>(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">  splash:wait(<span class="number">0.5</span>)</span><br><span class="line">  <span class="built_in">local</span> <span class="built_in">title</span> = splash:evaljs(<span class="string">"document.title"</span>)</span><br><span class="line">  <span class="built_in">return</span> &#123;<span class="built_in">title</span>=<span class="built_in">title</span>&#125;</span><br><span class="line">end</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们将代码粘贴到刚才打开的<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo4MDUwLw==">http://localhost:8050/<i class="fa fa-external-link-alt"></i></span>的代码编辑区域，然后点击Render me!按钮来测试一下。</p>
                  <p>我们看到它返回了网页的标题，如图7-8所示。这里我们通过<code>evaljs()</code>方法传入JavaScript脚本，而<code>document.title</code>的执行结果就是返回网页标题，执行完毕后将其赋值给一个<code>title</code>变量，随后将其返回。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-8.png" alt="">图7-8 运行结果</p>
                  <p>注意，我们在这里定义的方法名称叫作<code>main()</code>。这个名称必须是固定的，Splash会默认调用这个方法。</p>
                  <p>该方法的返回值既可以是字典形式，也可以是字符串形式，最后都会转化为Splash HTTP Response，例如：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">function</span> <span class="title">main</span>(splash)</span><br><span class="line">    <span class="keyword">return</span> <span class="type">&#123;hello="world!"&#125;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>返回了一个字典形式的内容。例如：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">function</span> <span class="title">main</span>(splash)</span><br><span class="line">    <span class="keyword">return</span> <span class="type">'hello'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>返回了一个字符串形式的内容。</p>
                  <h3 id="异步处理"><a href="#异步处理" class="headerlink" title="异步处理"></a>异步处理</h3>
                  <p>Splash支持异步处理，但是这里并没有显式指明回调方法，其回调的跳转是在Splash内部完成的。示例如下：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash, args)</span></span></span><br><span class="line">  <span class="keyword">local</span> example_urls = &#123;<span class="string">"www.baidu.com"</span>, <span class="string">"www.taobao.com"</span>, <span class="string">"www.zhihu.com"</span>&#125;</span><br><span class="line">  <span class="keyword">local</span> urls = args.urls <span class="keyword">or</span> example_urls</span><br><span class="line">  <span class="keyword">local</span> results = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> index, url <span class="keyword">in</span> <span class="built_in">ipairs</span>(urls) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">local</span> ok, reason = splash:go(<span class="string">"http://"</span> .. url)</span><br><span class="line">    <span class="keyword">if</span> ok <span class="keyword">then</span></span><br><span class="line">      splash:wait(<span class="number">2</span>)</span><br><span class="line">      results[url] = splash:png()</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">return</span> results</span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果是3个站点的截图，如图7-9所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-9.png" alt="">图7-9 运行结果</p>
                  <p>在脚本内调用的<code>wait()</code>方法类似于Python中的<code>sleep()</code>，其参数为等待的秒数。当Splash执行到此方法时，它会转而去处理其他任务，然后在指定的时间过后再回来继续处理。</p>
                  <p>这里值得注意的是，Lua脚本中的字符串拼接和Python不同，它使用的是<code>..</code>操作符，而不是<code>+</code>。如果有必要，可以简单了解一下Lua脚本的语法，详见<span class="exturl" data-url="aHR0cDovL3d3dy5ydW5vb2IuY29tL2x1YS9sdWEtYmFzaWMtc3ludGF4Lmh0bWw=">http://www.runoob.com/lua/lua-basic-syntax.html<i class="fa fa-external-link-alt"></i></span>。</p>
                  <p>另外，这里做了加载时的异常检测。<code>go()</code>方法会返回加载页面的结果状态，如果页面出现4xx或5xx状态码，<code>ok</code>变量就为空，就不会返回加载后的图片。</p>
                  <h2 id="5-Splash对象属性"><a href="#5-Splash对象属性" class="headerlink" title="5. Splash对象属性"></a>5. Splash对象属性</h2>
                  <p>我们注意到，前面例子中<code>main()</code>方法的第一个参数是<code>splash</code>，这个对象非常重要，它类似于Selenium中的<code>WebDriver</code>对象，我们可以调用它的一些属性和方法来控制加载过程。接下来，先看下它的属性。</p>
                  <h3 id="args"><a href="#args" class="headerlink" title="args"></a><code>args</code></h3>
                  <p>该属性可以获取加载时配置的参数，比如URL，如果为GET请求，它还可以获取GET请求参数；如果为POST请求，它可以获取表单提交的数据。Splash也支持使用第二个参数直接作为<code>args</code>，例如：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash, args)</span></span></span><br><span class="line">    <span class="keyword">local</span> url = args.url</span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里第二个参数<code>args</code>就相当于<code>splash.args</code>属性，以上代码等价于：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash)</span></span></span><br><span class="line">    <span class="keyword">local</span> url = splash.args.url</span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="js-enabled"><a href="#js-enabled" class="headerlink" title="js_enabled"></a><code>js_enabled</code></h3>
                  <p>这个属性是Splash的JavaScript执行开关，可以将其配置为<code>true</code>或<code>false</code>来控制是否执行JavaScript代码，默认为<code>true</code>。例如，这里禁止执行JavaScript代码：</p>
                  <figure class="highlight maxima">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">function main(splash, <span class="built_in">args</span>)</span><br><span class="line">  splash:<span class="built_in">go</span>(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line">  splash.js_enabled = <span class="literal">false</span></span><br><span class="line">  <span class="built_in">local</span> <span class="built_in">title</span> = splash:evaljs(<span class="string">"document.title"</span>)</span><br><span class="line">  <span class="built_in">return</span> &#123;<span class="built_in">title</span>=<span class="built_in">title</span>&#125;</span><br><span class="line">end</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接着我们重新调用了<code>evaljs()</code>方法执行JavaScript代码，此时运行结果就会抛出异常：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"error"</span>: <span class="number">400</span>,</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"ScriptError"</span>,</span><br><span class="line">    <span class="attr">"info"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"JS_ERROR"</span>,</span><br><span class="line">        <span class="attr">"js_error_message"</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"source"</span>: <span class="string">"[string \"function main(splash, args)\r...\"]"</span>,</span><br><span class="line">        <span class="attr">"message"</span>: <span class="string">"[string \"function main(splash, args)\r...\"]:4: unknown JS error: None"</span>,</span><br><span class="line">        <span class="attr">"line_number"</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="attr">"error"</span>: <span class="string">"unknown JS error: None"</span>,</span><br><span class="line">        <span class="attr">"splash_method"</span>: <span class="string">"evaljs"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"description"</span>: <span class="string">"Error happened while executing Lua script"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>不过一般来说，不用设置此属性，默认开启即可。</p>
                  <h3 id="resource-timeout"><a href="#resource-timeout" class="headerlink" title="resource_timeout"></a><code>resource_timeout</code></h3>
                  <p>此属性可以设置加载的超时时间，单位是秒。如果设置为0或<code>nil</code>（类似Python中的<code>None</code>），代表不检测超时。示例如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">function</span> <span class="function"><span class="title">main</span>(<span class="variable">splash</span>)</span></span><br><span class="line">    <span class="variable">splash.resource_timeout</span> = <span class="number">0.1</span></span><br><span class="line">    <span class="function"><span class="title"><span class="built_in">assert</span></span>(<span class="variable">splash</span>:<span class="title">go</span>(<span class="string">'https://www.taobao.com'</span>))</span></span><br><span class="line">    <span class="variable">return</span> <span class="variable">splash</span>:<span class="function"><span class="title">png</span>()</span></span><br><span class="line"><span class="variable">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>例如，这里将超时时间设置为0.1秒。如果在0.1秒之内没有得到响应，就会抛出异常，错误如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"error"</span>: <span class="number">400</span>,</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"ScriptError"</span>,</span><br><span class="line">    <span class="attr">"info"</span>: &#123;</span><br><span class="line">        <span class="attr">"error"</span>: <span class="string">"network5"</span>,</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"LUA_ERROR"</span>,</span><br><span class="line">        <span class="attr">"line_number"</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">"source"</span>: <span class="string">"[string \"function main(splash)\r...\"]"</span>,</span><br><span class="line">        <span class="attr">"message"</span>: <span class="string">"Lua error: [string \"function main(splash)\r...\"]:3: network5"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"description"</span>: <span class="string">"Error happened while executing Lua script"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此属性适合在网页加载速度较慢的情况下设置。如果超过了某个时间无响应，则直接抛出异常并忽略即可。</p>
                  <h3 id="images-enabled"><a href="#images-enabled" class="headerlink" title="images_enabled"></a><code>images_enabled</code></h3>
                  <p>此属性可以设置图片是否加载，默认情况下是加载的。禁用该属性后，可以节省网络流量并提高网页加载速度。但是需要注意的是，禁用图片加载可能会影响JavaScript渲染。因为禁用图片之后，它的外层DOM节点的高度会受影响，进而影响DOM节点的位置。因此，如果JavaScript对图片节点有操作的话，其执行就会受到影响。</p>
                  <p>另外值得注意的是，Splash使用了缓存。如果一开始加载出来了网页图片，然后禁用了图片加载，再重新加载页面，之前加载好的图片可能还会显示出来，这时直接重启Splash即可。</p>
                  <p>禁用图片加载的示例如下：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash, args)</span></span></span><br><span class="line">  splash.images_enabled = <span class="literal">false</span></span><br><span class="line">  <span class="built_in">assert</span>(splash:go(<span class="string">'https://www.jd.com'</span>))</span><br><span class="line">  <span class="keyword">return</span> &#123;png=splash:png()&#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样返回的页面截图就不会带有任何图片，加载速度也会快很多。</p>
                  <h3 id="plugins-enabled"><a href="#plugins-enabled" class="headerlink" title="plugins_enabled"></a><code>plugins_enabled</code></h3>
                  <p>此属性可以控制浏览器插件（如Flash插件）是否开启。默认情况下，此属性是<code>false</code>，表示不开启。可以使用如下代码控制其开启和关闭：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">splash.plugins_enabled</span> = <span class="literal">true</span>/<span class="literal">false</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="scroll-position"><a href="#scroll-position" class="headerlink" title="scroll_position"></a><code>scroll_position</code></h3>
                  <p>通过设置此属性，我们可以控制页面上下或左右滚动。这是一个比较常用的属性，示例如下：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash, args)</span></span></span><br><span class="line">  <span class="built_in">assert</span>(splash:go(<span class="string">'https://www.taobao.com'</span>))</span><br><span class="line">  splash.scroll_position = &#123;y=<span class="number">400</span>&#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;png=splash:png()&#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就可以控制页面向下滚动400像素值，结果如图7-10所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-10.png" alt="">图7-10 运行结果</p>
                  <p>如果要让页面左右滚动，可以传入<code>x</code>参数，代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">splash.scroll_position = &#123;<span class="attribute">x</span>=100, <span class="attribute">y</span>=200&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="6-Splash对象的方法"><a href="#6-Splash对象的方法" class="headerlink" title="6. Splash对象的方法"></a>6. Splash对象的方法</h2>
                  <p>除了前面介绍的属性外，Splash对象还有如下方法。</p>
                  <h3 id="go"><a href="#go" class="headerlink" title="go()"></a><code>go()</code></h3>
                  <p>该方法用来请求某个链接，而且它可以模拟GET和POST请求，同时支持传入请求头、表单等数据，其用法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ok, reason = splash:go&#123;url, <span class="attribute">baseurl</span>=<span class="literal">nil</span>, <span class="attribute">headers</span>=<span class="literal">nil</span>, <span class="attribute">http_method</span>=<span class="string">"GET"</span>, <span class="attribute">body</span>=<span class="literal">nil</span>, <span class="attribute">formdata</span>=<span class="literal">nil</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其参数说明如下。</p>
                  <ul>
                    <li><strong><code>url</code></strong>：请求的URL。</li>
                    <li><strong><code>baseurl</code></strong>：可选参数，默认为空，表示资源加载相对路径。</li>
                    <li><strong><code>headers</code></strong>：可选参数，默认为空，表示请求头。</li>
                    <li><strong><code>http_method</code></strong>：可选参数，默认为<code>GET</code>，同时支持<code>POST</code>。</li>
                    <li><strong><code>body</code></strong>：可选参数，默认为空，发POST请求时的表单数据，使用的<code>Content-type</code>为<code>application/json</code>。</li>
                    <li><strong><code>formdata</code></strong>：可选参数，默认为空，POST的时候的表单数据，使用的<code>Content-type</code>为<code>application/x-www-form-urlencoded</code>。</li>
                  </ul>
                  <p>该方法的返回结果是结果<code>ok</code>和原因<code>reason</code>的组合，如果<code>ok</code>为空，代表网页加载出现了错误，此时<code>reason</code>变量中包含了错误的原因，否则证明页面加载成功。示例如下：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash, args)</span></span></span><br><span class="line">  <span class="keyword">local</span> ok, reason = splash:go&#123;<span class="string">"http://httpbin.org/post"</span>, http_method=<span class="string">"POST"</span>, body=<span class="string">"name=Germey"</span>&#125;</span><br><span class="line">  <span class="keyword">if</span> ok <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span> splash:html()</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们模拟了一个POST请求，并传入了POST的表单数据，如果成功，则返回页面的源代码。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="params">&lt;html&gt;</span><span class="params">&lt;head&gt;</span><span class="params">&lt;/head&gt;</span><span class="params">&lt;body&gt;</span><span class="params">&lt;pre style="word-wrap: break-word; white-space: pre-wrap;"&gt;</span>&#123;</span><br><span class="line">  <span class="string">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">"data"</span>: <span class="string">""</span>, </span><br><span class="line">  <span class="string">"files"</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">"form"</span>: &#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"Germey"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">"headers"</span>: &#123;</span><br><span class="line">    <span class="string">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span>, </span><br><span class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="string">"Accept-Language"</span>: <span class="string">"en,*"</span>, </span><br><span class="line">    <span class="string">"Connection"</span>: <span class="string">"close"</span>, </span><br><span class="line">    <span class="string">"Content-Length"</span>: <span class="string">"11"</span>, </span><br><span class="line">    <span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>, </span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="string">"Origin"</span>: <span class="string">"null"</span>, </span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/602.1 (KHTML, like Gecko) splash Version/9.0 Safari/602.1"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">"json"</span>: null, </span><br><span class="line">  <span class="string">"origin"</span>: <span class="string">"60.207.237.85"</span>, </span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"http://httpbin.org/post"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="params">&lt;/pre&gt;</span><span class="params">&lt;/body&gt;</span><span class="params">&lt;/html&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，我们成功实现了POST请求并发送了表单数据。</p>
                  <h3 id="wait"><a href="#wait" class="headerlink" title="wait()"></a><code>wait()</code></h3>
                  <p>此方法可以控制页面的等待时间，使用方法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ok, reason = splash:wait&#123;time, <span class="attribute">cancel_on_redirect</span>=<span class="literal">false</span>, <span class="attribute">cancel_on_error</span>=<span class="literal">true</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>参数说明如下。</p>
                  <ul>
                    <li><strong><code>time</code></strong>：等待的秒数。</li>
                    <li><strong><code>cancel_on_redirect</code></strong>：可选参数，默认为<code>false</code>，表示如果发生了重定向就停止等待，并返回重定向结果。</li>
                    <li><strong><code>cancel_on_error</code></strong>：可选参数，默认为<code>false</code>，表示如果发生了加载错误，就停止等待。</li>
                  </ul>
                  <p>返回结果同样是结果<code>ok</code>和原因<code>reason</code>的组合。</p>
                  <p>我们用一个实例感受一下：</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash)</span></span></span><br><span class="line"><span class="function">    <span class="title">splash</span>:go<span class="params">(<span class="string">"https://www.taobao.com"</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">splash</span>:wait<span class="params">(2)</span></span></span><br><span class="line"><span class="function">    <span class="title">return</span> </span>&#123;html=splash:html()&#125;</span><br><span class="line">end</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这可以实现访问淘宝并等待2秒，随后返回页面源代码的功能。</p>
                  <h3 id="jsfunc"><a href="#jsfunc" class="headerlink" title="jsfunc()"></a><code>jsfunc()</code></h3>
                  <p>此方法可以直接调用JavaScript定义的方法，但是所调用的方法需要用双中括号包围，这相当于实现了JavaScript方法到Lua脚本的转换。示例如下：</p>
                  <figure class="highlight typescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params">splash, args</span>)</span></span><br><span class="line"><span class="function">  <span class="title">local</span> <span class="title">get_div_count</span> = <span class="title">splash</span>:<span class="title">jsfunc</span>(<span class="params">[[</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">function</span> () &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">var</span> body = <span class="built_in">document</span>.body;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">var</span> divs = body.getElementsByTagName(<span class="string">'div'</span>);</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">return</span> divs.length;</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">  ]]</span>)</span></span><br><span class="line"><span class="function">  <span class="title">splash</span>:<span class="title">go</span>(<span class="params">"https:<span class="comment">//www.baidu.com")</span></span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">return</span> (<span class="string">"There are %s DIVs"</span>):format(</span></span></span><br><span class="line"><span class="function"><span class="params">    get_div_count())</span></span></span><br><span class="line"><span class="function"><span class="params">end</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">There are <span class="number">21</span> DIVs</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先，我们声明了一个JavaScript定义的方法，然后在页面加载成功后调用了此方法计算出了页面中<code>div</code>节点的个数。</p>
                  <p>关于JavaScript到Lua脚本的更多转换细节，可以参考官方文档：<span class="exturl" data-url="aHR0cHM6Ly9zcGxhc2gucmVhZHRoZWRvY3MuaW8vZW4vc3RhYmxlL3NjcmlwdGluZy1yZWYuaHRtbCNzcGxhc2gtanNmdW5j">https://splash.readthedocs.io/en/stable/scripting-ref.html#splash-jsfunc<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h3 id="evaljs"><a href="#evaljs" class="headerlink" title="evaljs()"></a><code>evaljs()</code></h3>
                  <p>此方法可以执行JavaScript代码并返回最后一条JavaScript语句的返回结果，使用方法如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable"><span class="class">result</span></span> = <span class="variable">splash</span>:<span class="function"><span class="title">evaljs</span>(<span class="variable">js</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>比如，可以用下面的代码来获取页面标题：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">local</span> <span class="variable">title</span> = <span class="variable">splash</span>:<span class="function"><span class="title">evaljs</span>(<span class="string">"document.title"</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="runjs"><a href="#runjs" class="headerlink" title="runjs()"></a><code>runjs()</code></h3>
                  <p>此方法可以执行JavaScript代码，它与<code>evaljs()</code>的功能类似，但是更偏向于执行某些动作或声明某些方法。例如：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="title">splash</span>, <span class="title">args</span>)</span></span><br><span class="line">  splash:go(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line">  splash:runjs(<span class="string">"foo = function() &#123; return 'bar' &#125;"</span>)</span><br><span class="line">  <span class="built_in">local</span> <span class="built_in">result</span> = splash:evaljs(<span class="string">"foo()"</span>)</span><br><span class="line">  <span class="literal">return</span> <span class="built_in">result</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们用<code>runjs()</code>先声明了一个JavaScript定义的方法，然后通过<code>evaljs()</code>来调用得到的结果。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">bar</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="autoload"><a href="#autoload" class="headerlink" title="autoload()"></a><code>autoload()</code></h3>
                  <p>此方法可以设置每个页面访问时自动加载的对象，使用方法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ok, reason = splash:autoload&#123;source_or_url, <span class="attribute">source</span>=<span class="literal">nil</span>, <span class="attribute">url</span>=<span class="literal">nil</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>参数说明如下。</p>
                  <ul>
                    <li><strong><code>source_or_url</code></strong>：JavaScript代码或者JavaScript库链接。</li>
                    <li><strong><code>source</code></strong>：JavaScript代码。</li>
                    <li><strong><code>url</code></strong>：JavaScript库链接</li>
                  </ul>
                  <p>但是此方法只负责加载JavaScript代码或库，不执行任何操作。如果要执行操作，可以调用<code>evaljs()</code>或<code>runjs()</code>方法。示例如下：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash, args)</span></span></span><br><span class="line">  splash:autoload(<span class="string">[[</span></span><br><span class="line"><span class="string">    function get_document_title()&#123;</span></span><br><span class="line"><span class="string">      return document.title;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  ]]</span>)</span><br><span class="line">  splash:go(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line">  <span class="keyword">return</span> splash:evaljs(<span class="string">"get_document_title()"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们调用<code>autoload()</code>方法声明了一个JavaScript方法，然后通过<code>evaljs()</code>方法来执行此JavaScript方法。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">百度一下，你就知道</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外，我们也可以使用<code>autoload()</code>方法加载某些方法库，如jQuery，示例如下：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash, args)</span></span></span><br><span class="line">  <span class="built_in">assert</span>(splash:autoload(<span class="string">"https://code.jquery.com/jquery-2.1.3.min.js"</span>))</span><br><span class="line">  <span class="built_in">assert</span>(splash:go(<span class="string">"https://www.taobao.com"</span>))</span><br><span class="line">  <span class="keyword">local</span> version = splash:evaljs(<span class="string">"$.fn.jquery"</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'JQuery version: '</span> .. version</span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">JQuery version:</span> <span class="number">2.1</span><span class="number">.3</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="call-later"><a href="#call-later" class="headerlink" title="call_later()"></a><code>call_later()</code></h3>
                  <p>此方法可以通过设置定时任务和延迟时间来实现任务延时执行，并且可以在执行前通过<code>cancel()</code>方法重新执行定时任务。示例如下：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash, args)</span></span></span><br><span class="line">  <span class="keyword">local</span> snapshots = &#123;&#125;</span><br><span class="line">  <span class="keyword">local</span> timer = splash:call_later(<span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    snapshots[<span class="string">"a"</span>] = splash:png()</span><br><span class="line">    splash:wait(<span class="number">1.0</span>)</span><br><span class="line">    snapshots[<span class="string">"b"</span>] = splash:png()</span><br><span class="line">  <span class="keyword">end</span>, <span class="number">0.2</span>)</span><br><span class="line">  splash:go(<span class="string">"https://www.taobao.com"</span>)</span><br><span class="line">  splash:wait(<span class="number">3.0</span>)</span><br><span class="line">  <span class="keyword">return</span> snapshots</span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们设置了一个定时任务，0.2秒的时候获取网页截图，然后等待1秒，1.2秒时再次获取网页截图，访问的页面是淘宝，最后将截图结果返回。运行结果如图7-11所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-11.png" alt="">图7-11 运行结果</p>
                  <p>可以发现，第一次截图时网页还没有加载出来，截图为空，第二次网页便加载成功了。</p>
                  <h3 id="http-get"><a href="#http-get" class="headerlink" title="http_get()"></a><code>http_get()</code></h3>
                  <p>此方法可以模拟发送HTTP的GET请求，使用方法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">response = splash:http_get&#123;url, <span class="attribute">headers</span>=<span class="literal">nil</span>, <span class="attribute">follow_redirects</span>=<span class="literal">true</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>参数说明如下。</p>
                  <ul>
                    <li><strong><code>url</code></strong>：请求URL。</li>
                    <li><strong><code>headers</code></strong>：可选参数，默认为空，请求头。</li>
                    <li><strong><code>follow_redirects</code></strong>：可选参数，表示是否启动自动重定向，默认为<code>true</code>。</li>
                  </ul>
                  <p>示例如下：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash, args)</span></span></span><br><span class="line">  <span class="keyword">local</span> treat = <span class="built_in">require</span>(<span class="string">"treat"</span>)</span><br><span class="line">  <span class="keyword">local</span> response = splash:http_get(<span class="string">"http://httpbin.org/get"</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">    html=treat.as_string(response.body),</span><br><span class="line">    url=response.url,</span><br><span class="line">    <span class="built_in">status</span>=response.<span class="built_in">status</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Splash <span class="string">Response:</span> Object</span><br><span class="line"><span class="string">html:</span> String (length <span class="number">355</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">"headers"</span>: &#123;</span><br><span class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="string">"Accept-Language"</span>: <span class="string">"en,*"</span>, </span><br><span class="line">    <span class="string">"Connection"</span>: <span class="string">"close"</span>, </span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/602.1 (KHTML, like Gecko) splash Version/9.0 Safari/602.1"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">"origin"</span>: <span class="string">"60.207.237.85"</span>, </span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"http://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">status:</span> <span class="number">200</span></span><br><span class="line"><span class="string">url:</span> <span class="string">"http://httpbin.org/get"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="http-post"><a href="#http-post" class="headerlink" title="http_post()"></a><code>http_post()</code></h3>
                  <p>和<code>http_get()</code>方法类似，此方法用来模拟发送POST请求，不过多了一个参数<code>body</code>，使用方法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">response = splash:http_post&#123;url, <span class="attribute">headers</span>=<span class="literal">nil</span>, <span class="attribute">follow_redirects</span>=<span class="literal">true</span>, <span class="attribute">body</span>=<span class="literal">nil</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>参数说明如下。</p>
                  <ul>
                    <li><strong><code>url</code></strong>：请求URL。</li>
                    <li><strong><code>headers</code></strong>：可选参数，默认为空，请求头。</li>
                    <li><strong><code>follow_redirects</code></strong>：可选参数，表示是否启动自动重定向，默认为<code>true</code>。</li>
                    <li><strong><code>body</code></strong>：可选参数，即表单数据，默认为空。</li>
                  </ul>
                  <p>我们用实例感受一下：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash, args)</span></span></span><br><span class="line">  <span class="keyword">local</span> treat = <span class="built_in">require</span>(<span class="string">"treat"</span>)</span><br><span class="line">  <span class="keyword">local</span> json = <span class="built_in">require</span>(<span class="string">"json"</span>)</span><br><span class="line">  <span class="keyword">local</span> response = splash:http_post&#123;<span class="string">"http://httpbin.org/post"</span>,     </span><br><span class="line">      body=json.encode(&#123;name=<span class="string">"Germey"</span>&#125;),</span><br><span class="line">      headers=&#123;[<span class="string">"content-type"</span>]=<span class="string">"application/json"</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">    html=treat.as_string(response.body),</span><br><span class="line">    url=response.url,</span><br><span class="line">    <span class="built_in">status</span>=response.<span class="built_in">status</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Splash <span class="string">Response:</span> Object</span><br><span class="line"><span class="string">html:</span> String (length <span class="number">533</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">"data"</span>: <span class="string">"&#123;\"name\": \"Germey\"&#125;"</span>, </span><br><span class="line">  <span class="string">"files"</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">"form"</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">"headers"</span>: &#123;</span><br><span class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="string">"Accept-Language"</span>: <span class="string">"en,*"</span>, </span><br><span class="line">    <span class="string">"Connection"</span>: <span class="string">"close"</span>, </span><br><span class="line">    <span class="string">"Content-Length"</span>: <span class="string">"18"</span>, </span><br><span class="line">    <span class="string">"Content-Type"</span>: <span class="string">"application/json"</span>, </span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/602.1 (KHTML, like Gecko) splash Version/9.0 Safari/602.1"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">"json"</span>: &#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"Germey"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">"origin"</span>: <span class="string">"60.207.237.85"</span>, </span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"http://httpbin.org/post"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">status:</span> <span class="number">200</span></span><br><span class="line"><span class="string">url:</span> <span class="string">"http://httpbin.org/post"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这里我们成功模拟提交了POST请求并发送了表单数据。</p>
                  <h3 id="set-content"><a href="#set-content" class="headerlink" title="set_content()"></a><code>set_content()</code></h3>
                  <p>此方法用来设置页面的内容，示例如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">function</span> <span class="function"><span class="title">main</span>(<span class="variable">splash</span>)</span></span><br><span class="line">    <span class="function"><span class="title"><span class="built_in">assert</span></span>(<span class="variable">splash</span>:<span class="title">set_content</span>(<span class="string">"&lt;html&gt;&lt;body&gt;&lt;h1&gt;hello&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span>))</span></span><br><span class="line">    <span class="variable">return</span> <span class="variable">splash</span>:<span class="function"><span class="title">png</span>()</span></span><br><span class="line"><span class="variable">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如图7-12所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-12.png" alt="">图7-12 运行结果</p>
                  <h3 id="html"><a href="#html" class="headerlink" title="html()"></a><code>html()</code></h3>
                  <p>此方法用来获取网页的源代码，它是非常简单又常用的方法。示例如下：</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash, args)</span></span></span><br><span class="line"><span class="function">  <span class="title">splash</span>:go<span class="params">(<span class="string">"https://httpbin.org/get"</span>)</span></span></span><br><span class="line"><span class="function">  <span class="title">return</span> <span class="title">splash</span>:html<span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">end</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="params">&lt;html&gt;</span><span class="params">&lt;head&gt;</span><span class="params">&lt;/head&gt;</span><span class="params">&lt;body&gt;</span><span class="params">&lt;pre style="word-wrap: break-word; white-space: pre-wrap;"&gt;</span>&#123;</span><br><span class="line">  <span class="string">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">"headers"</span>: &#123;</span><br><span class="line">    <span class="string">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span>, </span><br><span class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="string">"Accept-Language"</span>: <span class="string">"en,*"</span>, </span><br><span class="line">    <span class="string">"Connection"</span>: <span class="string">"close"</span>, </span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/602.1 (KHTML, like Gecko) splash Version/9.0 Safari/602.1"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">"origin"</span>: <span class="string">"60.207.237.85"</span>, </span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"https://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="params">&lt;/pre&gt;</span><span class="params">&lt;/body&gt;</span><span class="params">&lt;/html&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="png"><a href="#png" class="headerlink" title="png()"></a><code>png()</code></h3>
                  <p>此方法用来获取PNG格式的网页截图，示例如下：</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash, args)</span></span></span><br><span class="line"><span class="function">  <span class="title">splash</span>:go<span class="params">(<span class="string">"https://www.taobao.com"</span>)</span></span></span><br><span class="line"><span class="function">  <span class="title">return</span> <span class="title">splash</span>:png<span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">end</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="jpeg"><a href="#jpeg" class="headerlink" title="jpeg()"></a><code>jpeg()</code></h3>
                  <p>此方法用来获取JPEG格式的网页截图，示例如下：</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash, args)</span></span></span><br><span class="line"><span class="function">  <span class="title">splash</span>:go<span class="params">(<span class="string">"https://www.taobao.com"</span>)</span></span></span><br><span class="line"><span class="function">  <span class="title">return</span> <span class="title">splash</span>:jpeg<span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">end</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="har"><a href="#har" class="headerlink" title="har()"></a><code>har()</code></h3>
                  <p>此方法用来获取页面加载过程描述，示例如下：</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash, args)</span></span></span><br><span class="line"><span class="function">  <span class="title">splash</span>:go<span class="params">(<span class="string">"https://www.baidu.com"</span>)</span></span></span><br><span class="line"><span class="function">  <span class="title">return</span> <span class="title">splash</span>:har<span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">end</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如图7-13所示，其中显示了页面加载过程中每个请求记录的详情。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-13.png" alt="">图7-13 运行结果</p>
                  <h3 id="url"><a href="#url" class="headerlink" title="url()"></a><code>url()</code></h3>
                  <p>此方法可以获取当前正在访问的URL，示例如下：</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash, args)</span></span></span><br><span class="line"><span class="function">  <span class="title">splash</span>:go<span class="params">(<span class="string">"https://www.baidu.com"</span>)</span></span></span><br><span class="line"><span class="function">  <span class="title">return</span> <span class="title">splash</span>:url<span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">end</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">https:</span><span class="comment">//www.baidu.com/</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="get-cookies"><a href="#get-cookies" class="headerlink" title="get_cookies()"></a><code>get_cookies()</code></h3>
                  <p>此方法可以获取当前页面的Cookies，示例如下：</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash, args)</span></span></span><br><span class="line"><span class="function">  <span class="title">splash</span>:go<span class="params">(<span class="string">"https://www.baidu.com"</span>)</span></span></span><br><span class="line"><span class="function">  <span class="title">return</span> <span class="title">splash</span>:get_cookies<span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">end</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Splash <span class="string">Response:</span> Array[<span class="number">2</span>]</span><br><span class="line"><span class="number">0</span>: Object</span><br><span class="line"><span class="string">domain:</span> <span class="string">".baidu.com"</span></span><br><span class="line"><span class="string">expires:</span> <span class="string">"2085-08-21T20:13:23Z"</span></span><br><span class="line"><span class="string">httpOnly:</span> <span class="literal">false</span></span><br><span class="line"><span class="string">name:</span> <span class="string">"BAIDUID"</span></span><br><span class="line"><span class="string">path:</span> <span class="string">"/"</span></span><br><span class="line"><span class="string">secure:</span> <span class="literal">false</span></span><br><span class="line"><span class="string">value:</span> <span class="string">"C1263A470B02DEF45593B062451C9722:FG=1"</span></span><br><span class="line"><span class="number">1</span>: Object</span><br><span class="line"><span class="string">domain:</span> <span class="string">".baidu.com"</span></span><br><span class="line"><span class="string">expires:</span> <span class="string">"2085-08-21T20:13:23Z"</span></span><br><span class="line"><span class="string">httpOnly:</span> <span class="literal">false</span></span><br><span class="line"><span class="string">name:</span> <span class="string">"BIDUPSID"</span></span><br><span class="line"><span class="string">path:</span> <span class="string">"/"</span></span><br><span class="line"><span class="string">secure:</span> <span class="literal">false</span></span><br><span class="line"><span class="string">value:</span> <span class="string">"C1263A470B02DEF45593B062451C9722"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="add-cookie"><a href="#add-cookie" class="headerlink" title="add_cookie()"></a><code>add_cookie()</code></h3>
                  <p>此方法可以为当前页面添加Cookie，用法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">cookies = splash:add_cookie&#123;name, value, <span class="attribute">path</span>=<span class="literal">nil</span>, <span class="attribute">domain</span>=<span class="literal">nil</span>, <span class="attribute">expires</span>=<span class="literal">nil</span>, <span class="attribute">httpOnly</span>=<span class="literal">nil</span>, <span class="attribute">secure</span>=<span class="literal">nil</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>该方法的各个参数代表Cookie的各个属性。</p>
                  <p>示例如下：</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash)</span></span></span><br><span class="line"><span class="function">    <span class="title">splash</span>:add_cookie</span>&#123;<span class="string">"sessionid"</span>, <span class="string">"237465ghgfsd"</span>, <span class="string">"/"</span>, domain=<span class="string">"http://example.com"</span>&#125;</span><br><span class="line">    splash:go(<span class="string">"http://example.com/"</span>)</span><br><span class="line">    <span class="keyword">return</span> splash:html()</span><br><span class="line">end</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="clear-cookies"><a href="#clear-cookies" class="headerlink" title="clear_cookies()"></a><code>clear_cookies()</code></h3>
                  <p>此方法可以清除所有的Cookies，示例如下：</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash)</span></span></span><br><span class="line"><span class="function">    <span class="title">splash</span>:go<span class="params">(<span class="string">"https://www.baidu.com/"</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">splash</span>:clear_cookies<span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="title">return</span> <span class="title">splash</span>:get_cookies<span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">end</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们清除了所有的Cookies，然后调用<code>get_cookies()</code>将结果返回。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight vbscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Splash <span class="built_in">Response</span>: <span class="built_in">Array</span>[<span class="number">0</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，Cookies被全部清空，没有任何结果。</p>
                  <h3 id="get-viewport-size"><a href="#get-viewport-size" class="headerlink" title="get_viewport_size()"></a><code>get_viewport_size()</code></h3>
                  <p>此方法可以获取当前浏览器页面的大小，即宽高，示例如下：</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash)</span></span></span><br><span class="line"><span class="function">    <span class="title">splash</span>:go<span class="params">(<span class="string">"https://www.baidu.com/"</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">return</span> <span class="title">splash</span>:get_viewport_size<span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">end</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Splash Response: Array[<span class="number">2</span>]</span><br><span class="line"><span class="number">0</span>: <span class="number">1024</span></span><br><span class="line"><span class="number">1</span>: <span class="number">768</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="set-viewport-size"><a href="#set-viewport-size" class="headerlink" title="set_viewport_size()"></a><code>set_viewport_size()</code></h3>
                  <p>此方法可以设置当前浏览器页面的大小，即宽高，用法如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">splash:set<span class="constructor">_viewport_size(<span class="params">width</span>, <span class="params">height</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>例如，这里访问一个宽度自适应的页面：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash)</span></span></span><br><span class="line">    splash:set_viewport_size(<span class="number">400</span>, <span class="number">700</span>)</span><br><span class="line">    <span class="built_in">assert</span>(splash:go(<span class="string">"http://cuiqingcai.com"</span>))</span><br><span class="line">    <span class="keyword">return</span> splash:png()</span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如图7-14所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-14.jpg" alt="">图7-14 运行结果</p>
                  <h3 id="set-viewport-full"><a href="#set-viewport-full" class="headerlink" title="set_viewport_full()"></a><code>set_viewport_full()</code></h3>
                  <p>此方法可以设置浏览器全屏显示，示例如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">function</span> <span class="function"><span class="title">main</span>(<span class="variable">splash</span>)</span></span><br><span class="line">    <span class="variable">splash</span>:<span class="function"><span class="title">set_viewport_full</span>()</span></span><br><span class="line">    <span class="function"><span class="title"><span class="built_in">assert</span></span>(<span class="variable">splash</span>:<span class="title">go</span>(<span class="string">"http://cuiqingcai.com"</span>))</span></span><br><span class="line">    <span class="variable">return</span> <span class="variable">splash</span>:<span class="function"><span class="title">png</span>()</span></span><br><span class="line"><span class="variable">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="set-user-agent"><a href="#set-user-agent" class="headerlink" title="set_user_agent()"></a><code>set_user_agent()</code></h3>
                  <p>此方法可以设置浏览器的<code>User-Agent</code>，示例如下：</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash)</span></span></span><br><span class="line"><span class="function">  <span class="title">splash</span>:set_user_agent<span class="params">(<span class="string">'Splash'</span>)</span></span></span><br><span class="line"><span class="function">  <span class="title">splash</span>:go<span class="params">(<span class="string">"http://httpbin.org/get"</span>)</span></span></span><br><span class="line"><span class="function">  <span class="title">return</span> <span class="title">splash</span>:html<span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">end</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们将浏览器的<code>User-Agent</code>设置为<code>Splash</code>，运行结果如下：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="params">&lt;html&gt;</span><span class="params">&lt;head&gt;</span><span class="params">&lt;/head&gt;</span><span class="params">&lt;body&gt;</span><span class="params">&lt;pre style="word-wrap: break-word; white-space: pre-wrap;"&gt;</span>&#123;</span><br><span class="line">  <span class="string">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">"headers"</span>: &#123;</span><br><span class="line">    <span class="string">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span>, </span><br><span class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="string">"Accept-Language"</span>: <span class="string">"en,*"</span>, </span><br><span class="line">    <span class="string">"Connection"</span>: <span class="string">"close"</span>, </span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Splash"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">"origin"</span>: <span class="string">"60.207.237.85"</span>, </span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"http://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="params">&lt;/pre&gt;</span><span class="params">&lt;/body&gt;</span><span class="params">&lt;/html&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，此处<code>User-Agent</code>被成功设置。</p>
                  <h3 id="set-custom-headers"><a href="#set-custom-headers" class="headerlink" title="set_custom_headers()"></a><code>set_custom_headers()</code></h3>
                  <p>此方法可以设置请求头，示例如下：</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash)</span></span></span><br><span class="line"><span class="function">  <span class="title">splash</span>:set_custom_headers<span class="params">(&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">     [<span class="string">"User-Agent"</span>] = <span class="string">"Splash"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">     [<span class="string">"Site"</span>] = <span class="string">"Splash"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;)</span></span></span><br><span class="line"><span class="function">  <span class="title">splash</span>:go<span class="params">(<span class="string">"http://httpbin.org/get"</span>)</span></span></span><br><span class="line"><span class="function">  <span class="title">return</span> <span class="title">splash</span>:html<span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">end</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们设置了请求头中的<code>User-Agent</code>和<code>Site</code>属性，运行结果如下：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="params">&lt;html&gt;</span><span class="params">&lt;head&gt;</span><span class="params">&lt;/head&gt;</span><span class="params">&lt;body&gt;</span><span class="params">&lt;pre style="word-wrap: break-word; white-space: pre-wrap;"&gt;</span>&#123;</span><br><span class="line">  <span class="string">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">"headers"</span>: &#123;</span><br><span class="line">    <span class="string">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span>, </span><br><span class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="string">"Accept-Language"</span>: <span class="string">"en,*"</span>, </span><br><span class="line">    <span class="string">"Connection"</span>: <span class="string">"close"</span>, </span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="string">"Site"</span>: <span class="string">"Splash"</span>, </span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Splash"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">"origin"</span>: <span class="string">"60.207.237.85"</span>, </span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"http://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="params">&lt;/pre&gt;</span><span class="params">&lt;/body&gt;</span><span class="params">&lt;/html&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="select"><a href="#select" class="headerlink" title="select()"></a><code>select()</code></h3>
                  <p>该方法可以选中符合条件的第一个节点，如果有多个节点符合条件，则只会返回一个，其参数是CSS选择器。示例如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">function</span> <span class="function"><span class="title">main</span>(<span class="variable">splash</span>)</span></span><br><span class="line">  <span class="variable">splash</span>:<span class="function"><span class="title">go</span>(<span class="string">"https://www.baidu.com/"</span>)</span></span><br><span class="line">  <span class="variable">input</span> = <span class="variable">splash</span>:<span class="function"><span class="title">select</span>(<span class="string">"#kw"</span>)</span></span><br><span class="line">  <span class="variable">input</span>:<span class="function"><span class="title">send_text</span>(<span class="string">'Splash'</span>)</span></span><br><span class="line">  <span class="variable">splash</span>:<span class="function"><span class="title">wait</span>(<span class="number">3</span>)</span></span><br><span class="line">  <span class="variable">return</span> <span class="variable">splash</span>:<span class="function"><span class="title">png</span>()</span></span><br><span class="line"><span class="variable">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们首先访问了百度，然后选中了搜索框，随后调用了<code>send_text()</code>方法填写了文本，然后返回网页截图。</p>
                  <p>结果如图7-15所示，可以看到，我们成功填写了输入框。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-15.jpg" alt="">图7-15 运行结果</p>
                  <h3 id="select-all"><a href="#select-all" class="headerlink" title="select_all()"></a><code>select_all()</code></h3>
                  <p>此方法可以选中所有符合条件的节点，其参数是CSS选择器。示例如下：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash)</span></span></span><br><span class="line">  <span class="keyword">local</span> treat = <span class="built_in">require</span>(<span class="string">'treat'</span>)</span><br><span class="line">  <span class="built_in">assert</span>(splash:go(<span class="string">"http://quotes.toscrape.com/"</span>))</span><br><span class="line">  <span class="built_in">assert</span>(splash:wait(<span class="number">0.5</span>))</span><br><span class="line">  <span class="keyword">local</span> texts = splash:select_all(<span class="string">'.quote .text'</span>)</span><br><span class="line">  <span class="keyword">local</span> results = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> index, text <span class="keyword">in</span> <span class="built_in">ipairs</span>(texts) <span class="keyword">do</span></span><br><span class="line">    results[index] = text.node.innerHTML</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">return</span> treat.as_array(results)</span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们通过CSS选择器选中了节点的正文内容，随后遍历了所有节点，将其中的文本获取下来。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight smalltalk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="type">Splash</span> <span class="type">Response</span>: <span class="type">Array</span>[<span class="number">10</span>]</span><br><span class="line"><span class="number">0</span>: <span class="comment">"“The world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.”"</span></span><br><span class="line"><span class="number">1</span>: <span class="comment">"“It is our choices, Harry, that show what we truly are, far more than our abilities.”"</span></span><br><span class="line"><span class="number">2</span>: “<span class="type">There</span> are only two ways to live your life. <span class="type">One</span> is as though nothing is a miracle. <span class="type">The</span> other is as though everything is a miracle.”</span><br><span class="line"><span class="number">3</span>: <span class="comment">"“The person, be it gentleman or lady, who has not pleasure in a good novel, must be intolerably stupid.”"</span></span><br><span class="line"><span class="number">4</span>: <span class="comment">"“Imperfection is beauty, madness is genius and it's better to be absolutely ridiculous than absolutely boring.”"</span></span><br><span class="line"><span class="number">5</span>: <span class="comment">"“Try not to become a man of success. Rather become a man of value.”"</span></span><br><span class="line"><span class="number">6</span>: <span class="comment">"“It is better to be hated for what you are than to be loved for what you are not.”"</span></span><br><span class="line"><span class="number">7</span>: <span class="comment">"“I have not failed. I've just found 10,000 ways that won't work.”"</span></span><br><span class="line"><span class="number">8</span>: <span class="comment">"“A woman is like a tea bag; you never know how strong it is until it's in hot water.”"</span></span><br><span class="line"><span class="number">9</span>: <span class="comment">"“A day without sunshine is like, you know, night.”"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，我们成功地将10个节点的正文内容获取了下来。</p>
                  <h3 id="mouse-click"><a href="#mouse-click" class="headerlink" title="mouse_click()"></a><code>mouse_click()</code></h3>
                  <p>此方法可以模拟鼠标点击操作，传入的参数为坐标值<code>x</code>和<code>y</code>。此外，也可以直接选中某个节点，然后调用此方法，示例如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">function</span> <span class="function"><span class="title">main</span>(<span class="variable">splash</span>)</span></span><br><span class="line">  <span class="variable">splash</span>:<span class="function"><span class="title">go</span>(<span class="string">"https://www.baidu.com/"</span>)</span></span><br><span class="line">  <span class="variable">input</span> = <span class="variable">splash</span>:<span class="function"><span class="title">select</span>(<span class="string">"#kw"</span>)</span></span><br><span class="line">  <span class="variable">input</span>:<span class="function"><span class="title">send_text</span>(<span class="string">'Splash'</span>)</span></span><br><span class="line">  <span class="variable">submit</span> = <span class="variable">splash</span>:<span class="function"><span class="title">select</span>(<span class="string">'#su'</span>)</span></span><br><span class="line">  <span class="variable">submit</span>:<span class="function"><span class="title">mouse_click</span>()</span></span><br><span class="line">  <span class="variable">splash</span>:<span class="function"><span class="title">wait</span>(<span class="number">3</span>)</span></span><br><span class="line">  <span class="variable">return</span> <span class="variable">splash</span>:<span class="function"><span class="title">png</span>()</span></span><br><span class="line"><span class="variable">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们首先选中页面的输入框，输入了文本，然后选中“提交”按钮，调用了<code>mouse_click()</code>方法提交查询，然后页面等待三秒，返回截图，结果如图7-16所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-16.jpg" alt="">图7-16 运行结果</p>
                  <p>可以看到，这里我们成功获取了查询后的页面内容，模拟了百度搜索操作。</p>
                  <p>前面介绍了Splash的常用API操作，还有一些API在这不再一一介绍，更加详细和权威的说明可以参见官方文档<span class="exturl" data-url="aHR0cHM6Ly9zcGxhc2gucmVhZHRoZWRvY3MuaW8vZW4vc3RhYmxlL3NjcmlwdGluZy1yZWYuaHRtbA==">https://splash.readthedocs.io/en/stable/scripting-ref.html<i class="fa fa-external-link-alt"></i></span>，此页面介绍了Splash对象的所有API操作。另外，还有针对页面元素的API操作，链接为<span class="exturl" data-url="aHR0cHM6Ly9zcGxhc2gucmVhZHRoZWRvY3MuaW8vZW4vc3RhYmxlL3NjcmlwdGluZy1lbGVtZW50LW9iamVjdC5odG1s">https://splash.readthedocs.io/en/stable/scripting-element-object.html<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="7-Splash-API调用"><a href="#7-Splash-API调用" class="headerlink" title="7. Splash API调用"></a>7. Splash API调用</h2>
                  <p>前面说明了Splash Lua脚本的用法，但这些脚本是在Splash页面中测试运行的，如何才能利用Splash渲染页面呢？怎样才能和Python程序结合使用并抓取JavaScript渲染的页面呢？</p>
                  <p>其实Splash给我们提供了一些HTTP API接口，我们只需要请求这些接口并传递相应的参数即可，下面简要介绍这些接口。</p>
                  <h3 id="render-html"><a href="#render-html" class="headerlink" title="render.html"></a>render.html</h3>
                  <p>此接口用于获取JavaScript渲染的页面的HTML代码，接口地址就是Splash的运行地址加此接口名称，例如<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo4MDUwL3JlbmRlci5odG1s">http://localhost:8050/render.html<i class="fa fa-external-link-alt"></i></span>。可以用<code>curl</code>来测试一下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl http://localhos<span class="variable">t:8050</span>/render.html?url=http<span class="variable">s:</span>//www.baidu.<span class="keyword">com</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们给此接口传递了一个<code>url</code>参数来指定渲染的URL，返回结果即页面渲染后的源代码。</p>
                  <p>如果用Python实现的话，代码如下：</p>
                  <figure class="highlight processing">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">'http://localhost:8050/render.html?url=https://www.baidu.com'</span></span><br><span class="line">response = requests.<span class="built_in">get</span>(url)</span><br><span class="line"><span class="built_in">print</span>(response.<span class="built_in">text</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就可以成功输出百度页面渲染后的源代码了。</p>
                  <p>另外，此接口还可以指定其他参数，比如通过<code>wait</code>指定等待秒数。如果要确保页面完全加载出来，可以增加等待时间，例如：</p>
                  <figure class="highlight processing">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">'http://localhost:8050/render.html?url=https://www.taobao.com&amp;wait=5'</span></span><br><span class="line">response = requests.<span class="built_in">get</span>(url)</span><br><span class="line"><span class="built_in">print</span>(response.<span class="built_in">text</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此时得到响应的时间就会相应变长，比如这里会等待5秒多钟才能获取淘宝页面的源代码。</p>
                  <p>另外，此接口还支持代理设置、图片加载设置、Headers设置、请求方法设置，具体的用法可以参见官方文档<span class="exturl" data-url="aHR0cHM6Ly9zcGxhc2gucmVhZHRoZWRvY3MuaW8vZW4vc3RhYmxlL2FwaS5odG1sI3JlbmRlci1odG1s">https://splash.readthedocs.io/en/stable/api.html#render-html<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h3 id="render-png"><a href="#render-png" class="headerlink" title="render.png"></a>render.png</h3>
                  <p>此接口可以获取网页截图，其参数比render.html多了几个，比如通过<code>width</code>和<code>height</code>来控制宽高，它返回的是PNG格式的图片二进制数据。示例如下：</p>
                  <figure class="highlight sas">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl http://localhost:8050/render.png?url=https://www.taobao.com<span class="variable">&amp;wait</span>=5<span class="variable">&amp;width</span>=1000<span class="variable">&amp;height</span>=700</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们传入了<code>width</code>和<code>height</code>来设置页面大小为1000×700像素。</p>
                  <p>如果用Python实现，可以将返回的二进制数据保存为PNG格式的图片，具体如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://localhost:8050/render.png?url=https://www.jd.com&amp;wait=5&amp;width=1000&amp;height=700'</span></span><br><span class="line">response = requests.<span class="built_in">get</span>(url)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'taobao.png'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.<span class="built_in">write</span>(response.content)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>得到的图片如图7-17所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-17.png" alt="">图7-17 运行结果</p>
                  <p>这样我们就成功获取了京东首页渲染完成后的页面截图，详细的参数设置可以参考官网文档<span class="exturl" data-url="aHR0cHM6Ly9zcGxhc2gucmVhZHRoZWRvY3MuaW8vZW4vc3RhYmxlL2FwaS5odG1sI3JlbmRlci1wbmc=">https://splash.readthedocs.io/en/stable/api.html#render-png<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h3 id="render-jpeg"><a href="#render-jpeg" class="headerlink" title="render.jpeg"></a>render.jpeg</h3>
                  <p>此接口和render.png类似，不过它返回的是JPEG格式的图片二进制数据。</p>
                  <p>另外，此接口比render.png多了参数<code>quality</code>，它用来设置图片质量。</p>
                  <h3 id="render-har"><a href="#render-har" class="headerlink" title="render.har"></a>render.har</h3>
                  <p>此接口用于获取页面加载的HAR数据，示例如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl http://localhos<span class="variable">t:8050</span>/render.har?url=http<span class="variable">s:</span>//www.jd.<span class="keyword">com</span>&amp;wait=<span class="number">5</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>它的返回结果（如图7-18所示）非常多，是一个JSON格式的数据，其中包含页面加载过程中的HAR数据。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-18.jpg" alt="">图7-18 运行结果</p>
                  <h3 id="render-json"><a href="#render-json" class="headerlink" title="render.json"></a>render.json</h3>
                  <p>此接口包含了前面接口的所有功能，返回结果是JSON格式，示例如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8050</span><span class="regexp">/render.json?url=https:/</span><span class="regexp">/httpbin.org</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="attr">"title"</span>: <span class="string">"httpbin(1): HTTP Client Testing Service"</span>, <span class="attr">"url"</span>: <span class="string">"https://httpbin.org/"</span>, <span class="attr">"requestedUrl"</span>: <span class="string">"https://httpbin.org/"</span>, <span class="attr">"geometry"</span>: [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1024</span>, <span class="number">768</span>]&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这里以JSON形式返回了相应的请求数据。</p>
                  <p>我们可以通过传入不同参数控制其返回结果。比如，传入<code>html=1</code>，返回结果即会增加源代码数据；传入<code>png=1</code>，返回结果即会增加页面PNG截图数据；传入<code>har=1</code>，则会获得页面HAR数据。例如：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl http:<span class="regexp">//</span>localhost:<span class="number">8050</span><span class="regexp">/render.json?url=https:/</span><span class="regexp">/httpbin.org&amp;html=1&amp;har=1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样返回的JSON结果会包含网页源代码和HAR数据。</p>
                  <p>此外还有更多参数设置，具体可以参考官方文档：<span class="exturl" data-url="aHR0cHM6Ly9zcGxhc2gucmVhZHRoZWRvY3MuaW8vZW4vc3RhYmxlL2FwaS5odG1sI3JlbmRlci1qc29u">https://splash.readthedocs.io/en/stable/api.html#render-json<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h3 id="execute"><a href="#execute" class="headerlink" title="execute"></a>execute</h3>
                  <p>此接口才是最为强大的接口。前面说了很多Splash Lua脚本的操作，用此接口便可实现与Lua脚本的对接。</p>
                  <p>前面的render.html和render.png等接口对于一般的JavaScript渲染页面是足够了，但是如果要实现一些交互操作的话，它们还是无能为力，这里就需要使用execute接口了。</p>
                  <p>我们先实现一个最简单的脚本，直接返回数据：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">function</span> <span class="title">main</span>(splash)</span><br><span class="line">    <span class="keyword">return</span> <span class="type">'hello'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后将此脚本转化为URL编码后的字符串，拼接到execute接口后面，示例如下：</p>
                  <figure class="highlight xquery">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl http://localhost:<span class="number">8050</span>/execute?lua_source=<span class="keyword">function</span>+main<span class="meta">%28splash</span><span class="meta">%29</span><span class="meta">%0D</span><span class="meta">%0A</span>++<span class="keyword">return</span>+<span class="meta">%27hello</span><span class="meta">%27</span><span class="meta">%0D</span><span class="meta">%0Aend</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">hello</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们通过<code>lua_source</code>参数传递了转码后的Lua脚本，通过execute接口获取了最终脚本的执行结果。</p>
                  <p>这里我们更加关心的肯定是如何用Python来实现，上例用Python实现的话，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">lua = <span class="string">'''</span></span><br><span class="line"><span class="string">function main(splash)</span></span><br><span class="line"><span class="string">    return 'hello'</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://localhost:8050/execute?lua_source='</span> + quote(lua)</span><br><span class="line">response = requests.get(url)</span><br><span class="line">print(response.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">hello</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们用Python中的三引号将Lua脚本包括起来，然后用urllib.parse模块里的<code>quote()</code>方法将脚本进行URL转码，随后构造了Splash请求URL，将其作为<code>lua_source</code>参数传递，这样运行结果就会显示Lua脚本执行后的结果。</p>
                  <p>我们再通过实例看一下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">lua = <span class="string">'''</span></span><br><span class="line"><span class="string">function main(splash, args)</span></span><br><span class="line"><span class="string">  local treat = require("treat")</span></span><br><span class="line"><span class="string">  local response = splash:http_get("http://httpbin.org/get")</span></span><br><span class="line"><span class="string">    return &#123;</span></span><br><span class="line"><span class="string">    html=treat.as_string(response.body),</span></span><br><span class="line"><span class="string">    url=response.url,</span></span><br><span class="line"><span class="string">    status=response.status</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://localhost:8050/execute?lua_source='</span> + quote(lua)</span><br><span class="line">response = requests.get(url)</span><br><span class="line">print(response.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight taggerscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;"url": "http://httpbin.org/get", "status": 200, "html": "&#123;<span class="symbol">\n</span>  <span class="symbol">\"</span>args<span class="symbol">\"</span>: &#123;&#125;, <span class="symbol">\n</span>  <span class="symbol">\"</span>headers<span class="symbol">\"</span>: &#123;<span class="symbol">\n</span>    <span class="symbol">\"</span>Accept-Encoding<span class="symbol">\"</span>: <span class="symbol">\"</span>gzip, deflate<span class="symbol">\"</span>, <span class="symbol">\n</span>    <span class="symbol">\"</span>Accept-Language<span class="symbol">\"</span>: <span class="symbol">\"</span>en,*<span class="symbol">\"</span>, <span class="symbol">\n</span>    <span class="symbol">\"</span>Connection<span class="symbol">\"</span>: <span class="symbol">\"</span>close<span class="symbol">\"</span>, <span class="symbol">\n</span>    <span class="symbol">\"</span>Host<span class="symbol">\"</span>: <span class="symbol">\"</span>httpbin.org<span class="symbol">\"</span>, <span class="symbol">\n</span>    <span class="symbol">\"</span>User-Agent<span class="symbol">\"</span>: <span class="symbol">\"</span>Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/602.1 (KHTML, like Gecko) splash Version/9.0 Safari/602.1<span class="symbol">\"</span><span class="symbol">\n</span>  &#125;, <span class="symbol">\n</span>  <span class="symbol">\"</span>origin<span class="symbol">\"</span>: <span class="symbol">\"</span>60.207.237.85<span class="symbol">\"</span>, <span class="symbol">\n</span>  <span class="symbol">\"</span>url<span class="symbol">\"</span>: <span class="symbol">\"</span>http://httpbin.org/get<span class="symbol">\"</span><span class="symbol">\n</span>&#125;<span class="symbol">\n</span>"&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，返回结果是JSON形式，我们成功获取了请求的URL、状态码和网页源代码。</p>
                  <p>如此一来，我们之前所说的Lua脚本均可以用此方式与Python进行对接，所有网页的动态渲染、模拟点击、表单提交、页面滑动、延时等待后的一些结果均可以自由控制，获取页面源码和截图也都不在话下。</p>
                  <p>到现在为止，我们可以用Python和Splash实现JavaScript渲染的页面的抓取了。除了Selenium，本节所说的Splash同样可以做到非常强大的渲染功能，同时它也不需要浏览器即可渲染，使用非常方便。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-31 20:41:33" itemprop="dateCreated datePublished" datetime="2018-01-31T20:41:33+08:00">2018-01-31</time>
                </span>
                <span id="/5638.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 7.2-Splash的使用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>22k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>20 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5630.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5630.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 7.1-Selenium的使用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>Selenium是一个自动化测试工具，利用它可以驱动浏览器执行特定的动作，如点击、下拉等操作，同时还可以获取浏览器当前呈现的页面的源代码，做到可见即可爬。对于一些JavaScript动态渲染的页面来说，此种抓取方式非常有效。本节中，就让我们来感受一下它的强大之处吧。</p>
                  <h2 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h2>
                  <p>本节以Chrome为例来讲解Selenium的用法。在开始之前，请确保已经正确安装好了Chrome浏览器并配置好了ChromeDriver。另外，还需要正确安装好Python的Selenium库，详细的安装和配置过程可以参考第1章。</p>
                  <h2 id="2-基本使用"><a href="#2-基本使用" class="headerlink" title="2. 基本使用"></a>2. 基本使用</h2>
                  <p>准备工作做好之后，首先来大体看一下Selenium有一些怎样的功能。示例如下：</p>
                  <figure class="highlight sas">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">from</span> selenium import webdriver</span><br><span class="line"><span class="meta">from</span> selenium.webdriver.common.<span class="meta">by</span> import <span class="meta">By</span></span><br><span class="line"><span class="meta">from</span> selenium.webdriver.common.keys import Keys</span><br><span class="line"><span class="meta">from</span> selenium.webdriver.support import expected_conditions <span class="meta">as</span> EC</span><br><span class="line"><span class="meta">from</span> selenium.webdriver.support.wait import WebDriverWait</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">try:</span><br><span class="line">    browser.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">    <span class="meta">input</span> = browser.find_element_by_id(<span class="string">'kw'</span>)</span><br><span class="line">    <span class="meta">input</span>.send_keys(<span class="string">'Python'</span>)</span><br><span class="line">    <span class="meta">input</span>.send_keys(Keys.ENTER)</span><br><span class="line">    wait = WebDriverWait(browser, 10)</span><br><span class="line">    wait.<span class="meta">until</span>(EC.presence_of_element_located((<span class="meta">By</span>.ID, <span class="string">'content_left'</span>)))</span><br><span class="line">    p<span class="meta">rint(</span>browser.current_url)</span><br><span class="line">    p<span class="meta">rint(</span>browser.get_cookies())</span><br><span class="line">    p<span class="meta">rint(</span>browser.page_source)</span><br><span class="line">finally:</span><br><span class="line">    browser<span class="meta">.close(</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行代码后发现，会自动弹出一个Chrome浏览器。浏览器首先会跳转到百度，然后在搜索框中输入Python，接着跳转到搜索结果页，如图7-1所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-1.png" alt="">图7-1 运行结果</p>
                  <p>搜索结果加载出来后，控制台分别会输出当前的URL、当前的Cookies和网页源代码：</p>
                  <figure class="highlight sas">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">https://www.baidu.com/s?ie=utf-8<span class="variable">&amp;f</span>=8<span class="variable">&amp;rsv_bp</span>=0<span class="variable">&amp;rsv_idx</span>=1<span class="variable">&amp;tn</span>=baidu<span class="variable">&amp;wd</span>=Python<span class="variable">&amp;rsv_pq</span>=c94d0df9000a72d0<span class="variable">&amp;rsv_t</span>=07099xvun1ZmC0bf6eQvygJ43IUTTUOl5FCJVPgwG2YREs70GplJjH2F%2BCQ<span class="variable">&amp;rqlang</span>=cn<span class="variable">&amp;rsv_enter</span>=1<span class="variable">&amp;rsv_sug3</span>=6<span class="variable">&amp;rsv_sug2</span>=0<span class="variable">&amp;inputT</span>=87<span class="variable">&amp;rsv_sug4</span>=87</span><br><span class="line">[&#123;<span class="string">'secure'</span>: False, <span class="string">'value'</span>: <span class="string">'B490B5EBF6F3CD402E515D22BCDA1598'</span>, <span class="string">'domain'</span>: <span class="string">'.baidu.com'</span>, <span class="string">'path'</span>: <span class="string">'/'</span>, <span class="string">'httpOnly'</span>: False, <span class="string">'name'</span>: <span class="string">'BDORZ'</span>, <span class="string">'expiry'</span>: 1491688071.707553&#125;, &#123;<span class="string">'secure'</span>: False, <span class="string">'value'</span>: <span class="string">'22473_1441_21084_17001'</span>, <span class="string">'domain'</span>: <span class="string">'.baidu.com'</span>, <span class="string">'path'</span>: <span class="string">'/'</span>, <span class="string">'httpOnly'</span>: False, <span class="string">'name'</span>: <span class="string">'H_PS_PSSID'</span>&#125;, &#123;<span class="string">'secure'</span>: False, <span class="string">'value'</span>: <span class="string">'12883875381399993259_00_0_I_R_2_0303_C02F_N_I_I_0'</span>, <span class="string">'domain'</span>: <span class="string">'.www.baidu.com'</span>, <span class="string">'path'</span>: <span class="string">'/'</span>, <span class="string">'httpOnly'</span>: False, <span class="string">'name'</span>: <span class="string">'__bsi'</span>, <span class="string">'expiry'</span>: 1491601676.69722&#125;]</span><br><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;...&lt;/html&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>源代码过长，在此省略。可以看到，我们得到的当前URL、Cookies和源代码都是浏览器中的真实内容。</p>
                  <p>所以说，如果用Selenium来驱动浏览器加载网页的话，就可以直接拿到JavaScript渲染的结果了，不用担心使用的是什么加密系统。</p>
                  <p>下面来详细了解一下Selenium的用法。</p>
                  <h2 id="3-声明浏览器对象"><a href="#3-声明浏览器对象" class="headerlink" title="3. 声明浏览器对象"></a>3. 声明浏览器对象</h2>
                  <p>Selenium支持非常多的浏览器，如Chrome、Firefox、Edge等，还有Android、BlackBerry等手机端的浏览器。另外，也支持无界面浏览器PhantomJS。</p>
                  <p>此外，我们可以用如下方式初始化：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">from</span> <span class="keyword">selenium </span><span class="meta">import</span> webdriver</span><br><span class="line"></span><br><span class="line"><span class="keyword">browser </span>= webdriver.Chrome()</span><br><span class="line"><span class="keyword">browser </span>= webdriver.Firefox()</span><br><span class="line"><span class="keyword">browser </span>= webdriver.Edge()</span><br><span class="line"><span class="keyword">browser </span>= webdriver.PhantomJS()</span><br><span class="line"><span class="keyword">browser </span>= webdriver.Safari()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就完成了浏览器对象的初始化并将其赋值为<code>browser</code>对象。接下来，我们要做的就是调用<code>browser</code>对象，让其执行各个动作以模拟浏览器操作。</p>
                  <h2 id="4-访问页面"><a href="#4-访问页面" class="headerlink" title="4. 访问页面"></a>4. 访问页面</h2>
                  <p>我们可以用<code>get()</code>方法来请求网页，参数传入链接URL即可。比如，这里用<code>get()</code>方法访问淘宝，然后打印出源代码，代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium import webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.<span class="builtin-name">get</span>(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(browser.page_source)</span><br><span class="line">browser.close()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行后发现，弹出了Chrome浏览器并且自动访问了淘宝，然后控制台输出了淘宝页面的源代码，随后浏览器关闭。</p>
                  <p>通过这几行简单的代码，我们可以实现浏览器的驱动并获取网页源码，非常便捷。</p>
                  <h2 id="5-查找节点"><a href="#5-查找节点" class="headerlink" title="5. 查找节点"></a>5. 查找节点</h2>
                  <p>Selenium可以驱动浏览器完成各种操作，比如填充表单、模拟点击等。比如，我们想要完成向某个输入框输入文字的操作，总需要知道这个输入框在哪里吧？而Selenium提供了一系列查找节点的方法，我们可以用这些方法来获取想要的节点，以便下一步执行一些动作或者提取信息。</p>
                  <h3 id="单个节点"><a href="#单个节点" class="headerlink" title="单个节点"></a>单个节点</h3>
                  <p>比如，想要从淘宝页面中提取搜索框这个节点，首先要观察它的源代码，如图7-2所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-2.png" alt="">图7-2 源代码</p>
                  <p>可以发现，它的<code>id</code>是<code>q</code>，<code>name</code>也是<code>q</code>。此外，还有许多其他属性，此时我们就可以用多种方式获取它了。比如，<code>find_element_by_name()</code>是根据<code>name</code>值获取，<code>find_element_by_id()</code>是根据<code>id</code>获取。另外，还有根据XPath、CSS选择器等获取的方式。</p>
                  <p>我们用代码实现一下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from selenium import webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.<span class="constructor">Chrome()</span></span><br><span class="line">browser.get('https:<span class="comment">//www.taobao.com')</span></span><br><span class="line">input_first = browser.find<span class="constructor">_element_by_id('<span class="params">q</span>')</span></span><br><span class="line">input_second = browser.find<span class="constructor">_element_by_css_selector('#<span class="params">q</span>')</span></span><br><span class="line">input_third = browser.find<span class="constructor">_element_by_xpath('<span class="operator">/</span><span class="operator">/</span><span class="operator">*</span>[@<span class="params">id</span>=<span class="string">"q"</span>]')</span></span><br><span class="line">print(input_first, input_second, input_third)</span><br><span class="line">browser.close<span class="literal">()</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们使用3种方式获取输入框，分别是根据ID、CSS选择器和XPath获取，它们返回的结果完全一致。运行结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;selenium.webdriver.remote.webelement.WebElement (<span class="attribute">session</span>=<span class="string">"5e53d9e1c8646e44c14c1c2880d424af"</span>, <span class="attribute">element</span>=<span class="string">"0.5649563096161541-1"</span>)&gt; </span><br><span class="line">&lt;selenium.webdriver.remote.webelement.WebElement (<span class="attribute">session</span>=<span class="string">"5e53d9e1c8646e44c14c1c2880d424af"</span>, <span class="attribute">element</span>=<span class="string">"0.5649563096161541-1"</span>)&gt; </span><br><span class="line">&lt;selenium.webdriver.remote.webelement.WebElement (<span class="attribute">session</span>=<span class="string">"5e53d9e1c8646e44c14c1c2880d424af"</span>, <span class="attribute">element</span>=<span class="string">"0.5649563096161541-1"</span>)&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这3个节点都是<code>WebElement</code>类型，是完全一致的。</p>
                  <p>这里列出所有获取单个节点的方法：</p>
                  <figure class="highlight ceylon">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_</span>id</span><br><span class="line">find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_n</span>ame</span><br><span class="line">find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_</span>xpath</span><br><span class="line">find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_</span>link<span class="number">_</span>text</span><br><span class="line">find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_p</span>artial<span class="number">_</span>link<span class="number">_</span>text</span><br><span class="line">find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_</span>tag<span class="number">_n</span>ame</span><br><span class="line">find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_</span><span class="keyword">class</span><span class="number">_n</span>ame</span><br><span class="line">find<span class="number">_</span>element<span class="number">_</span><span class="meta">by</span><span class="number">_</span>css<span class="number">_</span>selector</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外，Selenium还提供了通用方法<code>find_element()</code>，它需要传入两个参数：查找方式<code>By</code>和值。实际上，它就是<code>find_element_by_id()</code>这种方法的通用函数版本，比如<code>find_element_by_id(id)</code>就等价于<code>find_element(By.ID, id)</code>，二者得到的结果完全一致。我们用代码实现一下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.<span class="keyword">by</span> <span class="keyword">import</span> <span class="keyword">By</span></span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.<span class="keyword">get</span>(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">input_first = browser.find_element(<span class="keyword">By</span>.ID, <span class="string">'q'</span>)</span><br><span class="line">print(input_first)</span><br><span class="line">browser.<span class="keyword">close</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>实际上，这种查找方式的功能和上面列举的查找函数完全一致，不过参数更加灵活。</p>
                  <h3 id="多个节点"><a href="#多个节点" class="headerlink" title="多个节点"></a>多个节点</h3>
                  <p>如果查找的目标在网页中只有一个，那么完全可以用<code>find_element()</code>方法。但如果有多个节点，再用<code>find_element()</code>方法查找，就只能得到第一个节点了。如果要查找所有满足条件的节点，需要用<code>find_elements()</code>这样的方法。注意，在这个方法的名称中，element多了一个s，注意区分。</p>
                  <p>比如，要查找淘宝左侧导航条的所有条目，如图7-3所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-3.jpg" alt="">图7-3 导航栏</p>
                  <p>就可以这样来实现：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium import webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.<span class="builtin-name">get</span>(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">lis = browser.find_elements_by_css_selector(<span class="string">'.service-bd li'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(lis)</span><br><span class="line">browser.close()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[&lt;selenium<span class="selector-class">.webdriver</span><span class="selector-class">.remote</span><span class="selector-class">.webelement</span><span class="selector-class">.WebElement</span> (session=<span class="string">"c26290835d4457ebf7d96bfab3740d19"</span>, element=<span class="string">"0.09221044033125603-1"</span>)&gt;, &lt;selenium<span class="selector-class">.webdriver</span><span class="selector-class">.remote</span><span class="selector-class">.webelement</span><span class="selector-class">.WebElement</span> (session=<span class="string">"c26290835d4457ebf7d96bfab3740d19"</span>, element=<span class="string">"0.09221044033125603-2"</span>)&gt;, &lt;selenium<span class="selector-class">.webdriver</span><span class="selector-class">.remote</span><span class="selector-class">.webelement</span><span class="selector-class">.WebElement</span> (session=<span class="string">"c26290835d4457ebf7d96bfab3740d19"</span>, element=<span class="string">"0.09221044033125603-3"</span>)&gt;...&lt;selenium<span class="selector-class">.webdriver</span><span class="selector-class">.remote</span><span class="selector-class">.webelement</span><span class="selector-class">.WebElement</span> (session=<span class="string">"c26290835d4457ebf7d96bfab3740d19"</span>, element=<span class="string">"0.09221044033125603-16"</span>)&gt;]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里简化了输出结果，中间部分省略。</p>
                  <p>可以看到，得到的内容变成了列表类型，列表中的每个节点都是<code>WebElement</code>类型。</p>
                  <p>也就是说，如果我们用<code>find_element()</code>方法，只能获取匹配的第一个节点，结果是<code>WebElement</code>类型。如果用<code>find_elements()</code>方法，则结果是列表类型，列表中的每个节点是<code>WebElement</code>类型。</p>
                  <p>这里列出所有获取多个节点的方法：</p>
                  <figure class="highlight ceylon">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">find<span class="number">_</span>elements<span class="number">_</span><span class="meta">by</span><span class="number">_</span>id</span><br><span class="line">find<span class="number">_</span>elements<span class="number">_</span><span class="meta">by</span><span class="number">_n</span>ame</span><br><span class="line">find<span class="number">_</span>elements<span class="number">_</span><span class="meta">by</span><span class="number">_</span>xpath</span><br><span class="line">find<span class="number">_</span>elements<span class="number">_</span><span class="meta">by</span><span class="number">_</span>link<span class="number">_</span>text</span><br><span class="line">find<span class="number">_</span>elements<span class="number">_</span><span class="meta">by</span><span class="number">_p</span>artial<span class="number">_</span>link<span class="number">_</span>text</span><br><span class="line">find<span class="number">_</span>elements<span class="number">_</span><span class="meta">by</span><span class="number">_</span>tag<span class="number">_n</span>ame</span><br><span class="line">find<span class="number">_</span>elements<span class="number">_</span><span class="meta">by</span><span class="number">_</span><span class="keyword">class</span><span class="number">_n</span>ame</span><br><span class="line">find<span class="number">_</span>elements<span class="number">_</span><span class="meta">by</span><span class="number">_</span>css<span class="number">_</span>selector</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然，我们也可以直接用<code>find_elements()</code>方法来选择，这时可以这样写：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">lis = browser.find<span class="constructor">_elements(By.CSS_SELECTOR, '.<span class="params">service</span>-<span class="params">bd</span> <span class="params">li</span>')</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果是完全一致的。</p>
                  <h2 id="6-节点交互"><a href="#6-节点交互" class="headerlink" title="6. 节点交互"></a>6. 节点交互</h2>
                  <p>Selenium可以驱动浏览器来执行一些操作，也就是说可以让浏览器模拟执行一些动作。比较常见的用法有：输入文字时用<code>send_keys()</code>方法，清空文字时用<code>clear()</code>方法，点击按钮时用<code>click()</code>方法。示例如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.<span class="keyword">get</span>(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">input = browser.find_element_by_id(<span class="string">'q'</span>)</span><br><span class="line"><span class="keyword">input</span>.send_keys(<span class="string">'iPhone'</span>)</span><br><span class="line"><span class="type">time</span>.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">input</span>.clear()</span><br><span class="line"><span class="keyword">input</span>.send_keys(<span class="string">'iPad'</span>)</span><br><span class="line">button = browser.find_element_by_class_name(<span class="string">'btn-search'</span>)</span><br><span class="line">button.click()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先驱动浏览器打开淘宝，然后用<code>find_element_by_id()</code>方法获取输入框，然后用<code>send_keys()</code>方法输入iPhone文字，等待一秒后用<code>clear()</code>方法清空输入框，再次调用<code>send_keys()</code>方法输入iPad文字，之后再用<code>find_element_by_class_name()</code>方法获取搜索按钮，最后调用<code>click()</code>方法完成搜索动作。</p>
                  <p>通过上面的方法，我们就完成了一些常见节点的动作操作，更多的操作可以参见官方文档的交互动作介绍：<span class="exturl" data-url="aHR0cDovL3NlbGVuaXVtLXB5dGhvbi5yZWFkdGhlZG9jcy5pby9hcGkuaHRtbCNtb2R1bGUtc2VsZW5pdW0ud2ViZHJpdmVyLnJlbW90ZS53ZWJlbGVtZW50">http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.remote.webelement<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="7-动作链"><a href="#7-动作链" class="headerlink" title="7. 动作链"></a>7. 动作链</h2>
                  <p>在上面的实例中，一些交互动作都是针对某个节点执行的。比如，对于输入框，我们就调用它的输入文字和清空文字方法；对于按钮，就调用它的点击方法。其实，还有另外一些操作，它们没有特定的执行对象，比如鼠标拖曳、键盘按键等，这些动作用另一种方式来执行，那就是动作链。</p>
                  <p>比如，现在实现一个节点的拖曳操作，将某个节点从一处拖曳到另外一处，可以这样实现：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">url = <span class="string">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span></span><br><span class="line">browser.<span class="keyword">get</span>(url)</span><br><span class="line">browser.switch_to.frame(<span class="string">'iframeResult'</span>)</span><br><span class="line">source = browser.find_element_by_css_selector(<span class="string">'#draggable'</span>)</span><br><span class="line">target = browser.find_element_by_css_selector(<span class="string">'#droppable'</span>)</span><br><span class="line">actions = ActionChains(browser)</span><br><span class="line">actions.drag_and_drop(source, target)</span><br><span class="line">actions.<span class="keyword">perform</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先，打开网页中的一个拖曳实例，然后依次选中要拖曳的节点和拖曳到的目标节点，接着声明<code>ActionChains</code>对象并将其赋值为<code>actions</code>变量，然后通过调用<code>actions</code>变量的<code>drag_and_drop()</code>方法，再调用<code>perform()</code>方法执行动作，此时就完成了拖曳操作，如图7-4和图7-5所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-4.jpg" alt="">图7-4 拖曳前的页面</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/7-5.jpg" alt="">图7-5 拖曳后的页面</p>
                  <p>更多的动作链操作可以参考官方文档：<span class="exturl" data-url="aHR0cDovL3NlbGVuaXVtLXB5dGhvbi5yZWFkdGhlZG9jcy5pby9hcGkuaHRtbCNtb2R1bGUtc2VsZW5pdW0ud2ViZHJpdmVyLmNvbW1vbi5hY3Rpb25fY2hhaW5z">http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.common.action_chains<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="8-执行JavaScript"><a href="#8-执行JavaScript" class="headerlink" title="8. 执行JavaScript"></a>8. 执行JavaScript</h2>
                  <p>对于某些操作，Selenium API并没有提供。比如，下拉进度条，它可以直接模拟运行JavaScript，此时使用<code>execute_script()</code>方法即可实现，代码如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from selenium import webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.<span class="constructor">Chrome()</span></span><br><span class="line">browser.get('https:<span class="comment">//www.zhihu.com/explore')</span></span><br><span class="line">browser.execute<span class="constructor">_script('<span class="params">window</span>.<span class="params">scrollTo</span>(0, <span class="params">document</span>.<span class="params">body</span>.<span class="params">scrollHeight</span>)</span>')</span><br><span class="line">browser.execute<span class="constructor">_script('<span class="params">alert</span>(<span class="string">"To Bottom"</span>)</span>')</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里就利用<code>execute_script()</code>方法将进度条下拉到最底部，然后弹出alert提示框。</p>
                  <p>所以说有了这个方法，基本上API没有提供的所有功能都可以用执行JavaScript的方式来实现了。</p>
                  <h2 id="9-获取节点信息"><a href="#9-获取节点信息" class="headerlink" title="9. 获取节点信息"></a>9. 获取节点信息</h2>
                  <p>前面说过，通过<code>page_source</code>属性可以获取网页的源代码，接着就可以使用解析库（如正则表达式、Beautiful Soup、pyquery等）来提取信息了。</p>
                  <p>不过，既然Selenium已经提供了选择节点的方法，返回的是<code>WebElement</code>类型，那么它也有相关的方法和属性来直接提取节点信息，如属性、文本等。这样的话，我们就可以不用通过解析源代码来提取信息了，非常方便。</p>
                  <p>接下来，就看看通过怎样的方式来获取节点信息吧。</p>
                  <h3 id="获取属性"><a href="#获取属性" class="headerlink" title="获取属性"></a>获取属性</h3>
                  <p>我们可以使用<code>get_attribute()</code>方法来获取节点的属性，但是其前提是先选中这个节点，示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium import webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver import ActionChains</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">url = <span class="string">'https://www.zhihu.com/explore'</span></span><br><span class="line">browser.<span class="builtin-name">get</span>(url)</span><br><span class="line">logo = browser.find_element_by_id(<span class="string">'zh-top-link-logo'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(logo)</span><br><span class="line"><span class="builtin-name">print</span>(logo.get_attribute(<span class="string">'class'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行之后，程序便会驱动浏览器打开知乎页面，然后获取知乎的logo节点，最后打印出它的<code>class</code>。</p>
                  <p>控制台的输出结果如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;selenium<span class="selector-class">.webdriver</span><span class="selector-class">.remote</span><span class="selector-class">.webelement</span><span class="selector-class">.WebElement</span> (session=<span class="string">"e08c0f28d7f44d75ccd50df6bb676104"</span>, element=<span class="string">"0.7236390660048155-1"</span>)&gt;</span><br><span class="line">zu-<span class="attribute">top</span>-link-logo</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过<code>get_attribute()</code>方法，然后传入想要获取的属性名，就可以得到它的值了。</p>
                  <h3 id="获取文本值"><a href="#获取文本值" class="headerlink" title="获取文本值"></a>获取文本值</h3>
                  <p>每个<code>WebElement</code>节点都有<code>text</code>属性，直接调用这个属性就可以得到节点内部的文本信息，这相当于Beautiful Soup的<code>get_text()</code>方法、pyquery的<code>text()</code>方法，示例如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">url = <span class="string">'https://www.zhihu.com/explore'</span></span><br><span class="line">browser.<span class="keyword">get</span>(url)</span><br><span class="line">input = browser.find_element_by_class_name(<span class="string">'zu-top-add-question'</span>)</span><br><span class="line">print(<span class="keyword">input</span>.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里依然先打开知乎页面，然后获取“提问”按钮这个节点，再将其文本值打印出来。</p>
                  <p>控制台的输出结果如下：</p>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">提问</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="获取id、位置、标签名和大小"><a href="#获取id、位置、标签名和大小" class="headerlink" title="获取id、位置、标签名和大小"></a>获取id、位置、标签名和大小</h3>
                  <p>另外，<code>WebElement</code>节点还有一些其他属性，比如<code>id</code>属性可以获取节点<code>id</code>，<code>location</code>属性可以获取该节点在页面中的相对位置，<code>tag_name</code>属性可以获取标签名称，<code>size</code>属性可以获取节点的大小，也就是宽高，这些属性有时候还是很有用的。示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"> from selenium import webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">url = <span class="string">'https://www.zhihu.com/explore'</span></span><br><span class="line">browser.get(url)</span><br><span class="line"><span class="selector-tag">input</span> = browser.find_element_by_class_name(<span class="string">'zu-top-add-question'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(input.id)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(input.location)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(input.tag_name)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(input.size)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先获得“提问”按钮这个节点，然后调用其<code>id</code>、<code>location</code>、<code>tag_name</code>、<code>size</code>属性来获取对应的属性值。</p>
                  <h2 id="10-切换Frame"><a href="#10-切换Frame" class="headerlink" title="10. 切换Frame"></a>10. 切换Frame</h2>
                  <p>我们知道网页中有一种节点叫作iframe，也就是子Frame，相当于页面的子页面，它的结构和外部网页的结构完全一致。Selenium打开页面后，它默认是在父级Frame里面操作，而此时如果页面中还有子Frame，它是不能获取到子Frame里面的节点的。这时就需要使用<code>switch_to.frame()</code>方法来切换Frame。示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import time</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from selenium<span class="selector-class">.common</span><span class="selector-class">.exceptions</span> import NoSuchElementException</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">url = <span class="string">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span></span><br><span class="line">browser.get(url)</span><br><span class="line">browser<span class="selector-class">.switch_to</span>.frame(<span class="string">'iframeResult'</span>)</span><br><span class="line">try:</span><br><span class="line">    logo = browser.find_element_by_class_name(<span class="string">'logo'</span>)</span><br><span class="line">except NoSuchElementException:</span><br><span class="line">    print(<span class="string">'NO LOGO'</span>)</span><br><span class="line">browser<span class="selector-class">.switch_to</span>.parent_frame()</span><br><span class="line">logo = browser.find_element_by_class_name(<span class="string">'logo'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(logo)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(logo.text)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>控制台的输出如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="literal">NO</span> LOGO</span><br><span class="line">&lt;selenium.webdriver.remote.webelement.WebElement (<span class="attribute">session</span>=<span class="string">"4bb8ac03ced4ecbdefef03ffdc0e4ccd"</span>, <span class="attribute">element</span>=<span class="string">"0.13792611320464965-2"</span>)&gt;</span><br><span class="line">RUNOOB.COM</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里还是以前面演示动作链操作的网页为实例，首先通过<code>switch_to.frame()</code>方法切换到子Frame里面，然后尝试获取父级Frame里的logo节点（这是不能找到的），如果找不到的话，就会抛出<code>NoSuchElementException</code>异常，异常被捕捉之后，就会输出<code>NO LOGO</code>。接下来，重新切换回父级Frame，然后再次重新获取节点，发现此时可以成功获取了。</p>
                  <p>所以，当页面中包含子Frame时，如果想获取子Frame中的节点，需要先调用<code>switch_to.frame()</code>方法切换到对应的Frame，然后再进行操作。</p>
                  <h2 id="11-延时等待"><a href="#11-延时等待" class="headerlink" title="11. 延时等待"></a>11. 延时等待</h2>
                  <p>在Selenium中，<code>get()</code>方法会在网页框架加载结束后结束执行，此时如果获取<code>page_source</code>，可能并不是浏览器完全加载完成的页面，如果某些页面有额外的Ajax请求，我们在网页源代码中也不一定能成功获取到。所以，这里需要延时等待一定时间，确保节点已经加载出来。</p>
                  <p>这里等待的方式有两种：一种是隐式等待，一种是显式等待。</p>
                  <h3 id="隐式等待"><a href="#隐式等待" class="headerlink" title="隐式等待"></a>隐式等待</h3>
                  <p>当使用隐式等待执行测试的时候，如果Selenium没有在DOM中找到节点，将继续等待，超出设定时间后，则抛出找不到节点的异常。换句话说，当查找节点而节点并没有立即出现的时候，隐式等待将等待一段时间再查找DOM，默认的时间是0。示例如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from selenium import webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.<span class="constructor">Chrome()</span></span><br><span class="line">browser.implicitly<span class="constructor">_wait(10)</span></span><br><span class="line">browser.get('https:<span class="comment">//www.zhihu.com/explore')</span></span><br><span class="line">input = browser.find<span class="constructor">_element_by_class_name('<span class="params">zu</span>-<span class="params">top</span>-<span class="params">add</span>-<span class="params">question</span>')</span></span><br><span class="line">print(input)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们用<code>implicitly_wait()</code>方法实现了隐式等待。</p>
                  <h3 id="显式等待"><a href="#显式等待" class="headerlink" title="显式等待"></a>显式等待</h3>
                  <p>隐式等待的效果其实并没有那么好，因为我们只规定了一个固定时间，而页面的加载时间会受到网络条件的影响。</p>
                  <p>这里还有一种更合适的显式等待方法，它指定要查找的节点，然后指定一个最长等待时间。如果在规定时间内加载出来了这个节点，就返回查找的节点；如果到了规定时间依然没有加载出该节点，则抛出超时异常。示例如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.<span class="keyword">by</span> <span class="keyword">import</span> <span class="keyword">By</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.<span class="keyword">get</span>(<span class="string">'https://www.taobao.com/'</span>)</span><br><span class="line">wait = WebDriverWait(browser, <span class="number">10</span>)</span><br><span class="line">input = wait.<span class="keyword">until</span>(EC.presence_of_element_located((<span class="keyword">By</span>.ID, <span class="string">'q'</span>)))</span><br><span class="line">button = wait.<span class="keyword">until</span>(EC.element_to_be_clickable((<span class="keyword">By</span>.CSS_SELECTOR, <span class="string">'.btn-search'</span>)))</span><br><span class="line">print(<span class="keyword">input</span>, button)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先引入<code>WebDriverWait</code>这个对象，指定最长等待时间，然后调用它的<code>until()</code>方法，传入要等待条件<code>expected_conditions</code>。比如，这里传入了<code>presence_of_element_located</code>这个条件，代表节点出现的意思，其参数是节点的定位元组，也就是<code>ID</code>为<code>q</code>的节点搜索框。</p>
                  <p>这样可以做到的效果就是，在10秒内如果<code>ID</code>为<code>q</code>的节点（即搜索框）成功加载出来，就返回该节点；如果超过10秒还没有加载出来，就抛出异常。</p>
                  <p>对于按钮，可以更改一下等待条件，比如改为<code>element_to_be_clickable</code>，也就是可点击，所以查找按钮时查找CSS选择器为.btn-search的按钮，如果10秒内它是可点击的，也就是成功加载出来了，就返回这个按钮节点；如果超过10秒还不可点击，也就是没有加载出来，就抛出异常。</p>
                  <p>运行代码，在网速较佳的情况下是可以成功加载出来的。</p>
                  <p>控制台的输出如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;selenium.webdriver.remote.webelement.WebElement (<span class="attribute">session</span>=<span class="string">"07dd2fbc2d5b1ce40e82b9754aba8fa8"</span>, <span class="attribute">element</span>=<span class="string">"0.5642646294074107-1"</span>)&gt;</span><br><span class="line">&lt;selenium.webdriver.remote.webelement.WebElement (<span class="attribute">session</span>=<span class="string">"07dd2fbc2d5b1ce40e82b9754aba8fa8"</span>, <span class="attribute">element</span>=<span class="string">"0.5642646294074107-2"</span>)&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，控制台成功输出了两个节点，它们都是<code>WebElement</code>类型。</p>
                  <p>如果网络有问题，10秒内没有成功加载，那就抛出<code>TimeoutException</code>异常，此时控制台的输出如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">TimeoutException Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-<span class="number">4</span>-f3d73973b223&gt; <span class="keyword">in</span> &lt;<span class="keyword">module</span>&gt;<span class="literal">()</span></span><br><span class="line">      <span class="number">7</span> browser.get('https:<span class="comment">//www.taobao.com/')</span></span><br><span class="line">      <span class="number">8</span> wait = <span class="constructor">WebDriverWait(<span class="params">browser</span>, 10)</span></span><br><span class="line">----&gt; <span class="number">9</span> input = wait.until(<span class="module-access"><span class="module"><span class="identifier">EC</span>.</span></span>presence<span class="constructor">_of_element_located((By.ID, '<span class="params">q</span>')</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>关于等待条件，其实还有很多，比如判断标题内容，判断某个节点内是否出现了某文字等。表7-1列出了所有的等待条件。</p>
                  <p>表7-1 等待条件及其含义</p>
                  <p>等待条件</p>
                  <p>含义</p>
                  <p><code>title_is</code></p>
                  <p>标题是某内容</p>
                  <p><code>title_contains</code></p>
                  <p>标题包含某内容</p>
                  <p><code>presence_of_element_located</code></p>
                  <p>节点加载出来，传入定位元组，如<code>(By.ID, &#39;p&#39;)</code></p>
                  <p><code>visibility_of_element_located</code></p>
                  <p>节点可见，传入定位元组</p>
                  <p><code>visibility_of</code></p>
                  <p>可见，传入节点对象</p>
                  <p><code>presence_of_all_elements_located</code></p>
                  <p>所有节点加载出来</p>
                  <p><code>text_to_be_present_in_element</code></p>
                  <p>某个节点文本包含某文字</p>
                  <p><code>text_to_be_present_in_element_value</code></p>
                  <p>某个节点值包含某文字</p>
                  <p><code>frame_to_be_available_and_switch_to_it</code></p>
                  <p>加载并切换</p>
                  <p><code>invisibility_of_element_located</code></p>
                  <p>节点不可见</p>
                  <p><code>element_to_be_clickable</code></p>
                  <p>节点可点击</p>
                  <p><code>staleness_of</code></p>
                  <p>判断一个节点是否仍在DOM，可判断页面是否已经刷新</p>
                  <p><code>element_to_be_selected</code></p>
                  <p>节点可选择，传节点对象</p>
                  <p><code>element_located_to_be_selected</code></p>
                  <p>节点可选择，传入定位元组</p>
                  <p><code>element_selection_state_to_be</code></p>
                  <p>传入节点对象以及状态，相等返回<code>True</code>，否则返回<code>False</code></p>
                  <p><code>element_located_selection_state_to_be</code></p>
                  <p>传入定位元组以及状态，相等返回<code>True</code>，否则返回<code>False</code></p>
                  <p><code>alert_is_present</code></p>
                  <p>是否出现警告</p>
                  <p>关于更多等待条件的参数及用法，可以参考官方文档：<span class="exturl" data-url="aHR0cDovL3NlbGVuaXVtLXB5dGhvbi5yZWFkdGhlZG9jcy5pby9hcGkuaHRtbCNtb2R1bGUtc2VsZW5pdW0ud2ViZHJpdmVyLnN1cHBvcnQuZXhwZWN0ZWRfY29uZGl0aW9ucw==">http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.support.expected_conditions<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="12-前进和后退"><a href="#12-前进和后退" class="headerlink" title="12. 前进和后退"></a>12. 前进和后退</h2>
                  <p>平常使用浏览器时都有前进和后退功能，Selenium也可以完成这个操作，它使用<code>back()</code>方法后退，使用<code>forward()</code>方法前进。示例如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.<span class="keyword">get</span>(<span class="string">'https://www.baidu.com/'</span>)</span><br><span class="line">browser.<span class="keyword">get</span>(<span class="string">'https://www.taobao.com/'</span>)</span><br><span class="line">browser.<span class="keyword">get</span>(<span class="string">'https://www.python.org/'</span>)</span><br><span class="line">browser.back()</span><br><span class="line"><span class="type">time</span>.sleep(<span class="number">1</span>)</span><br><span class="line">browser.forward()</span><br><span class="line">browser.<span class="keyword">close</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们连续访问3个页面，然后调用<code>back()</code>方法回到第二个页面，接下来再调用<code>forward()</code>方法又可以前进到第三个页面。</p>
                  <h2 id="13-Cookies"><a href="#13-Cookies" class="headerlink" title="13. Cookies"></a>13. Cookies</h2>
                  <p>使用Selenium，还可以方便地对Cookies进行操作，例如获取、添加、删除Cookies等。示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium import webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.<span class="builtin-name">get</span>(<span class="string">'https://www.zhihu.com/explore'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(browser.get_cookies())</span><br><span class="line">browser.add_cookie(&#123;<span class="string">'name'</span>: <span class="string">'name'</span>, <span class="string">'domain'</span>: <span class="string">'www.zhihu.com'</span>, <span class="string">'value'</span>: <span class="string">'germey'</span>&#125;)</span><br><span class="line"><span class="builtin-name">print</span>(browser.get_cookies())</span><br><span class="line">browser.delete_all_cookies()</span><br><span class="line"><span class="builtin-name">print</span>(browser.get_cookies())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先，我们访问了知乎。加载完成后，浏览器实际上已经生成Cookies了。接着，调用<code>get_cookies()</code>方法获取所有的Cookies。然后，我们添加一个Cookie，这里传入一个字典，有<code>name</code>、<code>domain</code>和<code>value</code>等内容。接下来，再次获取所有的Cookies。可以发现，结果就多了这一项新加的Cookie。最后，调用<code>delete_all_cookies()</code>方法删除所有的Cookies。再重新获取，发现结果就为空了。</p>
                  <p>控制台的输出如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[&#123;<span class="symbol">'secure</span><span class="symbol">':</span> False, <span class="symbol">'value</span><span class="symbol">':</span> '<span class="string">"NGM0ZTM5NDAwMWEyNDQwNDk5ODlkZWY3OTkxY2I0NDY=|1491604091|236e34290a6f407bfbb517888849ea509ac366d0"</span>', <span class="symbol">'domain</span><span class="symbol">':</span> <span class="symbol">'.zhihu.com</span>', <span class="symbol">'path</span><span class="symbol">':</span> <span class="symbol">'/</span>', <span class="symbol">'httpOnly</span><span class="symbol">':</span> False, <span class="symbol">'name</span><span class="symbol">':</span> <span class="symbol">'l_cap_id</span>', <span class="symbol">'expiry</span><span class="symbol">':</span> <span class="number">1494196091.403418</span>&#125;]</span><br><span class="line">[&#123;<span class="symbol">'secure</span><span class="symbol">':</span> False, <span class="symbol">'value</span><span class="symbol">':</span> <span class="symbol">'germey</span>', <span class="symbol">'domain</span><span class="symbol">':</span> <span class="symbol">'.www.zhihu.com</span>', <span class="symbol">'path</span><span class="symbol">':</span> <span class="symbol">'/</span>', <span class="symbol">'httpOnly</span><span class="symbol">':</span> False, <span class="symbol">'name</span><span class="symbol">':</span> <span class="symbol">'name</span>'&#125;, &#123;<span class="symbol">'secure</span><span class="symbol">':</span> False, <span class="symbol">'value</span><span class="symbol">':</span> '<span class="string">"NGM0ZTM5NDAwMWEyNDQwNDk5ODlkZWY3OTkxY2I0NDY=|1491604091|236e34290a6f407bfbb517888849ea509ac366d0"</span>', <span class="symbol">'domain</span><span class="symbol">':</span> <span class="symbol">'.zhihu.com</span>', <span class="symbol">'path</span><span class="symbol">':</span> <span class="symbol">'/</span>', <span class="symbol">'httpOnly</span><span class="symbol">':</span> False, <span class="symbol">'name</span><span class="symbol">':</span> <span class="symbol">'l_cap_id</span>', <span class="symbol">'expiry</span><span class="symbol">':</span> <span class="number">1494196091.403418</span>&#125;]</span><br><span class="line">[]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="14-选项卡管理"><a href="#14-选项卡管理" class="headerlink" title="14. 选项卡管理"></a>14. 选项卡管理</h2>
                  <p>在访问网页的时候，会开启一个个选项卡。在Selenium中，我们也可以对选项卡进行操作。示例如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import time</span><br><span class="line">from selenium import webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.<span class="constructor">Chrome()</span></span><br><span class="line">browser.get('https:<span class="comment">//www.baidu.com')</span></span><br><span class="line">browser.execute<span class="constructor">_script('<span class="params">window</span>.<span class="params">open</span>()</span>')</span><br><span class="line">print(browser.window_handles)</span><br><span class="line">browser.switch<span class="constructor">_to_window(<span class="params">browser</span>.<span class="params">window_handles</span>[1])</span></span><br><span class="line">browser.get('https:<span class="comment">//www.taobao.com')</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">browser.switch<span class="constructor">_to_window(<span class="params">browser</span>.<span class="params">window_handles</span>[0])</span></span><br><span class="line">browser.get('https:<span class="comment">//python.org')</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>控制台的输出如下：</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">['CDwindow<span class="number">-4</span>f58e3a7<span class="number">-7167</span><span class="number">-4587</span>-bedf<span class="number">-9</span>cd8c867f435', 'CDwindow<span class="number">-6e05</span>f076<span class="number">-6</span>d77<span class="number">-453</span>a-a36c<span class="number">-32</span>baacc447df']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先访问了百度，然后调用了<code>execute_script()</code>方法，这里传入<code>window.open()</code>这个JavaScript语句新开启一个选项卡。接下来，我们想切换到该选项卡。这里调用<code>window_handles</code>属性获取当前开启的所有选项卡，返回的是选项卡的代号列表。要想切换选项卡，只需要调用<code>switch_to_window()</code>方法即可，其中参数是选项卡的代号。这里我们将第二个选项卡代号传入，即跳转到第二个选项卡，接下来在第二个选项卡下打开一个新页面，然后切换回第一个选项卡重新调用switch_to_window()方法，再执行其他操作即可。</p>
                  <h2 id="15-异常处理"><a href="#15-异常处理" class="headerlink" title="15. 异常处理"></a>15. 异常处理</h2>
                  <p>在使用Selenium的过程中，难免会遇到一些异常，例如超时、节点未找到等错误，一旦出现此类错误，程序便不会继续运行了。这里我们可以使用<code>try except</code>语句来捕获各种异常。</p>
                  <p>首先，演示一下节点未找到的异常，示例如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.<span class="keyword">get</span>(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">browser.find_element_by_id(<span class="string">'hello'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先打开百度页面，然后尝试选择一个并不存在的节点，此时就会遇到异常。</p>
                  <p>运行之后控制台的输出如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">NoSuchElementException Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>)</span><br><span class="line"><span class="symbol">&lt;ipython-input-23-978945848a1b&gt;</span> in <span class="symbol">&lt;module&gt;</span>()</span><br><span class="line">      <span class="number">3</span> browser = webdriver.Chrome()</span><br><span class="line">      <span class="number">4</span> browser.<span class="built_in">get</span>(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">----&gt; <span class="number">5</span> browser.find_element_by_id(<span class="string">'hello'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这里抛出了<code>NoSuchElementException</code>异常，这通常是节点未找到的异常。为了防止程序遇到异常而中断，我们需要捕获这些异常，示例如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException, NoSuchElementException</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    browser.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"><span class="keyword">except</span> TimeoutException:</span><br><span class="line">    print(<span class="string">'Time Out'</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    browser.find_element_by_id(<span class="string">'hello'</span>)</span><br><span class="line"><span class="keyword">except</span> NoSuchElementException:</span><br><span class="line">    print(<span class="string">'No Element'</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    browser.close()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们使用<code>try except</code>来捕获各类异常。比如，我们对<code>find_element_by_id()</code>查找节点的方法捕获<code>NoSuchElementException</code>异常，这样一旦出现这样的错误，就进行异常处理，程序也不会中断了。</p>
                  <p>控制台的输出如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="literal">No</span> <span class="string">Element</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>关于更多的异常类，可以参考官方文档：<span class="exturl" data-url="aHR0cDovL3NlbGVuaXVtLXB5dGhvbi5yZWFkdGhlZG9jcy5pby9hcGkuaHRtbCNtb2R1bGUtc2VsZW5pdW0uY29tbW9uLmV4Y2VwdGlvbnM=">http://selenium-python.readthedocs.io/api.html#module-selenium.common.exceptions<i class="fa fa-external-link-alt"></i></span>。</p>
                  <p>现在，我们基本对Selenium的常规用法有了大体的了解。使用Selenium，处理JavaScript不再是难事。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-31 20:28:45" itemprop="dateCreated datePublished" datetime="2018-01-31T20:28:45+08:00">2018-01-31</time>
                </span>
                <span id="/5630.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 7.1-Selenium的使用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>17k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>15 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5627.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5627.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 7-动态渲染页面爬取</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在前一章中，我们了解了Ajax的分析和抓取方式，这其实也是JavaScript动态渲染的页面的一种情形，通过直接分析Ajax，我们仍然可以借助requests或urllib来实现数据爬取。</p>
                  <p>不过JavaScript动态渲染的页面不止Ajax这一种。比如中国青年网（详见<span class="exturl" data-url="aHR0cDovL25ld3MueW91dGguY24vZ24v">http://news.youth.cn/gn/<i class="fa fa-external-link-alt"></i></span>），它的分页部分是由JavaScript生成的，并非原始HTML代码，这其中并不包含Ajax请求。比如ECharts的官方实例（详见<span class="exturl" data-url="aHR0cDovL2VjaGFydHMuYmFpZHUuY29tL2RlbW8uaHRtbCNiYXItbmVnYXRpdmU=">http://echarts.baidu.com/demo.html#bar-negative<i class="fa fa-external-link-alt"></i></span>），其图形都是经过JavaScript计算之后生成的。再有淘宝这种页面，它即使是Ajax获取的数据，但是其Ajax接口含有很多加密参数，我们难以直接找出其规律，也很难直接分析Ajax来抓取。</p>
                  <p>为了解决这些问题，我们可以直接使用模拟浏览器运行的方式来实现，这样就可以做到在浏览器中看到是什么样，抓取的源码就是什么样，也就是可见即可爬。这样我们就不用再去管网页内部的JavaScript用了什么算法渲染页面，不用管网页后台的Ajax接口到底有哪些参数。</p>
                  <p>Python提供了许多模拟浏览器运行的库，如Selenium、Splash、PyV8、Ghost等。本章中，我们就来介绍一下Selenium和Splash的用法。有了它们，就不用再为动态渲染的页面发愁了。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-31 20:25:59" itemprop="dateCreated datePublished" datetime="2018-01-31T20:25:59+08:00">2018-01-31</time>
                </span>
                <span id="/5627.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 7-动态渲染页面爬取" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>595</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5616.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5616.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 6.4-分析Ajax爬取今日头条街拍美图</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本节中，我们以今日头条为例来尝试通过分析Ajax请求来抓取网页数据的方法。这次要抓取的目标是今日头条的街拍美图，抓取完成之后，将每组图片分文件夹下载到本地并保存下来。</p>
                  <h2 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h2>
                  <p>在本节开始之前，请确保已经安装好requests库。如果没有安装，可以参考第1章。</p>
                  <h2 id="2-抓取分析"><a href="#2-抓取分析" class="headerlink" title="2. 抓取分析"></a>2. 抓取分析</h2>
                  <p>在抓取之前，首先要分析抓取的逻辑。打开今日头条的首页<span class="exturl" data-url="aHR0cDovL3d3dy50b3V0aWFvLmNvbS8=">http://www.toutiao.com/<i class="fa fa-external-link-alt"></i></span>，如图6-15所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-15.jpg" alt="">图6-15 首页内容</p>
                  <p>右上角有一个搜索入口，这里尝试抓取街拍美图，所以输入“街拍”二字搜索一下，结果如图6-16所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-16.jpg" alt="">图6-16 搜索结果</p>
                  <p>这时打开开发者工具，查看所有的网络请求。首先，打开第一个网络请求，这个请求的URL就是当前的链接<span class="exturl" data-url="aHR0cDovL2VwdWIuaXR1cmluZy5jb20uY24vYXJ0aWNsZS9lZGl0L1todHRwOi8vd3d3LnRvdXRpYW8uY29tL3NlYXJjaC8/a2V5d29yZD0lRTglQTElOTclRTYlOEIlOERd">http://www.toutiao.com/search/?keyword=街拍<i class="fa fa-external-link-alt"></i></span>，打开Preview选项卡查看Response Body。如果页面中的内容是根据第一个请求得到的结果渲染出来的，那么第一个请求的源代码中必然会包含页面结果中的文字。为了验证，我们可以尝试搜索一下搜索结果的标题，比如“路人”二字，如图6-17所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-17.jpg" alt="">图6-17 搜索结果</p>
                  <p>我们发现，网页源代码中并没有包含这两个字，搜索匹配结果数目为0。因此，可以初步判断这些内容是由Ajax加载，然后用JavaScript渲染出来的。接下来，我们可以切换到XHR过滤选项卡，查看一下有没有Ajax请求。</p>
                  <p>不出所料，此处出现了一个比较常规的Ajax请求，看看它的结果是否包含了页面中的相关数据。</p>
                  <p>点击<code>data</code>字段展开，发现这里有许多条数据。点击第一条展开，可以发现有一个<code>title</code>字段，它的值正好就是页面中第一条数据的标题。再检查一下其他数据，也正好是一一对应的，如图6-18所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-18.jpg" alt="">图6-18 对比结果</p>
                  <p>这就确定了这些数据确实是由Ajax加载的。</p>
                  <p>我们的目的是要抓取其中的美图，这里一组图就对应前面<code>data</code>字段中的一条数据。每条数据还有一个<code>image_detail</code>字段，它是列表形式，这其中就包含了组图的所有图片列表，如图6-19所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-19.jpg" alt="">图6-19 图片列表信息</p>
                  <p>因此，我们只需要将列表中的<code>url</code>字段提取出来并下载下来就好了。每一组图都建立一个文件夹，文件夹的名称就为组图的标题。</p>
                  <p>接下来，就可以直接用Python来模拟这个Ajax请求，然后提取出相关美图链接并下载。但是在这之前，我们还需要分析一下URL的规律。</p>
                  <p>切换回Headers选项卡，观察一下它的请求URL和Headers信息，如图6-20所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-20.jpg" alt="">图6-20 请求信息</p>
                  <p>可以看到，这是一个GET请求，请求URL的参数有<code>offset</code>、<code>format</code>、<code>keyword</code>、<code>autoload</code>、<code>count</code>和<code>cur_tab</code>。我们需要找出这些参数的规律，因为这样才可以方便地用程序构造出来。</p>
                  <p>接下来，可以滑动页面，多加载一些新结果。在加载的同时可以发现，Network中又出现了许多Ajax请求，如图6-21所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-21.jpg" alt="">图6-21 Ajax请求</p>
                  <p>这里观察一下后续链接的参数，发现变化的参数只有<code>offset</code>，其他参数都没有变化，而且第二次请求的<code>offset</code>值为20，第三次为40，第四次为60，所以可以发现规律，这个<code>offset</code>值就是偏移量，进而可以推断出<code>count</code>参数就是一次性获取的数据条数。因此，我们可以用<code>offset</code>参数来控制数据分页。这样一来，我们就可以通过接口批量获取数据了，然后将数据解析，将图片下载下来即可。</p>
                  <h2 id="3-实战演练"><a href="#3-实战演练" class="headerlink" title="3. 实战演练"></a>3. 实战演练</h2>
                  <p>我们刚才已经分析了一下Ajax请求的逻辑，下面就用程序来实现美图下载吧。</p>
                  <p>首先，实现方法<code>get_page()</code>来加载单个Ajax请求的结果。其中唯一变化的参数就是<code>offset</code>，所以我们将它当作参数传递，实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlencode</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_page</span><span class="params">(offset)</span>:</span></span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">'offset'</span>: offset,</span><br><span class="line">        <span class="string">'format'</span>: <span class="string">'json'</span>,</span><br><span class="line">        <span class="string">'keyword'</span>: <span class="string">'街拍'</span>,</span><br><span class="line">        <span class="string">'autoload'</span>: <span class="string">'true'</span>,</span><br><span class="line">        <span class="string">'count'</span>: <span class="string">'20'</span>,</span><br><span class="line">        <span class="string">'cur_tab'</span>: <span class="string">'1'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    url = <span class="string">'http://www.toutiao.com/search_content/?'</span> + urlencode(params)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.json()</span><br><span class="line">    <span class="keyword">except</span> requests.ConnectionError:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们用<code>urlencode()</code>方法构造请求的GET参数，然后用requests请求这个链接，如果返回状态码为200，则调用<code>response</code>的<code>json()</code>方法将结果转为JSON格式，然后返回。</p>
                  <p>接下来，再实现一个解析方法：提取每条数据的<code>image_detail</code>字段中的每一张图片链接，将图片链接和图片所属的标题一并返回，此时可以构造一个生成器。实现代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def get_images(json):</span><br><span class="line">    <span class="keyword">if</span> json.<span class="builtin-name">get</span>(<span class="string">'data'</span>):</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> json.<span class="builtin-name">get</span>(<span class="string">'data'</span>):</span><br><span class="line">            title = item.<span class="builtin-name">get</span>(<span class="string">'title'</span>)</span><br><span class="line">            images = item.<span class="builtin-name">get</span>(<span class="string">'image_detail'</span>)</span><br><span class="line">            <span class="keyword">for</span> image <span class="keyword">in</span> images:</span><br><span class="line">                yield &#123;</span><br><span class="line">                    <span class="string">'image'</span>: image.<span class="builtin-name">get</span>(<span class="string">'url'</span>),</span><br><span class="line">                    <span class="string">'title'</span>: title</span><br><span class="line">                &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来，实现一个保存图片的方法<code>save_image()</code>，其中<code>item</code>就是前面<code>get_images()</code>方法返回的一个字典。在该方法中，首先根据<code>item</code>的<code>title</code>来创建文件夹，然后请求这个图片链接，获取图片的二进制数据，以二进制的形式写入文件。图片的名称可以使用其内容的MD5值，这样可以去除重复。相关代码如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import os</span><br><span class="line"><span class="built_in">from</span> hashlib import md5</span><br><span class="line"></span><br><span class="line">def save_image(<span class="keyword">item</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="keyword">item</span>.<span class="built_in">get</span>(<span class="string">'title'</span>)):</span><br><span class="line">        os.mkdir(<span class="keyword">item</span>.<span class="built_in">get</span>(<span class="string">'title'</span>))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.<span class="built_in">get</span>(<span class="keyword">item</span>.<span class="built_in">get</span>(<span class="string">'image'</span>))</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            file_path = <span class="string">'&#123;0&#125;/&#123;1&#125;.&#123;2&#125;'</span>.<span class="built_in">format</span>(<span class="keyword">item</span>.<span class="built_in">get</span>(<span class="string">'title'</span>), md5(response.content).hexdigest(), <span class="string">'jpg'</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(file_path):</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    f.<span class="built_in">write</span>(response.content)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">'Already Downloaded'</span>, file_path)</span><br><span class="line">    except requests.ConnectionError:</span><br><span class="line">        print(<span class="string">'Failed to Save Image'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后，只需要构造一个<code>offset</code>数组，遍历<code>offset</code>，提取图片链接，并将其下载即可：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> multiprocessing.pool import Pool</span><br><span class="line"></span><br><span class="line">def main(offset):</span><br><span class="line">    json = get_page(offset)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> get_images(json):</span><br><span class="line">        <span class="builtin-name">print</span>(item)</span><br><span class="line">        save_image(item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GROUP_START = 1</span><br><span class="line">GROUP_END = 20</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">   <span class="built_in"> pool </span>= Pool()</span><br><span class="line">    groups = ([x * 20 <span class="keyword">for</span> x <span class="keyword">in</span> range(GROUP_START, GROUP_END + 1)])</span><br><span class="line">    pool.map(main, groups)</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里定义了分页的起始页数和终止页数，分别为<code>GROUP_START</code>和<code>GROUP_END</code>，还利用了多线程的线程池，调用其<code>map()</code>方法实现多线程下载。</p>
                  <p>这样整个程序就完成了，运行之后可以发现街拍美图都分文件夹保存下来了，如图6-22所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-22.jpg" alt="">图6-22 保存结果</p>
                  <p>最后，我们给出本节的代码地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1B5dGhvbjNXZWJTcGlkZXIvSmllcGFp">https://github.com/Python3WebSpider/Jiepai<i class="fa fa-external-link-alt"></i></span>。</p>
                  <p>通过本节，我们了解了Ajax分析的流程、Ajax分页的模拟以及图片的下载过程。</p>
                  <p>本节的内容需要熟练掌握，在后面的实战中我们还会用到很多次这样的分析和抓取。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-30 20:18:22" itemprop="dateCreated datePublished" datetime="2018-01-30T20:18:22+08:00">2018-01-30</time>
                </span>
                <span id="/5616.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 6.4-分析Ajax爬取今日头条街拍美图" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5609.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5609.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 6.3-Ajax结果提取</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>这里仍然以微博为例，接下来用Python来模拟这些Ajax请求，把我发过的微博爬取下来。</p>
                  <h2 id="1-分析请求"><a href="#1-分析请求" class="headerlink" title="1. 分析请求"></a>1. 分析请求</h2>
                  <p>打开Ajax的XHR过滤器，然后一直滑动页面以加载新的微博内容。可以看到，会不断有Ajax请求发出。</p>
                  <p>选定其中一个请求，分析它的参数信息。点击该请求，进入详情页面，如图6-11所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-11.png" alt="">图6-11 详情页面</p>
                  <p>可以发现，这是一个GET类型的请求，请求链接为[<span class="exturl" data-url="aHR0cHM6Ly9tLndlaWJvLmNuL2FwaS9jb250YWluZXIvZ2V0SW5kZXg/dHlwZT11aWQmYW1wO3ZhbHVlPTI4MzA2Nzg0NzQmYW1wO2NvbnRhaW5lcmlkPTEwNzYwMzI4MzA2Nzg0NzQmYW1wO3BhZ2U9MinjgILor7fmsYLnmoTlj4LmlbDmnIk05Liq77yaYHR5cGVg44CBYHZhbHVlYOOAgWBjb250YWluZXJpZGDlkoxgcGFnZWDjgII=">https://m.weibo.cn/api/container/getIndex?type=uid&amp;value=2830678474&amp;containerid=1076032830678474&amp;page=2)。请求的参数有4个：`type`、`value`、`containerid`和`page`。<i class="fa fa-external-link-alt"></i></span></p>
                  <p>随后再看看其他请求，可以发现，它们的<code>type</code>、<code>value</code>和<code>containerid</code>始终如一。<code>type</code>始终为<code>uid</code>，<code>value</code>的值就是页面链接中的数字，其实这就是用户的<code>id</code>。另外，还有<code>containerid</code>。可以发现，它就是107603加上用户<code>id</code>。改变的值就是<code>page</code>，很明显这个参数是用来控制分页的，<code>page=1</code>代表第一页，<code>page=2</code>代表第二页，以此类推。</p>
                  <h2 id="2-分析响应"><a href="#2-分析响应" class="headerlink" title="2. 分析响应"></a>2. 分析响应</h2>
                  <p>随后，观察这个请求的响应内容，如图6-12所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-12.png" alt="">图6-12 响应内容</p>
                  <p>这个内容是JSON格式的，浏览器开发者工具自动做了解析以方便我们查看。可以看到，最关键的两部分信息就是<code>cardlistInfo</code>和<code>cards</code>：前者包含一个比较重要的信息<code>total</code>，观察后可以发现，它其实是微博的总数量，我们可以根据这个数字来估算分页数；后者则是一个列表，它包含10个元素，展开其中一个看一下，如图6-13所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-13.png" alt="">图6-13 列表内容</p>
                  <p>可以发现，这个元素有一个比较重要的字段<code>mblog</code>。展开它，可以发现它包含的正是微博的一些信息，比如<code>attitudes_count</code>（赞数目）、<code>comments_count</code>（评论数目）、<code>reposts_count</code>（转发数目）、<code>created_at</code>（发布时间）、<code>text</code>（微博正文）等，而且它们都是一些格式化的内容。</p>
                  <p>这样我们请求一个接口，就可以得到10条微博，而且请求时只需要改变<code>page</code>参数即可。</p>
                  <p>这样的话，我们只需要简单做一个循环，就可以获取所有微博了。</p>
                  <h2 id="3-实战演练"><a href="#3-实战演练" class="headerlink" title="3. 实战演练"></a>3. 实战演练</h2>
                  <p>这里我们用程序模拟这些Ajax请求，将我的前10页微博全部爬取下来。</p>
                  <p>首先，定义一个方法来获取每次请求的结果。在请求时，<code>page</code>是一个可变参数，所以我们将它作为方法的参数传递进来，相关代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> urllib.parse import urlencode</span><br><span class="line">import requests</span><br><span class="line">base_url = <span class="string">'https://m.weibo.cn/api/container/getIndex?'</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'Host'</span>: <span class="string">'m.weibo.cn'</span>,</span><br><span class="line">    <span class="string">'Referer'</span>: <span class="string">'https://m.weibo.cn/u/2830678474'</span>,</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36'</span>,</span><br><span class="line">    <span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def get_page(page):</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">'type'</span>: <span class="string">'uid'</span>,</span><br><span class="line">        <span class="string">'value'</span>: <span class="string">'2830678474'</span>,</span><br><span class="line">        <span class="string">'containerid'</span>: <span class="string">'1076032830678474'</span>,</span><br><span class="line">        <span class="string">'page'</span>: page</span><br><span class="line">    &#125;</span><br><span class="line">    url = base_url + urlencode(params)</span><br><span class="line">    try:</span><br><span class="line">        response = requests.<span class="builtin-name">get</span>(url, <span class="attribute">headers</span>=headers)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == 200:</span><br><span class="line">            return response.json()</span><br><span class="line">    except requests.ConnectionError as e:</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">'Error'</span>, e.args)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先，这里定义了<code>base_url</code>来表示请求的URL的前半部分。接下来，构造参数字典，其中<code>type</code>、<code>value</code>和<code>containerid</code>是固定参数，<code>page</code>是可变参数。接下来，调用<code>urlencode()</code>方法将参数转化为URL的GET请求参数，即类似于<code>type=uid&amp;value=2830678474&amp;containerid=1076032830678474&amp;page=2</code>这样的形式。随后，<code>base_url</code>与参数拼合形成一个新的URL。接着，我们用requests请求这个链接，加入<code>headers</code>参数。然后判断响应的状态码，如果是200，则直接调用<code>json()</code>方法将内容解析为JSON返回，否则不返回任何信息。如果出现异常，则捕获并输出其异常信息。</p>
                  <p>随后，我们需要定义一个解析方法，用来从结果中提取想要的信息，比如这次想保存微博的<code>id</code>、正文、赞数、评论数和转发数这几个内容，那么可以先遍历<code>cards</code>，然后获取<code>mblog</code>中的各个信息，赋值为一个新的字典返回即可：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pyquery import PyQuery as pq</span><br><span class="line"></span><br><span class="line">def parse_page(json):</span><br><span class="line">    <span class="keyword">if</span> json:</span><br><span class="line">        items = json.<span class="builtin-name">get</span>(<span class="string">'data'</span>).<span class="builtin-name">get</span>(<span class="string">'cards'</span>)</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">            item = item.<span class="builtin-name">get</span>(<span class="string">'mblog'</span>)</span><br><span class="line">            weibo = &#123;&#125;</span><br><span class="line">            weibo[<span class="string">'id'</span>] = item.<span class="builtin-name">get</span>(<span class="string">'id'</span>)</span><br><span class="line">            weibo[<span class="string">'text'</span>] = pq(item.<span class="builtin-name">get</span>(<span class="string">'text'</span>)).text()</span><br><span class="line">            weibo[<span class="string">'attitudes'</span>] = item.<span class="builtin-name">get</span>(<span class="string">'attitudes_count'</span>)</span><br><span class="line">            weibo[<span class="string">'comments'</span>] = item.<span class="builtin-name">get</span>(<span class="string">'comments_count'</span>)</span><br><span class="line">            weibo[<span class="string">'reposts'</span>] = item.<span class="builtin-name">get</span>(<span class="string">'reposts_count'</span>)</span><br><span class="line">            yield weibo</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们借助pyquery将正文中的HTML标签去掉。</p>
                  <p>最后，遍历一下<code>page</code>，一共10页，将提取到的结果打印输出即可：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span><span class="built_in"> page </span><span class="keyword">in</span> range(1, 11):</span><br><span class="line">        json = get_page(page)</span><br><span class="line">        results = parse_page(json)</span><br><span class="line">        <span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">            <span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外，我们还可以加一个方法将结果保存到MongoDB数据库：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pymongo import MongoClient</span><br><span class="line"></span><br><span class="line">client = MongoClient()</span><br><span class="line">db = client[<span class="string">'weibo'</span>]</span><br><span class="line">collection = db[<span class="string">'weibo'</span>]</span><br><span class="line"></span><br><span class="line">def save_to_mongo(result):</span><br><span class="line">    <span class="keyword">if</span> collection.insert(result):</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">'Saved to Mongo'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样所有功能就实现完成了。运行程序后，样例输出结果如下：</p>
                  <figure class="highlight puppet">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="string">'id'</span>: <span class="string">'4134879836735238'</span>, <span class="string">'text'</span>: <span class="string">'惊不惊喜，刺不刺激，意不意外，感不感动'</span>, <span class="string">'attitudes'</span>: 3, <span class="string">'comments'</span>: 1, <span class="string">'reposts'</span>: 0&#125;</span><br><span class="line">Saved to Mongo</span><br><span class="line">&#123;<span class="string">'id'</span>: <span class="string">'4143853554221385'</span>, <span class="string">'text'</span>: <span class="string">'曾经梦想仗剑走天涯，后来过安检给收走了。分享单曲 远走高飞'</span>, <span class="string">'attitudes'</span>: 5, <span class="string">'comments'</span>: 1, <span class="string">'reposts'</span>: 0&#125;</span><br><span class="line">Saved to Mongo</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>查看一下MongoDB，相应的数据也被保存到MongoDB，如图6-14所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-14.png" alt="">图6-14 保存结果</p>
                  <p>这样，我们就顺利通过分析Ajax并编写爬虫爬取下来了微博列表，最后，给出本节的代码地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1B5dGhvbjNXZWJTcGlkZXIvV2VpYm9MaXN0">https://github.com/Python3WebSpider/WeiboList<i class="fa fa-external-link-alt"></i></span>。</p>
                  <p>本节的目的是为了演示Ajax的模拟请求过程，爬取的结果不是重点。该程序仍有很多可以完善的地方，如页码的动态计算、微博查看全文等，若感兴趣，可以尝试一下。</p>
                  <p>通过这个实例，我们主要学会了怎样去分析Ajax请求，怎样用程序来模拟抓取Ajax请求。了解了抓取原理之后，下一节的Ajax实战演练会更加得心应手。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-30 20:06:07" itemprop="dateCreated datePublished" datetime="2018-01-30T20:06:07+08:00">2018-01-30</time>
                </span>
                <span id="/5609.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 6.3-Ajax结果提取" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5597.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5597.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 6.2-Ajax分析方法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>这里还以前面的微博为例，我们知道拖动刷新的内容由Ajax加载，而且页面的URL没有变化，那么应该到哪里去查看这些Ajax请求呢？</p>
                  <h2 id="1-查看请求"><a href="#1-查看请求" class="headerlink" title="1. 查看请求"></a>1. 查看请求</h2>
                  <p>这里还需要借助浏览器的开发者工具，下面以Chrome浏览器为例来介绍。</p>
                  <p>首先，用Chrome浏览器打开微博的链接<span class="exturl" data-url="aHR0cHM6Ly9tLndlaWJvLmNuL3UvMjgzMDY3ODQ3NA==">https://m.weibo.cn/u/2830678474<i class="fa fa-external-link-alt"></i></span>，随后在页面中点击鼠标右键，从弹出的快捷菜单中选择“检查”选项，此时便会弹出开发者工具，如图6-2所示：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-2.png" alt="">图6-2 开发者工具</p>
                  <p>此时在Elements选项卡中便会观察到网页的源代码，右侧便是节点的样式。</p>
                  <p>不过这不是我们想要寻找的内容。切换到Network选项卡，随后重新刷新页面，可以发现这里出现了非常多的条目，如图6-3所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-3.png" alt="">图6-3 Network面板结果</p>
                  <p>前面也提到过，这里其实就是在页面加载过程中浏览器与服务器之间发送请求和接收响应的所有记录。</p>
                  <p>Ajax其实有其特殊的请求类型，它叫作<code>xhr</code>。在图6-3中，我们可以发现一个名称以getIndex开头的请求，其Type为<code>xhr</code>，这就是一个Ajax请求。用鼠标点击这个请求，可以查看这个请求的详细信息，如图6-4所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-4.png" alt="">图6-4 详细信息</p>
                  <p>在右侧可以观察到其Request Headers、URL和Response Headers等信息。其中Request Headers中有一个信息为X-Requested-With:XMLHttpRequest，这就标记了此请求是Ajax请求，如图6-5所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-5.png" alt="">图6-5 详细信息</p>
                  <p>随后点击一下Preview，即可看到响应的内容，它是JSON格式的。这里Chrome为我们自动做了解析，点击箭头即可展开和收起相应内容，如图6-6所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-6.png" alt="">图6-6 JSON结果</p>
                  <p>观察可以发现，这里的返回结果是我的个人信息，如昵称、简介、头像等，这也是用来渲染个人主页所使用的数据。JavaScript接收到这些数据之后，再执行相应的渲染方法，整个页面就渲染出来了。</p>
                  <p>另外，也可以切换到Response选项卡，从中观察到真实的返回数据，如图6-7所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-7.png" alt="">图6-7 Response内容</p>
                  <p>接下来，切回到第一个请求，观察一下它的Response是什么，如图6-8所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-8.png" alt="">图6-8 Response内容</p>
                  <p>这是最原始的链接<span class="exturl" data-url="aHR0cHM6Ly9tLndlaWJvLmNuL3UvMjgzMDY3ODQ3NA==">https://m.weibo.cn/u/2830678474<i class="fa fa-external-link-alt"></i></span>返回的结果，其代码只有不到50行，结构也非常简单，只是执行了一些JavaScript。</p>
                  <p>所以说，我们看到的微博页面的真实数据并不是最原始的页面返回的，而是后来执行JavaScript后再次向后台发送了Ajax请求，浏览器拿到数据后再进一步渲染出来的。</p>
                  <h2 id="2-过滤请求"><a href="#2-过滤请求" class="headerlink" title="2. 过滤请求"></a>2. 过滤请求</h2>
                  <p>接下来，再利用Chrome开发者工具的筛选功能筛选出所有的Ajax请求。在请求的上方有一层筛选栏，直接点击XHR，此时在下方显示的所有请求便都是Ajax请求了，如图6-9所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-9.png" alt="">图6-9 Ajax请求</p>
                  <p>接下来，不断滑动页面，可以看到页面底部有一条条新的微博被刷出，而开发者工具下方也一个个地出现Ajax请求，这样我们就可以捕获到所有的Ajax请求了。</p>
                  <p>随意点开一个条目，都可以清楚地看到其Request URL、Request Headers、Response Headers、Response Body等内容，此时想要模拟请求和提取就非常简单了。</p>
                  <p>图6-10所示的内容便是我的某一页微博的列表信息。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-10.png" alt="">图6-10 微博列表信息</p>
                  <p>到现在为止，我们已经可以分析出来Ajax请求的一些详细信息了，接下来只需要用程序模拟这些Ajax请求，就可以轻松提取我们所需要的信息了。</p>
                  <p>在下一节中，我们用Python实现Ajax请求的模拟，从而实现数据的抓取。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-30 19:59:19" itemprop="dateCreated datePublished" datetime="2018-01-30T19:59:19+08:00">2018-01-30</time>
                </span>
                <span id="/5597.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 6.2-Ajax分析方法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5593.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5593.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 6.1-什么是Ajax</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>Ajax，全称为Asynchronous JavaScript and XML，即异步的JavaScript和XML。它不是一门编程语言，而是利用JavaScript在保证页面不被刷新、页面链接不改变的情况下与服务器交换数据并更新部分网页的技术。</p>
                  <p>对于传统的网页，如果想更新其内容，那么必须要刷新整个页面，但有了Ajax，便可以在页面不被全部刷新的情况下更新其内容。在这个过程中，页面实际上是在后台与服务器进行了数据交互，获取到数据之后，再利用JavaScript改变网页，这样网页内容就会更新了。</p>
                  <p>可以到W3School上体验几个示例来感受一下：<span class="exturl" data-url="aHR0cDovL3d3dy53M3NjaG9vbC5jb20uY24vYWpheC9hamF4X3htbGh0dHByZXF1ZXN0X3NlbmQuYXNw">http://www.w3school.com.cn/ajax/ajax_xmlhttprequest_send.asp<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="1-实例引入"><a href="#1-实例引入" class="headerlink" title="1. 实例引入"></a>1. 实例引入</h2>
                  <p>浏览网页的时候，我们会发现很多网页都有下滑查看更多的选项。比如，拿微博来说，我们以我的个人的主页为例：<span class="exturl" data-url="aHR0cHM6Ly9tLndlaWJvLmNuL3UvMjgzMDY3ODQ3NA==">https://m.weibo.cn/u/2830678474<i class="fa fa-external-link-alt"></i></span>，切换到微博页面，一直下滑，可以发现下滑几个微博之后，再向下就没有了，转而会出现一个加载的动画，不一会儿下方就继续出现了新的微博内容，这个过程其实就是Ajax加载的过程，如图6-1所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/6-1.png" alt="">图6-1 页面加载过程</p>
                  <p>我们注意到页面其实并没有整个刷新，也就意味着页面的链接没有变化，但是网页中却多了新内容，也就是后面刷出来的新微博。这就是通过Ajax获取新数据并呈现的过程。</p>
                  <h2 id="2-基本原理"><a href="#2-基本原理" class="headerlink" title="2. 基本原理"></a>2. 基本原理</h2>
                  <p>初步了解了Ajax之后，我们再来详细了解它的基本原理。发送Ajax请求到网页更新的这个过程可以简单分为以下3步：</p>
                  <p>(1) 发送请求； (2) 解析内容； (3) 渲染网页。</p>
                  <p>下面我们分别来详细介绍这几个过程。</p>
                  <h3 id="发送请求"><a href="#发送请求" class="headerlink" title="发送请求"></a>发送请求</h3>
                  <p>我们知道JavaScript可以实现页面的各种交互功能，Ajax也不例外，它也是由JavaScript实现的，实际上执行了如下代码：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> xmlhttp;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;</span><br><span class="line">    <span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class="line">    xmlhttp=<span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;<span class="comment">// code for IE6, IE5</span></span><br><span class="line">    xmlhttp=<span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">&#125;</span><br><span class="line">xmlhttp.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xmlhttp.readyState==<span class="number">4</span> &amp;&amp; xmlhttp.status==<span class="number">200</span>) &#123;</span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">"myDiv"</span>).innerHTML=xmlhttp.responseText;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xmlhttp.open(<span class="string">"POST"</span>,<span class="string">"/ajax/"</span>,<span class="literal">true</span>);</span><br><span class="line">xmlhttp.send();</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这是JavaScript对Ajax最底层的实现，实际上就是新建了<code>XMLHttpRequest</code>对象，然后调用<code>onreadystatechange</code>属性设置了监听，然后调用<code>open()</code>和<code>send()</code>方法向某个链接（也就是服务器）发送了请求。前面用Python实现请求发送之后，可以得到响应结果，但这里请求的发送变成JavaScript来完成.由于设置了监听，所以当服务器返回响应时，<code>onreadystatechange</code>对应的方法便会被触发，然后在这个方法里面解析响应内容即可。</p>
                  <h3 id="解析内容"><a href="#解析内容" class="headerlink" title="解析内容"></a>解析内容</h3>
                  <p>得到响应之后，<code>onreadystatechange</code>属性对应的方法便会被触发，此时利用<code>xmlhttp</code>的<code>responseText</code>属性便可取到响应内容。这类似于Python中利用requests向服务器发起请求，然后得到响应的过程。那么返回内容可能是HTML，可能是JSON，接下来只需要在方法中用JavaScript进一步处理即可。比如，如果是JSON的话，可以进行解析和转化。</p>
                  <h3 id="渲染网页"><a href="#渲染网页" class="headerlink" title="渲染网页"></a>渲染网页</h3>
                  <p>JavaScript有改变网页内容的能力，解析完响应内容之后，就可以调用JavaScript来针对解析完的内容对网页进行下一步处理了。比如，通过<code>document.getElementById().innerHTML</code>这样的操作，便可以对某个元素内的源代码进行更改，这样网页显示的内容就改变了，这样的操作也被称作DOM操作，即对Document网页文档进行操作，如更改、删除等。</p>
                  <p>上例中，<code>document.getElementById(&quot;myDiv&quot;).innerHTML=xmlhttp.responseText</code>便将<code>ID</code>为<code>myDiv</code>的节点内部的HTML代码更改为服务器返回的内容，这样<code>myDiv</code>元素内部便会呈现出服务器返回的新数据，网页的部分内容看上去就更新了。</p>
                  <p>我们观察到，这3个步骤其实都是由JavaScript完成的，它完成了整个请求、解析和渲染的过程。</p>
                  <p>再回想微博的下拉刷新，这其实就是JavaScript向服务器发送了一个Ajax请求，然后获取新的微博数据，将其解析，并将其渲染在网页中。</p>
                  <p>因此，我们知道，真实的数据其实都是一次次Ajax请求得到的，如果想要抓取这些数据，需要知道这些请求到底是怎么发送的，发往哪里，发了哪些参数。如果我们知道了这些，不就可以用Python模拟这个发送操作，获取到其中的结果了吗？</p>
                  <p>在下一节中，我们就来了解下到哪里可以看到这些后台Ajax操作，去了解它到底是怎么发送的，发送了什么参数。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-30 19:55:17" itemprop="dateCreated datePublished" datetime="2018-01-30T19:55:17+08:00">2018-01-30</time>
                </span>
                <span id="/5593.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 6.1-什么是Ajax" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5590.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5590.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 6-Ajax数据爬取</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>有时候我们在用requests抓取页面的时候，得到的结果可能和在浏览器中看到的不一样：在浏览器中可以看到正常显示的页面数据，但是使用requests得到的结果并没有。这是因为requests获取的都是原始的HTML文档，而浏览器中的页面则是经过JavaScript处理数据后生成的结果，这些数据的来源有多种，可能是通过Ajax加载的，可能是包含在HTML文档中的，也可能是经过JavaScript和特定算法计算后生成的。</p>
                  <p>对于第一种情况，数据加载是一种异步加载方式，原始的页面最初不会包含某些数据，原始页面加载完后，会再向服务器请求某个接口获取数据，然后数据才被处理从而呈现到网页上，这其实就是发送了一个Ajax请求。</p>
                  <p>照Web发展的趋势来看，这种形式的页面越来越多。网页的原始HTML文档不会包含任何数据，数据都是通过Ajax统一加载后再呈现出来的，这样在Web开发上可以做到前后端分离，而且降低服务器直接渲染页面带来的压力。</p>
                  <p>所以如果遇到这样的页面，直接利用requests等库来抓取原始页面，是无法获取到有效数据的，这时需要分析网页后台向接口发送的Ajax请求，如果可以用requests来模拟Ajax请求，那么就可以成功抓取了。</p>
                  <p>所以，本章我们的主要目的是了解什么是Ajax以及如何去分析和抓取Ajax请求。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-30 19:51:31" itemprop="dateCreated datePublished" datetime="2018-01-30T19:51:31+08:00">2018-01-30</time>
                </span>
                <span id="/5590.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 6-Ajax数据爬取" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>554</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5587.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5587.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 5.3.2-Redis存储</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>Redis是一个基于内存的高效的键值型非关系型数据库，存取效率极高，而且支持多种存储数据结构，使用也非常简单。本节中，我们就来介绍一下Python的Redis操作，主要介绍RedisPy这个库的用法。</p>
                  <h2 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h2>
                  <p>在开始之前，请确保已经安装好了Redis及RedisPy库。如果要做数据导入/导出操作的话，还需要安装RedisDump。如果没有安装，可以参考第1章。</p>
                  <h2 id="2-Redis和StrictRedis"><a href="#2-Redis和StrictRedis" class="headerlink" title="2. Redis和StrictRedis"></a>2. <code>Redis</code>和<code>StrictRedis</code></h2>
                  <p>RedisPy库提供两个类<code>Redis</code>和<code>StrictRedis</code>来实现Redis的命令操作。</p>
                  <p><code>StrictRedis</code>实现了绝大部分官方的命令，参数也一一对应，比如<code>set()</code>方法就对应Redis命令的<code>set</code>方法。而<code>Redis</code>是<code>StrictRedis</code>的子类，它的主要功能是用于向后兼容旧版本库里的几个方法。为了做兼容，它将方法做了改写，比如<code>lrem()</code>方法就将<code>value</code>和<code>num</code>参数的位置互换，这和Redis命令行的命令参数不一致。</p>
                  <p>官方推荐使用<code>StrictRedis</code>，所以本节中我们也用<code>StrictRedis类</code>的相关方法作演示。</p>
                  <h2 id="3-连接Redis"><a href="#3-连接Redis" class="headerlink" title="3. 连接Redis"></a>3. 连接Redis</h2>
                  <p>现在我们已经在本地安装了Redis并运行在6379端口，密码设置为foobared。那么，可以用如下示例连接Redis并测试：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> redis import StrictRedis</span><br><span class="line"></span><br><span class="line">redis = StrictRedis(<span class="attribute">host</span>=<span class="string">'localhost'</span>, <span class="attribute">port</span>=6379, <span class="attribute">db</span>=0, <span class="attribute">password</span>=<span class="string">'foobared'</span>)</span><br><span class="line">redis.<span class="builtin-name">set</span>(<span class="string">'name'</span>, <span class="string">'Bob'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(redis.<span class="builtin-name">get</span>(<span class="string">'name'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们传入了Redis的地址、运行端口、使用的数据库和密码信息。在默认不传的情况下，这4个参数分别为<code>localhost</code>、<code>6379</code>、<code>0</code>和<code>None</code>。首先声明了一个<code>StrictRedis</code>对象，接下来调用<code>set()</code>方法，设置一个键值对，然后将其获取并打印。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">b'Bob'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这说明我们连接成功，并可以执行<code>set()</code>和<code>get()</code>操作了。</p>
                  <p>当然，我们还可以使用<code>ConnectionPool</code>来连接，示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> redis import StrictRedis, ConnectionPool</span><br><span class="line"></span><br><span class="line">pool = ConnectionPool(<span class="attribute">host</span>=<span class="string">'localhost'</span>, <span class="attribute">port</span>=6379, <span class="attribute">db</span>=0, <span class="attribute">password</span>=<span class="string">'foobared'</span>)</span><br><span class="line">redis = StrictRedis(<span class="attribute">connection_pool</span>=pool)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样的连接效果是一样的。观察源码可以发现，<code>StrictRedis</code>内其实就是用<code>host</code>和<code>port</code>等参数又构造了一个<code>ConnectionPool</code>，所以直接将<code>ConnectionPool</code>当作参数传给<code>StrictRedis</code>也一样。</p>
                  <p>另外，<code>ConnectionPool</code>还支持通过URL来构建。URL的格式支持有如下3种：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">redis:</span><span class="comment">//[:password]@host:port/db</span></span><br><span class="line"><span class="symbol">rediss:</span><span class="comment">//[:password]@host:port/db</span></span><br><span class="line"><span class="symbol">unix:</span><span class="comment">//[:password]@/path/to/socket.sock?db=db</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这3种URL分别表示创建Redis TCP连接、Redis TCP+SSL连接、Redis UNIX socket连接。我们只需要构造上面任意一种URL即可，其中<code>password</code>部分如果有则可以写，没有则可以省略。下面再用URL连接演示一下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">url = <span class="string">'redis://:foobared@localhost:6379/0'</span></span><br><span class="line">pool = ConnectionPool.from_url(url)</span><br><span class="line">redis = StrictRedis(<span class="attribute">connection_pool</span>=pool)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们使用第一种连接字符串进行连接。首先，声明一个Redis连接字符串，然后调用<code>from_url()</code>方法创建<code>ConnectionPool</code>，接着将其传给<code>StrictRedis</code>即可完成连接，所以使用URL的连接方式还是比较方便的。</p>
                  <h2 id="4-键操作"><a href="#4-键操作" class="headerlink" title="4. 键操作"></a>4. 键操作</h2>
                  <p>表5-5总结了键的一些判断和操作方法。</p>
                  <p>表5-5 键的一些判断和操作方法</p>
                  <p>方法</p>
                  <p>作用</p>
                  <p>参数说明</p>
                  <p>示例</p>
                  <p>示例说明</p>
                  <p>示例结果</p>
                  <p><code>exists(name)</code></p>
                  <p>判断一个键是否存在</p>
                  <p><code>name</code>：键名</p>
                  <p><code>redis.exists(&#39;name&#39;)</code></p>
                  <p>是否存在<code>name</code>这个键</p>
                  <p><code>True</code></p>
                  <p><code>delete(name)</code></p>
                  <p>删除一个键</p>
                  <p><code>name</code>：键名</p>
                  <p><code>redis.delete(&#39;name&#39;)</code></p>
                  <p>删除<code>name</code>这个键</p>
                  <p>1</p>
                  <p><code>type(name)</code></p>
                  <p>判断键类型</p>
                  <p><code>name</code>：键名</p>
                  <p><code>redis.type(&#39;name&#39;)</code></p>
                  <p>判断<code>name</code>这个键类型</p>
                  <p><code>b&#39;string&#39;</code></p>
                  <p><code>keys(pattern)</code></p>
                  <p>获取所有符合规则的键</p>
                  <p><code>pattern</code>：匹配规则</p>
                  <p><code>redis.keys(&#39;n*&#39;)</code></p>
                  <p>获取所有以<code>n</code>开头的键</p>
                  <p><code>[b&#39;name&#39;]</code></p>
                  <p><code>randomkey()</code></p>
                  <p>获取随机的一个键</p>
                  <p><code>randomkey()</code></p>
                  <p>获取随机的一个键</p>
                  <p><code>b&#39;name&#39;</code></p>
                  <p><code>rename(src, dst)</code></p>
                  <p>重命名键</p>
                  <p><code>src</code>：原键名；<code>dst</code>：新键名</p>
                  <p><code>redis.rename(&#39;name&#39;, &#39;nickname&#39;)</code></p>
                  <p>将<code>name</code>重命名为<code>nickname</code></p>
                  <p><code>True</code></p>
                  <p><code>dbsize()</code></p>
                  <p>获取当前数据库中键的数目</p>
                  <p><code>dbsize()</code></p>
                  <p>获取当前数据库中键的数目</p>
                  <p>100</p>
                  <p><code>expire(name, time)</code></p>
                  <p>设定键的过期时间，单位为秒</p>
                  <p><code>name</code>：键名；<code>time</code>：秒数</p>
                  <p><code>redis.expire(&#39;name&#39;, 2)</code></p>
                  <p>将<code>name</code>键的过期时间设置为2秒</p>
                  <p><code>True</code></p>
                  <p><code>ttl(name)</code></p>
                  <p>获取键的过期时间，单位为秒，-1表示永久不过期</p>
                  <p><code>name</code>：键名</p>
                  <p><code>redis.ttl(&#39;name&#39;)</code></p>
                  <p>获取<code>name</code>这个键的过期时间</p>
                  <p>-1</p>
                  <p><code>move(name, db)</code></p>
                  <p>将键移动到其他数据库</p>
                  <p><code>name</code>：键名；<code>db</code>：数据库代号</p>
                  <p><code>move(&#39;name&#39;, 2)</code></p>
                  <p>将<code>name</code>移动到2号数据库</p>
                  <p><code>True</code></p>
                  <p><code>flushdb()</code></p>
                  <p>删除当前选择数据库中的所有键</p>
                  <p><code>flushdb()</code></p>
                  <p>删除当前选择数据库中的所有键</p>
                  <p><code>True</code></p>
                  <p><code>flushall()</code></p>
                  <p>删除所有数据库中的所有键</p>
                  <p><code>flushall()</code></p>
                  <p>删除所有数据库中的所有键</p>
                  <p><code>True</code></p>
                  <h2 id="5-字符串操作"><a href="#5-字符串操作" class="headerlink" title="5. 字符串操作"></a>5. 字符串操作</h2>
                  <p>Redis支持最基本的键值对形式存储，用法总结如表5-6所示。</p>
                  <p>表5-6 键值对形式存储</p>
                  <p>方法</p>
                  <p>作用</p>
                  <p>参数说明</p>
                  <p>示例</p>
                  <p>示例说明</p>
                  <p>示例结果</p>
                  <p><code>set(name, value)</code></p>
                  <p>给数据库中键为<code>name</code>的<code>string</code>赋予值<code>value</code></p>
                  <p><code>name</code>: 键名；<code>value</code>: 值</p>
                  <p><code>redis.set(&#39;name&#39;, &#39;Bob&#39;)</code></p>
                  <p>给<code>name</code>这个键的<code>value</code>赋值为<code>Bob</code></p>
                  <p><code>True</code></p>
                  <p><code>get(name)</code></p>
                  <p>返回数据库中键为<code>name</code>的<code>string</code>的<code>value</code></p>
                  <p><code>name</code>：键名</p>
                  <p><code>redis.get(&#39;name&#39;)</code></p>
                  <p>返回<code>name</code>这个键的<code>value</code></p>
                  <p><code>b&#39;Bob&#39;</code></p>
                  <p><code>getset(name, value)</code></p>
                  <p>给数据库中键为<code>name</code>的<code>string</code>赋予值<code>value</code>并返回上次的<code>value</code></p>
                  <p><code>name</code>：键名；<code>value</code>：新值</p>
                  <p><code>redis.getset(&#39;name&#39;, &#39;Mike&#39;)</code></p>
                  <p>赋值<code>name</code>为<code>Mike</code>并得到上次的<code>value</code></p>
                  <p><code>b&#39;Bob&#39;</code></p>
                  <p><code>mget(keys, *args)</code></p>
                  <p>返回多个键对应的<code>value</code></p>
                  <p><code>keys</code>：键的列表</p>
                  <p><code>redis.mget([&#39;name&#39;, &#39;nickname&#39;])</code></p>
                  <p>返回<code>name</code>和<code>nickname</code>的<code>value</code></p>
                  <p><code>[b&#39;Mike&#39;, b&#39;Miker&#39;]</code></p>
                  <p><code>setnx(name, value)</code></p>
                  <p>如果不存在这个键值对，则更新<code>value</code>，否则不变</p>
                  <p><code>name</code>：键名</p>
                  <p><code>redis.setnx(&#39;newname&#39;, &#39;James&#39;)</code></p>
                  <p>如果<code>newname</code>这个键不存在，则设置值为<code>James</code></p>
                  <p>第一次运行结果是<code>True</code>，第二次运行结果是<code>False</code></p>
                  <p><code>setex(name, time, value)</code></p>
                  <p>设置可以对应的值为<code>string</code>类型的<code>value</code>，并指定此键值对应的有效期</p>
                  <p><code>name</code>: 键名；<code>time</code>: 有效期； <code>value</code>：值</p>
                  <p><code>redis.setex(&#39;name&#39;, 1, &#39;James&#39;)</code></p>
                  <p>将<code>name</code>这个键的值设为<code>James</code>，有效期为1秒</p>
                  <p><code>True</code></p>
                  <p><code>setrange(name, offset, value)</code></p>
                  <p>设置指定键的<code>value</code>值的子字符串</p>
                  <p><code>name</code>：键名；<code>offset</code>：偏移量；<code>value</code>：值</p>
                  <p><code>redis.set(&#39;name&#39;, &#39;Hello&#39;) redis.setrange(&#39;name&#39;, 6, &#39;World&#39;)</code></p>
                  <p>设置<code>name</code>为<code>Hello</code>字符串，并在<code>index</code>为6的位置补<code>World</code></p>
                  <p>11，修改后的字符串长度</p>
                  <p><code>mset(mapping)</code></p>
                  <p>批量赋值</p>
                  <p><code>mapping</code>：字典</p>
                  <p><code>redis.mset({&#39;name1&#39;: &#39;Durant&#39;, &#39;name2&#39;: &#39;James&#39;})</code></p>
                  <p>将<code>name1</code>设为<code>Durant</code>，<code>name2</code>设为<code>James</code></p>
                  <p><code>True</code></p>
                  <p><code>msetnx(mapping)</code></p>
                  <p>键均不存在时才批量赋值</p>
                  <p><code>mapping</code>：字典</p>
                  <p><code>redis.msetnx({&#39;name3&#39;: &#39;Smith&#39;, &#39;name4&#39;: &#39;Curry&#39;})</code></p>
                  <p>在<code>name3</code>和<code>name4</code>均不存在的情况下才设置二者值</p>
                  <p><code>True</code></p>
                  <p><code>incr(name, amount=1)</code></p>
                  <p>键为<code>name</code>的<code>value</code>增值操作，默认为1，键不存在则被创建并设为<code>amount</code></p>
                  <p><code>name</code>：键名；<code>amount</code>：增长的值</p>
                  <p><code>redis.incr(&#39;age&#39;, 1)</code></p>
                  <p><code>age</code>对应的值增1，若不存在，则会创建并设置为1</p>
                  <p>1，即修改后的值</p>
                  <p><code>decr(name, amount=1)</code></p>
                  <p>键为<code>name</code>的<code>value</code>减值操作，默认为1，键不存在则被创建并将<code>value</code>设置为<code>\-amount</code></p>
                  <p><code>name</code>：键名； <code>amount</code>：减少的值</p>
                  <p><code>redis.decr(&#39;age&#39;, 1)</code></p>
                  <p><code>age</code>对应的值减1，若不存在，则会创建并设置为-1</p>
                  <p>-1，即修改后的值</p>
                  <p><code>append(key, value)</code></p>
                  <p>键为<code>name</code>的<code>string</code>的值附加<code>value</code></p>
                  <p><code>key</code>：键名</p>
                  <p><code>redis.append(&#39;nickname&#39;, &#39;OK&#39;)</code></p>
                  <p>向键为<code>nickname</code>的值后追加<code>OK</code></p>
                  <p>13，即修改后的字符串长度</p>
                  <p><code>substr(name, start, end=-1)</code></p>
                  <p>返回键为<code>name</code>的<code>string</code>的子串</p>
                  <p><code>name</code>：键名；<code>start</code>：起始索引；<code>end</code>：终止索引，默认为-1，表示截取到末尾</p>
                  <p><code>redis.substr(&#39;name&#39;, 1, 4)</code></p>
                  <p>返回键为<code>name</code>的值的字符串，截取索引为1~4的字符</p>
                  <p><code>b&#39;ello&#39;</code></p>
                  <p><code>getrange(key, start, end)</code></p>
                  <p>获取键的<code>value</code>值从<code>start</code>到<code>end</code>的子字符串</p>
                  <p><code>key</code>：键名；<code>start</code>：起始索引；<code>end</code>：终止索引</p>
                  <p><code>redis.getrange(&#39;name&#39;, 1, 4)</code></p>
                  <p>返回键为<code>name</code>的值的字符串，截取索引为1~4的字符</p>
                  <p><code>b&#39;ello&#39;</code></p>
                  <h2 id="6-列表操作"><a href="#6-列表操作" class="headerlink" title="6. 列表操作"></a>6. 列表操作</h2>
                  <p>Redis还提供了列表存储，列表内的元素可以重复，而且可以从两端存储，用法如表5-7所示。</p>
                  <p>表5-7 列表操作</p>
                  <p>方法</p>
                  <p>作用</p>
                  <p>参数说明</p>
                  <p>示例</p>
                  <p>示例说明</p>
                  <p>示例结果</p>
                  <p><code>rpush(name, *values)</code></p>
                  <p>在键为<code>name</code>的列表末尾添加值为<code>value</code>的元素，可以传多个</p>
                  <p><code>name</code>：键名；<code>values</code>：值</p>
                  <p><code>redis.rpush(&#39;list&#39;, 1, 2, 3)</code></p>
                  <p>向键为<code>list</code>的列表尾添加1、2、3</p>
                  <p>3，列表大小</p>
                  <p><code>lpush(name, *values)</code></p>
                  <p>在键为<code>name</code>的列表头添加值为<code>value</code>的元素，可以传多个</p>
                  <p><code>name</code>：键名；<code>values</code>：值</p>
                  <p><code>redis.lpush(&#39;list&#39;, 0)</code></p>
                  <p>向键为<code>list</code>的列表头部添加0</p>
                  <p>4，列表大小</p>
                  <p><code>llen(name)</code></p>
                  <p>返回键为<code>name</code>的列表的长度</p>
                  <p><code>name</code>：键名</p>
                  <p><code>redis.llen(&#39;list&#39;)</code></p>
                  <p>返回键为<code>list</code>的列表的长度</p>
                  <p>4</p>
                  <p><code>lrange(name, start, end)</code></p>
                  <p>返回键为<code>name</code>的列表中<code>start</code>至<code>end</code>之间的元素</p>
                  <p><code>name</code>：键名；<code>start</code>：起始索引；<code>end</code>：终止索引</p>
                  <p><code>redis.lrange(&#39;list&#39;, 1, 3)</code></p>
                  <p>返回起始索引为1终止索引为3的索引范围对应的列表</p>
                  <p><code>[b&#39;3&#39;, b&#39;2&#39;, b&#39;1&#39;]</code></p>
                  <p><code>ltrim(name, start, end)</code></p>
                  <p>截取键为<code>name</code>的列表，保留索引为<code>start</code>到<code>end</code>的内容</p>
                  <p><code>name</code>：键名；<code>start</code>：起始索引；<code>end</code>：终止索引</p>
                  <p><code>ltrim(&#39;list&#39;, 1, 3)</code></p>
                  <p>保留键为<code>list</code>的索引为1到3的元素</p>
                  <p><code>True</code></p>
                  <p><code>lindex(name, index)</code></p>
                  <p>返回键为<code>name</code>的列表中<code>index</code>位置的元素</p>
                  <p><code>name</code>：键名；<code>index</code>：索引</p>
                  <p><code>redis.lindex(&#39;list&#39;, 1)</code></p>
                  <p>返回键为<code>list</code>的列表索引为1的元素</p>
                  <p>b’2’</p>
                  <p><code>lset(name, index, value)</code></p>
                  <p>给键为<code>name</code>的列表中<code>index</code>位置的元素赋值，越界则报错</p>
                  <p><code>name</code>：键名；<code>index</code>：索引位置；<code>value</code>：值</p>
                  <p><code>redis.lset(&#39;list&#39;, 1, 5)</code></p>
                  <p>将键为<code>list</code>的列表中索引为1的位置赋值为5</p>
                  <p><code>True</code></p>
                  <p><code>lrem(name, count, value)</code></p>
                  <p>删除<code>count</code>个键的列表中值为<code>value</code>的元素</p>
                  <p><code>name</code>：键名；<code>count</code>：删除个数；<code>value</code>：值</p>
                  <p><code>redis.lrem(&#39;list&#39;, 2, 3)</code></p>
                  <p>将键为<code>list</code>的列表删除两个3</p>
                  <p>1，即删除的个数</p>
                  <p><code>lpop(name)</code></p>
                  <p>返回并删除键为<code>name</code>的列表中的首元素</p>
                  <p><code>name</code>：键名</p>
                  <p><code>redis.lpop(&#39;list&#39;)</code></p>
                  <p>返回并删除名为<code>list</code>的列表中的第一个元素</p>
                  <p><code>b&#39;5&#39;</code></p>
                  <p><code>rpop(name)</code></p>
                  <p>返回并删除键为<code>name</code>的列表中的尾元素</p>
                  <p><code>name</code>：键名</p>
                  <p><code>redis.rpop(&#39;list&#39;)</code></p>
                  <p>返回并删除名为<code>list</code>的列表中的最后一个元素</p>
                  <p><code>b&#39;2&#39;</code></p>
                  <p><code>blpop(keys, timeout=0)</code></p>
                  <p>返回并删除名称在<code>keys</code>中的<code>list</code>中的首个元素，如果列表为空，则会一直阻塞等待</p>
                  <p><code>keys</code>：键列表；<code>timeout</code>： 超时等待时间，0为一直等待</p>
                  <p><code>redis.blpop(&#39;list&#39;)</code></p>
                  <p>返回并删除键为<code>list</code>的列表中的第一个元素</p>
                  <p><code>[b&#39;5&#39;]</code></p>
                  <p><code>brpop(keys, timeout=0)</code></p>
                  <p>返回并删除键为<code>name</code>的列表中的尾元素，如果<code>list</code>为空，则会一直阻塞等待</p>
                  <p><code>keys</code>：键列表；<code>timeout</code>：超时等待时间，0为一直等待</p>
                  <p><code>redis.brpop(&#39;list&#39;)</code></p>
                  <p>返回并删除名为<code>list</code>的列表中的最后一个元素</p>
                  <p><code>[b&#39;2&#39;]</code></p>
                  <p><code>rpoplpush(src, dst)</code></p>
                  <p>返回并删除名称为<code>src</code>的列表的尾元素，并将该元素添加到名称为<code>dst</code>的列表头部</p>
                  <p><code>src</code>：源列表的键；<code>dst</code>：目标列表的key</p>
                  <p><code>redis.rpoplpush(&#39;list&#39;, &#39;list2&#39;)</code></p>
                  <p>将键为<code>list</code>的列表尾元素删除并将其添加到键为<code>list2</code>的列表头部，然后返回</p>
                  <p><code>b&#39;2&#39;</code></p>
                  <h2 id="7-集合操作"><a href="#7-集合操作" class="headerlink" title="7. 集合操作"></a>7. 集合操作</h2>
                  <p>Redis还提供了集合存储，集合中的元素都是不重复的，用法如表5-8所示。</p>
                  <p>表5-8 集合操作</p>
                  <p>方法</p>
                  <p>作用</p>
                  <p>参数说明</p>
                  <p>示例</p>
                  <p>示例说明</p>
                  <p>示例结果</p>
                  <p><code>sadd(name, *values)</code></p>
                  <p>向键为<code>name</code>的集合中添加元素</p>
                  <p><code>name</code>：键名；<code>values</code>：值，可为多个</p>
                  <p><code>redis.sadd(&#39;tags&#39;, &#39;Book&#39;, &#39;Tea&#39;, &#39;Coffee&#39;)</code></p>
                  <p>向键为<code>tags</code>的集合中添加<code>Book</code>、<code>Tea</code>和<code>Coffee</code>这3个内容</p>
                  <p>3，即插入的数据个数</p>
                  <p><code>srem(name, *values)</code></p>
                  <p>从键为<code>name</code>的集合中删除元素</p>
                  <p><code>name</code>：键名；<code>values</code>：值，可为多个</p>
                  <p><code>redis.srem(&#39;tags&#39;, &#39;Book&#39;)</code></p>
                  <p>从键为<code>tags</code>的集合中删除<code>Book</code></p>
                  <p>1，即删除的数据个数</p>
                  <p><code>spop(name)</code></p>
                  <p>随机返回并删除键为<code>name</code>的集合中的一个元素</p>
                  <p><code>name</code>：键名</p>
                  <p><code>redis.spop(&#39;tags&#39;)</code></p>
                  <p>从键为<code>tags</code>的集合中随机删除并返回该元素</p>
                  <p><code>b&#39;Tea&#39;</code></p>
                  <p><code>smove(src, dst, value)</code></p>
                  <p>从<code>src</code>对应的集合中移除元素并将其添加到<code>dst</code>对应的集合中</p>
                  <p><code>src</code>：源集合；<code>dst</code>：目标集合；<code>value</code>：元素值</p>
                  <p><code>redis.smove(&#39;tags&#39;, &#39;tags2&#39;, &#39;Coffee&#39;)</code></p>
                  <p>从键为<code>tags</code>的集合中删除元素<code>Coffee</code>并将其添加到键为<code>tags2</code>的集合</p>
                  <p><code>True</code></p>
                  <p><code>scard(name)</code></p>
                  <p>返回键为<code>name</code>的集合的元素个数</p>
                  <p><code>name</code>：键名</p>
                  <p><code>redis.scard(&#39;tags&#39;)</code></p>
                  <p>获取键为<code>tags</code>的集合中的元素个数</p>
                  <p>3</p>
                  <p><code>sismember(name, value)</code></p>
                  <p>测试<code>member</code>是否是键为<code>name</code>的集合的元素</p>
                  <p><code>name</code>：键值</p>
                  <p><code>redis.sismember(&#39;tags&#39;, &#39;Book&#39;)</code></p>
                  <p>判断<code>Book</code>是否是键为<code>tags</code>的集合元素</p>
                  <p><code>True</code></p>
                  <p><code>sinter(keys, *args)</code></p>
                  <p>返回所有给定键的集合的交集</p>
                  <p><code>keys</code>：键列表</p>
                  <p><code>redis.sinter([&#39;tags&#39;, &#39;tags2&#39;])</code></p>
                  <p>返回键为<code>tags</code>的集合和键为<code>tags2</code>的集合的交集</p>
                  <p><code>{b&#39;Coffee&#39;}</code></p>
                  <p><code>sinterstore(dest, keys, *args)</code></p>
                  <p>求交集并将交集保存到<code>dest</code>的集合</p>
                  <p><code>dest</code>：结果集合；<code>keys</code>：键列表</p>
                  <p><code>redis.sinterstore(&#39;inttag&#39;, [&#39;tags&#39;, &#39;tags2&#39;])</code></p>
                  <p>求键为<code>tags</code>的集合和键为<code>tags2</code>的集合的交集并将其保存为<code>inttag</code></p>
                  <p>1</p>
                  <p><code>sunion(keys, *args)</code></p>
                  <p>返回所有给定键的集合的并集</p>
                  <p><code>keys</code>：键列表</p>
                  <p><code>redis.sunion([&#39;tags&#39;, &#39;tags2&#39;])</code></p>
                  <p>返回键为<code>tags</code>的集合和键为<code>tags2</code>的集合的并集</p>
                  <p><code>{b&#39;Coffee&#39;, b&#39;Book&#39;, b&#39;Pen&#39;}</code></p>
                  <p><code>sunionstore(dest, keys, *args)</code></p>
                  <p>求并集并将并集保存到<code>dest</code>的集合</p>
                  <p><code>dest</code>：结果集合；<code>keys</code>：键列表</p>
                  <p><code>redis.sunionstore(&#39;inttag&#39;, [&#39;tags&#39;, &#39;tags2&#39;])</code></p>
                  <p>求键为<code>tags</code>的集合和键为<code>tags2</code>的集合的并集并将其保存为<code>inttag</code></p>
                  <p>3</p>
                  <p><code>sdiff(keys, *args)</code></p>
                  <p>返回所有给定键的集合的差集</p>
                  <p><code>keys</code>：键列表</p>
                  <p><code>redis.sdiff([&#39;tags&#39;, &#39;tags2&#39;])</code></p>
                  <p>返回键为<code>tags</code>的集合和键为<code>tags2</code>的集合的差集</p>
                  <p><code>{b&#39;Book&#39;, b&#39;Pen&#39;}</code></p>
                  <p><code>sdiffstore(dest, keys, *args)</code></p>
                  <p>求差集并将差集保存到<code>dest</code>集合</p>
                  <p><code>dest</code>：结果集合；<code>keys</code>：键列表</p>
                  <p><code>redis.sdiffstore(&#39;inttag&#39;, [&#39;tags&#39;, &#39;tags2&#39;])</code></p>
                  <p>求键为tags<code>的集合和键为</code>tags2<code>的集合的差集并将其保存为</code>inttag`</p>
                  <p>3</p>
                  <p><code>smembers(name)</code></p>
                  <p>返回键为<code>name</code>的集合的所有元素</p>
                  <p><code>name</code>：键名</p>
                  <p><code>redis.smembers(&#39;tags&#39;)</code></p>
                  <p>返回键为<code>tags</code>的集合的所有元素</p>
                  <p><code>{b&#39;Pen&#39;, b&#39;Book&#39;, b&#39;Coffee&#39;}</code></p>
                  <p><code>srandmember(name)</code></p>
                  <p>随机返回键为<code>name</code>的集合中的一个元素，但不删除元素</p>
                  <p><code>name</code>：键值</p>
                  <p><code>redis.srandmember(&#39;tags&#39;)</code></p>
                  <p>随机返回键为<code>tags</code>的集合中的一个元素</p>
                  <h2 id="8-有序集合操作"><a href="#8-有序集合操作" class="headerlink" title="8. 有序集合操作"></a>8. 有序集合操作</h2>
                  <p>有序集合比集合多了一个分数字段，利用它可以对集合中的数据进行排序，其用法总结如表5-9所示。</p>
                  <p>表5-9 有序集合操作</p>
                  <p>方法</p>
                  <p>作用</p>
                  <p>参数说明</p>
                  <p>示例</p>
                  <p>示例说明</p>
                  <p>示例结果</p>
                  <p><code>zadd(name, *args, **kwargs)</code></p>
                  <p>向键为<code>name</code>的zset中添加元素member，score用于排序。如果该元素存在，则更新其顺序</p>
                  <p><code>name</code>： 键名；<code>args</code>：可变参数</p>
                  <p><code>redis.zadd(&#39;grade&#39;, 100, &#39;Bob&#39;, 98, &#39;Mike&#39;)</code></p>
                  <p>向键为<code>grade</code>的zset中添加<code>Bob</code>（其<code>score</code>为100），并添加<code>Mike</code>（其<code>score</code>为98）</p>
                  <p>2，即添加的元素个数</p>
                  <p><code>zrem(name, *values)</code></p>
                  <p>删除键为<code>name</code>的zset中的元素</p>
                  <p><code>name</code>：键名；<code>values</code>：元素</p>
                  <p><code>redis.zrem(&#39;grade&#39;, &#39;Mike&#39;)</code></p>
                  <p>从键为<code>grade</code>的zset中删除<code>Mike</code></p>
                  <p>1，即删除的元素个数</p>
                  <p><code>zincrby(name, value, amount=1)</code></p>
                  <p>如果在键为<code>name</code>的zset中已经存在元素<code>value</code>，则将该元素的<code>score</code>增加<code>amount</code>；否则向该集合中添加该元素，其<code>score</code>的值为<code>amount</code></p>
                  <p><code>name</code>：key名；<code>value</code>：元素；<code>amount</code>：增长的<code>score</code>值</p>
                  <p><code>redis.zincrby(&#39;grade&#39;, &#39;Bob&#39;, -2)</code></p>
                  <p>键为<code>grade</code>的zset中<code>Bob</code>的<code>score</code>减2</p>
                  <p>98.0，即修改后的值</p>
                  <p><code>zrank(name, value)</code></p>
                  <p>返回键为<code>name</code>的zset中元素的排名，按<code>score</code>从小到大排序，即名次</p>
                  <p><code>name</code>：键名；<code>value</code>：元素值</p>
                  <p><code>redis.zrank(&#39;grade&#39;, &#39;Amy&#39;)</code></p>
                  <p>得到键为<code>grade</code>的zset中<code>Amy</code>的排名</p>
                  <p>1</p>
                  <p><code>zrevrank(name, value)</code></p>
                  <p>返回键为<code>name</code>的zset中元素的倒数排名（按<code>score</code>从大到小排序），即名次</p>
                  <p><code>name</code>：键名；<code>value</code>：元素值</p>
                  <p><code>redis.zrevrank(&#39;grade&#39;, &#39;Amy&#39;)</code></p>
                  <p>得到键为<code>grade</code>的zset中<code>Amy</code>的倒数排名</p>
                  <p>2</p>
                  <p><code>zrevrange(name, start, end, withscores=False)</code></p>
                  <p>返回键为<code>name</code>的zset（按<code>score</code>从大到小排序）中<code>index</code>从<code>start</code>到<code>end</code>的所有元素</p>
                  <p><code>name</code>：键值；<code>start</code>：开始索引；<code>end</code>：结束索引；<code>withscores</code>：是否带<code>score</code></p>
                  <p><code>redis.zrevrange(&#39;grade&#39;, 0, 3)</code></p>
                  <p>返回键为<code>grade</code>的zset中前四名元素</p>
                  <p><code>[b&#39;Bob&#39;, b&#39;Mike&#39;, b&#39;Amy&#39;, b&#39;James&#39;]</code></p>
                  <p><code>zrangebyscore(name, min, max, start=None, num=None, withscores=False)</code></p>
                  <p>返回键为<code>name</code>的zset中<code>score</code>在给定区间的元素</p>
                  <p><code>name</code>：键名；<code>min</code>：最低<code>score</code>；<code>max</code>：最高<code>score</code>； <code>start</code>：起始索引；<code>num</code>：个数；<code>withscores</code>：是否带<code>score</code></p>
                  <p><code>redis.zrangebyscore(&#39;grade&#39;, 80, 95)</code></p>
                  <p>返回键为<code>grade</code>的zset中<code>score</code>在80和95之间的元素</p>
                  <p><code>[b&#39;Bob&#39;, b&#39;Mike&#39;, b&#39;Amy&#39;, b&#39;James&#39;]</code></p>
                  <p><code>zcount(name, min, max)</code></p>
                  <p>返回键为<code>name</code>的zset中<code>score</code>在给定区间的数量</p>
                  <p><code>name</code>：键名；<code>min</code>：最低<code>score</code>；max：最高<code>score</code></p>
                  <p><code>redis.zcount(&#39;grade&#39;, 80, 95)</code></p>
                  <p>返回键为<code>grade</code>的zset中<code>score</code>在80到95的元素个数</p>
                  <p>2</p>
                  <p><code>zcard(name)</code></p>
                  <p>返回键为<code>name</code>的zset的元素个数</p>
                  <p><code>name</code>：键名</p>
                  <p><code>redis.zcard(&#39;grade&#39;)</code></p>
                  <p>获取键为<code>grade</code>的zset中元素的个数</p>
                  <p>3</p>
                  <p><code>zremrangebyrank(name, min, max)</code></p>
                  <p>删除键为<code>name</code>的zset中排名在给定区间的元素</p>
                  <p><code>name</code>：键名；<code>min</code>：最低位次；<code>max</code>：最高位次</p>
                  <p><code>redis.zremrangebyrank(&#39;grade&#39;, 0, 0)</code></p>
                  <p>删除键为<code>grade</code>的zset中排名第一的元素</p>
                  <p>1，即删除的元素个数</p>
                  <p><code>zremrangebyscore(name, min, max)</code></p>
                  <p>删除键为<code>name</code>的zset中<code>score</code>在给定区间的元素</p>
                  <p><code>name</code>：键名；<code>min</code>：最低<code>score</code>；<code>max</code>：最高<code>score</code></p>
                  <p><code>redis.zremrangebyscore(&#39;grade&#39;, 80, 90)</code></p>
                  <p>删除<code>score</code>在80到90之间的元素</p>
                  <p>1，即删除的元素个数</p>
                  <h2 id="9-散列操作"><a href="#9-散列操作" class="headerlink" title="9. 散列操作"></a>9. 散列操作</h2>
                  <p>Redis还提供了散列表的数据结构，我们可以用<code>name</code>指定一个散列表的名称，表内存储了各个键值对，用法总结如表5-10所示。</p>
                  <p>表5-10 散列操作</p>
                  <p>方法</p>
                  <p>作用</p>
                  <p>参数说明</p>
                  <p>示例</p>
                  <p>示例说明</p>
                  <p>示例结果</p>
                  <p><code>hset(name, key, value)</code></p>
                  <p>向键为<code>name</code>的散列表中添加映射</p>
                  <p><code>name</code>：键名；<code>key</code>：映射键名；<code>value</code>：映射键值</p>
                  <p><code>hset(&#39;price&#39;, &#39;cake&#39;, 5)</code></p>
                  <p>向键为<code>price</code>的散列表中添加映射关系，<code>cake</code>的值为5</p>
                  <p>1，即添加的映射个数</p>
                  <p><code>hsetnx(name, key, value)</code></p>
                  <p>如果映射键名不存在，则向键为<code>name</code>的散列表中添加映射</p>
                  <p><code>name</code>：键名；<code>key</code>：映射键名；<code>value</code>：映射键值</p>
                  <p><code>hsetnx(&#39;price&#39;, &#39;book&#39;, 6)</code></p>
                  <p>向键为<code>price</code>的散列表中添加映射关系，<code>book</code>的值为6</p>
                  <p>1，即添加的映射个数</p>
                  <p><code>hget(name, key)</code></p>
                  <p>返回键为<code>name</code>的散列表中<code>key</code>对应的值</p>
                  <p><code>name</code>：键名；<code>key</code>：映射键名</p>
                  <p><code>redis.hget(&#39;price&#39;, &#39;cake&#39;)</code></p>
                  <p>获取键为<code>price</code>的散列表中键名为<code>cake</code>的值</p>
                  <p>5</p>
                  <p><code>hmget(name, keys, *args)</code></p>
                  <p>返回键为<code>name</code>的散列表中各个键对应的值</p>
                  <p><code>name</code>：键名；<code>keys</code>：映射键名列表</p>
                  <p><code>redis.hmget(&#39;price&#39;, [&#39;apple&#39;, &#39;orange&#39;])</code></p>
                  <p>获取键为<code>price</code>的散列表中<code>apple</code>和<code>orange</code>的值</p>
                  <p><code>[b&#39;3&#39;, b&#39;7&#39;]</code></p>
                  <p><code>hmset(name, mapping)</code></p>
                  <p>向键为<code>name</code>的散列表中批量添加映射</p>
                  <p><code>name</code>：键名；<code>mapping</code>：映射字典</p>
                  <p><code>redis.hmset(&#39;price&#39;, {&#39;banana&#39;: 2, &#39;pear&#39;: 6})</code></p>
                  <p>向键为<code>price</code>的散列表中批量添加映射</p>
                  <p><code>True</code></p>
                  <p><code>hincrby(name, key, amount=1)</code></p>
                  <p>将键为<code>name</code>的散列表中映射的值增加<code>amount</code></p>
                  <p><code>name</code>：键名；<code>key</code>：映射键名；<code>amount</code>：增长量</p>
                  <p><code>redis.hincrby(&#39;price&#39;, &#39;apple&#39;, 3)</code></p>
                  <p><code>key</code>为<code>price</code>的散列表中<code>apple</code>的值增加3</p>
                  <p>6，修改后的值</p>
                  <p><code>hexists(name, key)</code></p>
                  <p>键为<code>name</code>的散列表中是否存在键名为键的映射</p>
                  <p><code>name</code>：键名；<code>key</code>：映射键名</p>
                  <p><code>redis.hexists(&#39;price&#39;, &#39;banana&#39;)</code></p>
                  <p>键为<code>price</code>的散列表中<code>banana</code>的值是否存在</p>
                  <p><code>True</code></p>
                  <p><code>hdel(name, *keys)</code></p>
                  <p>在键为<code>name</code>的散列表中，删除键名为键的映射</p>
                  <p><code>name</code>：键名；<code>keys</code>：映射键名</p>
                  <p><code>redis.hdel(&#39;price&#39;, &#39;banana&#39;)</code></p>
                  <p>从键为<code>price</code>的散列表中删除键名为<code>banana</code>的映射</p>
                  <p><code>True</code></p>
                  <p><code>hlen(name)</code></p>
                  <p>从键为<code>name</code>的散列表中获取映射个数</p>
                  <p><code>name</code>： 键名</p>
                  <p><code>redis.hlen(&#39;price&#39;)</code></p>
                  <p>从键为<code>price</code>的散列表中获取映射个数</p>
                  <p>6</p>
                  <p><code>hkeys(name)</code></p>
                  <p>从键为<code>name</code>的散列表中获取所有映射键名</p>
                  <p><code>name</code>：键名</p>
                  <p><code>redis.hkeys(&#39;price&#39;)</code></p>
                  <p>从键为<code>price</code>的散列表中获取所有映射键名</p>
                  <p><code>[b&#39;cake&#39;, b&#39;book&#39;, b&#39;banana&#39;, b&#39;pear&#39;]</code></p>
                  <p><code>hvals(name)</code></p>
                  <p>从键为<code>name</code>的散列表中获取所有映射键值</p>
                  <p><code>name</code>：键名</p>
                  <p><code>redis.hvals(&#39;price&#39;)</code></p>
                  <p>从键为<code>price</code>的散列表中获取所有映射键值</p>
                  <p><code>[b&#39;5&#39;, b&#39;6&#39;, b&#39;2&#39;, b&#39;6&#39;]</code></p>
                  <p><code>hgetall(name)</code></p>
                  <p>从键为<code>name</code>的散列表中获取所有映射键值对</p>
                  <p><code>name</code>：键名</p>
                  <p><code>redis.hgetall(&#39;price&#39;)</code></p>
                  <p>从键为<code>price</code>的散列表中获取所有映射键值对</p>
                  <p><code>{b&#39;cake&#39;: b&#39;5&#39;, b&#39;book&#39;: b&#39;6&#39;, b&#39;orange&#39;: b&#39;7&#39;, b&#39;pear&#39;: b&#39;6&#39;}</code></p>
                  <h2 id="10-RedisDump"><a href="#10-RedisDump" class="headerlink" title="10. RedisDump"></a>10. RedisDump</h2>
                  <p>RedisDump提供了强大的Redis数据的导入和导出功能，现在就来看下它的具体用法。</p>
                  <p>首先，确保已经安装好了RedisDump。</p>
                  <p>RedisDump提供了两个可执行命令：<code>redis-dump</code>用于导出数据，<code>redis-load</code>用于导入数据。</p>
                  <h5 id="redis-dump"><a href="#redis-dump" class="headerlink" title="redis-dump"></a><code>redis-dump</code></h5>
                  <p>首先，可以输入如下命令查看所有可选项：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">redis-dump -h</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Usage</span>: redis-dump [<span class="keyword">global</span> <span class="keyword">options</span>] COMMAND [command <span class="keyword">options</span>] </span><br><span class="line">    -u, <span class="comment">--uri=S                      Redis URI (e.g. redis://hostname[:port])</span></span><br><span class="line">    -d, <span class="comment">--database=S                 Redis database (e.g. -d 15)</span></span><br><span class="line">    -s, <span class="comment">--sleep=S                    Sleep for S seconds after dumping (for debugging)</span></span><br><span class="line">    -c, <span class="comment">--count=S                    Chunk size (default: 10000)</span></span><br><span class="line">    -f, <span class="comment">--filter=S                   Filter selected keys (passed directly to redis' KEYS command)</span></span><br><span class="line">    -O, <span class="comment">--without_optimizations      Disable run time optimizations</span></span><br><span class="line">    -V, <span class="comment">--version                    Display version</span></span><br><span class="line">    -D, <span class="comment">--debug</span></span><br><span class="line">        <span class="comment">--nosafe</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中<code>\-u</code>代表Redis连接字符串，<code>\-d</code>代表数据库代号，<code>\-s</code>代表导出之后的休眠时间，<code>\-c</code>代表分块大小，默认是10000，<code>\-f</code>代表导出时的过滤器，<code>\-O</code>代表禁用运行时优化，<code>\-V</code>用于显示版本，<code>\-D</code>表示开启调试。</p>
                  <p>我们拿本地的Redis做测试，运行在6379端口上，密码为foobared，导出命令如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">redis-dump -u :<span class="symbol">foobared@</span>localhost:<span class="number">6379</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果没有密码的话，可以不加密码前缀，命令如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">redis-dump -u localhost:<span class="number">6379</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行之后，可以将本地0至15号数据库的所有数据输出出来，例如：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"James"</span>,<span class="attr">"size"</span>:<span class="number">5</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name2"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"Durant"</span>,<span class="attr">"size"</span>:<span class="number">6</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name3"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"Durant"</span>,<span class="attr">"size"</span>:<span class="number">6</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name4"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"HelloWorld"</span>,<span class="attr">"size"</span>:<span class="number">10</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name5"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"James"</span>,<span class="attr">"size"</span>:<span class="number">5</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name6"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"James"</span>,<span class="attr">"size"</span>:<span class="number">5</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"age"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"1"</span>,<span class="attr">"size"</span>:<span class="number">1</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"age2"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"-5"</span>,<span class="attr">"size"</span>:<span class="number">2</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>每条数据都包含6个字段，其中<code>db</code>即数据库代号，<code>key</code>即键名，<code>ttl</code>即该键值对的有效时间，<code>type</code>即键值类型，<code>value</code>即内容，<code>size</code>即占用空间。</p>
                  <p>如果想要将其输出为JSON行文件，可以使用如下命令：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">redis-dump -u :<span class="symbol">foobared@</span>localhost:<span class="number">6379</span> &gt; ./redis_data.jl</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就可以成功将Redis的所有数据库的所有数据导出成JSON行文件了。</p>
                  <p>另外，可以使用<code>\-d</code>参数指定某个数据库的导出，例如只导出1号数据库的内容：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">redis-dump -u :<span class="symbol">foobared@</span>localhost:<span class="number">6379</span> -d <span class="number">1</span> &gt; ./redis.data.jl</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果只想导出特定的内容，比如想导出以<code>adsl</code>开头的数据，可以加入<code>\-f</code>参数用来过滤，命令如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">redis-dump -<span class="string">u :</span>foobared<span class="meta">@localhost</span>:<span class="number">6379</span> -f <span class="string">adsl:</span>* &gt; ./redis.data.jl</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中<code>\-f</code>参数即Redis的<code>keys</code>命令的参数，可以写一些过滤规则。</p>
                  <h5 id="redis-load"><a href="#redis-load" class="headerlink" title="redis-load"></a><code>redis-load</code></h5>
                  <p>同样，我们可以首先输入如下命令查看所有可选项：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">redis-load -h</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">redis-<span class="built_in">load</span> <span class="comment">--help</span></span><br><span class="line">  Try: redis-<span class="built_in">load</span> [<span class="built_in">global</span> options] COMMAND [<span class="keyword">command</span> <span class="title">options</span>] </span><br><span class="line">    -u, <span class="comment">--uri=S                      Redis URI (e.g. redis://hostname[:port])</span></span><br><span class="line">    -d, <span class="comment">--database=S                 Redis database (e.g. -d 15)</span></span><br><span class="line">    -s, <span class="comment">--sleep=S                    Sleep for S seconds after dumping (for debugging)</span></span><br><span class="line">    -n, <span class="comment">--no_check_utf8</span></span><br><span class="line">    -V, <span class="comment">--version                    Display version</span></span><br><span class="line">    -D, <span class="comment">--debug</span></span><br><span class="line">        <span class="comment">--nosafe</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中<code>\-u</code>代表Redis连接字符串，<code>\-d</code>代表数据库代号，默认是全部，<code>\-s</code>代表导出之后的休眠时间，<code>\-n</code>代表不检测UTF-8编码，<code>\-V</code>表示显示版本，<code>\-D</code>表示开启调试。</p>
                  <p>我们可以将JSON行文件导入到Redis数据库中：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt; redis_data.json redis-load -u :<span class="symbol">foobared@</span>localhost:<span class="number">6379</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就可以成功将JSON行文件导入到数据库中了。</p>
                  <p>另外，下面的命令同样可以达到同样的效果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">cat redis_data.json | redis-load -u :<span class="symbol">foobared@</span>localhost:<span class="number">6379</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>本节中，我们不仅了解了RedisPy对Redis数据库的一些基本操作，还演示了RedisDump对数据的导入导出操作。由于其便捷性和高效性，后面我们会利用Redis实现很多架构，如维护代理池、Cookies池、ADSL拨号代理池、Scrapy-Redis分布式架构等，所以Redis的操作需要好好掌握。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-29 19:43:41" itemprop="dateCreated datePublished" datetime="2018-01-29T19:43:41+08:00">2018-01-29</time>
                </span>
                <span id="/5587.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 5.3.2-Redis存储" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>15k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>14 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5584.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5584.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 5.3.1-MongoDB存储</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>MongoDB是由C++语言编写的非关系型数据库，是一个基于分布式文件存储的开源数据库系统，其内容存储形式类似JSON对象，它的字段值可以包含其他文档、数组及文档数组，非常灵活。在这一节中，我们就来看看Python 3下MongoDB的存储操作。</p>
                  <h2 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h2>
                  <p>在开始之前，请确保已经安装好了MongoDB并启动了其服务，并且安装好了Python的PyMongo库。如果没有安装，可以参考第1章。</p>
                  <h2 id="2-连接MongoDB"><a href="#2-连接MongoDB" class="headerlink" title="2. 连接MongoDB"></a>2. 连接MongoDB</h2>
                  <p>连接MongoDB时，我们需要使用PyMongo库里面的<code>MongoClient</code>。一般来说，传入MongoDB的IP及端口即可，其中第一个参数为地址<code>host</code>，第二个参数为端口<code>port</code>（如果不给它传递参数，默认是27017）：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pymongo</span><br><span class="line">client = pymongo.MongoClient(<span class="attribute">host</span>=<span class="string">'localhost'</span>, <span class="attribute">port</span>=27017)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就可以创建MongoDB的连接对象了。</p>
                  <p>另外，<code>MongoClient</code>的第一个参数<code>host</code>还可以直接传入MongoDB的连接字符串，它以<code>mongodb</code>开头，例如：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">client</span> = MongoClient(<span class="string">'mongodb://localhost:27017/'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这也可以达到同样的连接效果。</p>
                  <h2 id="3-指定数据库"><a href="#3-指定数据库" class="headerlink" title="3. 指定数据库"></a>3. 指定数据库</h2>
                  <p>MongoDB中可以建立多个数据库，接下来我们需要指定操作哪个数据库。这里我们以test数据库为例来说明，下一步需要在程序中指定要使用的数据库：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">db</span> = client.test</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里调用<code>client</code>的<code>test</code>属性即可返回test数据库。当然，我们也可以这样指定：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">db</span> = client[<span class="string">'test'</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这两种方式是等价的。</p>
                  <h2 id="4-指定集合"><a href="#4-指定集合" class="headerlink" title="4. 指定集合"></a>4. 指定集合</h2>
                  <p>MongoDB的每个数据库又包含许多集合（collection），它们类似于关系型数据库中的表。</p>
                  <p>下一步需要指定要操作的集合，这里指定一个集合名称为students。与指定数据库类似，指定集合也有两种方式：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">collection</span> = db.students</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">collection</span> = db[<span class="string">'students'</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们便声明了一个<code>Collection</code>对象。</p>
                  <h2 id="5-插入数据"><a href="#5-插入数据" class="headerlink" title="5. 插入数据"></a>5. 插入数据</h2>
                  <p>接下来，便可以插入数据了。对于students这个集合，新建一条学生数据，这条数据以字典形式表示：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">student = &#123;</span><br><span class="line">    'id': '<span class="number">20170101</span>',</span><br><span class="line">    'name': 'Jordan',</span><br><span class="line">    'age': <span class="number">20</span>,</span><br><span class="line">    'gender': 'male'</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里指定了学生的学号、姓名、年龄和性别。接下来，直接调用<code>collection</code>的<code>insert()</code>方法即可插入数据，代码如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable"><span class="class">result</span></span> = <span class="variable">collection.insert</span>(<span class="variable">student</span>)</span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable"><span class="class">result</span></span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在MongoDB中，每条数据其实都有一个<code>_id</code>属性来唯一标识。如果没有显式指明该属性，MongoDB会自动产生一个<code>ObjectId</code>类型的<code>_id</code>属性。<code>insert()</code>方法会在执行后返回<code>_id</code>值。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight llvm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">5932</span>a<span class="number">68615</span><span class="keyword">c</span><span class="number">2606814</span><span class="keyword">c</span><span class="number">91</span>f<span class="number">3</span>d</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然，我们也可以同时插入多条数据，只需要以列表形式传递即可，示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">student1 = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'20170101'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'Jordan'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="string">'gender'</span>: <span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">student2 = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'20170202'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'Mike'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">21</span>,</span><br><span class="line">    <span class="string">'gender'</span>: <span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result = collection.insert([student1, student2])</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>返回结果是对应的<code>_id</code>的集合：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[ObjectId('<span class="number">5932</span>a<span class="number">8011</span>5c<span class="number">2606</span>a59e8a048'), ObjectId('<span class="number">5932</span>a<span class="number">8011</span>5c<span class="number">2606</span>a59e8a049')]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>实际上，在PyMongo 3.x版本中，官方已经不推荐使用<code>insert()</code>方法了。当然，继续使用也没有什么问题。官方推荐使用<code>insert_one()</code>和<code>insert_many()</code>方法来分别插入单条记录和多条记录，示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">student = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'20170101'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'Jordan'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="string">'gender'</span>: <span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result = collection.insert_one(student)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result.inserted_id)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight llvm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;pymongo.results.InsertOneResult object at <span class="number">0x10d68b558</span>&gt;</span><br><span class="line"><span class="number">5932</span>ab<span class="number">0</span>f<span class="number">15</span><span class="keyword">c</span><span class="number">2606</span>f<span class="number">0</span><span class="keyword">c</span><span class="number">1</span>cf<span class="number">6</span><span class="keyword">c</span><span class="number">5</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>与<code>insert()</code>方法不同，这次返回的是<code>InsertOneResult</code>对象，我们可以调用其<code>inserted_id</code>属性获取<code>_id</code>。</p>
                  <p>对于<code>insert_many()</code>方法，我们可以将数据以列表形式传递，示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">student1 = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'20170101'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'Jordan'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="string">'gender'</span>: <span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">student2 = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'20170202'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'Mike'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">21</span>,</span><br><span class="line">    <span class="string">'gender'</span>: <span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result = collection.insert_many([student1, student2])</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result.inserted_ids)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;pymongo.results.InsertManyResult object at <span class="number">0</span>x101dea558&gt;</span><br><span class="line">[ObjectId('<span class="number">5932</span>abf415c<span class="number">260708</span>3d3b2ac'), ObjectId('<span class="number">5932</span>abf415c<span class="number">260708</span>3d3b2ad')]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>该方法返回的类型是<code>InsertManyResult</code>，调用<code>inserted_ids</code>属性可以获取插入数据的<code>_id</code>列表。</p>
                  <h2 id="6-查询"><a href="#6-查询" class="headerlink" title="6. 查询"></a>6. 查询</h2>
                  <p>插入数据后，我们可以利用<code>find_one()</code>或<code>find()</code>方法进行查询，其中<code>find_one()</code>查询得到的是单个结果，<code>find()</code>则返回一个生成器对象。示例如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable"><span class="class">result</span></span> = <span class="variable">collection.find_one</span>(&#123;<span class="string">'name'</span>: <span class="string">'Mike'</span>&#125;)</span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="title">type</span>(<span class="variable"><span class="class">result</span></span>))</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable"><span class="class">result</span></span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们查询<code>name</code>为<code>Mike</code>的数据，它的返回结果是字典类型，运行结果如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;class 'dict'&gt;</span><br><span class="line">&#123;'_id': ObjectId('<span class="number">5932</span>a<span class="number">8011</span>5c<span class="number">2606</span>a59e8a049'), 'id': '<span class="number">20170202</span>', 'name': 'Mike', 'age': <span class="number">21</span>, 'gender': 'male'&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，它多了<code>_id</code>属性，这就是MongoDB在插入过程中自动添加的。</p>
                  <p>此外，我们也可以根据<code>ObjectId</code>来查询，此时需要使用bson库里面的<code>objectid</code>：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">from</span> <span class="variable">bson.objectid</span> <span class="variable">import</span> <span class="variable">ObjectId</span></span><br><span class="line"></span><br><span class="line"><span class="variable"><span class="class">result</span></span> = <span class="variable">collection.find_one</span>(&#123;<span class="string">'_id'</span>: <span class="function"><span class="title">ObjectId</span>(<span class="string">'593278c115c2602667ec6bae'</span>)&#125;)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable"><span class="class">result</span></span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其查询结果依然是字典类型，具体如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;'_id': ObjectId('<span class="number">593278</span>c115c<span class="number">260266</span>7ec6bae'), 'id': '<span class="number">20170101</span>', 'name': 'Jordan', 'age': <span class="number">20</span>, 'gender': 'male'&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然，如果查询结果不存在，则会返回<code>None</code>。</p>
                  <p>对于多条数据的查询，我们可以使用<code>find()</code>方法。例如，这里查找年龄为20的数据，示例如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">results</span> = <span class="variable">collection.find</span>(&#123;<span class="string">'age'</span>: <span class="number">20</span>&#125;)</span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable">results</span>)</span></span><br><span class="line"><span class="variable">for</span> <span class="variable"><span class="class">result</span></span> <span class="variable"><span class="keyword">in</span></span> <span class="variable">results</span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="variable"><span class="class">result</span></span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;pymongo.cursor.Cursor object at <span class="number">0</span>x1032d5128&gt;</span><br><span class="line">&#123;'_id': ObjectId('<span class="number">593278</span>c115c<span class="number">260266</span>7ec6bae'), 'id': '<span class="number">20170101</span>', 'name': 'Jordan', 'age': <span class="number">20</span>, 'gender': 'male'&#125;</span><br><span class="line">&#123;'_id': ObjectId('<span class="number">593278</span>c815c<span class="number">260267</span>8bb2b8d'), 'id': '<span class="number">20170102</span>', 'name': 'Kevin', 'age': <span class="number">20</span>, 'gender': 'male'&#125;</span><br><span class="line">&#123;'_id': ObjectId('<span class="number">593278</span>d815c<span class="number">260269</span>d<span class="number">7645</span>a8'), 'id': '<span class="number">20170103</span>', 'name': 'Harden', 'age': <span class="number">20</span>, 'gender': 'male'&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>返回结果是<code>Cursor</code>类型，它相当于一个生成器，我们需要遍历取到所有的结果，其中每个结果都是字典类型。</p>
                  <p>如果要查询年龄大于20的数据，则写法如下：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">results</span> = collection.find(&#123;<span class="string">'age'</span>: &#123;<span class="string">'$gt'</span>: <span class="number">20</span>&#125;&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里查询的条件键值已经不是单纯的数字了，而是一个字典，其键名为比较符号<code>$gt</code>，意思是大于，键值为20。</p>
                  <p>这里将比较符号归纳为表5-3。</p>
                  <p>表5-3 比较符号</p>
                  <p>符号</p>
                  <p>含义</p>
                  <p>示例</p>
                  <p><code>$lt</code></p>
                  <p>小于</p>
                  <p><code>{&#39;age&#39;: {&#39;$lt&#39;: 20}}</code></p>
                  <p><code>$gt</code></p>
                  <p>大于</p>
                  <p><code>{&#39;age&#39;: {&#39;$gt&#39;: 20}}</code></p>
                  <p><code>$lte</code></p>
                  <p>小于等于</p>
                  <p><code>{&#39;age&#39;: {&#39;$lte&#39;: 20}}</code></p>
                  <p><code>$gte</code></p>
                  <p>大于等于</p>
                  <p><code>{&#39;age&#39;: {&#39;$gte&#39;: 20}}</code></p>
                  <p><code>$ne</code></p>
                  <p>不等于</p>
                  <p><code>{&#39;age&#39;: {&#39;$ne&#39;: 20}}</code></p>
                  <p><code>$in</code></p>
                  <p>在范围内</p>
                  <p><code>{&#39;age&#39;: {&#39;$in&#39;: [20, 23]}}</code></p>
                  <p><code>$nin</code></p>
                  <p>不在范围内</p>
                  <p><code>{&#39;age&#39;: {&#39;$nin&#39;: [20, 23]}}</code></p>
                  <p>另外，还可以进行正则匹配查询。例如，查询名字以M开头的学生数据，示例如下：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">results</span> = collection.find(&#123;<span class="string">'name'</span>: &#123;<span class="string">'$regex'</span>: <span class="string">'^M.*'</span>&#125;&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里使用<code>$regex</code>来指定正则匹配，<code>^M.*</code>代表以M开头的正则表达式。</p>
                  <p>这里将一些功能符号再归类为表5-4。</p>
                  <p>表5-4 功能符号</p>
                  <p>符号</p>
                  <p>含义</p>
                  <p>示例</p>
                  <p>示例含义</p>
                  <p><code>$regex</code></p>
                  <p>匹配正则表达式</p>
                  <p><code>{&#39;name&#39;: {&#39;$regex&#39;: &#39;^M.*&#39;}}</code></p>
                  <p><code>name</code>以M开头</p>
                  <p><code>$exists</code></p>
                  <p>属性是否存在</p>
                  <p><code>{&#39;name&#39;: {&#39;$exists&#39;: True}}</code></p>
                  <p><code>name</code>属性存在</p>
                  <p><code>$type</code></p>
                  <p>类型判断</p>
                  <p><code>{&#39;age&#39;: {&#39;$type&#39;: &#39;int&#39;}}</code></p>
                  <p><code>age</code>的类型为<code>int</code></p>
                  <p><code>$mod</code></p>
                  <p>数字模操作</p>
                  <p><code>{&#39;age&#39;: {&#39;$mod&#39;: [5, 0]}}</code></p>
                  <p>年龄模5余0</p>
                  <p><code>$text</code></p>
                  <p>文本查询</p>
                  <p><code>{&#39;$text&#39;: {&#39;$search&#39;: &#39;Mike&#39;}}</code></p>
                  <p><code>text</code>类型的属性中包含<code>Mike</code>字符串</p>
                  <p><code>$where</code></p>
                  <p>高级条件查询</p>
                  <p><code>{&#39;$where&#39;: &#39;obj.fans_count == obj.follows_count&#39;}</code></p>
                  <p>自身粉丝数等于关注数</p>
                  <p>关于这些操作的更详细用法，可以在MongoDB官方文档找到：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1vbmdvZGIuY29tL21hbnVhbC9yZWZlcmVuY2Uvb3BlcmF0b3IvcXVlcnkv">https://docs.mongodb.com/manual/reference/operator/query/<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="7-计数"><a href="#7-计数" class="headerlink" title="7. 计数"></a>7. 计数</h2>
                  <p>要统计查询结果有多少条数据，可以调用<code>count()</code>方法。比如，统计所有数据条数：</p>
                  <figure class="highlight gradle">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">count</span> = collection.<span class="keyword">find</span>().<span class="keyword">count</span>()</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">count</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或者统计符合某个条件的数据：</p>
                  <figure class="highlight gradle">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">count</span> = collection.<span class="keyword">find</span>(&#123;<span class="string">'age'</span>: <span class="number">20</span>&#125;).<span class="keyword">count</span>()</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">count</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果是一个数值，即符合条件的数据条数。</p>
                  <h2 id="8-排序"><a href="#8-排序" class="headerlink" title="8. 排序"></a>8. 排序</h2>
                  <p>排序时，直接调用<code>sort()</code>方法，并在其中传入排序的字段及升降序标志即可。示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">results = collection.<span class="builtin-name">find</span>().sort(<span class="string">'name'</span>, pymongo.ASCENDING)</span><br><span class="line"><span class="builtin-name">print</span>([result[<span class="string">'name'</span>] <span class="keyword">for</span> result <span class="keyword">in</span> results])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'Harden</span>', <span class="symbol">'Jordan</span>', <span class="symbol">'Kevin</span>', <span class="symbol">'Mark</span>', <span class="symbol">'Mike</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们调用<code>pymongo.ASCENDING</code>指定升序。如果要降序排列，可以传入<code>pymongo.DESCENDING</code>。</p>
                  <h2 id="9-偏移"><a href="#9-偏移" class="headerlink" title="9. 偏移"></a>9. 偏移</h2>
                  <p>在某些情况下，我们可能想只取某几个元素，这时可以利用<code>skip()</code>方法偏移几个位置，比如偏移2，就忽略前两个元素，得到第三个及以后的元素：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">results = collection.<span class="builtin-name">find</span>().sort(<span class="string">'name'</span>, pymongo.ASCENDING).skip(2)</span><br><span class="line"><span class="builtin-name">print</span>([result[<span class="string">'name'</span>] <span class="keyword">for</span> result <span class="keyword">in</span> results])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'Kevin</span>', <span class="symbol">'Mark</span>', <span class="symbol">'Mike</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外，还可以用<code>limit()</code>方法指定要取的结果个数，示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">results = collection.<span class="builtin-name">find</span>().sort(<span class="string">'name'</span>, pymongo.ASCENDING).skip(2).limit(2)</span><br><span class="line"><span class="builtin-name">print</span>([result[<span class="string">'name'</span>] <span class="keyword">for</span> result <span class="keyword">in</span> results])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'Kevin</span>', <span class="symbol">'Mark</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果不使用<code>limit()</code>方法，原本会返回三个结果，加了限制后，会截取两个结果返回。</p>
                  <p>值得注意的是，在数据库数量非常庞大的时候，如千万、亿级别，最好不要使用大的偏移量来查询数据，因为这样很可能导致内存溢出。此时可以使用类似如下操作来查询：</p>
                  <figure class="highlight gradle">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> bson.objectid <span class="keyword">import</span> ObjectId</span><br><span class="line">collection.<span class="keyword">find</span>(&#123;<span class="string">'_id'</span>: &#123;<span class="string">'$gt'</span>: ObjectId(<span class="string">'593278c815c2602678bb2b8d'</span>)&#125;&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时需要记录好上次查询的<code>_id</code>。</p>
                  <h2 id="10-更新"><a href="#10-更新" class="headerlink" title="10. 更新"></a>10. 更新</h2>
                  <p>对于数据更新，我们可以使用<code>update()</code>方法，指定更新的条件和更新后的数据即可。例如：</p>
                  <figure class="highlight mel">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">condition</span> = &#123;<span class="string">'name'</span>: <span class="string">'Kevin'</span>&#125;</span><br><span class="line">student = collection.find_one(<span class="keyword">condition</span>)</span><br><span class="line">student[<span class="string">'age'</span>] = <span class="number">25</span></span><br><span class="line">result = collection.update(<span class="keyword">condition</span>, student)</span><br><span class="line"><span class="keyword">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们要更新<code>name</code>为<code>Kevin</code>的数据的年龄：首先指定查询条件，然后将数据查询出来，修改年龄后调用<code>update()</code>方法将原条件和修改后的数据传入。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">&#123;'ok':</span> <span class="number">1</span><span class="string">,</span> <span class="attr">'nModified':</span> <span class="number">1</span><span class="string">,</span> <span class="attr">'n':</span> <span class="number">1</span><span class="string">,</span> <span class="attr">'updatedExisting':</span> <span class="literal">True</span><span class="string">&#125;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>返回结果是字典形式，<code>ok</code>代表执行成功，<code>nModified</code>代表影响的数据条数。</p>
                  <p>另外，我们也可以使用<code>$set</code>操作符对数据进行更新，代码如下：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">result</span> = collection.update(condition, &#123;<span class="string">'$set'</span>: student&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样可以只更新<code>student</code>字典内存在的字段。如果原先还有其他字段，则不会更新，也不会删除。而如果不用<code>$set</code>的话，则会把之前的数据全部用<code>student</code>字典替换；如果原本存在其他字段，则会被删除。</p>
                  <p>另外，<code>update()</code>方法其实也是官方不推荐使用的方法。这里也分为<code>update_one()</code>方法和<code>update_many()</code>方法，用法更加严格，它们的第二个参数需要使用<code>$</code>类型操作符作为字典的键名，示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">condition = &#123;<span class="string">'name'</span>: <span class="string">'Kevin'</span>&#125;</span><br><span class="line">student = collection.find_one(condition)</span><br><span class="line">student[<span class="string">'age'</span>] = <span class="number">26</span></span><br><span class="line">result = collection.update_one(condition, &#123;<span class="string">'$set'</span>: student&#125;)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result.matched_count, result.modified_count)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里调用了<code>update_one()</code>方法，第二个参数不能再直接传入修改后的字典，而是需要使用<code>{&#39;$set&#39;: student}</code>这样的形式，其返回结果是<code>UpdateResult</code>类型。然后分别调用<code>matched_count</code>和<code>modified_count</code>属性，可以获得匹配的数据条数和影响的数据条数。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;pymongo.results.UpdateResult object at <span class="number">0x10d17b678</span>&gt;</span><br><span class="line"><span class="number">1</span> <span class="number">0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们再看一个例子：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">condition = &#123;<span class="string">'age'</span>: &#123;<span class="string">'$gt'</span>: <span class="number">20</span>&#125;&#125;</span><br><span class="line">result = collection.update_one(condition, &#123;<span class="string">'$inc'</span>: &#123;<span class="string">'age'</span>: <span class="number">1</span>&#125;&#125;)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result.matched_count, result.modified_count)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里指定查询条件为年龄大于20，然后更新条件为<code>{&#39;$inc&#39;: {&#39;age&#39;: 1}}</code>，也就是年龄加1，执行之后会将第一条符合条件的数据年龄加1。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;pymongo.results.UpdateResult object at <span class="number">0x10b8874c8</span>&gt;</span><br><span class="line"><span class="number">1</span> <span class="number">1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到匹配条数为1条，影响条数也为1条。</p>
                  <p>如果调用<code>update_many()</code>方法，则会将所有符合条件的数据都更新，示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">condition = &#123;<span class="string">'age'</span>: &#123;<span class="string">'$gt'</span>: <span class="number">20</span>&#125;&#125;</span><br><span class="line">result = collection.update_many(condition, &#123;<span class="string">'$inc'</span>: &#123;<span class="string">'age'</span>: <span class="number">1</span>&#125;&#125;)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result.matched_count, result.modified_count)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时匹配条数就不再为1条了，运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;pymongo.results.UpdateResult object at <span class="number">0x10c6384c8</span>&gt;</span><br><span class="line"><span class="number">3</span> <span class="number">3</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这时所有匹配到的数据都会被更新。</p>
                  <h2 id="11-删除"><a href="#11-删除" class="headerlink" title="11. 删除"></a>11. 删除</h2>
                  <p>删除操作比较简单，直接调用<code>remove()</code>方法指定删除的条件即可，此时符合条件的所有数据均会被删除。示例如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable"><span class="class">result</span></span> = <span class="variable">collection.remove</span>(&#123;<span class="string">'name'</span>: <span class="string">'Kevin'</span>&#125;)</span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable"><span class="class">result</span></span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">&#123;'ok':</span> <span class="number">1</span><span class="string">,</span> <span class="attr">'n':</span> <span class="number">1</span><span class="string">&#125;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外，这里依然存在两个新的推荐方法——<code>delete_one()</code>和<code>delete_many()</code>。示例如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable"><span class="class">result</span></span> = <span class="variable">collection.delete_one</span>(&#123;<span class="string">'name'</span>: <span class="string">'Kevin'</span>&#125;)</span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable"><span class="class">result</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable"><span class="class">result</span>.deleted_count</span>)</span></span><br><span class="line"><span class="variable"><span class="class">result</span></span> = <span class="variable">collection.delete_many</span>(&#123;<span class="string">'age'</span>: &#123;<span class="string">'$lt'</span>: <span class="number">25</span>&#125;&#125;)</span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable"><span class="class">result</span>.deleted_count</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;pymongo.results.DeleteResult object at <span class="number">0x10e6ba4c8</span>&gt;</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">4</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><code>delete_one()</code>即删除第一条符合条件的数据，<code>delete_many()</code>即删除所有符合条件的数据。它们的返回结果都是<code>DeleteResult</code>类型，可以调用<code>deleted_count</code>属性获取删除的数据条数。</p>
                  <h2 id="12-其他操作"><a href="#12-其他操作" class="headerlink" title="12. 其他操作"></a>12. 其他操作</h2>
                  <p>另外，PyMongo还提供了一些组合方法，如<code>find_one_and_delete()</code>、<code>find_one_and_replace()</code>和<code>find_one_and_update()</code>，它们是查找后删除、替换和更新操作，其用法与上述方法基本一致。</p>
                  <p>另外，还可以对索引进行操作，相关方法有<code>create_index()</code>、<code>create_indexes()</code>和<code>drop_index()</code>等。</p>
                  <p>关于PyMongo的详细用法，可以参见官方文档：<span class="exturl" data-url="aHR0cDovL2FwaS5tb25nb2RiLmNvbS9weXRob24vY3VycmVudC9hcGkvcHltb25nby9jb2xsZWN0aW9uLmh0bWw=">http://api.mongodb.com/python/current/api/pymongo/collection.html<i class="fa fa-external-link-alt"></i></span>。</p>
                  <p>另外，还有对数据库和集合本身等的一些操作，这里不再一一讲解，可以参见官方文档：<span class="exturl" data-url="aHR0cDovL2FwaS5tb25nb2RiLmNvbS9weXRob24vY3VycmVudC9hcGkvcHltb25nby8=">http://api.mongodb.com/python/current/api/pymongo/<i class="fa fa-external-link-alt"></i></span>。</p>
                  <p>本节讲解了使用PyMongo操作MongoDB进行数据增删改查的方法，后面我们会在实战案例中应用这些操作进行数据存储。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-29 19:37:47" itemprop="dateCreated datePublished" datetime="2018-01-29T19:37:47+08:00">2018-01-29</time>
                </span>
                <span id="/5584.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 5.3.1-MongoDB存储" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>8.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>8 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5581.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5581.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 5.3-非关系型数据库存储</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>NoSQL，全称Not Only SQL，意为不仅仅是SQL，泛指非关系型数据库。NoSQL是基于键值对的，而且不需要经过SQL层的解析，数据之间没有耦合性，性能非常高。</p>
                  <p>非关系型数据库又可细分如下。</p>
                  <ul>
                    <li><strong>键值存储数据库</strong>：代表有Redis、Voldemort和Oracle BDB等。</li>
                    <li><strong>列存储数据库</strong>：代表有Cassandra、HBase和Riak等。</li>
                    <li><strong>文档型数据库</strong>：代表有CouchDB和MongoDB等。</li>
                    <li><strong>图形数据库</strong>：代表有Neo4J、InfoGrid和Infinite Graph等。</li>
                  </ul>
                  <p>对于爬虫的数据存储来说，一条数据可能存在某些字段提取失败而缺失的情况，而且数据可能随时调整。另外，数据之间还存在嵌套关系。如果使用关系型数据库存储，一是需要提前建表，二是如果存在数据嵌套关系的话，需要进行序列化操作才可以存储，这非常不方便。如果用了非关系型数据库，就可以避免一些麻烦，更简单高效。</p>
                  <p>本节中，我们主要介绍MongoDB和Redis的数据存储操作。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-29 19:35:58" itemprop="dateCreated datePublished" datetime="2018-01-29T19:35:58+08:00">2018-01-29</time>
                </span>
                <span id="/5581.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 5.3-非关系型数据库存储" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>412</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5578.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5578.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 5.2.1-MySQL存储</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在Python 2中，连接MySQL的库大多是使用MySQLdb，但是此库的官方并不支持Python 3，所以这里推荐使用的库是PyMySQL。</p>
                  <p>本节中，我们就来讲解使用PyMySQL操作MySQL数据库的方法。</p>
                  <h2 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h2>
                  <p>在开始之前，请确保已经安装好了MySQL数据库并保证它能正常运行，而且需要安装好PyMySQL库。如果没有安装，可以参考第1章。</p>
                  <h2 id="2-连接数据库"><a href="#2-连接数据库" class="headerlink" title="2. 连接数据库"></a>2. 连接数据库</h2>
                  <p>这里，首先尝试连接一下数据库。假设当前的MySQL运行在本地，用户名为root，密码为123456，运行端口为3306。这里利用PyMySQL先连接MySQL，然后创建一个新的数据库，名字叫作spiders，代码如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.<span class="keyword">connect</span>(host=<span class="string">'localhost'</span>,<span class="keyword">user</span>=<span class="string">'root'</span>, <span class="keyword">password</span>=<span class="string">'123456'</span>, port=<span class="number">3306</span>)</span><br><span class="line"><span class="keyword">cursor</span> = db.<span class="keyword">cursor</span>()</span><br><span class="line"><span class="keyword">cursor</span>.<span class="keyword">execute</span>(<span class="string">'SELECT VERSION()'</span>)</span><br><span class="line">data = <span class="keyword">cursor</span>.fetchone()</span><br><span class="line">print(<span class="string">'Database version:'</span>, data)</span><br><span class="line"><span class="keyword">cursor</span>.<span class="keyword">execute</span>("CREATE DATABASE spiders DEFAULT CHARACTER SET utf8")</span><br><span class="line">db.<span class="keyword">close</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Database</span> <span class="keyword">version</span>: (<span class="string">'5.6.22'</span>,)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里通过PyMySQL的<code>connect()</code>方法声明一个MySQL连接对象<code>db</code>，此时需要传入MySQL运行的<code>host</code>（即IP）。由于MySQL在本地运行，所以传入的是<code>localhost</code>。如果MySQL在远程运行，则传入其公网IP地址。后续的参数<code>user</code>即用户名，<code>password</code>即密码，<code>port</code>即端口（默认为<code>3306</code>）。</p>
                  <p>连接成功后，需要再调用<code>cursor()</code>方法获得MySQL的操作游标，利用游标来执行SQL语句。这里我们执行了两句SQL，直接用<code>execute()</code>方法执行即可。第一句SQL用于获得MySQL的当前版本，然后调用<code>fetchone()</code>方法获得第一条数据，也就得到了版本号。第二句SQL执行创建数据库的操作，数据库名叫作spiders，默认编码为UTF-8。由于该语句不是查询语句，所以直接执行后就成功创建了数据库spiders。接着，再利用这个数据库进行后续的操作。</p>
                  <h2 id="3-创建表"><a href="#3-创建表" class="headerlink" title="3. 创建表"></a>3. 创建表</h2>
                  <p>一般来说，创建数据库的操作只需要执行一次就好了。当然，我们也可以手动创建数据库。以后，我们的操作都在spiders数据库上执行。</p>
                  <p>创建数据库后，在连接时需要额外指定一个参数<code>db</code>。</p>
                  <p>接下来，新创建一个数据表students，此时执行创建表的SQL语句即可。这里指定3个字段，结构如表5-1所示。</p>
                  <p>表5-1 数据表students</p>
                  <p>字段名</p>
                  <p>含义</p>
                  <p>类型</p>
                  <p><code>id</code></p>
                  <p>学号</p>
                  <p><code>varchar</code></p>
                  <p><code>name</code></p>
                  <p>姓名</p>
                  <p><code>varchar</code></p>
                  <p><code>age</code></p>
                  <p>年龄</p>
                  <p><code>int</code></p>
                  <p>创建该表的示例代码如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.<span class="keyword">connect</span>(host=<span class="string">'localhost'</span>, <span class="keyword">user</span>=<span class="string">'root'</span>, <span class="keyword">password</span>=<span class="string">'123456'</span>, port=<span class="number">3306</span>, db=<span class="string">'spiders'</span>)</span><br><span class="line"><span class="keyword">cursor</span> = db.<span class="keyword">cursor</span>()</span><br><span class="line"><span class="keyword">sql</span> = <span class="string">'CREATE TABLE IF NOT EXISTS students (id VARCHAR(255) NOT NULL, name VARCHAR(255) NOT NULL, age INT NOT NULL, PRIMARY KEY (id))'</span></span><br><span class="line"><span class="keyword">cursor</span>.<span class="keyword">execute</span>(<span class="keyword">sql</span>)</span><br><span class="line">db.<span class="keyword">close</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行之后，我们便创建了一个名为students的数据表。</p>
                  <p>当然，为了演示，这里只指定了最简单的几个字段。实际上，在爬虫过程中，我们会根据爬取结果设计特定的字段。</p>
                  <h2 id="4-插入数据"><a href="#4-插入数据" class="headerlink" title="4. 插入数据"></a>4. 插入数据</h2>
                  <p>下一步就是向数据库中插入数据了。例如，这里爬取了一个学生信息，学号为20120001，名字为Bob，年龄为20，那么如何将该条数据插入数据库呢？示例代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line">id = <span class="string">'20120001'</span></span><br><span class="line">user = <span class="string">'Bob'</span></span><br><span class="line">age = 20</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(<span class="attribute">host</span>=<span class="string">'localhost'</span>, <span class="attribute">user</span>=<span class="string">'root'</span>, <span class="attribute">password</span>=<span class="string">'123456'</span>, <span class="attribute">port</span>=3306, <span class="attribute">db</span>=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">'INSERT INTO students(id, name, age) values(%s, %s, %s)'</span></span><br><span class="line">try:</span><br><span class="line">    cursor.execute(sql, (id, user, age))</span><br><span class="line">    db.commit()</span><br><span class="line">except:</span><br><span class="line">    db.rollback()</span><br><span class="line">db.close()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先构造了一个SQL语句，其<code>Value</code>值没有用字符串拼接的方式来构造，如：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sql = '<span class="keyword">INSERT</span> <span class="keyword">INTO</span> students(<span class="keyword">id</span>, <span class="keyword">name</span>, age) <span class="keyword">values</span>(<span class="string">' + id + '</span>, <span class="string">' + name + '</span>, <span class="string">' + age + '</span>)<span class="string">'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样的写法烦琐而且不直观，所以我们选择直接用格式化符<code>%s</code>来实现。有几个<code>Value</code>写几个<code>%s</code>，我们只需要在<code>execute()</code>方法的第一个参数传入该SQL语句，<code>Value</code>值用统一的元组传过来就好了。这样的写法既可以避免字符串拼接的麻烦，又可以避免引号冲突的问题。</p>
                  <p>之后值得注意的是，需要执行<code>db</code>对象的<code>commit()</code>方法才可实现数据插入，这个方法才是真正将语句提交到数据库执行的方法。对于数据插入、更新、删除操作，都需要调用该方法才能生效。</p>
                  <p>接下来，我们加了一层异常处理。如果执行失败，则调用<code>rollback()</code>执行数据回滚，相当于什么都没有发生过。</p>
                  <p>这里涉及事务的问题。事务机制可以确保数据的一致性，也就是这件事要么发生了，要么没有发生。比如插入一条数据，不会存在插入一半的情况，要么全部插入，要么都不插入，这就是事务的原子性。另外，事务还有3个属性——一致性、隔离性和持久性。这4个属性通常称为ACID特性，具体如表5-2所示。</p>
                  <p>表5-2 事务的4个属性</p>
                  <p>属性</p>
                  <p>解释</p>
                  <p>原子性（atomicity）</p>
                  <p>事务是一个不可分割的工作单位，事务中包括的诸操作要么都做，要么都不做</p>
                  <p>一致性（consistency）</p>
                  <p>事务必须使数据库从一个一致性状态变到另一个一致性状态。一致性与原子性是密切相关的</p>
                  <p>隔离性（isolation）</p>
                  <p>一个事务的执行不能被其他事务干扰，即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰</p>
                  <p>持久性（durability）</p>
                  <p>持续性也称永久性（permanence），指一个事务一旦提交，它对数据库中数据的改变就应该是永久性的。接下来的其他操作或故障不应该对其有任何影响</p>
                  <p>插入、更新和删除操作都是对数据库进行更改的操作，而更改操作都必须为一个事务，所以这些操作的标准写法就是：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">cursor</span>.<span class="keyword">execute</span>(sql)</span><br><span class="line">    db.commit()</span><br><span class="line">excep<span class="variable">t:</span></span><br><span class="line">    db.rollback()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样便可以保证数据的一致性。这里的<code>commit()</code>和<code>rollback()</code>方法就为事务的实现提供了支持。</p>
                  <p>上面数据插入的操作是通过构造SQL语句实现的，但是很明显，这有一个极其不方便的地方，比如突然增加了性别字段<code>gender</code>，此时SQL语句就需要改成：</p>
                  <figure class="highlight sas">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">INSERT</span> <span class="meta">INTO</span> students(id, name, age, gender) values(<span class="name">%s</span>, <span class="name">%s</span>, <span class="name">%s</span>, <span class="name">%s</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>相应的元组参数则需要改成：</p>
                  <figure class="highlight hy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="name"><span class="builtin-name">id</span></span>, name, age, gender)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这显然不是我们想要的。在很多情况下，我们要达到的效果是插入方法无需改动，做成一个通用方法，只需要传入一个动态变化的字典就好了。比如，构造这样一个字典：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    'id': '<span class="number">20120001</span>',</span><br><span class="line">    'name': 'Bob',</span><br><span class="line">    'age': <span class="number">20</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后SQL语句会根据字典动态构造，元组也动态构造，这样才能实现通用的插入方法。所以，这里我们需要改写一下插入方法：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'20120001'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'Bob'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line">table = <span class="string">'students'</span></span><br><span class="line"><span class="built_in">keys</span> = <span class="string">', '</span>.<span class="keyword">join</span>(data.<span class="built_in">keys</span>())</span><br><span class="line"><span class="built_in">values</span> = <span class="string">', '</span>.<span class="keyword">join</span>([<span class="string">'%s'</span>] * <span class="built_in">len</span>(data))</span><br><span class="line">sql = <span class="string">'INSERT INTO &#123;table&#125;(&#123;keys&#125;) VALUES (&#123;values&#125;)'</span>.format(table=table, <span class="built_in">keys</span>=<span class="built_in">keys</span>, <span class="built_in">values</span>=<span class="built_in">values</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">cursor</span>.<span class="keyword">execute</span>(sql, tuple(data.<span class="built_in">values</span>())):</span><br><span class="line">       <span class="keyword">print</span>(<span class="string">'Successful'</span>)</span><br><span class="line">       db.commit()</span><br><span class="line">excep<span class="variable">t:</span></span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Failed'</span>)</span><br><span class="line">    db.rollback()</span><br><span class="line">db.<span class="keyword">close</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们传入的数据是字典，并将其定义为<code>data</code>变量。表名也定义成变量<code>table</code>。接下来，就需要构造一个动态的SQL语句了。</p>
                  <p>首先，需要构造插入的字段<code>id</code>、<code>name</code>和<code>age</code>。这里只需要将<code>data</code>的键名拿过来，然后用逗号分隔即可。所以<code>&#39;, &#39;.join(data.keys())</code>的结果就是<code>id, name, age</code>，然后需要构造多个<code>%s</code>当作占位符，有几个字段构造几个即可。比如，这里有三个字段，就需要构造<code>%s, %s, %s</code>。这里首先定义了长度为1的数组<code>[&#39;%s&#39;]</code>，然后用乘法将其扩充为<code>[&#39;%s&#39;, &#39;%s&#39;, &#39;%s&#39;]</code>，再调用<code>join()</code>方法，最终变成<code>%s, %s, %s</code>。最后，我们再利用字符串的<code>format()</code>方法将表名、字段名和占位符构造出来。最终的SQL语句就被动态构造成了：</p>
                  <figure class="highlight sas">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">INSERT</span> <span class="meta">INTO</span> students(id, name, age) VALUES (<span class="name">%s</span>, <span class="name">%s</span>, <span class="name">%s</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后，为<code>execute()</code>方法的第一个参数传入<code>sql</code>变量，第二个参数传入<code>data</code>的键值构造的元组，就可以成功插入数据了。</p>
                  <p>如此以来，我们便实现了传入一个字典来插入数据的方法，不需要再去修改SQL语句和插入操作了。</p>
                  <h2 id="5-更新数据"><a href="#5-更新数据" class="headerlink" title="5. 更新数据"></a>5. 更新数据</h2>
                  <p>数据更新操作实际上也是执行SQL语句，最简单的方式就是构造一个SQL语句，然后执行：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sql = <span class="string">'UPDATE students SET age = %s WHERE name = %s'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">   <span class="built_in">cursor</span>.<span class="keyword">execute</span>(sql, (<span class="number">25</span>, <span class="string">'Bob'</span>))</span><br><span class="line">   db.commit()</span><br><span class="line">excep<span class="variable">t:</span></span><br><span class="line">   db.rollback()</span><br><span class="line">db.<span class="keyword">close</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里同样用占位符的方式构造SQL，然后执行<code>execute()</code>方法，传入元组形式的参数，同样执行<code>commit()</code>方法执行操作。如果要做简单的数据更新的话，完全可以使用此方法。</p>
                  <p>但是在实际的数据抓取过程中，大部分情况下需要插入数据，但是我们关心的是会不会出现重复数据，如果出现了，我们希望更新数据而不是重复保存一次。另外，就像前面所说的动态构造SQL的问题，所以这里可以再实现一种去重的方法，如果数据存在，则更新数据；如果数据不存在，则插入数据。另外，这种做法支持灵活的字典传值。示例如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'20120001'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'Bob'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">21</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">table = <span class="string">'students'</span></span><br><span class="line"><span class="built_in">keys</span> = <span class="string">', '</span>.<span class="keyword">join</span>(data.<span class="built_in">keys</span>())</span><br><span class="line"><span class="built_in">values</span> = <span class="string">', '</span>.<span class="keyword">join</span>([<span class="string">'%s'</span>] * <span class="built_in">len</span>(data))</span><br><span class="line"></span><br><span class="line">sql = <span class="string">'INSERT INTO &#123;table&#125;(&#123;keys&#125;) VALUES (&#123;values&#125;) ON DUPLICATE KEY UPDATE'</span>.format(table=table, <span class="built_in">keys</span>=<span class="built_in">keys</span>, <span class="built_in">values</span>=<span class="built_in">values</span>)</span><br><span class="line"><span class="keyword">update</span> = <span class="string">','</span>.<span class="keyword">join</span>([<span class="string">" &#123;key&#125; = %s"</span>.format(key=key) <span class="keyword">for</span> key in data])</span><br><span class="line">sql += <span class="keyword">update</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">cursor</span>.<span class="keyword">execute</span>(sql, tuple(data.<span class="built_in">values</span>())*<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">'Successful'</span>)</span><br><span class="line">        db.commit()</span><br><span class="line">excep<span class="variable">t:</span></span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Failed'</span>)</span><br><span class="line">    db.rollback()</span><br><span class="line">db.<span class="keyword">close</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里构造的SQL语句其实是插入语句，但是我们在后面加了<code>ON DUPLICATE KEY UPDATE</code>。这行代码的意思是如果主键已经存在，就执行更新操作。比如，我们传入的数据<code>id</code>仍然为<code>20120001</code>，但是年龄有所变化，由20变成了21，此时这条数据不会被插入，而是直接更新<code>id</code>为<code>20120001</code>的数据。完整的SQL构造出来是这样的：</p>
                  <figure class="highlight sas">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">INSERT</span> <span class="meta">INTO</span> students(id, name, age) VALUES (<span class="name">%s</span>, <span class="name">%s</span>, <span class="name">%s</span>) <span class="meta">ON</span> DUPLICATE <span class="meta">KEY</span> <span class="meta">UPDATE</span> id = <span class="name">%s</span>, name = <span class="name">%s</span>, age = <span class="name">%s</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里就变成了6个<code>%s</code>。所以在后面的<code>execute()</code>方法的第二个参数元组就需要乘以2变成原来的2倍。</p>
                  <p>如此一来，我们就可以实现主键不存在便插入数据，存在则更新数据的功能了。</p>
                  <h2 id="6-删除数据"><a href="#6-删除数据" class="headerlink" title="6. 删除数据"></a>6. 删除数据</h2>
                  <p>删除操作相对简单，直接使用<code>DELETE</code>语句即可，只是需要指定要删除的目标表名和删除条件，而且仍然需要使用<code>db</code>的<code>commit()</code>方法才能生效。示例如下：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">table</span> = <span class="string">'students'</span></span><br><span class="line">condition = <span class="string">'age &gt; 20'</span></span><br><span class="line"></span><br><span class="line">sql = <span class="string">'DELETE FROM  &#123;table&#125; WHERE &#123;condition&#125;'</span>.<span class="built_in">format</span>(<span class="built_in">table</span>=<span class="built_in">table</span>, condition=condition)</span><br><span class="line">try:</span><br><span class="line">    cursor.<span class="built_in">execute</span>(sql)</span><br><span class="line">    db.commit()</span><br><span class="line">except:</span><br><span class="line">    db.rollback()</span><br><span class="line"></span><br><span class="line">db.<span class="built_in">close</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>因为删除条件有多种多样，运算符有大于、小于、等于、<code>LIKE</code>等，条件连接符有<code>AND</code>、<code>OR</code>等，所以不再继续构造复杂的判断条件。这里直接将条件当作字符串来传递，以实现删除操作。</p>
                  <h2 id="7-查询数据"><a href="#7-查询数据" class="headerlink" title="7. 查询数据"></a>7. 查询数据</h2>
                  <p>说完插入、修改和删除等操作，还剩下非常重要的一个操作，那就是查询。查询会用到<code>SELECT</code>语句，示例如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sql = <span class="string">'SELECT * FROM students WHERE age &gt;= 20'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">cursor</span>.<span class="keyword">execute</span>(sql)</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Count:'</span>, <span class="built_in">cursor</span>.rowcount)</span><br><span class="line">    one = <span class="built_in">cursor</span>.fetchone()</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'One:'</span>, one)</span><br><span class="line">    results = <span class="built_in">cursor</span>.fetchall()</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Results:'</span>, results)</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Results Type:'</span>, <span class="built_in">type</span>(results))</span><br><span class="line">    <span class="keyword">for</span> row in result<span class="variable">s:</span></span><br><span class="line">        <span class="keyword">print</span>(row)</span><br><span class="line">excep<span class="variable">t:</span></span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Error'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Count: <span class="number">4</span></span><br><span class="line">One: ('<span class="number">20120001</span>', 'Bob', <span class="number">25</span>)</span><br><span class="line">Results: (('<span class="number">20120011</span>', 'Mary', <span class="number">21</span>), ('<span class="number">20120012</span>', 'Mike', <span class="number">20</span>), ('<span class="number">20120013</span>', 'James', <span class="number">22</span>))</span><br><span class="line">Results Type: &lt;class 'tuple'&gt;</span><br><span class="line">('<span class="number">20120011</span>', 'Mary', <span class="number">21</span>)</span><br><span class="line">('<span class="number">20120012</span>', 'Mike', <span class="number">20</span>)</span><br><span class="line">('<span class="number">20120013</span>', 'James', <span class="number">22</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们构造了一条SQL语句，将年龄20岁及以上的学生查询出来，然后将其传给<code>execute()</code>方法。注意，这里不再需要<code>db</code>的<code>commit()</code>方法。接着，调用<code>cursor</code>的<code>rowcount</code>属性获取查询结果的条数，当前示例中是4条。</p>
                  <p>然后我们调用了<code>fetchone()</code>方法，这个方法可以获取结果的第一条数据，返回结果是元组形式，元组的元素顺序跟字段一一对应，即第一个元素就是第一个字段<code>id</code>，第二个元素就是第二个字段<code>name</code>，以此类推。随后，我们又调用了<code>fetchall()</code>方法，它可以得到结果的所有数据。然后将其结果和类型打印出来，它是二重元组，每个元素都是一条记录，我们将其遍历输出出来。</p>
                  <p>但是这里需要注意一个问题，这里显示的是3条数据而不是4条，<code>fetchall()</code>方法不是获取所有数据吗？这是因为它的内部实现有一个偏移指针用来指向查询结果，最开始偏移指针指向第一条数据，取一次之后，指针偏移到下一条数据，这样再取的话，就会取到下一条数据了。我们最初调用了一次<code>fetchone()</code>方法，这样结果的偏移指针就指向下一条数据，<code>fetchall()</code>方法返回的是偏移指针指向的数据一直到结束的所有数据，所以该方法获取的结果就只剩3个了。</p>
                  <p>此外，我们还可以用<code>while</code>循环加<code>fetchone()</code>方法来获取所有数据，而不是用<code>fetchall()</code>全部一起获取出来。<code>fetchall()</code>会将结果以元组形式全部返回，如果数据量很大，那么占用的开销会非常高。因此，推荐使用如下方法来逐条取数据：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sql = <span class="string">'SELECT * FROM students WHERE age &gt;= 20'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">cursor</span>.<span class="keyword">execute</span>(sql)</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Count:'</span>, <span class="built_in">cursor</span>.rowcount)</span><br><span class="line">    row = <span class="built_in">cursor</span>.fetchone()</span><br><span class="line">    <span class="keyword">while</span> ro<span class="variable">w:</span></span><br><span class="line">        <span class="keyword">print</span>(<span class="string">'Row:'</span>, row)</span><br><span class="line">        row = <span class="built_in">cursor</span>.fetchone()</span><br><span class="line">excep<span class="variable">t:</span></span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Error'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样每循环一次，指针就会偏移一条数据，随用随取，简单高效。</p>
                  <p>本节中，我们介绍了如何使用PyMySQL操作MySQL数据库以及一些SQL语句的构造方法，后面会在实战案例中应用这些操作来存储数据。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-29 19:29:25" itemprop="dateCreated datePublished" datetime="2018-01-29T19:29:25+08:00">2018-01-29</time>
                </span>
                <span id="/5578.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 5.2.1-MySQL存储" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5575.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5575.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 5.2-关系型数据库存储</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>关系型数据库是基于关系模型的数据库，而关系模型是通过二维表来保存的，所以它的存储方式就是行列组成的表，每一列是一个字段，每一行是一条记录。表可以看作某个实体的集合，而实体之间存在联系，这就需要表与表之间的关联关系来体现，如主键外键的关联关系。多个表组成一个数据库，也就是关系型数据库。</p>
                  <p>关系型数据库有多种，如SQLite、MySQL、Oracle、SQL Server、DB2等。</p>
                  <p>本节中，我们主要介绍Python 3下MySQL的存储。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-29 19:25:55" itemprop="dateCreated datePublished" datetime="2018-01-29T19:25:55+08:00">2018-01-29</time>
                </span>
                <span id="/5575.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 5.2-关系型数据库存储" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>215</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5571.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5571.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 5.1.3-CSV文件存储</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>CSV，全称为Comma-Separated Values，中文可以叫作逗号分隔值或字符分隔值，其文件以纯文本形式存储表格数据。该文件是一个字符序列，可以由任意数目的记录组成，记录间以某种换行符分隔。每条记录由字段组成，字段间的分隔符是其他字符或字符串，最常见的是逗号或制表符。不过所有记录都有完全相同的字段序列，相当于一个结构化表的纯文本形式。它比Excel文件更加简介，XLS文本是电子表格，它包含了文本、数值、公式和格式等内容，而CSV中不包含这些内容，就是特定字符分隔的纯文本，结构简单清晰。所以，有时候用CSV来保存数据是比较方便的。本节中，我们来讲解Python读取和写入CSV文件的过程。</p>
                  <h2 id="1-写入"><a href="#1-写入" class="headerlink" title="1. 写入"></a>1. 写入</h2>
                  <p>这里先看一个最简单的例子：</p>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import csv</span><br><span class="line"></span><br><span class="line">with open(<span class="string">'data.csv'</span>, <span class="string">'w'</span>) as csvfile:</span><br><span class="line">    writer = csv.writer(csvfile)</span><br><span class="line">    writer.writerow([<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'age'</span>])</span><br><span class="line">    writer.writerow([<span class="string">'10001'</span>, <span class="string">'Mike'</span>, <span class="number">20</span>])</span><br><span class="line">    writer.writerow([<span class="string">'10002'</span>, <span class="string">'Bob'</span>, <span class="number">22</span>])</span><br><span class="line">    writer.writerow([<span class="string">'10003'</span>, <span class="string">'Jordan'</span>, <span class="number">21</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先，打开data.csv文件，然后指定打开的模式为<code>w</code>（即写入），获得文件句柄，随后调用csv库的<code>writer()</code>方法初始化写入对象，传入该句柄，然后调用<code>writerow()</code>方法传入每行的数据即可完成写入。</p>
                  <p>运行结束后，会生成一个名为data.csv的文件，此时数据就成功写入了。直接以文本形式打开的话，其内容如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">id,name,age</span><br><span class="line"><span class="number">10001</span>,Mike,<span class="number">20</span></span><br><span class="line"><span class="number">10002</span>,Bob,<span class="number">22</span></span><br><span class="line"><span class="number">10003</span>,Jordan,<span class="number">21</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，写入的文本默认以逗号分隔，调用一次<code>writerow()</code>方法即可写入一行数据。用Excel打开的结果如图5-6所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/5-6.jpg" alt="">图5-6 打开结果</p>
                  <p>如果想修改列与列之间的分隔符，可以传入<code>delimiter</code>参数，其代码如下：</p>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import csv</span><br><span class="line"></span><br><span class="line">with open(<span class="string">'data.csv'</span>, <span class="string">'w'</span>) as csvfile:</span><br><span class="line">    writer = csv.writer(csvfile, delimiter=<span class="string">' '</span>)</span><br><span class="line">    writer.writerow([<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'age'</span>])</span><br><span class="line">    writer.writerow([<span class="string">'10001'</span>, <span class="string">'Mike'</span>, <span class="number">20</span>])</span><br><span class="line">    writer.writerow([<span class="string">'10002'</span>, <span class="string">'Bob'</span>, <span class="number">22</span>])</span><br><span class="line">    writer.writerow([<span class="string">'10003'</span>, <span class="string">'Jordan'</span>, <span class="number">21</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里在初始化写入对象时传入<code>delimiter</code>为空格，此时输出结果的每一列就是以空格分隔了，内容如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">id name age</span><br><span class="line"><span class="number">10001</span> Mike <span class="number">20</span></span><br><span class="line"><span class="number">10002</span> Bob <span class="number">22</span></span><br><span class="line"><span class="number">10003</span> Jordan <span class="number">21</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外，我们也可以调用<code>writerows()</code>方法同时写入多行，此时参数就需要为二维列表，例如：</p>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import csv</span><br><span class="line"></span><br><span class="line">with open(<span class="string">'data.csv'</span>, <span class="string">'w'</span>) as csvfile:</span><br><span class="line">    writer = csv.writer(csvfile)</span><br><span class="line">    writer.writerow([<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'age'</span>])</span><br><span class="line">    writer.writerows([[<span class="string">'10001'</span>, <span class="string">'Mike'</span>, <span class="number">20</span>], [<span class="string">'10002'</span>, <span class="string">'Bob'</span>, <span class="number">22</span>], [<span class="string">'10003'</span>, <span class="string">'Jordan'</span>, <span class="number">21</span>]])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出效果是相同的，内容如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">id,name,age</span><br><span class="line"><span class="number">10001</span>,Mike,<span class="number">20</span></span><br><span class="line"><span class="number">10002</span>,Bob,<span class="number">22</span></span><br><span class="line"><span class="number">10003</span>,Jordan,<span class="number">21</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但是一般情况下，爬虫爬取的都是结构化数据，我们一般会用字典来表示。在csv库中也提供了字典的写入方式，示例如下：</p>
                  <figure class="highlight xl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.csv'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    fieldnames = [<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'age'</span>]</span><br><span class="line">    writer = csv.DictWriter(csvfile, fieldnames=fieldnames)</span><br><span class="line">    writer.writeheader()</span><br><span class="line">    writer.writerow(&#123;<span class="string">'id'</span>: <span class="string">'10001'</span>, <span class="string">'name'</span>: <span class="string">'Mike'</span>, <span class="string">'age'</span>: <span class="number">20</span>&#125;)</span><br><span class="line">    writer.writerow(&#123;<span class="string">'id'</span>: <span class="string">'10002'</span>, <span class="string">'name'</span>: <span class="string">'Bob'</span>, <span class="string">'age'</span>: <span class="number">22</span>&#125;)</span><br><span class="line">    writer.writerow(&#123;<span class="string">'id'</span>: <span class="string">'10003'</span>, <span class="string">'name'</span>: <span class="string">'Jordan'</span>, <span class="string">'age'</span>: <span class="number">21</span>&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里先定义3个字段，用<code>fieldnames</code>表示，然后将其传给<code>DictWriter</code>来初始化一个字典写入对象，接着可以调用<code>writeheader()</code>方法先写入头信息，然后再调用<code>writerow()</code>方法传入相应字典即可。最终写入的结果是完全相同的，内容如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">id,name,age</span><br><span class="line"><span class="number">10001</span>,Mike,<span class="number">20</span></span><br><span class="line"><span class="number">10002</span>,Bob,<span class="number">22</span></span><br><span class="line"><span class="number">10003</span>,Jordan,<span class="number">21</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就可以完成字典到CSV文件的写入了。</p>
                  <p>另外，如果想追加写入的话，可以修改文件的打开模式，即将<code>open()</code>函数的第二个参数改成<code>a</code>，代码如下：</p>
                  <figure class="highlight xl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.csv'</span>, <span class="string">'a'</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    fieldnames = [<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'age'</span>]</span><br><span class="line">    writer = csv.DictWriter(csvfile, fieldnames=fieldnames)</span><br><span class="line">    writer.writerow(&#123;<span class="string">'id'</span>: <span class="string">'10004'</span>, <span class="string">'name'</span>: <span class="string">'Durant'</span>, <span class="string">'age'</span>: <span class="number">22</span>&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样在上面的基础上再执行这段代码，文件内容便会变成：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">id,name,age</span><br><span class="line"><span class="number">10001</span>,Mike,<span class="number">20</span></span><br><span class="line"><span class="number">10002</span>,Bob,<span class="number">22</span></span><br><span class="line"><span class="number">10003</span>,Jordan,<span class="number">21</span></span><br><span class="line"><span class="number">10004</span>,Durant,<span class="number">22</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可见，数据被追加写入到文件中。</p>
                  <p>如果要写入中文内容的话，可能会遇到字符编码的问题，此时需要给<code>open()</code>参数指定编码格式。比如，这里再写入一行包含中文的数据，代码需要改写如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import csv</span><br><span class="line"></span><br><span class="line">with open(<span class="string">'data.csv'</span>, <span class="string">'a'</span>, <span class="attribute">encoding</span>=<span class="string">'utf-8'</span>) as csvfile:</span><br><span class="line">    fieldnames = [<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'age'</span>]</span><br><span class="line">    writer = csv.DictWriter(csvfile, <span class="attribute">fieldnames</span>=fieldnames)</span><br><span class="line">    writer.writerow(&#123;<span class="string">'id'</span>: <span class="string">'10005'</span>, <span class="string">'name'</span>: <span class="string">'王伟'</span>, <span class="string">'age'</span>: 22&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里需要给<code>open()</code>函数指定编码，否则可能发生编码错误。</p>
                  <p>另外，如果接触过pandas等库的话，可以调用<code>DataFrame</code>对象的<code>to_csv()</code>方法来将数据写入CSV文件中。</p>
                  <h2 id="2-读取"><a href="#2-读取" class="headerlink" title="2. 读取"></a>2. 读取</h2>
                  <p>我们同样可以使用csv库来读取CSV文件。例如，将刚才写入的文件内容读取出来，相关代码如下：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="keyword">open</span>(<span class="string">'data.csv'</span>, <span class="string">'r'</span>, <span class="keyword">encoding</span>=<span class="string">'utf-8'</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    reader = csv.reader(csvfile)</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">row</span> <span class="keyword">in</span> reader:</span><br><span class="line">        print(<span class="keyword">row</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'id</span>', <span class="symbol">'name</span>', <span class="symbol">'age</span>']</span><br><span class="line">[<span class="symbol">'10001</span>', <span class="symbol">'Mike</span>', <span class="symbol">'20</span>']</span><br><span class="line">[<span class="symbol">'10002</span>', <span class="symbol">'Bob</span>', <span class="symbol">'22</span>']</span><br><span class="line">[<span class="symbol">'10003</span>', <span class="symbol">'Jordan</span>', <span class="symbol">'21</span>']</span><br><span class="line">[<span class="symbol">'10004</span>', <span class="symbol">'Durant</span>', <span class="symbol">'22</span>']</span><br><span class="line">[<span class="symbol">'10005</span>', <span class="symbol">'王伟</span>', <span class="symbol">'22</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们构造的是<code>Reader</code>对象，通过遍历输出了每行的内容，每一行都是一个列表形式。注意，如果CSV文件中包含中文的话，还需要指定文件编码。</p>
                  <p>另外，如果接触过pandas的话，可以利用<code>read_csv()</code>方法将数据从CSV中读取出来，例如：</p>
                  <figure class="highlight haskell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> pandas  <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="title">df</span> = pd.read_csv('<span class="class"><span class="keyword">data</span>.csv')</span></span><br><span class="line"><span class="title">print</span>(df)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">      id    name  age</span><br><span class="line"><span class="number">0</span>  <span class="number">10001</span>    Mike   <span class="number">20</span></span><br><span class="line"><span class="number">1</span>  <span class="number">10002</span>     Bob   <span class="number">22</span></span><br><span class="line"><span class="number">2</span>  <span class="number">10003</span>  Jordan   <span class="number">21</span></span><br><span class="line"><span class="number">3</span>  <span class="number">10004</span>  Durant   <span class="number">22</span></span><br><span class="line"><span class="number">4</span>  <span class="number">10005</span>      王伟   <span class="number">22</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在做数据分析的时候，此种方法用得比较多，也是一种比较方便地读取CSV文件的方法。</p>
                  <p>本节中，我们了解了CSV文件的写入和读取方式。这也是一种常用的数据存储方式，需要熟练掌握。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-29 16:59:52" itemprop="dateCreated datePublished" datetime="2018-01-29T16:59:52+08:00">2018-01-29</time>
                </span>
                <span id="/5571.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 5.1.3-CSV文件存储" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5564.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5564.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 5.1.2-JSON文件存储</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>JSON，全称为JavaScript Object Notation, 也就是JavaScript对象标记，它通过对象和数组的组合来表示数据，构造简洁但是结构化程度非常高，是一种轻量级的数据交换格式。本节中，我们就来了解如何利用Python保存数据到JSON文件。</p>
                  <h2 id="1-对象和数组"><a href="#1-对象和数组" class="headerlink" title="1. 对象和数组"></a>1. 对象和数组</h2>
                  <p>在JavaScript语言中，一切都是对象。因此，任何支持的类型都可以通过JSON来表示，例如字符串、数字、对象、数组等，但是对象和数组是比较特殊且常用的两种类型，下面简要介绍一下它们。</p>
                  <ul>
                    <li><strong>对象</strong>：它在JavaScript中是使用花括号<code>{}</code>包裹起来的内容，数据结构为<code>{key1：value1, key2：value2, ...}</code>的键值对结构。在面向对象的语言中，<code>key</code>为对象的属性，<code>value</code>为对应的值。键名可以使用整数和字符串来表示。值的类型可以是任意类型。</li>
                    <li><strong>数组</strong>：数组在JavaScript中是方括号<code>[]</code>包裹起来的内容，数据结构为<code>[&quot;java&quot;, &quot;javascript&quot;, &quot;vb&quot;, ...]</code>的索引结构。在JavaScript中，数组是一种比较特殊的数据类型，它也可以像对象那样使用键值对，但还是索引用得多。同样，值的类型可以是任意类型。</li>
                  </ul>
                  <p>所以，一个JSON对象可以写为如下形式：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[&#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"Bob"</span>,</span><br><span class="line">    <span class="attr">"gender"</span>: <span class="string">"male"</span>,</span><br><span class="line">    <span class="attr">"birthday"</span>: <span class="string">"1992-10-18"</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">     <span class="attr">"name"</span>: <span class="string">"Selina"</span>,</span><br><span class="line">    <span class="attr">"gender"</span>: <span class="string">"female"</span>,</span><br><span class="line">    <span class="attr">"birthday"</span>: <span class="string">"1995-10-18"</span></span><br><span class="line">&#125;]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>由中括号包围的就相当于列表类型，列表中的每个元素可以是任意类型，这个示例中它是字典类型，由大括号包围。</p>
                  <p>JSON可以由以上两种形式自由组合而成，可以无限次嵌套，结构清晰，是数据交换的极佳方式。</p>
                  <h2 id="2-读取JSON"><a href="#2-读取JSON" class="headerlink" title="2. 读取JSON"></a>2. 读取JSON</h2>
                  <p>Python为我们提供了简单易用的库来实现JSON文件的读写操作，我们可以调用库的<code>loads()</code>方法将JSON文本字符串转为JSON对象，可以通过<code>dumps()</code>方法将JSON对象转为文本字符串。</p>
                  <p>例如，这里有一段JSON形式的字符串，它是<code>str</code>类型，我们用Python将其转换为可操作的数据结构，如列表或字典：</p>
                  <figure class="highlight haskell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="title">str</span> = '''</span><br><span class="line">[&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"Bob"</span>,</span><br><span class="line">    <span class="string">"gender"</span>: <span class="string">"male"</span>,</span><br><span class="line">    <span class="string">"birthday"</span>: <span class="string">"1992-10-18"</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"Selina"</span>,</span><br><span class="line">    <span class="string">"gender"</span>: <span class="string">"female"</span>,</span><br><span class="line">    <span class="string">"birthday"</span>: <span class="string">"1995-10-18"</span></span><br><span class="line">&#125;]</span><br><span class="line">'''</span><br><span class="line"><span class="title">print</span>(<span class="class"><span class="keyword">type</span>(<span class="title">str</span>))</span></span><br><span class="line"><span class="class"><span class="keyword">data</span> = json.loads(<span class="title">str</span>)</span></span><br><span class="line"><span class="title">print</span>(<span class="class"><span class="keyword">data</span>)</span></span><br><span class="line"><span class="title">print</span>(<span class="class"><span class="keyword">type</span>(<span class="title">data</span>))</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;class 'str'&gt;</span><br><span class="line">[&#123;'name': 'Bob', 'gender': 'male', 'birthday': '<span class="number">1992-10-18</span>'&#125;, &#123;'name': 'Selina', 'gender': 'female', 'birthday': '<span class="number">1995-10-18</span>'&#125;]</span><br><span class="line">&lt;class 'list'&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里使用<code>loads()</code>方法将字符串转为JSON对象。由于最外层是中括号，所以最终的类型是列表类型。</p>
                  <p>这样一来，我们就可以用索引来获取对应的内容了。例如，如果想取第一个元素里的<code>name</code>属性，就可以使用如下方式：</p>
                  <figure class="highlight markdown">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">data[<span class="string">0</span>][<span class="symbol">'name'</span>]</span><br><span class="line">data[0].get('name')</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>得到的结果都是：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">Bob</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过中括号加0索引，可以得到第一个字典元素，然后再调用其键名即可得到相应的键值。获取键值时有两种方式，一种是中括号加键名，另一种是通过<code>get()</code>方法传入键名。这里推荐使用<code>get()</code>方法，这样如果键名不存在，则不会报错，会返回<code>None</code>。另外，<code>get()</code>方法还可以传入第二个参数（即默认值），示例如下：</p>
                  <figure class="highlight haskell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">data</span>[0].get('<span class="title">age'</span>)</span></span><br><span class="line"><span class="class"><span class="keyword">data</span>[0].get('<span class="title">age'</span>, 25)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">None</span><br><span class="line"><span class="number">25</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们尝试获取年龄<code>age</code>，其实在原字典中该键名不存在，此时默认会返回<code>None</code>。如果传入第二个参数（即默认值），那么在不存在的情况下返回该默认值。</p>
                  <p>值得注意的是，JSON的数据需要用双引号来包围，不能使用单引号。例如，若使用如下形式表示，则会出现错误：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> <span class="type">json</span></span><br><span class="line"></span><br><span class="line">str = <span class="string">'''</span></span><br><span class="line"><span class="string">[&#123;</span></span><br><span class="line"><span class="string">    '</span><span class="type">name</span><span class="string">': '</span>Bob<span class="string">',</span></span><br><span class="line"><span class="string">    '</span>gender<span class="string">': '</span>mal<span class="string">e',</span></span><br><span class="line"><span class="string">    '</span>birthday<span class="string">': '</span><span class="number">1992</span><span class="number">-10</span><span class="number">-18</span><span class="string">'</span></span><br><span class="line"><span class="string">&#125;]</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">data = <span class="type">json</span>.loads(str)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="type">json</span>.decoder.JSONDecodeError: Expecting property <span class="type">name</span> enclosed <span class="keyword">in</span> <span class="type">double</span> quotes: <span class="type">line</span> <span class="number">3</span> <span class="keyword">column</span> <span class="number">5</span> (<span class="type">char</span> <span class="number">8</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里会出现JSON解析错误的提示。这是因为这里数据用单引号来包围，请千万注意JSON字符串的表示需要用双引号，否则<code>loads()</code>方法会解析失败。</p>
                  <p>如果从JSON文本中读取内容，例如这里有一个data.文本文件，其内容是刚才定义的JSON字符串，我们可以先将文本文件内容读出，然后再利用<code>loads()</code>方法转化：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import json</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="keyword">open</span>(<span class="string">'data.json'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> <span class="keyword">file</span>:</span><br><span class="line">    <span class="keyword">str</span> = file.read()</span><br><span class="line">    <span class="keyword">data</span> = json.loads(<span class="keyword">str</span>)</span><br><span class="line">    print(<span class="keyword">data</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[&#123;<span class="symbol">'name</span><span class="symbol">':</span> <span class="symbol">'Bob</span>', <span class="symbol">'gender</span><span class="symbol">':</span> <span class="symbol">'male</span>', <span class="symbol">'birthday</span><span class="symbol">':</span> <span class="symbol">'1992-10-18</span>'&#125;, &#123;<span class="symbol">'name</span><span class="symbol">':</span> <span class="symbol">'Selina</span>', <span class="symbol">'gender</span><span class="symbol">':</span> <span class="symbol">'female</span>', <span class="symbol">'birthday</span><span class="symbol">':</span> <span class="symbol">'1995-10-18</span>'&#125;]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="3-输出JSON"><a href="#3-输出JSON" class="headerlink" title="3. 输出JSON"></a>3. 输出JSON</h2>
                  <p>另外，我们还可以调用<code>dumps()</code>方法将JSON对象转化为字符串。例如，将上例中的列表重新写入文本：</p>
                  <figure class="highlight xl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> = [&#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'Bob'</span>,</span><br><span class="line">    <span class="string">'gender'</span>: <span class="string">'male'</span>,</span><br><span class="line">    <span class="string">'birthday'</span>: <span class="string">'1992-10-18'</span></span><br><span class="line">&#125;]</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.json'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(json.dumps(<span class="keyword">data</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>利用<code>dumps()</code>方法，我们可以将JSON对象转为字符串，然后再调用文件的<code>write()</code>方法写入文本，结果如图5-2所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/5-2.jpg" alt="">图5-2 写入结果</p>
                  <p>另外，如果想保存JSON的格式，可以再加一个参数<code>indent</code>，代表缩进字符个数。示例如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'data.json'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> <span class="built_in">file</span>:</span><br><span class="line">    <span class="built_in">file</span>.<span class="built_in">write</span>(json.dumps(data, indent=<span class="number">2</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此时写入结果如图5-3所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/5-3.jpg" alt="">图5-3 写入结果</p>
                  <p>这样得到的内容会自动带缩进，格式会更加清晰。</p>
                  <p>另外，如果JSON中包含中文字符，会怎么样呢？例如，我们将之前的JSON的部分值改为中文，再用之前的方法写入到文本：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import json</span><br><span class="line"></span><br><span class="line">data = [&#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'王伟'</span>,</span><br><span class="line">    <span class="string">'gender'</span>: <span class="string">'男'</span>,</span><br><span class="line">    <span class="string">'birthday'</span>: <span class="string">'1992-10-18'</span></span><br><span class="line">&#125;]</span><br><span class="line">with <span class="keyword">open</span>(<span class="string">'data.json'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> <span class="keyword">file</span>:</span><br><span class="line">    <span class="keyword">file</span>.<span class="keyword">write</span>(json.dumps(data, <span class="built_in">indent</span>=<span class="number">2</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>写入结果如图5-4所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/5-4.jpg" alt="">图5-4 写入结果</p>
                  <p>可以看到，中文字符都变成了Unicode字符，这并不是我们想要的结果。</p>
                  <p>为了输出中文，还需要指定参数<code>ensure_ascii</code>为<code>False</code>，另外还要规定文件输出的编码：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">with open(<span class="string">'data.json'</span>, <span class="string">'w'</span>, <span class="attribute">encoding</span>=<span class="string">'utf-8'</span>) as file:</span><br><span class="line">    file.write(json.dumps(data, <span class="attribute">indent</span>=2, <span class="attribute">ensure_ascii</span>=<span class="literal">False</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>写入结果如图5-5所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/5-5.jpg" alt="">图5-5 写入结果</p>
                  <p>可以发现，这样就可以输出JSON为中文了。</p>
                  <p>本节中，我们了解了用Python进行JSON文件读写的方法，后面做数据解析时经常会用到，建议熟练掌握。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-29 16:54:40" itemprop="dateCreated datePublished" datetime="2018-01-29T16:54:40+08:00">2018-01-29</time>
                </span>
                <span id="/5564.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 5.1.2-JSON文件存储" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5560.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5560.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 5.1.1-TXT文本存储</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>将数据保存到TXT文本的操作非常简单，而且TXT文本几乎兼容任何平台，但是这有个缺点，那就是不利于检索。所以如果对检索和数据结构要求不高，追求方便第一的话，可以采用TXT文本存储。本节中，我们就来看下如何利用Python保存TXT文本文件。</p>
                  <h2 id="1-本节目标"><a href="#1-本节目标" class="headerlink" title="1. 本节目标"></a>1. 本节目标</h2>
                  <p>本节中，我们要保存知乎上“发现”页面的“热门话题”部分，将其问题和答案统一保存成文本形式。</p>
                  <h2 id="2-基本实例"><a href="#2-基本实例" class="headerlink" title="2. 基本实例"></a>2. 基本实例</h2>
                  <p>首先，可以用requests将网页源代码获取下来，然后使用pyquery解析库解析，接下来将提取的标题、回答者、回答保存到文本，代码如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line">from pyquery import PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://www.zhihu.com/explore'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">html = requests.<span class="built_in">get</span>(url, headers=headers).text</span><br><span class="line">doc = pq(html)</span><br><span class="line"><span class="built_in">items</span> = doc(<span class="string">'.explore-tab .feed-item'</span>).<span class="built_in">items</span>()</span><br><span class="line"><span class="keyword">for</span> item in item<span class="variable">s:</span></span><br><span class="line">    question = item.<span class="keyword">find</span>(<span class="string">'h2'</span>).text()</span><br><span class="line">    author = item.<span class="keyword">find</span>(<span class="string">'.author-link-line'</span>).text()</span><br><span class="line">    answer = pq(item.<span class="keyword">find</span>(<span class="string">'.content'</span>).html()).text()</span><br><span class="line">    <span class="keyword">file</span> = <span class="keyword">open</span>(<span class="string">'explore.txt'</span>, <span class="string">'a'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="keyword">file</span>.<span class="keyword">write</span>(<span class="string">'\n'</span>.<span class="keyword">join</span>([question, author, answer]))</span><br><span class="line">    <span class="keyword">file</span>.<span class="keyword">write</span>(<span class="string">'\n'</span> + <span class="string">'='</span> * <span class="number">50</span> + <span class="string">'\n'</span>)</span><br><span class="line">    <span class="keyword">file</span>.<span class="keyword">close</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里主要是为了演示文件保存的方式，因此requests异常处理部分在此省去。首先，用requests提取知乎的“发现”页面，然后将热门话题的问题、回答者、答案全文提取出来，然后利用Python提供的<code>open()</code>方法打开一个文本文件，获取一个文件操作对象，这里赋值为<code>file</code>，接着利用<code>file</code>对象的<code>write()</code>方法将提取的内容写入文件，最后调用<code>close()</code>方法将其关闭，这样抓取的内容即可成功写入文本中了。</p>
                  <p>运行程序，可以发现在本地生成了一个explore.txt文件，其内容如图5-1所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/5-1.jpg" alt="">图5-1 文件内容</p>
                  <p>这样热门问答的内容就被保存成文本形式了。</p>
                  <p>这里<code>open()</code>方法的第一个参数即要保存的目标文件名称，第二个参数为<code>a</code>，代表以追加方式写入到文本。另外，我们还指定了文件的编码为<code>utf-8</code>。最后，写入完成后，还需要调用<code>close()</code>方法来关闭文件对象。</p>
                  <h2 id="3-打开方式"><a href="#3-打开方式" class="headerlink" title="3. 打开方式"></a>3. 打开方式</h2>
                  <p>在刚才的实例中，<code>open()</code>方法的第二个参数设置成了<code>a</code>，这样在每次写入文本时不会清空源文件，而是在文件末尾写入新的内容，这是一种文件打开方式。关于文件的打开方式，其实还有其他几种，这里简要介绍一下。</p>
                  <ul>
                    <li><strong><code>r</code></strong>：以只读方式打开文件。文件的指针将会放在文件的开头。这是默认模式。</li>
                    <li><strong><code>rb</code></strong>：以二进制只读方式打开一个文件。文件指针将会放在文件的开头。</li>
                    <li><strong><code>r+</code></strong>：以读写方式打开一个文件。文件指针将会放在文件的开头。</li>
                    <li><strong><code>rb+</code></strong>：以二进制读写方式打开一个文件。文件指针将会放在文件的开头。</li>
                    <li><strong><code>w</code></strong>：以写入方式打开一个文件。如果该文件已存在，则将其覆盖。如果该文件不存在，则创建新文件。</li>
                    <li><strong><code>wb</code></strong>：以二进制写入方式打开一个文件。如果该文件已存在，则将其覆盖。如果该文件不存在，则创建新文件。</li>
                    <li><strong><code>w+</code></strong>：以读写方式打开一个文件。如果该文件已存在，则将其覆盖。如果该文件不存在，则创建新文件。</li>
                    <li><strong><code>wb+</code></strong>：以二进制读写格式打开一个文件。如果该文件已存在，则将其覆盖。如果该文件不存在，则创建新文件。</li>
                    <li>
                      <p><strong><code>a</code></strong>：以追加方式打开一个文件。如果该文件已存在，文件指针将会放在文件结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，则创建新文件来写入。</p>
                    </li>
                    <li>
                      <p><strong><code>ab</code></strong>：以二进制追加方式打开一个文件。如果该文件已存在，则文件指针将会放在文件结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，则创建新文件来写入。</p>
                    </li>
                    <li>
                      <p><strong><code>a+</code></strong>：以读写方式打开一个文件。如果该文件已存在，文件指针将会放在文件的结尾。文件打开时会是追加模式。如果该文件不存在，则创建新文件来读写。</p>
                    </li>
                    <li><strong><code>ab+</code></strong>：以二进制追加方式打开一个文件。如果该文件已存在，则文件指针将会放在文件结尾。如果该文件不存在，则创建新文件用于读写。</li>
                  </ul>
                  <h2 id="4-简化写法"><a href="#4-简化写法" class="headerlink" title="4. 简化写法"></a>4. 简化写法</h2>
                  <p>另外，文件写入还有一种简写方法，那就是使用<code>with as</code>语法。在<code>with</code>控制块结束时，文件会自动关闭，所以就不需要再调用<code>close()</code>方法了。这种保存方式可以简写如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'explore.txt'</span>, <span class="string">'a'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> <span class="built_in">file</span>:</span><br><span class="line">    <span class="built_in">file</span>.<span class="built_in">write</span>(<span class="string">'\n'</span>.join([question, author, answer]))</span><br><span class="line">    <span class="built_in">file</span>.<span class="built_in">write</span>(<span class="string">'\n'</span> + <span class="string">'='</span> * <span class="number">50</span> + <span class="string">'\n'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果想保存时将原文清空，那么可以将第二个参数改写为<code>w</code>，代码如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'explore.txt'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> <span class="built_in">file</span>:</span><br><span class="line">    <span class="built_in">file</span>.<span class="built_in">write</span>(<span class="string">'\n'</span>.join([question, author, answer]))</span><br><span class="line">    <span class="built_in">file</span>.<span class="built_in">write</span>(<span class="string">'\n'</span> + <span class="string">'='</span> * <span class="number">50</span> + <span class="string">'\n'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上面便是利用Python将结果保存为TXT文件的方法，这种方法简单易用，操作高效，是一种最基本的保存数据的方法。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-29 16:51:07" itemprop="dateCreated datePublished" datetime="2018-01-29T16:51:07+08:00">2018-01-29</time>
                </span>
                <span id="/5560.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 5.1.1-TXT文本存储" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5557.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5557.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 5.1-文件存储</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>文件存储形式多种多样，比如可以保存成TXT纯文本形式，也可以保存为JSON格式、CSV格式等，本节就来了解一下文本文件的存储方式。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-29 16:43:41" itemprop="dateCreated datePublished" datetime="2018-01-29T16:43:41+08:00">2018-01-29</time>
                </span>
                <span id="/5557.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 5.1-文件存储" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>65</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5554.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5554.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 5-数据存储</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>用解析器解析出数据之后，接下来就是存储数据了。保存的形式可以多种多样，最简单的形式是直接保存为文本文件，如TXT、JSON、CSV等。另外，还可以保存到数据库中，如关系型数据库MySQL，非关系型数据库MongoDB、Redis等。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-29 16:42:06" itemprop="dateCreated datePublished" datetime="2018-01-29T16:42:06+08:00">2018-01-29</time>
                </span>
                <span id="/5554.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 5-数据存储" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>116</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5551.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5551.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 4.3-使用pyquery</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在上一节中，我们介绍了Beautiful Soup的用法，它是一个非常强大的网页解析库，你是否觉得它的一些方法用起来有点不适应？有没有觉得它的CSS选择器的功能没有那么强大？</p>
                  <p>如果你对Web有所涉及，如果你比较喜欢用CSS选择器，如果你对jQuery有所了解，那么这里有一个更适合你的解析库——pyquery。</p>
                  <p>接下来，我们就来感受一下pyquery的强大之处。</p>
                  <h2 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h2>
                  <p>在开始之前，请确保已经正确安装好了pyquery。若没有安装，可以参考第1章的安装过程。</p>
                  <h2 id="2-初始化"><a href="#2-初始化" class="headerlink" title="2. 初始化"></a>2. 初始化</h2>
                  <p>像Beautiful Soup一样，初始化pyquery的时候，也需要传入HTML文本来初始化一个PyQuery对象。它的初始化方式有多种，比如直接传入字符串，传入URL，传入文件名，等等。下面我们来详细介绍一下。</p>
                  <h3 id="字符串初始化"><a href="#字符串初始化" class="headerlink" title="字符串初始化"></a>字符串初始化</h3>
                  <p>首先，我们用一个实例来感受一下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = '''</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">'''</span><br><span class="line">from pyquery import PyQuery as pq</span><br><span class="line">doc = pq(html)</span><br><span class="line">print(doc('li'))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先引入PyQuery这个对象，取别名为<code>pq</code>。然后声明了一个长HTML字符串，并将其当作参数传递给<code>PyQuery</code>类，这样就成功完成了初始化。接下来，将初始化的对象传入CSS选择器。在这个实例中，我们传入<code>li</code>节点，这样就可以选择所有的<code>li</code>节点。</p>
                  <h3 id="URL初始化"><a href="#URL初始化" class="headerlink" title="URL初始化"></a>URL初始化</h3>
                  <p>初始化的参数不仅可以以字符串的形式传递，还可以传入网页的URL，此时只需要指定参数为<code>url</code>即可：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from pyquery import PyQuery as pq</span><br><span class="line">doc = pq(<span class="name">url=</span>'http<span class="symbol">://cuiqingcai</span>.com')</span><br><span class="line">print(<span class="name">doc</span>('title'))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>静觅丨崔庆才的个人博客<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样的话，<code>PyQuery</code>对象会首先请求这个URL，然后用得到的HTML内容完成初始化，这其实就相当于用网页的源代码以字符串的形式传递给<code>PyQuery</code>类来初始化。</p>
                  <p>它与下面的功能是相同的：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from pyquery import PyQuery as pq</span><br><span class="line">import requests</span><br><span class="line">doc = pq(<span class="name">requests</span>.get('http<span class="symbol">://cuiqingcai</span>.com').text)</span><br><span class="line">print(<span class="name">doc</span>('title'))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="文件初始化"><a href="#文件初始化" class="headerlink" title="文件初始化"></a>文件初始化</h3>
                  <p>当然，除了传递URL，还可以传递本地的文件名，此时将参数指定为<code>filename</code>即可：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">from</span> <span class="variable">pyquery</span> <span class="variable">import</span> <span class="variable">PyQuery</span> <span class="variable">as</span> <span class="variable">pq</span></span><br><span class="line"><span class="variable">doc</span> = <span class="function"><span class="title">pq</span>(<span class="variable">filename</span>=<span class="string">'demo.html'</span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="title">doc</span>(<span class="string">'li'</span>))</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然，这里需要有一个本地HTML文件demo.html，其内容是待解析的HTML字符串。这样它会首先读取本地的文件内容，然后用文件内容以字符串的形式传递给<code>PyQuery</code>类来初始化。</p>
                  <p>以上3种初始化方式均可，当然最常用的初始化方式还是以字符串形式传递。</p>
                  <h2 id="3-基本CSS选择器"><a href="#3-基本CSS选择器" class="headerlink" title="3. 基本CSS选择器"></a>3. 基本CSS选择器</h2>
                  <p>首先，用一个实例来感受pyquery的CSS选择器的用法：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = '''</span><br><span class="line">&lt;div id=<span class="string">"container"</span>&gt;</span><br><span class="line">    &lt;ul <span class="keyword">class</span>=<span class="string">"list"</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-0"</span>&gt;first item&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-1"</span>&gt;&lt;a href=<span class="string">"link2.html"</span>&gt;second item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-0 active"</span>&gt;&lt;a href=<span class="string">"link3.html"</span>&gt;&lt;span <span class="keyword">class</span>=<span class="string">"bold"</span>&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-1 active"</span>&gt;&lt;a href=<span class="string">"link4.html"</span>&gt;fourth item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-0"</span>&gt;&lt;a href=<span class="string">"link5.html"</span>&gt;fifth item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">     &lt;/ul&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">'''</span><br><span class="line">from pyquery import PyQuery <span class="keyword">as</span> pq</span><br><span class="line">doc = pq(html)</span><br><span class="line"><span class="keyword">print</span>(doc('#container .<span class="keyword">list</span> <span class="keyword">li</span>'))</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">type</span>(doc('#container .<span class="keyword">list</span> <span class="keyword">li</span>')))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> '<span class="attr">pyquery.pyquery.PyQuery</span>'&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们初始化<code>PyQuery</code>对象之后，传入了一个CSS选择器<code>#container .list li</code>，它的意思是先选取<code>id</code>为<code>container</code>的节点，然后再选取其内部的<code>class</code>为<code>list</code>的节点内部的所有<code>li</code>节点。然后，打印输出。可以看到，我们成功获取到了符合条件的节点。</p>
                  <p>最后，将它的类型打印输出。可以看到，它的类型依然是<code>PyQuery</code>类型。</p>
                  <h2 id="4-查找节点"><a href="#4-查找节点" class="headerlink" title="4. 查找节点"></a>4. 查找节点</h2>
                  <p>下面我们介绍一些常用的查询函数，这些函数和jQuery中函数的用法完全相同。</p>
                  <h3 id="子节点"><a href="#子节点" class="headerlink" title="子节点"></a>子节点</h3>
                  <p>查找子节点时，需要用到<code>find()</code>方法，此时传入的参数是CSS选择器。这里还是以前面的HTML为例：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">from</span> <span class="variable">pyquery</span> <span class="variable">import</span> <span class="variable">PyQuery</span> <span class="variable">as</span> <span class="variable">pq</span></span><br><span class="line"><span class="variable">doc</span> = <span class="function"><span class="title">pq</span>(<span class="variable">html</span>)</span></span><br><span class="line"><span class="variable">items</span> = <span class="function"><span class="title">doc</span>(<span class="string">'.list'</span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="title">type</span>(<span class="variable">items</span>))</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable">items</span>)</span></span><br><span class="line"><span class="variable">lis</span> = <span class="variable">items.find</span>(<span class="string">'li'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="title">type</span>(<span class="variable">lis</span>))</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable">lis</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">class</span> '<span class="attr">pyquery.pyquery.PyQuery</span>'&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> '<span class="attr">pyquery.pyquery.PyQuery</span>'&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先，我们选取<code>class</code>为<code>list</code>的节点，然后调用了<code>find()</code>方法，传入CSS选择器，选取其内部的<code>li</code>节点，最后打印输出。可以发现，<code>find()</code>方法会将符合条件的所有节点选择出来，结果的类型是<code>PyQuery</code>类型。</p>
                  <p>其实<code>find()</code>的查找范围是节点的所有子孙节点，而如果我们只想查找子节点，那么可以用<code>children()</code>方法：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">lis</span> = items.children()</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">type</span>(<span class="keyword">lis</span>))</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">lis</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">class</span> '<span class="attr">pyquery.pyquery.PyQuery</span>'&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果要筛选所有子节点中符合条件的节点，比如想筛选出子节点中<code>class</code>为<code>active</code>的节点，可以向<code>children()</code>方法传入CSS选择器<code>.active</code>：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">lis = items.children(<span class="string">'.active'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(lis)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，输出结果已经做了筛选，留下了<code>class</code>为<code>active</code>的节点。</p>
                  <h3 id="父节点"><a href="#父节点" class="headerlink" title="父节点"></a>父节点</h3>
                  <p>我们可以用<code>parent()</code>方法来获取某个节点的父节点，示例如下：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = '''</span><br><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"wrap"</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;ul <span class="built_in">class</span>=<span class="string">"list"</span>&gt;</span><br><span class="line">             &lt;li <span class="built_in">class</span>=<span class="string">"item-0"</span>&gt;<span class="keyword">first</span> <span class="built_in">item</span>&lt;/li&gt;</span><br><span class="line">             &lt;li <span class="built_in">class</span>=<span class="string">"item-1"</span>&gt;&lt;a href=<span class="string">"link2.html"</span>&gt;<span class="keyword">second</span> <span class="built_in">item</span>&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">             &lt;li <span class="built_in">class</span>=<span class="string">"item-0 active"</span>&gt;&lt;a href=<span class="string">"link3.html"</span>&gt;&lt;span <span class="built_in">class</span>=<span class="string">"bold"</span>&gt;<span class="keyword">third</span> <span class="built_in">item</span>&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">             &lt;li <span class="built_in">class</span>=<span class="string">"item-1 active"</span>&gt;&lt;a href=<span class="string">"link4.html"</span>&gt;<span class="keyword">fourth</span> <span class="built_in">item</span>&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">             &lt;li <span class="built_in">class</span>=<span class="string">"item-0"</span>&gt;&lt;a href=<span class="string">"link5.html"</span>&gt;<span class="keyword">fifth</span> <span class="built_in">item</span>&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">         &lt;/ul&gt;</span><br><span class="line">     &lt;/<span class="keyword">div</span>&gt;</span><br><span class="line"> &lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">'''</span><br><span class="line"><span class="keyword">from</span> pyquery import PyQuery <span class="keyword">as</span> pq</span><br><span class="line">doc = pq(html)</span><br><span class="line">items = doc('.<span class="built_in">list</span>')</span><br><span class="line">container = items.parent()</span><br><span class="line">print(type(container))</span><br><span class="line">print(container)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">class</span> '<span class="attr">pyquery.pyquery.PyQuery</span>'&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们首先用<code>.list</code>选取<code>class</code>为<code>list</code>的节点，然后调用<code>parent()</code>方法得到其父节点，其类型依然是<code>PyQuery</code>类型。</p>
                  <p>这里的父节点是该节点的直接父节点，也就是说，它不会再去查找父节点的父节点，即祖先节点。</p>
                  <p>但是如果想获取某个祖先节点，该怎么办呢？这时可以用<code>parents()</code>方法：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">from</span> <span class="variable">pyquery</span> <span class="variable">import</span> <span class="variable">PyQuery</span> <span class="variable">as</span> <span class="variable">pq</span></span><br><span class="line"><span class="variable">doc</span> = <span class="function"><span class="title">pq</span>(<span class="variable">html</span>)</span></span><br><span class="line"><span class="variable">items</span> = <span class="function"><span class="title">doc</span>(<span class="string">'.list'</span>)</span></span><br><span class="line"><span class="variable">parents</span> = <span class="variable">items.parents</span>()</span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="title">type</span>(<span class="variable">parents</span>))</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable">parents</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">class</span> '<span class="attr">pyquery.pyquery.PyQuery</span>'&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，输出结果有两个：一个是<code>class</code>为<code>wrap</code>的节点，一个是<code>id</code>为<code>container</code>的节点。也就是说，<code>parents()</code>方法会返回所有的祖先节点。</p>
                  <p>如果想要筛选某个祖先节点的话，可以向<code>parents()</code>方法传入CSS选择器，这样就会返回祖先节点中符合CSS选择器的节点：</p>
                  <figure class="highlight mel">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">parent</span> = items.parents(<span class="string">'.wrap'</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">parent</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，输出结果少了一个节点，只保留了<code>class</code>为<code>wrap</code>的节点。</p>
                  <h3 id="兄弟节点"><a href="#兄弟节点" class="headerlink" title="兄弟节点"></a>兄弟节点</h3>
                  <p>前面我们说明了子节点和父节点的用法，还有一种节点，那就是兄弟节点。如果要获取兄弟节点，可以使用<code>siblings()</code>方法。这里还是以上面的HTML代码为例：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">from</span> <span class="variable">pyquery</span> <span class="variable">import</span> <span class="variable">PyQuery</span> <span class="variable">as</span> <span class="variable">pq</span></span><br><span class="line"><span class="variable">doc</span> = <span class="function"><span class="title">pq</span>(<span class="variable">html</span>)</span></span><br><span class="line"><span class="variable">li</span> = <span class="function"><span class="title">doc</span>(<span class="string">'.list .item-0.active'</span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable">li.siblings</span>())</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先选择<code>class</code>为<code>list</code>的节点内部<code>class</code>为<code>item-0</code>和<code>active</code>的节点，也就是第三个<code>li</code>节点。那么，很明显，它的兄弟节点有4个，那就是第一、二、四、五个<code>li</code>节点。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这正是我们刚才所说的4个兄弟节点。</p>
                  <p>如果要筛选某个兄弟节点，我们依然可以向<code>siblings</code>方法传入CSS选择器，这样就会从所有兄弟节点中挑选出符合条件的节点了：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">from</span> <span class="variable">pyquery</span> <span class="variable">import</span> <span class="variable">PyQuery</span> <span class="variable">as</span> <span class="variable">pq</span></span><br><span class="line"><span class="variable">doc</span> = <span class="function"><span class="title">pq</span>(<span class="variable">html</span>)</span></span><br><span class="line"><span class="variable">li</span> = <span class="function"><span class="title">doc</span>(<span class="string">'.list .item-0.active'</span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable">li.siblings</span>(<span class="string">'.active'</span>))</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们筛选了<code>class</code>为<code>active</code>的节点，通过刚才的结果可以观察到，<code>class</code>为<code>active</code>的兄弟节点只有第四个<code>li</code>节点，所以结果应该是一个。</p>
                  <p>我们再看一下运行结果：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="5-遍历"><a href="#5-遍历" class="headerlink" title="5. 遍历"></a>5. 遍历</h2>
                  <p>刚才可以观察到，pyquery的选择结果可能是多个节点，也可能是单个节点，类型都是<code>PyQuery</code>类型，并没有返回像Beautiful Soup那样的列表。</p>
                  <p>对于单个节点来说，可以直接打印输出，也可以直接转成字符串：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">from</span> <span class="variable">pyquery</span> <span class="variable">import</span> <span class="variable">PyQuery</span> <span class="variable">as</span> <span class="variable">pq</span></span><br><span class="line"><span class="variable">doc</span> = <span class="function"><span class="title">pq</span>(<span class="variable">html</span>)</span></span><br><span class="line"><span class="variable">li</span> = <span class="function"><span class="title">doc</span>(<span class="string">'.item-0.active'</span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable">li</span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="title">str</span>(<span class="variable">li</span>))</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>对于多个节点的结果，我们就需要遍历来获取了。例如，这里把每一个<code>li</code>节点进行遍历，需要调用<code>items()</code>方法：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from pyquery import PyQuery <span class="keyword">as</span> pq</span><br><span class="line">doc = pq(html)</span><br><span class="line"><span class="keyword">lis</span> = doc('<span class="keyword">li</span>').items()</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">type</span>(<span class="keyword">lis</span>))</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">li</span> <span class="keyword">in</span> <span class="keyword">lis</span>:</span><br><span class="line">    <span class="keyword">print</span>(<span class="keyword">li</span>, <span class="keyword">type</span>(<span class="keyword">li</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">class</span> '<span class="attr">generator</span>'&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> '<span class="attr">pyquery.pyquery.PyQuery</span>'&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> '<span class="attr">pyquery.pyquery.PyQuery</span>'&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> '<span class="attr">pyquery.pyquery.PyQuery</span>'&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> '<span class="attr">pyquery.pyquery.PyQuery</span>'&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> '<span class="attr">pyquery.pyquery.PyQuery</span>'&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，调用<code>items()</code>方法后，会得到一个生成器，遍历一下，就可以逐个得到<code>li</code>节点对象了，它的类型也是<code>PyQuery</code>类型。每个<code>li</code>节点还可以调用前面所说的方法进行选择，比如继续查询子节点，寻找某个祖先节点等，非常灵活。</p>
                  <h2 id="6-获取信息"><a href="#6-获取信息" class="headerlink" title="6. 获取信息"></a>6. 获取信息</h2>
                  <p>提取到节点之后，我们的最终目的当然是提取节点所包含的信息了。比较重要的信息有两类，一是获取属性，二是获取文本，下面分别进行说明。</p>
                  <h3 id="获取属性"><a href="#获取属性" class="headerlink" title="获取属性"></a>获取属性</h3>
                  <p>提取到某个<code>PyQuery</code>类型的节点后，就可以调用<code>attr()</code>方法来获取属性：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = '''</span><br><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"wrap"</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;ul <span class="built_in">class</span>=<span class="string">"list"</span>&gt;</span><br><span class="line">             &lt;li <span class="built_in">class</span>=<span class="string">"item-0"</span>&gt;<span class="keyword">first</span> <span class="built_in">item</span>&lt;/li&gt;</span><br><span class="line">             &lt;li <span class="built_in">class</span>=<span class="string">"item-1"</span>&gt;&lt;a href=<span class="string">"link2.html"</span>&gt;<span class="keyword">second</span> <span class="built_in">item</span>&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">             &lt;li <span class="built_in">class</span>=<span class="string">"item-0 active"</span>&gt;&lt;a href=<span class="string">"link3.html"</span>&gt;&lt;span <span class="built_in">class</span>=<span class="string">"bold"</span>&gt;<span class="keyword">third</span> <span class="built_in">item</span>&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">             &lt;li <span class="built_in">class</span>=<span class="string">"item-1 active"</span>&gt;&lt;a href=<span class="string">"link4.html"</span>&gt;<span class="keyword">fourth</span> <span class="built_in">item</span>&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">             &lt;li <span class="built_in">class</span>=<span class="string">"item-0"</span>&gt;&lt;a href=<span class="string">"link5.html"</span>&gt;<span class="keyword">fifth</span> <span class="built_in">item</span>&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">         &lt;/ul&gt;</span><br><span class="line">     &lt;/<span class="keyword">div</span>&gt;</span><br><span class="line"> &lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">'''</span><br><span class="line"><span class="keyword">from</span> pyquery import PyQuery <span class="keyword">as</span> pq</span><br><span class="line">doc = pq(html)</span><br><span class="line">a = doc('.<span class="built_in">item</span><span class="number">-0.</span>active a')</span><br><span class="line">print(a, type(a))</span><br><span class="line">print(a.attr('href'))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">class</span> '<span class="attr">pyquery.pyquery.PyQuery</span>'&gt;</span></span><br><span class="line">link3.html</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先选中<code>class</code>为<code>item-0</code>和<code>active</code>的<code>li</code>节点内的<code>a</code>节点，它的类型是<code>PyQuery</code>类型。</p>
                  <p>然后调用<code>attr()</code>方法。在这个方法中传入属性的名称，就可以得到这个属性值了。</p>
                  <p>此外，也可以通过调用<code>attr</code>属性来获取属性，用法如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(a.attr.href)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">link3</span><span class="selector-class">.html</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这两种方法的结果完全一样。</p>
                  <p>如果选中的是多个元素，然后调用<code>attr()</code>方法，会出现怎样的结果呢？我们用实例来测试一下：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">a = doc('a')</span><br><span class="line">print(<span class="name">a</span>, type(<span class="name">a</span>))</span><br><span class="line">print(<span class="name">a</span>.attr('href'))</span><br><span class="line">print(<span class="name">a</span>.attr.href)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;<span class="keyword">a</span> href=<span class="string">"link2.html"</span>&gt;<span class="keyword">second</span> <span class="keyword">item</span>&lt;/<span class="keyword">a</span>&gt;&lt;<span class="keyword">a</span> href=<span class="string">"link3.html"</span>&gt;&lt;span class=<span class="string">"bold"</span>&gt;<span class="keyword">third</span> <span class="keyword">item</span>&lt;/span&gt;&lt;/<span class="keyword">a</span>&gt;&lt;<span class="keyword">a</span> href=<span class="string">"link4.html"</span>&gt;<span class="keyword">fourth</span> <span class="keyword">item</span>&lt;/<span class="keyword">a</span>&gt;&lt;<span class="keyword">a</span> href=<span class="string">"link5.html"</span>&gt;<span class="keyword">fifth</span> <span class="keyword">item</span>&lt;/<span class="keyword">a</span>&gt; &lt;class <span class="string">'pyquery.pyquery.PyQuery'</span>&gt;</span><br><span class="line">link2.html</span><br><span class="line">link2.html</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>照理来说，我们选中的<code>a</code>节点应该有4个，而且打印结果也应该是4个，但是当我们调用<code>attr()</code>方法时，返回结果却只是第一个。这是因为，当返回结果包含多个节点时，调用<code>attr()</code>方法，只会得到第一个节点的属性。</p>
                  <p>那么，遇到这种情况时，如果想获取所有的<code>a</code>节点的属性，就要用到前面所说的遍历了：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">from</span> pyquery import PyQuery <span class="keyword">as</span> pq</span><br><span class="line">doc = pq(html)</span><br><span class="line"><span class="keyword">a</span> = doc(<span class="string">'a'</span>)</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">item</span> <span class="keyword">in</span> <span class="keyword">a</span>.<span class="keyword">items</span>():</span><br><span class="line">    print(<span class="keyword">item</span>.attr(<span class="string">'href'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此时的运行结果如下：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">link2</span><span class="selector-class">.html</span></span><br><span class="line"><span class="selector-tag">link3</span><span class="selector-class">.html</span></span><br><span class="line"><span class="selector-tag">link4</span><span class="selector-class">.html</span></span><br><span class="line"><span class="selector-tag">link5</span><span class="selector-class">.html</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>因此，在进行属性获取时，可以观察返回节点是一个还是多个，如果是多个，则需要遍历才能依次获取每个节点的属性。</p>
                  <h3 id="获取文本"><a href="#获取文本" class="headerlink" title="获取文本"></a>获取文本</h3>
                  <p>获取节点之后的另一个主要操作就是获取其内部的文本了，此时可以调用<code>text()</code>方法来实现：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = '''</span><br><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"wrap"</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;ul <span class="built_in">class</span>=<span class="string">"list"</span>&gt;</span><br><span class="line">             &lt;li <span class="built_in">class</span>=<span class="string">"item-0"</span>&gt;<span class="keyword">first</span> <span class="built_in">item</span>&lt;/li&gt;</span><br><span class="line">             &lt;li <span class="built_in">class</span>=<span class="string">"item-1"</span>&gt;&lt;a href=<span class="string">"link2.html"</span>&gt;<span class="keyword">second</span> <span class="built_in">item</span>&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">             &lt;li <span class="built_in">class</span>=<span class="string">"item-0 active"</span>&gt;&lt;a href=<span class="string">"link3.html"</span>&gt;&lt;span <span class="built_in">class</span>=<span class="string">"bold"</span>&gt;<span class="keyword">third</span> <span class="built_in">item</span>&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">             &lt;li <span class="built_in">class</span>=<span class="string">"item-1 active"</span>&gt;&lt;a href=<span class="string">"link4.html"</span>&gt;<span class="keyword">fourth</span> <span class="built_in">item</span>&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">             &lt;li <span class="built_in">class</span>=<span class="string">"item-0"</span>&gt;&lt;a href=<span class="string">"link5.html"</span>&gt;<span class="keyword">fifth</span> <span class="built_in">item</span>&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">         &lt;/ul&gt;</span><br><span class="line">     &lt;/<span class="keyword">div</span>&gt;</span><br><span class="line"> &lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">'''</span><br><span class="line"><span class="keyword">from</span> pyquery import PyQuery <span class="keyword">as</span> pq</span><br><span class="line">doc = pq(html)</span><br><span class="line">a = doc('.<span class="built_in">item</span><span class="number">-0.</span>active a')</span><br><span class="line">print(a)</span><br><span class="line">print(a.<span class="built_in">text</span>())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;a href=<span class="string">"link3.html"</span>&gt;&lt;span <span class="keyword">class</span>="<span class="symbol">bold</span>"&gt;<span class="symbol">third</span> <span class="symbol">item</span>&lt;/<span class="symbol">span</span>&gt;&lt;/<span class="symbol">a</span>&gt;</span><br><span class="line"><span class="symbol">third</span> <span class="symbol">item</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先选中一个<code>a</code>节点，然后调用<code>text()</code>方法，就可以获取其内部的文本信息。此时它会忽略掉节点内部包含的所有HTML，只返回纯文字内容。</p>
                  <p>但如果想要获取这个节点内部的HTML文本，就要用<code>html()</code>方法了：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">from</span> <span class="variable">pyquery</span> <span class="variable">import</span> <span class="variable">PyQuery</span> <span class="variable">as</span> <span class="variable">pq</span></span><br><span class="line"><span class="variable">doc</span> = <span class="function"><span class="title">pq</span>(<span class="variable">html</span>)</span></span><br><span class="line"><span class="variable">li</span> = <span class="function"><span class="title">doc</span>(<span class="string">'.item-0.active'</span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable">li</span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable">li.html</span>())</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们选中了第三个<code>li</code>节点，然后调用了<code>html()</code>方法，它返回的结果应该是<code>li</code>节点内的所有HTML文本。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;a href=<span class="string">"link3.html"</span>&gt;&lt;span <span class="keyword">class</span>="<span class="symbol">bold</span>"&gt;<span class="symbol">third</span> <span class="symbol">item</span>&lt;/<span class="symbol">span</span>&gt;&lt;/<span class="symbol">a</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里同样有一个问题，如果我们选中的结果是多个节点，<code>text()</code>或<code>html()</code>会返回什么内容？我们用实例来看一下：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = '''</span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">"wrap"</span>&gt;</span><br><span class="line">    &lt;div id=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;ul <span class="keyword">class</span>=<span class="string">"list"</span>&gt;</span><br><span class="line">             &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-1"</span>&gt;&lt;a href=<span class="string">"link2.html"</span>&gt;second item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">             &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-0 active"</span>&gt;&lt;a href=<span class="string">"link3.html"</span>&gt;&lt;span <span class="keyword">class</span>=<span class="string">"bold"</span>&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">             &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-1 active"</span>&gt;&lt;a href=<span class="string">"link4.html"</span>&gt;fourth item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">             &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-0"</span>&gt;&lt;a href=<span class="string">"link5.html"</span>&gt;fifth item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">         &lt;/ul&gt;</span><br><span class="line">     &lt;/div&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">'''</span><br><span class="line">from pyquery import PyQuery <span class="keyword">as</span> pq</span><br><span class="line">doc = pq(html)</span><br><span class="line"><span class="keyword">li</span> = doc('<span class="keyword">li</span>')</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">li</span>.html())</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">li</span>.text())</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">type</span>(<span class="keyword">li</span>.text())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;<span class="keyword">a</span> href=<span class="string">"link2.html"</span>&gt;<span class="keyword">second</span> <span class="keyword">item</span>&lt;/<span class="keyword">a</span>&gt;</span><br><span class="line"><span class="keyword">second</span> <span class="keyword">item</span> <span class="keyword">third</span> <span class="keyword">item</span> <span class="keyword">fourth</span> <span class="keyword">item</span> <span class="keyword">fifth</span> <span class="keyword">item</span></span><br><span class="line">&lt;class <span class="string">'str'</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果可能比较出乎意料，<code>html()</code>方法返回的是第一个<code>li</code>节点的内部HTML文本，而<code>text()</code>则返回了所有的<code>li</code>节点内部的纯文本，中间用一个空格分割开，即返回结果是一个字符串。</p>
                  <p>所以这个地方值得注意，如果得到的结果是多个节点，并且想要获取每个节点的内部HTML文本，则需要遍历每个节点。而<code>text()</code>方法不需要遍历就可以获取，它将所有节点取文本之后合并成一个字符串。</p>
                  <h2 id="7-节点操作"><a href="#7-节点操作" class="headerlink" title="7. 节点操作"></a>7. 节点操作</h2>
                  <p>pyquery提供了一系列方法来对节点进行动态修改，比如为某个节点添加一个<code>class</code>，移除某个节点等，这些操作有时候会为提取信息带来极大的便利。</p>
                  <p>由于节点操作的方法太多，下面举几个典型的例子来说明它的用法。</p>
                  <h3 id="addClass和removeClass"><a href="#addClass和removeClass" class="headerlink" title="addClass和removeClass"></a><code>addClass</code>和<code>removeClass</code></h3>
                  <p>我们先用实例来感受一下：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = '''</span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">"wrap"</span>&gt;</span><br><span class="line">    &lt;div id=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;ul <span class="keyword">class</span>=<span class="string">"list"</span>&gt;</span><br><span class="line">             &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-0"</span>&gt;first item&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">             &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-1"</span>&gt;&lt;a href=<span class="string">"link2.html"</span>&gt;second item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">             &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-0 active"</span>&gt;&lt;a href=<span class="string">"link3.html"</span>&gt;&lt;span <span class="keyword">class</span>=<span class="string">"bold"</span>&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">             &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-1 active"</span>&gt;&lt;a href=<span class="string">"link4.html"</span>&gt;fourth item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">             &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-0"</span>&gt;&lt;a href=<span class="string">"link5.html"</span>&gt;fifth item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">         &lt;/ul&gt;</span><br><span class="line">     &lt;/div&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">'''</span><br><span class="line">from pyquery import PyQuery <span class="keyword">as</span> pq</span><br><span class="line">doc = pq(html)</span><br><span class="line"><span class="keyword">li</span> = doc('.item-0.active')</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">li</span>)</span><br><span class="line"><span class="keyword">li</span>.removeClass('active')</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">li</span>)</span><br><span class="line"><span class="keyword">li</span>.addClass('active')</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">li</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先选中了第三个<code>li</code>节点，然后调用<code>removeClass()</code>方法，将<code>li</code>节点的<code>active</code>这个<code>class</code>移除，后来又调用<code>addClass()</code>方法，将<code>class</code>添加回来。每执行一次操作，就打印输出当前<code>li</code>节点的内容。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，一共输出了3次。第二次输出时，<code>li</code>节点的<code>active</code>这个<code>class</code>被移除了，第三次<code>class</code>又添加回来了。</p>
                  <p>所以说，<code>addClass()</code>和<code>removeClass()</code>这些方法可以动态改变节点的<code>class</code>属性。</p>
                  <h3 id="attr、text和html"><a href="#attr、text和html" class="headerlink" title="attr、text和html"></a><code>attr</code>、<code>text</code>和<code>html</code></h3>
                  <p>当然，除了操作<code>class</code>这个属性外，也可以用<code>attr()</code>方法对属性进行操作。此外，还可以用<code>text()</code>和<code>html()</code>方法来改变节点内部的内容。示例如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;ul class="list"&gt;</span></span><br><span class="line"><span class="string">     &lt;li class="item-0 active"&gt;&lt;a href="link3.html"&gt;&lt;span class="bold"&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">&lt;/ul&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line">doc = pq(html)</span><br><span class="line">li = doc(<span class="string">'.item-0.active'</span>)</span><br><span class="line">print(li)</span><br><span class="line">li.attr(<span class="string">'name'</span>, <span class="string">'link'</span>)</span><br><span class="line">print(li)</span><br><span class="line">li.text(<span class="string">'changed item'</span>)</span><br><span class="line">print(li)</span><br><span class="line">li.html(<span class="string">'&lt;span&gt;changed item&lt;/span&gt;'</span>)</span><br><span class="line">print(li)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们首先选中<code>li</code>节点，然后调用<code>attr()</code>方法来修改属性，其中该方法的第一个参数为属性名，第二个参数为属性值。接着，调用<code>text()</code>和<code>html()</code>方法来改变节点内部的内容。三次操作后，分别打印输出当前的<code>li</code>节点。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span> <span class="attr">name</span>=<span class="string">"link"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span> <span class="attr">name</span>=<span class="string">"link"</span>&gt;</span>changed item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span> <span class="attr">name</span>=<span class="string">"link"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>changed item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，调用<code>attr()</code>方法后，<code>li</code>节点多了一个原本不存在的属性<code>name</code>，其值为<code>link</code>。接着调用<code>text()</code>方法，传入文本之后，<code>li</code>节点内部的文本全被改为传入的字符串文本了。最后，调用<code>html()</code>方法传入HTML文本后，<code>li</code>节点内部又变为传入的HTML文本了。</p>
                  <p>所以说，如果<code>attr()</code>方法只传入第一个参数的属性名，则是获取这个属性值；如果传入第二个参数，可以用来修改属性值。<code>text()</code>和<code>html()</code>方法如果不传参数，则是获取节点内纯文本和HTML文本；如果传入参数，则进行赋值。</p>
                  <h3 id="remove"><a href="#remove" class="headerlink" title="remove()"></a><code>remove()</code></h3>
                  <p>顾名思义，<code>remove()</code>方法就是移除，它有时会为信息的提取带来非常大的便利。下面有一段HTML文本：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="wrap"&gt;</span></span><br><span class="line"><span class="string">    Hello, World</span></span><br><span class="line"><span class="string">    &lt;p&gt;This is a paragraph.&lt;/p&gt;</span></span><br><span class="line"><span class="string"> &lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line">doc = pq(html)</span><br><span class="line">wrap = doc(<span class="string">'.wrap'</span>)</span><br><span class="line">print(wrap.text())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>现在想提取<code>Hello, World</code>这个字符串，而不要<code>p</code>节点内部的字符串，需要怎样操作呢？</p>
                  <p>这里直接先尝试提取<code>class</code>为<code>wrap</code>的节点的内容，看看是不是我们想要的。运行结果如下：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Hello, World This <span class="keyword">is</span> a <span class="built_in">paragraph</span>.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个结果还包含了内部的<code>p</code>节点的内容，也就是说<code>text()</code>把所有的纯文本全提取出来了。如果我们想去掉<code>p</code>节点内部的文本，可以选择再把<code>p</code>节点内的文本提取一遍，然后从整个结果中移除这个子串，但这个做法明显比较烦琐。</p>
                  <p>这时<code>remove()</code>方法就可以派上用场了，我们可以接着这么做:</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">wrap.<span class="builtin-name">find</span>(<span class="string">'p'</span>).<span class="builtin-name">remove</span>()</span><br><span class="line"><span class="builtin-name">print</span>(wrap.text())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先选中<code>p</code>节点，然后调用了<code>remove()</code>方法将其移除，然后这时<code>wrap</code>内部就只剩下<code>Hello, World</code>这句话了，然后再利用<code>text()</code>方法提取即可。</p>
                  <p>另外，其实还有很多节点操作的方法，比如<code>append()</code>、<code>empty()</code>和<code>prepend()</code>等方法，它们和jQuery的用法完全一致，详细的用法可以参考官方文档：<span class="exturl" data-url="aHR0cDovL3B5cXVlcnkucmVhZHRoZWRvY3MuaW8vZW4vbGF0ZXN0L2FwaS5odG1s">http://pyquery.readthedocs.io/en/latest/api.html<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="8-伪类选择器"><a href="#8-伪类选择器" class="headerlink" title="8. 伪类选择器"></a>8. 伪类选择器</h2>
                  <p>CSS选择器之所以强大，还有一个很重要的原因，那就是它支持多种多样的伪类选择器，例如选择第一个节点、最后一个节点、奇偶数节点、包含某一文本的节点等。示例如下：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = '''</span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">"wrap"</span>&gt;</span><br><span class="line">    &lt;div id=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;ul <span class="keyword">class</span>=<span class="string">"list"</span>&gt;</span><br><span class="line">             &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-0"</span>&gt;first item&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">             &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-1"</span>&gt;&lt;a href=<span class="string">"link2.html"</span>&gt;second item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">             &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-0 active"</span>&gt;&lt;a href=<span class="string">"link3.html"</span>&gt;&lt;span <span class="keyword">class</span>=<span class="string">"bold"</span>&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">             &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-1 active"</span>&gt;&lt;a href=<span class="string">"link4.html"</span>&gt;fourth item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">             &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-0"</span>&gt;&lt;a href=<span class="string">"link5.html"</span>&gt;fifth item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">         &lt;/ul&gt;</span><br><span class="line">     &lt;/div&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">'''</span><br><span class="line">from pyquery import PyQuery <span class="keyword">as</span> pq</span><br><span class="line">doc = pq(html)</span><br><span class="line"><span class="keyword">li</span> = doc('<span class="keyword">li</span>:first-child')</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">li</span>)</span><br><span class="line"><span class="keyword">li</span> = doc('<span class="keyword">li</span>:last-child')</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">li</span>)</span><br><span class="line"><span class="keyword">li</span> = doc('<span class="keyword">li</span>:nth-child(2)')</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">li</span>)</span><br><span class="line"><span class="keyword">li</span> = doc('<span class="keyword">li</span>:gt(2)')</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">li</span>)</span><br><span class="line"><span class="keyword">li</span> = doc('<span class="keyword">li</span>:nth-child(2n)')</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">li</span>) `<span class="keyword">li</span> \= doc('<span class="keyword">li</span>:contains(second)')</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">li</span>)`</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们使用了CSS3的伪类选择器，依次选择了第一个<code>li</code>节点、最后一个<code>li</code>节点、第二个<code>li</code>节点、第三个<code>li</code>之后的<code>li</code>节点、偶数位置的<code>li</code>节点、包含<code>second</code>文本的<code>li</code>节点。</p>
                  <p>关于CSS选择器的更多用法，可以参考<span class="exturl" data-url="aHR0cDovL3d3dy53M3NjaG9vbC5jb20uY24vY3NzL2luZGV4LmFzcA==">http://www.w3school.com.cn/css/index.asp<i class="fa fa-external-link-alt"></i></span>。</p>
                  <p>到此为止，pyquery的常用用法就介绍完了。如果想查看更多的内容，可以参考pyquery的官方文档：<span class="exturl" data-url="aHR0cDovL3B5cXVlcnkucmVhZHRoZWRvY3MuaW8v">http://pyquery.readthedocs.io<i class="fa fa-external-link-alt"></i></span>。我们相信有了它，解析网页不再是难事。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-28 16:31:40" itemprop="dateCreated datePublished" datetime="2018-01-28T16:31:40+08:00">2018-01-28</time>
                </span>
                <span id="/5551.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 4.3-使用pyquery" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>20k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>18 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5548.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5548.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 4.2-使用Beautiful Soup</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>前面介绍了正则表达式的相关用法，但是一旦正则表达式写的有问题，得到的可能就不是我们想要的结果了。而且对于一个网页来说，都有一定的特殊结构和层级关系，而且很多节点都有<code>id</code>或<code>class</code>来作区分，所以借助它们的结构和属性来提取不也可以吗？</p>
                  <p>这一节中，我们就来介绍一个强大的解析工具Beautiful Soup，它借助网页的结构和属性等特性来解析网页。有了它，我们不用再去写一些复杂的正则表达式，只需要简单的几条语句，就可以完成网页中某个元素的提取。</p>
                  <p>废话不多说，接下来就来感受一下Beautiful Soup的强大之处吧。</p>
                  <h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h2>
                  <p>简单来说，Beautiful Soup就是Python的一个HTML或XML的解析库，可以用它来方便地从网页中提取数据。官方解释如下：</p>
                  <blockquote>
                    <p>Beautiful Soup提供一些简单的、Python式的函数来处理导航、搜索、修改分析树等功能。它是一个工具箱，通过解析文档为用户提供需要抓取的数据，因为简单，所以不需要多少代码就可以写出一个完整的应用程序。</p>
                    <p>Beautiful Soup自动将输入文档转换为Unicode编码，输出文档转换为UTF-8编码。你不需要考虑编码方式，除非文档没有指定一个编码方式，这时你仅仅需要说明一下原始编码方式就可以了。</p>
                    <p>Beautiful Soup已成为和lxml、html6lib一样出色的Python解释器，为用户灵活地提供不同的解析策略或强劲的速度。</p>
                  </blockquote>
                  <p>所以说，利用它可以省去很多烦琐的提取工作，提高了解析效率。</p>
                  <h2 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2. 准备工作"></a>2. 准备工作</h2>
                  <p>在开始之前，请确保已经正确安装好了Beautiful Soup和lxml，如果没有安装，可以参考第1章的内容。</p>
                  <h2 id="3-解析器"><a href="#3-解析器" class="headerlink" title="3. 解析器"></a>3. 解析器</h2>
                  <p>Beautiful Soup在解析时实际上依赖解析器，它除了支持Python标准库中的HTML解析器外，还支持一些第三方解析器（比如lxml）。表4-3列出了Beautiful Soup支持的解析器。</p>
                  <p>表4-3 Beautiful Soup支持的解析器</p>
                  <p>解析器</p>
                  <p>使用方法</p>
                  <p>优势</p>
                  <p>劣势</p>
                  <p>Python标准库</p>
                  <p><code>BeautifulSoup(markup, &quot;html.parser&quot;)</code></p>
                  <p>Python的内置标准库、执行速度适中、文档容错能力强</p>
                  <p>Python 2.7.3及Python 3.2.2之前的版本文档容错能力差</p>
                  <p>lxml HTML解析器</p>
                  <p><code>BeautifulSoup(markup, &quot;lxml&quot;)</code></p>
                  <p>速度快、文档容错能力强</p>
                  <p>需要安装C语言库</p>
                  <p>lxml XML解析器</p>
                  <p><code>BeautifulSoup(markup, &quot;xml&quot;)</code></p>
                  <p>速度快、唯一支持XML的解析器</p>
                  <p>需要安装C语言库</p>
                  <p>html5lib</p>
                  <p><code>BeautifulSoup(markup, &quot;html5lib&quot;)</code></p>
                  <p>最好的容错性、以浏览器的方式解析文档、生成HTML5格式的文档</p>
                  <p>速度慢、不依赖外部扩展</p>
                  <p>通过以上对比可以看出，lxml解析器有解析HTML和XML的功能，而且速度快，容错能力强，所以推荐使用它。</p>
                  <p>如果使用lxml，那么在初始化Beautiful Soup时，可以把第二个参数改为<code>lxml</code>即可：</p>
                  <figure class="highlight moonscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(<span class="string">'&lt;p&gt;Hello&lt;/p&gt;'</span>, <span class="string">'lxml'</span>)</span><br><span class="line"><span class="built_in">print</span>(soup.p.<span class="built_in">string</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在后面，Beautiful Soup的用法实例也统一用这个解析器来演示。</p>
                  <h2 id="4-基本用法"><a href="#4-基本用法" class="headerlink" title="4. 基本用法"></a>4. 基本用法</h2>
                  <p>下面首先用实例来看看Beautiful Soup的基本用法：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = """</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>The Dormouse's story<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"title"</span> <span class="attr">name</span>=<span class="string">"dromouse"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>The Dormouse's story<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"story"</span>&gt;</span>Once upon a time there were three little sisters; and their names were</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://example.com/elsie"</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">id</span>=<span class="string">"link1"</span>&gt;</span><span class="comment">&lt;!-- Elsie --&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>,</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://example.com/lacie"</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">id</span>=<span class="string">"link2"</span>&gt;</span>Lacie<span class="tag">&lt;/<span class="name">a</span>&gt;</span> and</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://example.com/tillie"</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">id</span>=<span class="string">"link3"</span>&gt;</span>Tillie<span class="tag">&lt;/<span class="name">a</span>&gt;</span>;</span><br><span class="line">and they lived at the bottom of a well.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"story"</span>&gt;</span>...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">"""</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html, 'lxml')</span><br><span class="line">print(soup.prettify())</span><br><span class="line">print(soup.title.string)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span></span><br><span class="line">   The Dormouse's story</span><br><span class="line">  <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"title"</span> <span class="attr">name</span>=<span class="string">"dromouse"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">b</span>&gt;</span></span><br><span class="line">    The Dormouse's story</span><br><span class="line">   <span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"story"</span>&gt;</span></span><br><span class="line">   Once upon a time there were three little sisters; and their names were</span><br><span class="line">   <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">href</span>=<span class="string">"http://example.com/elsie"</span> <span class="attr">id</span>=<span class="string">"link1"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Elsie --&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">   ,</span><br><span class="line">   <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">href</span>=<span class="string">"http://example.com/lacie"</span> <span class="attr">id</span>=<span class="string">"link2"</span>&gt;</span></span><br><span class="line">    Lacie</span><br><span class="line">   <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">   and</span><br><span class="line">   <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">href</span>=<span class="string">"http://example.com/tillie"</span> <span class="attr">id</span>=<span class="string">"link3"</span>&gt;</span></span><br><span class="line">    Tillie</span><br><span class="line">   <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">   ;</span><br><span class="line">and they lived at the bottom of a well.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"story"</span>&gt;</span></span><br><span class="line">   ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">The Dormouse's story</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先声明变量<code>html</code>，它是一个HTML字符串。但是需要注意的是，它并不是一个完整的HTML字符串，因为<code>body</code>和<code>html</code>节点都没有闭合。接着，我们将它当作第一个参数传给<code>BeautifulSoup</code>对象，该对象的第二个参数为解析器的类型（这里使用<code>lxml</code>），此时就完成了<code>BeaufulSoup</code>对象的初始化。然后，将这个对象赋值给<code>soup</code>变量。</p>
                  <p>接下来，就可以调用<code>soup</code>的各个方法和属性解析这串HTML代码了。</p>
                  <p>首先，调用<code>prettify()</code>方法。这个方法可以把要解析的字符串以标准的缩进格式输出。这里需要注意的是，输出结果里面包含<code>body</code>和<code>html</code>节点，也就是说对于不标准的HTML字符串<code>BeautifulSoup</code>，可以自动更正格式。这一步不是由<code>prettify()</code>方法做的，而是在初始化<code>BeautifulSoup</code>时就完成了。</p>
                  <p>然后调用<code>soup.title.string</code>，这实际上是输出HTML中<code>title</code>节点的文本内容。所以，<code>soup.title</code>可以选出HTML中的<code>title</code>节点，再调用<code>string</code>属性就可以得到里面的文本了，所以我们可以通过简单调用几个属性完成文本提取，这是不是非常方便？</p>
                  <h2 id="5-节点选择器"><a href="#5-节点选择器" class="headerlink" title="5. 节点选择器"></a>5. 节点选择器</h2>
                  <p>直接调用节点的名称就可以选择节点元素，再调用<code>string</code>属性就可以得到节点内的文本了，这种选择方式速度非常快。如果单个节点结构层次非常清晰，可以选用这种方式来解析。</p>
                  <h3 id="选择元素"><a href="#选择元素" class="headerlink" title="选择元素"></a>选择元素</h3>
                  <p>下面再用一个例子详细说明选择元素的方法：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = """</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>The Dormouse's story<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"title"</span> <span class="attr">name</span>=<span class="string">"dromouse"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>The Dormouse's story<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"story"</span>&gt;</span>Once upon a time there were three little sisters; and their names were</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://example.com/elsie"</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">id</span>=<span class="string">"link1"</span>&gt;</span><span class="comment">&lt;!-- Elsie --&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>,</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://example.com/lacie"</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">id</span>=<span class="string">"link2"</span>&gt;</span>Lacie<span class="tag">&lt;/<span class="name">a</span>&gt;</span> and</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://example.com/tillie"</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">id</span>=<span class="string">"link3"</span>&gt;</span>Tillie<span class="tag">&lt;/<span class="name">a</span>&gt;</span>;</span><br><span class="line">and they lived at the bottom of a well.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"story"</span>&gt;</span>...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">"""</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html, 'lxml')</span><br><span class="line">print(soup.title)</span><br><span class="line">print(type(soup.title))</span><br><span class="line">print(soup.title.string)</span><br><span class="line">print(soup.head)</span><br><span class="line">print(soup.p)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;title&gt;The Dormous<span class="string">e's story&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;class '</span>bs4.element.Tag<span class="string">'&gt;</span></span><br><span class="line"><span class="string">The Dormouse'</span>s story</span><br><span class="line">&lt;head&gt;&lt;title&gt;The Dormous<span class="string">e's story&lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;p class="title" name="dromouse"&gt;&lt;b&gt;The Dormouse'</span>s story&lt;/b&gt;&lt;/p&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里依然选用刚才的HTML代码，首先打印输出<code>title</code>节点的选择结果，输出结果正是<code>title</code>节点加里面的文字内容。接下来，输出它的类型，是<code>bs4.element.Tag</code>类型，这是Beautiful Soup中一个重要的数据结构。经过选择器选择后，选择结果都是这种<code>Tag</code>类型。<code>Tag</code>具有一些属性，比如<code>string</code>属性，调用该属性，可以得到节点的文本内容，所以接下来的输出结果正是节点的文本内容。</p>
                  <p>接下来，我们又尝试选择了<code>head</code>节点，结果也是节点加其内部的所有内容。最后，选择了<code>p</code>节点。不过这次情况比较特殊，我们发现结果是第一个<code>p</code>节点的内容，后面的几个<code>p</code>节点并没有选到。也就是说，当有多个节点时，这种选择方式只会选择到第一个匹配的节点，其他的后面节点都会忽略。</p>
                  <h3 id="提取信息"><a href="#提取信息" class="headerlink" title="提取信息"></a>提取信息</h3>
                  <p>上面演示了调用<code>string</code>属性来获取文本的值，那么如何获取节点属性的值呢？如何获取节点名呢？下面我们来统一梳理一下信息的提取方式。</p>
                  <h4 id="1-获取名称"><a href="#1-获取名称" class="headerlink" title="(1)获取名称"></a>(1)获取名称</h4>
                  <p>可以利用<code>name</code>属性获取节点的名称。这里还是以上面的文本为例，选取<code>title</code>节点，然后调用<code>name</code>属性就可以得到节点名称：</p>
                  <figure class="highlight gauss">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">print</span>(soup.<span class="built_in">title</span>.name)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight dos">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">title</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h4 id="2-获取属性"><a href="#2-获取属性" class="headerlink" title="(2)获取属性"></a>(2)获取属性</h4>
                  <p>每个节点可能有多个属性，比如<code>id</code>和<code>class</code>等，选择这个节点元素后，可以调用<code>attrs</code>获取所有属性：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(soup.p.attrs)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(soup.p.attrs[<span class="string">'name'</span>])</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="string">'class'</span>: [<span class="string">'title'</span>], <span class="string">'name'</span>: <span class="string">'dromouse'</span>&#125;</span><br><span class="line">dromouse</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，<code>attrs</code>的返回结果是字典形式，它把选择的节点的所有属性和属性值组合成一个字典。接下来，如果要获取<code>name</code>属性，就相当于从字典中获取某个键值，只需要用中括号加属性名就可以了。比如，要获取<code>name</code>属性，就可以通过<code>attrs[&#39;name&#39;]</code>来得到。</p>
                  <p>其实这样有点烦琐，还有一种更简单的获取方式：可以不用写<code>attrs</code>，直接在节点元素后面加中括号，传入属性名就可以获取属性值了。样例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(soup.p[<span class="string">'name'</span>])</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(soup.p[<span class="string">'class'</span>])</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">dromouse</span></span><br><span class="line"><span class="selector-attr">[<span class="string">'title'</span>]</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里需要注意的是，有的返回结果是字符串，有的返回结果是字符串组成的列表。比如，<code>name</code>属性的值是唯一的，返回的结果就是单个字符串。而对于<code>class</code>，一个节点元素可能有多个<code>class</code>，所以返回的是列表。在实际处理过程中，我们要注意判断类型。</p>
                  <h4 id="3-获取内容"><a href="#3-获取内容" class="headerlink" title="(3)获取内容"></a>(3)获取内容</h4>
                  <p>可以利用<code>string</code>属性获取节点元素包含的文本内容，比如要获取第一个<code>p</code>节点的文本：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(soup.p.string)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">The Dormouse<span class="symbol">'s</span> story</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>再次注意一下，这里选择到的<code>p</code>节点是第一个<code>p</code>节点，获取的文本也是第一个<code>p</code>节点里面的文本。</p>
                  <h3 id="嵌套选择"><a href="#嵌套选择" class="headerlink" title="嵌套选择"></a>嵌套选择</h3>
                  <p>在上面的例子中，我们知道每一个返回结果都是<code>bs4.element.Tag</code>类型，它同样可以继续调用节点进行下一步的选择。比如，我们获取了<code>head</code>节点元素，我们可以继续调用<code>head</code>来选取其内部的<code>head</code>节点元素：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse's story&lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">print(soup.head.title)</span><br><span class="line">print(type(soup.head.title))</span><br><span class="line">print(soup.head.title.string)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;title&gt;The Dormous<span class="string">e's story&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;class '</span>bs4.element.Tag<span class="string">'&gt;</span></span><br><span class="line"><span class="string">The Dormouse'</span>s story</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>第一行结果是调用<code>head</code>之后再次调用<code>title</code>而选择的<code>title</code>节点元素。然后打印输出了它的类型，可以看到，它仍然是<code>bs4.element.Tag</code>类型。也就是说，我们在<code>Tag</code>类型的基础上再次选择得到的依然还是<code>Tag</code>类型，每次返回的结果都相同，所以这样就可以做嵌套选择了。</p>
                  <p>最后，输出它的<code>string</code>属性，也就是节点里的文本内容。</p>
                  <h3 id="关联选择"><a href="#关联选择" class="headerlink" title="关联选择"></a>关联选择</h3>
                  <p>在做选择的时候，有时候不能做到一步就选到想要的节点元素，需要先选中某一个节点元素，然后以它为基准再选择它的子节点、父节点、兄弟节点等，这里就来介绍如何选择这些节点元素。</p>
                  <h4 id="1-子节点和子孙节点"><a href="#1-子节点和子孙节点" class="headerlink" title="(1)子节点和子孙节点"></a>(1)子节点和子孙节点</h4>
                  <p>选取节点元素之后，如果想要获取它的直接子节点，可以调用<code>contents</code>属性，示例如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = """</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>The Dormouse's story<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"story"</span>&gt;</span></span><br><span class="line">            Once upon a time there were three little sisters; and their names were</span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://example.com/elsie"</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">id</span>=<span class="string">"link1"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>Elsie<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://example.com/lacie"</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">id</span>=<span class="string">"link2"</span>&gt;</span>Lacie<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">            and</span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://example.com/tillie"</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">id</span>=<span class="string">"link3"</span>&gt;</span>Tillie<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            and they lived at the bottom of a well.</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"story"</span>&gt;</span>...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">"""</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xquery">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="string">'\n            Once upon a time there were three little sisters; and their names were\n            '</span>, <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">href</span>=<span class="string">"http://example.com/elsie"</span> <span class="attr">id</span>=<span class="string">"link1"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>Elsie<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span>, <span class="string">'\n'</span>, <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">href</span>=<span class="string">"http://example.com/lacie"</span> <span class="attr">id</span>=<span class="string">"link2"</span>&gt;</span>Lacie<span class="tag">&lt;/<span class="name">a</span>&gt;</span>, ' \n            and\n            ', <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">href</span>=<span class="string">"http://example.com/tillie"</span> <span class="attr">id</span>=<span class="string">"link3"</span>&gt;</span>Tillie<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span>, <span class="string">'\n            and they lived at the bottom of a well.\n        '</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，返回结果是列表形式。<code>p</code>节点里既包含文本，又包含节点，最后会将它们以列表形式统一返回。</p>
                  <p>需要注意的是，列表中的每个元素都是<code>p</code>节点的直接子节点。比如第一个<code>a</code>节点里面包含一层<code>span</code>节点，这相当于孙子节点了，但是返回结果并没有单独把<code>span</code>节点选出来。所以说，<code>contents</code>属性得到的结果是直接子节点的列表。</p>
                  <p>同样，我们可以调用<code>children</code>属性得到相应的结果：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(<span class="selector-tag">html</span>, <span class="string">'lxml'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(soup.p.children)</span></span></span><br><span class="line"><span class="keyword">for</span> <span class="selector-tag">i</span>, child <span class="keyword">in</span> enumerate(soup<span class="selector-class">.p</span>.children):</span><br><span class="line">    print(<span class="selector-tag">i</span>, child)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;list_iterator object <span class="keyword">at</span> <span class="number">0x1064f7dd8</span>&gt;</span><br><span class="line"><span class="number">0</span> </span><br><span class="line">            Once upon <span class="keyword">a</span> <span class="built_in">time</span> there were <span class="literal">three</span> little sisters; <span class="keyword">and</span> their names were</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> &lt;<span class="keyword">a</span> class=<span class="string">"sister"</span> href=<span class="string">"http://example.com/elsie"</span> id=<span class="string">"link1"</span>&gt;</span><br><span class="line">&lt;span&gt;Elsie&lt;/span&gt;</span><br><span class="line">&lt;/<span class="keyword">a</span>&gt;</span><br><span class="line"><span class="number">2</span> </span><br><span class="line"></span><br><span class="line"><span class="number">3</span> &lt;<span class="keyword">a</span> class=<span class="string">"sister"</span> href=<span class="string">"http://example.com/lacie"</span> id=<span class="string">"link2"</span>&gt;Lacie&lt;/<span class="keyword">a</span>&gt;</span><br><span class="line"><span class="number">4</span>  </span><br><span class="line">            <span class="keyword">and</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> &lt;<span class="keyword">a</span> class=<span class="string">"sister"</span> href=<span class="string">"http://example.com/tillie"</span> id=<span class="string">"link3"</span>&gt;Tillie&lt;/<span class="keyword">a</span>&gt;</span><br><span class="line"><span class="number">6</span> </span><br><span class="line">            <span class="keyword">and</span> they lived <span class="keyword">at</span> <span class="keyword">the</span> bottom <span class="keyword">of</span> <span class="keyword">a</span> well.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>还是同样的HTML文本，这里调用了<code>children</code>属性来选择，返回结果是生成器类型。接下来，我们用<code>for</code>循环输出相应的内容。</p>
                  <p>如果要得到所有的子孙节点的话，可以调用<code>descendants</code>属性：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(<span class="selector-tag">html</span>, <span class="string">'lxml'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(soup.p.descendants)</span></span></span><br><span class="line"><span class="keyword">for</span> <span class="selector-tag">i</span>, child <span class="keyword">in</span> enumerate(soup<span class="selector-class">.p</span>.descendants):</span><br><span class="line">    print(<span class="selector-tag">i</span>, child)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;generator object descendants at <span class="number">0x10650e678</span>&gt;</span><br><span class="line"><span class="number">0</span> </span><br><span class="line">            Once upon a time there were three little sisters; and their names were</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> &lt;a class=<span class="string">"sister"</span> href=<span class="string">"http://example.com/elsie"</span> id=<span class="string">"link1"</span>&gt;</span><br><span class="line">&lt;span&gt;Elsie&lt;/span&gt;</span><br><span class="line">&lt;/a&gt;</span><br><span class="line"><span class="number">2</span> </span><br><span class="line"></span><br><span class="line"><span class="number">3</span> &lt;span&gt;Elsie&lt;/span&gt;</span><br><span class="line"><span class="number">4</span> Elsie</span><br><span class="line"><span class="number">5</span> </span><br><span class="line"></span><br><span class="line"><span class="number">6</span> </span><br><span class="line"></span><br><span class="line"><span class="number">7</span> &lt;a class=<span class="string">"sister"</span> href=<span class="string">"http://example.com/lacie"</span> id=<span class="string">"link2"</span>&gt;Lacie&lt;/a&gt;</span><br><span class="line"><span class="number">8</span> Lacie</span><br><span class="line"><span class="number">9</span>  </span><br><span class="line">            and</span><br><span class="line"></span><br><span class="line"><span class="number">10</span> &lt;a class=<span class="string">"sister"</span> href=<span class="string">"http://example.com/tillie"</span> id=<span class="string">"link3"</span>&gt;Tillie&lt;/a&gt;</span><br><span class="line"><span class="number">11</span> Tillie</span><br><span class="line"><span class="number">12</span> </span><br><span class="line">            and they lived at the bottom of a well.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此时返回结果还是生成器。遍历输出一下可以看到，这次的输出结果就包含了<code>span</code>节点。<code>descendants</code>会递归查询所有子节点，得到所有的子孙节点。</p>
                  <h4 id="2-父节点和祖先节点"><a href="#2-父节点和祖先节点" class="headerlink" title="(2)父节点和祖先节点"></a>(2)父节点和祖先节点</h4>
                  <p>如果要获取某个节点元素的父节点，可以调用<code>parent</code>属性：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = """</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>The Dormouse's story<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"story"</span>&gt;</span></span><br><span class="line">            Once upon a time there were three little sisters; and their names were</span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://example.com/elsie"</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">id</span>=<span class="string">"link1"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>Elsie<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"story"</span>&gt;</span>...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">"""</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html, 'lxml')</span><br><span class="line">print(soup.a.parent)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"story"</span>&gt;</span></span><br><span class="line">            Once upon a time there were three little sisters; and their names were</span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">href</span>=<span class="string">"http://example.com/elsie"</span> <span class="attr">id</span>=<span class="string">"link1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>Elsie<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们选择的是第一个<code>a</code>节点的父节点元素。很明显，它的父节点是<code>p</code>节点，输出结果便是<code>p</code>节点及其内部的内容。</p>
                  <p>需要注意的是，这里输出的仅仅是<code>a</code>节点的直接父节点，而没有再向外寻找父节点的祖先节点。如果想获取所有的祖先节点，可以调用<code>parents</code>属性：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = <span class="string">""</span><span class="comment">"</span></span><br><span class="line"><span class="symbol">&lt;html&gt;</span></span><br><span class="line">    <span class="symbol">&lt;body&gt;</span></span><br><span class="line">        &lt;<span class="keyword">p</span> class=<span class="string">"story"</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">a</span> href=<span class="string">"http://example.com/elsie"</span> class=<span class="string">"sister"</span> id=<span class="string">"link1"</span>&gt;</span><br><span class="line">                <span class="symbol">&lt;span&gt;</span>Elsie&lt;/span&gt;</span><br><span class="line">            &lt;/<span class="keyword">a</span>&gt;</span><br><span class="line">        &lt;/<span class="keyword">p</span>&gt;</span><br><span class="line"><span class="string">""</span><span class="comment">"</span></span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="built_in">type</span>(soup.<span class="keyword">a</span>.parents))</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">list</span>(enumerate(soup.<span class="keyword">a</span>.parents)))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">class</span> '<span class="attr">generator</span>'&gt;</span></span><br><span class="line">[(0, <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"story"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">href</span>=<span class="string">"http://example.com/elsie"</span> <span class="attr">id</span>=<span class="string">"link1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>Elsie<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span>), (1, <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"story"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">href</span>=<span class="string">"http://example.com/elsie"</span> <span class="attr">id</span>=<span class="string">"link1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>Elsie<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span>), (2, <span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"story"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">href</span>=<span class="string">"http://example.com/elsie"</span> <span class="attr">id</span>=<span class="string">"link1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>Elsie<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>), (3, <span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"story"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"sister"</span> <span class="attr">href</span>=<span class="string">"http://example.com/elsie"</span> <span class="attr">id</span>=<span class="string">"link1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>Elsie<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>)]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，返回结果是生成器类型。这里用列表输出了它的索引和内容，而列表中的元素就是<code>a</code>节点的祖先节点。</p>
                  <h4 id="3-兄弟节点"><a href="#3-兄弟节点" class="headerlink" title="(3)兄弟节点"></a>(3)兄弟节点</h4>
                  <p>上面说明了子节点和父节点的获取方式，如果要获取同级的节点（也就是兄弟节点），应该怎么办呢？示例如下：</p>
                  <figure class="highlight smalltalk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = <span class="comment">""</span><span class="comment">"</span></span><br><span class="line"><span class="comment">&lt;html&gt;</span></span><br><span class="line"><span class="comment">    &lt;body&gt;</span></span><br><span class="line"><span class="comment">        &lt;p class="</span>story<span class="comment">"&gt;</span></span><br><span class="line"><span class="comment">            Once upon a time there were three little sisters; and their names were</span></span><br><span class="line"><span class="comment">            &lt;a href="</span>http://example.com/elsie<span class="comment">" class="</span>sister<span class="comment">" id="</span>link1<span class="comment">"&gt;</span></span><br><span class="line"><span class="comment">                &lt;span&gt;Elsie&lt;/span&gt;</span></span><br><span class="line"><span class="comment">            &lt;/a&gt;</span></span><br><span class="line"><span class="comment">            Hello</span></span><br><span class="line"><span class="comment">            &lt;a href="</span>http://example.com/lacie<span class="comment">" class="</span>sister<span class="comment">" id="</span>link2<span class="comment">"&gt;Lacie&lt;/a&gt; </span></span><br><span class="line"><span class="comment">            and</span></span><br><span class="line"><span class="comment">            &lt;a href="</span>http://example.com/tillie<span class="comment">" class="</span>sister<span class="comment">" id="</span>link3<span class="comment">"&gt;Tillie&lt;/a&gt;</span></span><br><span class="line"><span class="comment">            and they lived at the bottom of a well.</span></span><br><span class="line"><span class="comment">        &lt;/p&gt;</span></span><br><span class="line"><span class="comment">"</span><span class="comment">""</span></span><br><span class="line">from bs4 import <span class="type">BeautifulSoup</span></span><br><span class="line">soup = <span class="type">BeautifulSoup</span>(html, <span class="string">'lxml'</span>)</span><br><span class="line">print(<span class="string">'Next Sibling'</span>, soup.a.next_sibling)</span><br><span class="line">print(<span class="string">'Prev Sibling'</span>, soup.a.previous_sibling)</span><br><span class="line">print(<span class="string">'Next Siblings'</span>, list(enumerate(soup.a.next_siblings)))</span><br><span class="line">print(<span class="string">'Prev Siblings'</span>, list(enumerate(soup.a.previous_siblings)))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Next Sibling </span><br><span class="line">            Hello</span><br><span class="line"></span><br><span class="line">Prev Sibling </span><br><span class="line">            Once upon a time there were three little sisters; <span class="keyword">and</span> their names were</span><br><span class="line"></span><br><span class="line">Next Siblings [(0, <span class="string">'\n            Hello\n            '</span>), (1, &lt;a <span class="attribute">class</span>=<span class="string">"sister"</span> <span class="attribute">href</span>=<span class="string">"http://example.com/lacie"</span> <span class="attribute">id</span>=<span class="string">"link2"</span>&gt;Lacie&lt;/a&gt;), (2, <span class="string">' \n            and\n            '</span>), (3, &lt;a <span class="attribute">class</span>=<span class="string">"sister"</span> <span class="attribute">href</span>=<span class="string">"http://example.com/tillie"</span> <span class="attribute">id</span>=<span class="string">"link3"</span>&gt;Tillie&lt;/a&gt;), (4, <span class="string">'\n            and they lived at the bottom of a well.\n        '</span>)]</span><br><span class="line">Prev Siblings [(0, <span class="string">'\n            Once upon a time there were three little sisters; and their names were\n            '</span>)]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这里调用了4个属性，其中<code>next_sibling</code>和<code>previous_sibling</code>分别获取节点的下一个和上一个兄弟元素，<code>next_siblings</code>和<code>previous_siblings</code>则分别返回所有前面和后面的兄弟节点的生成器。</p>
                  <h4 id="4-提取信息"><a href="#4-提取信息" class="headerlink" title="(4)提取信息"></a>(4)提取信息</h4>
                  <p>前面讲解了关联元素节点的选择方法，如果想要获取它们的一些信息，比如文本、属性等，也用同样的方法，示例如下：</p>
                  <figure class="highlight moonscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;p class="</span>story<span class="string">"&gt;</span></span><br><span class="line"><span class="string">            Once upon a time there were three little sisters; and their names were</span></span><br><span class="line"><span class="string">            &lt;a href="</span><span class="name">http</span>://example.com/elsie<span class="string">" class="</span>sister<span class="string">" id="</span>link1<span class="string">"&gt;Bob&lt;/a&gt;&lt;a href="</span><span class="name">http</span>://example.com/lacie<span class="string">" class="</span>sister<span class="string">" id="</span>link2<span class="string">"&gt;Lacie&lt;/a&gt; </span></span><br><span class="line"><span class="string">        &lt;/p&gt;</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Next Sibling:'</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(soup.a.next_sibling))</span><br><span class="line"><span class="built_in">print</span>(soup.a.next_sibling)</span><br><span class="line"><span class="built_in">print</span>(soup.a.next_sibling.<span class="built_in">string</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Parent:'</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(soup.a.parents))</span><br><span class="line"><span class="built_in">print</span>(list(soup.a.parents)[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(list(soup.a.parents)[<span class="number">0</span>].attrs[<span class="string">'class'</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight scala">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="type">Next</span> <span class="type">Sibling</span>:</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">bs4</span>.<span class="title">element</span>.<span class="title">Tag</span>'<span class="title">&gt;</span></span></span><br><span class="line"><span class="class"><span class="title">&lt;a</span> <span class="title">class=</span>"<span class="title">sister</span>" <span class="title">href=</span>"<span class="title">http</span></span>:<span class="comment">//example.com/lacie" id="link2"&gt;Lacie&lt;/a&gt;</span></span><br><span class="line"><span class="type">Lacie</span></span><br><span class="line"><span class="type">Parent</span>:</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">generator</span>'<span class="title">&gt;</span></span></span><br><span class="line"><span class="class"><span class="title">&lt;p</span> <span class="title">class=</span>"<span class="title">story</span>"<span class="title">&gt;</span></span></span><br><span class="line"><span class="class">            <span class="title">Once</span> <span class="title">upon</span> <span class="title">a</span> <span class="title">time</span> <span class="title">there</span> <span class="title">were</span> <span class="title">three</span> <span class="title">little</span> <span class="title">sisters</span></span>; and their names were</span><br><span class="line">            &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"sister"</span> href=<span class="string">"http://example.com/elsie"</span> id=<span class="string">"link1"</span>&gt;<span class="type">Bob</span>&lt;/a&gt;&lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"sister"</span> href=<span class="string">"http://example.com/lacie"</span> id=<span class="string">"link2"</span>&gt;<span class="type">Lacie</span>&lt;/a&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">[<span class="symbol">'stor</span>y']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果返回结果是单个节点，那么可以直接调用<code>string</code>、<code>attrs</code>等属性获得其文本和属性；如果返回结果是多个节点的生成器，则可以转为列表后取出某个元素，然后再调用<code>string</code>、<code>attrs</code>等属性获取其对应节点的文本和属性。</p>
                  <h2 id="6-方法选择器"><a href="#6-方法选择器" class="headerlink" title="6. 方法选择器"></a>6. 方法选择器</h2>
                  <p>前面所讲的选择方法都是通过属性来选择的，这种方法非常快，但是如果进行比较复杂的选择的话，它就比较烦琐，不够灵活了。幸好，Beautiful Soup还为我们提供了一些查询方法，比如<code>find_all()</code>和<code>find()</code>等，调用它们，然后传入相应的参数，就可以灵活查询了。</p>
                  <h5 id="find-all"><a href="#find-all" class="headerlink" title="find_all()"></a><code>find_all()</code></h5>
                  <p><code>find_all</code>，顾名思义，就是查询所有符合条件的元素。给它传入一些属性或文本，就可以得到符合条件的元素，它的功能十分强大。</p>
                  <p>它的API如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">find<span class="constructor">_all(<span class="params">name</span> , <span class="params">attrs</span> , <span class="params">recursive</span> , <span class="params">text</span> , <span class="operator">**</span><span class="params">kwargs</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="1-name"><a href="#1-name" class="headerlink" title="(1)name"></a>(1)<code>name</code></h3>
                  <p>我们可以根据节点名来查询元素，示例如下：</p>
                  <figure class="highlight scala">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html='''</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-heading"</span>&gt;</span><br><span class="line">        &lt;h4&gt;<span class="type">Hello</span>&lt;/h4&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"list"</span> id=<span class="string">"list-1"</span>&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"element"</span>&gt;<span class="type">Foo</span>&lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"element"</span>&gt;<span class="type">Bar</span>&lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"element"</span>&gt;<span class="type">Jay</span>&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"list list-small"</span> id=<span class="string">"list-2"</span>&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"element"</span>&gt;<span class="type">Foo</span>&lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"element"</span>&gt;<span class="type">Bar</span>&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">'''</span><br><span class="line">from bs4 <span class="keyword">import</span> <span class="type">BeautifulSoup</span></span><br><span class="line">soup = <span class="type">BeautifulSoup</span>(html, <span class="symbol">'lxm</span>l')</span><br><span class="line">print(soup.find_all(name=<span class="symbol">'u</span>l'))</span><br><span class="line">print(<span class="class"><span class="keyword">type</span>(<span class="params">soup.find_all(name='ul'</span>)[0]))</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[&lt;ul <span class="keyword">class</span>=<span class="string">"list"</span> id=<span class="string">"list-1"</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Foo&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Bar&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Jay&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;/ul&gt;, &lt;ul <span class="keyword">class</span>=<span class="string">"list list-small"</span> id=<span class="string">"list-2"</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Foo&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Bar&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;/ul&gt;]</span><br><span class="line">&lt;<span class="keyword">class</span> 'bs4.element.Tag'&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们调用了<code>find_all()</code>方法，传入<code>name</code>参数，其参数值为<code>ul</code>。也就是说，我们想要查询所有<code>ul</code>节点，返回结果是列表类型，长度为2，每个元素依然都是<code>bs4.element.Tag</code>类型。</p>
                  <p>因为都是<code>Tag</code>类型，所以依然可以进行嵌套查询。还是同样的文本，这里查询出所有<code>ul</code>节点后，再继续查询其内部的<code>li</code>节点：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> soup.find_all(<span class="attribute">name</span>=<span class="string">'ul'</span>):</span><br><span class="line">    <span class="builtin-name">print</span>(ul.find_all(<span class="attribute">name</span>=<span class="string">'li'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[&lt;li <span class="keyword">class</span>="<span class="symbol">element</span>"&gt;<span class="symbol">Foo</span>&lt;/<span class="symbol">li</span>&gt;, &lt;<span class="symbol">li</span> <span class="symbol">class</span>="<span class="symbol">element</span>"&gt;<span class="symbol">Bar</span>&lt;/<span class="symbol">li</span>&gt;, &lt;<span class="symbol">li</span> <span class="symbol">class</span>="<span class="symbol">element</span>"&gt;<span class="symbol">Jay</span>&lt;/<span class="symbol">li</span>&gt;]</span><br><span class="line">[&lt;<span class="symbol">li</span> <span class="symbol">class</span>="<span class="symbol">element</span>"&gt;<span class="symbol">Foo</span>&lt;/<span class="symbol">li</span>&gt;, &lt;<span class="symbol">li</span> <span class="symbol">class</span>="<span class="symbol">element</span>"&gt;<span class="symbol">Bar</span>&lt;/<span class="symbol">li</span>&gt;]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>返回结果是列表类型，列表中的每个元素依然还是<code>Tag</code>类型。</p>
                  <p>接下来，就可以遍历每个<code>li</code>，获取它的文本了：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> soup.find_all(<span class="attribute">name</span>=<span class="string">'ul'</span>):</span><br><span class="line">    <span class="builtin-name">print</span>(ul.find_all(<span class="attribute">name</span>=<span class="string">'li'</span>))</span><br><span class="line">    <span class="keyword">for</span> li <span class="keyword">in</span> ul.find_all(<span class="attribute">name</span>=<span class="string">'li'</span>):</span><br><span class="line">        <span class="builtin-name">print</span>(li.string)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[&lt;li <span class="keyword">class</span>="<span class="symbol">element</span>"&gt;<span class="symbol">Foo</span>&lt;/<span class="symbol">li</span>&gt;, &lt;<span class="symbol">li</span> <span class="symbol">class</span>="<span class="symbol">element</span>"&gt;<span class="symbol">Bar</span>&lt;/<span class="symbol">li</span>&gt;, &lt;<span class="symbol">li</span> <span class="symbol">class</span>="<span class="symbol">element</span>"&gt;<span class="symbol">Jay</span>&lt;/<span class="symbol">li</span>&gt;]</span><br><span class="line"><span class="symbol">Foo</span></span><br><span class="line"><span class="symbol">Bar</span></span><br><span class="line"><span class="symbol">Jay</span></span><br><span class="line">[&lt;<span class="symbol">li</span> <span class="symbol">class</span>="<span class="symbol">element</span>"&gt;<span class="symbol">Foo</span>&lt;/<span class="symbol">li</span>&gt;, &lt;<span class="symbol">li</span> <span class="symbol">class</span>="<span class="symbol">element</span>"&gt;<span class="symbol">Bar</span>&lt;/<span class="symbol">li</span>&gt;]</span><br><span class="line"><span class="symbol">Foo</span></span><br><span class="line"><span class="symbol">Bar</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="2-attrs"><a href="#2-attrs" class="headerlink" title="(2)attrs"></a>(2)<code>attrs</code></h3>
                  <p>除了根据节点名查询，我们也可以传入一些属性来查询，示例如下：</p>
                  <figure class="highlight scala">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html='''</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-heading"</span>&gt;</span><br><span class="line">        &lt;h4&gt;<span class="type">Hello</span>&lt;/h4&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"list"</span> id=<span class="string">"list-1"</span> name=<span class="string">"elements"</span>&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"element"</span>&gt;<span class="type">Foo</span>&lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"element"</span>&gt;<span class="type">Bar</span>&lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"element"</span>&gt;<span class="type">Jay</span>&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"list list-small"</span> id=<span class="string">"list-2"</span>&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"element"</span>&gt;<span class="type">Foo</span>&lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"element"</span>&gt;<span class="type">Bar</span>&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">'''</span><br><span class="line">from bs4 <span class="keyword">import</span> <span class="type">BeautifulSoup</span></span><br><span class="line">soup = <span class="type">BeautifulSoup</span>(html, <span class="symbol">'lxm</span>l')</span><br><span class="line">print(soup.find_all(attrs=&#123;<span class="symbol">'i</span>d': <span class="symbol">'list</span><span class="number">-1</span>'&#125;))</span><br><span class="line">print(soup.find_all(attrs=&#123;<span class="symbol">'nam</span>e': <span class="symbol">'element</span>s'&#125;))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[&lt;ul <span class="keyword">class</span>=<span class="string">"list"</span> id=<span class="string">"list-1"</span> name=<span class="string">"elements"</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Foo&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Bar&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Jay&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;/ul&gt;]</span><br><span class="line">[&lt;ul <span class="keyword">class</span>=<span class="string">"list"</span> id=<span class="string">"list-1"</span> name=<span class="string">"elements"</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Foo&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Bar&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Jay&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;/ul&gt;]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里查询的时候传入的是<code>attrs</code>参数，参数的类型是字典类型。比如，要查询<code>id</code>为<code>list-1</code>的节点，可以传入<code>attrs={&#39;id&#39;: &#39;list-1&#39;}</code>的查询条件，得到的结果是列表形式，包含的内容就是符合<code>id</code>为<code>list-1</code>的所有节点。在上面的例子中，符合条件的元素个数是1，所以结果是长度为1的列表。</p>
                  <p>对于一些常用的属性，比如<code>id</code>和<code>class</code>等，我们可以不用<code>attrs</code>来传递。比如，要查询<code>id</code>为<code>list-1</code>的节点，可以直接传入<code>id</code>这个参数。还是上面的文本，我们换一种方式来查询：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(<span class="name">html</span>, 'lxml')</span><br><span class="line">print(<span class="name">soup</span>.find_all(<span class="name">id=</span>'list-1'))</span><br><span class="line">print(<span class="name">soup</span>.find_all(<span class="name">class_=</span>'element'))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[&lt;ul <span class="keyword">class</span>=<span class="string">"list"</span> id=<span class="string">"list-1"</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Foo&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Bar&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Jay&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;/ul&gt;]</span><br><span class="line">[&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Foo&lt;/<span class="keyword">li</span>&gt;, &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Bar&lt;/<span class="keyword">li</span>&gt;, &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Jay&lt;/<span class="keyword">li</span>&gt;, &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Foo&lt;/<span class="keyword">li</span>&gt;, &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Bar&lt;/<span class="keyword">li</span>&gt;]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里直接传入<code>id=&#39;list-1&#39;</code>，就可以查询<code>id</code>为<code>list-1</code>的节点元素了。而对于<code>class</code>来说，由于<code>class</code>在Python里是一个关键字，所以后面需要加一个下划线，即<code>class_=&#39;element&#39;</code>，返回的结果依然还是<code>Tag</code>组成的列表。</p>
                  <h3 id="3-text"><a href="#3-text" class="headerlink" title="(3)text"></a>(3)<code>text</code></h3>
                  <p><code>text</code>参数可用来匹配节点的文本，传入的形式可以是字符串，可以是正则表达式对象，示例如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">html=<span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="panel"&gt;</span></span><br><span class="line"><span class="string">    &lt;div class="panel-body"&gt;</span></span><br><span class="line"><span class="string">        &lt;a&gt;Hello, this is a link&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;a&gt;Hello, this is a link, too&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">print(soup.find_all(text=re.compile(<span class="string">'link'</span>)))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">['Hello, this is a link', 'Hello, this is a link, too']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里有两个<code>a</code>节点，其内部包含文本信息。这里在<code>find_all()</code>方法中传入<code>text</code>参数，该参数为正则表达式对象，结果返回所有匹配正则表达式的节点文本组成的列表。</p>
                  <h4 id="find"><a href="#find" class="headerlink" title="find()"></a><code>find()</code></h4>
                  <p>除了<code>find_all()</code>方法，还有<code>find()</code>方法，只不过后者返回的是单个元素，也就是第一个匹配的元素，而前者返回的是所有匹配的元素组成的列表。示例如下：</p>
                  <figure class="highlight scala">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html='''</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-heading"</span>&gt;</span><br><span class="line">        &lt;h4&gt;<span class="type">Hello</span>&lt;/h4&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"list"</span> id=<span class="string">"list-1"</span>&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"element"</span>&gt;<span class="type">Foo</span>&lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"element"</span>&gt;<span class="type">Bar</span>&lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"element"</span>&gt;<span class="type">Jay</span>&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"list list-small"</span> id=<span class="string">"list-2"</span>&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"element"</span>&gt;<span class="type">Foo</span>&lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"element"</span>&gt;<span class="type">Bar</span>&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">'''</span><br><span class="line">from bs4 <span class="keyword">import</span> <span class="type">BeautifulSoup</span></span><br><span class="line">soup = <span class="type">BeautifulSoup</span>(html, <span class="symbol">'lxm</span>l')</span><br><span class="line">print(soup.find(name=<span class="symbol">'u</span>l'))</span><br><span class="line">print(<span class="class"><span class="keyword">type</span>(<span class="params">soup.find(name='ul'</span>)))</span></span><br><span class="line"><span class="class"><span class="title">print</span>(<span class="params">soup.find(class_='list'</span>))</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;ul <span class="keyword">class</span>=<span class="string">"list"</span> id=<span class="string">"list-1"</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Foo&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Bar&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Jay&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;<span class="keyword">class</span> 'bs4.element.Tag'&gt;</span><br><span class="line">&lt;ul <span class="keyword">class</span>=<span class="string">"list"</span> id=<span class="string">"list-1"</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Foo&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Bar&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Jay&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的返回结果不再是列表形式，而是第一个匹配的节点元素，类型依然是<code>Tag</code>类型。</p>
                  <p>另外，还有许多查询方法，其用法与前面介绍的<code>find_all()</code>、<code>find()</code>方法完全相同，只不过查询范围不同，这里简单说明一下。</p>
                  <ul>
                    <li><strong><code>find_parents()</code>和<code>find_parent()</code></strong>：前者返回所有祖先节点，后者返回直接父节点。</li>
                    <li><strong><code>find_next_siblings()</code>和<code>find_next_sibling()</code></strong>：前者返回后面所有的兄弟节点，后者返回后面第一个兄弟节点。</li>
                    <li><strong><code>find_previous_siblings()</code>和<code>find_previous_sibling()</code></strong>：前者返回前面所有的兄弟节点，后者返回前面第一个兄弟节点。</li>
                    <li><strong><code>find_all_next()</code>和<code>find_next()</code></strong>：前者返回节点后所有符合条件的节点，后者返回第一个符合条件的节点。</li>
                    <li><strong><code>find_all_previous()</code>和<code>find_previous()</code></strong>：前者返回节点后所有符合条件的节点，后者返回第一个符合条件的节点。</li>
                  </ul>
                  <h2 id="7-CSS选择器"><a href="#7-CSS选择器" class="headerlink" title="7. CSS选择器"></a>7. CSS选择器</h2>
                  <p>Beautiful Soup还提供了另外一种选择器，那就是CSS选择器。如果对Web开发熟悉的话，那么对CSS选择器肯定也不陌生。如果不熟悉的话，可以参考<span class="exturl" data-url="aHR0cDovL3d3dy53M3NjaG9vbC5jb20uY24vY3NzcmVmL2Nzc19zZWxlY3RvcnMuYXNw">http://www.w3school.com.cn/cssref/css_selectors.asp<i class="fa fa-external-link-alt"></i></span>了解。</p>
                  <p>使用CSS选择器时，只需要调用<code>select()</code>方法，传入相应的CSS选择器即可，示例如下：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html='''</span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">"panel"</span>&gt;</span><br><span class="line">    &lt;div <span class="keyword">class</span>=<span class="string">"panel-heading"</span>&gt;</span><br><span class="line">        &lt;h4&gt;Hello&lt;/h4&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="keyword">class</span>=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">        &lt;ul <span class="keyword">class</span>=<span class="string">"list"</span> id=<span class="string">"list-1"</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Foo&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Bar&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Jay&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">        &lt;ul <span class="keyword">class</span>=<span class="string">"list list-small"</span> id=<span class="string">"list-2"</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Foo&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"element"</span>&gt;Bar&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">'''</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html, 'lxml')</span><br><span class="line"><span class="keyword">print</span>(soup.select('.panel .panel-heading'))</span><br><span class="line"><span class="keyword">print</span>(soup.select('ul <span class="keyword">li</span>'))</span><br><span class="line"><span class="keyword">print</span>(soup.select('#<span class="keyword">list</span>-2 .element'))</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">type</span>(soup.select('ul')[0]))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight fsharp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">[&lt;div class="panel-heading"&gt;</span></span><br><span class="line"><span class="meta">&lt;h4&gt;Hello&lt;/h4&gt;</span></span><br><span class="line"><span class="meta">&lt;/div&gt;]</span></span><br><span class="line"><span class="meta">[&lt;li class="element"&gt;Foo&lt;/li&gt;, &lt;li class="element"&gt;Bar&lt;/li&gt;, &lt;li class="element"&gt;Jay&lt;/li&gt;, &lt;li class="element"&gt;Foo&lt;/li&gt;, &lt;li class="element"&gt;Bar&lt;/li&gt;]</span></span><br><span class="line"><span class="meta">[&lt;li class="element"&gt;Foo&lt;/li&gt;, &lt;li class="element"&gt;Bar&lt;/li&gt;]</span></span><br><span class="line">&lt;<span class="keyword">class</span> 'bs4.element.Tag'&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们用了3次CSS选择器，返回的结果均是符合CSS选择器的节点组成的列表。例如，<code>select(&#39;ul li&#39;)</code>则是选择所有<code>ul</code>节点下面的所有<code>li</code>节点，结果便是所有的<code>li</code>节点组成的列表。</p>
                  <p>最后一句打印输出了列表中元素的类型。可以看到，类型依然是<code>Tag</code>类型。</p>
                  <h3 id="嵌套选择-1"><a href="#嵌套选择-1" class="headerlink" title="嵌套选择"></a>嵌套选择</h3>
                  <p><code>select()</code>方法同样支持嵌套选择。例如，先选择所有<code>ul</code>节点，再遍历每个<code>ul</code>节点，选择其<code>li</code>节点，样例如下：</p>
                  <figure class="highlight moonscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> soup.<span class="built_in">select</span>(<span class="string">'ul'</span>):</span><br><span class="line">    <span class="built_in">print</span>(ul.<span class="built_in">select</span>(<span class="string">'li'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[&lt;li <span class="keyword">class</span>="<span class="symbol">element</span>"&gt;<span class="symbol">Foo</span>&lt;/<span class="symbol">li</span>&gt;, &lt;<span class="symbol">li</span> <span class="symbol">class</span>="<span class="symbol">element</span>"&gt;<span class="symbol">Bar</span>&lt;/<span class="symbol">li</span>&gt;, &lt;<span class="symbol">li</span> <span class="symbol">class</span>="<span class="symbol">element</span>"&gt;<span class="symbol">Jay</span>&lt;/<span class="symbol">li</span>&gt;]</span><br><span class="line">[&lt;<span class="symbol">li</span> <span class="symbol">class</span>="<span class="symbol">element</span>"&gt;<span class="symbol">Foo</span>&lt;/<span class="symbol">li</span>&gt;, &lt;<span class="symbol">li</span> <span class="symbol">class</span>="<span class="symbol">element</span>"&gt;<span class="symbol">Bar</span>&lt;/<span class="symbol">li</span>&gt;]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这里正常输出了所有<code>ul</code>节点下所有<code>li</code>节点组成的列表。</p>
                  <h3 id="获取属性"><a href="#获取属性" class="headerlink" title="获取属性"></a>获取属性</h3>
                  <p>我们知道节点类型是<code>Tag</code>类型，所以获取属性还可以用原来的方法。仍然是上面的HTML文本，这里尝试获取每个<code>ul</code>节点的<code>id</code>属性：</p>
                  <figure class="highlight moonscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> soup.<span class="built_in">select</span>(<span class="string">'ul'</span>):</span><br><span class="line">    <span class="built_in">print</span>(ul[<span class="string">'id'</span>])</span><br><span class="line">    <span class="built_in">print</span>(ul.attrs[<span class="string">'id'</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight dsconfig">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">list-1</span></span><br><span class="line"><span class="built_in">list-1</span></span><br><span class="line"><span class="built_in">list-2</span></span><br><span class="line"><span class="built_in">list-2</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，直接传入中括号和属性名，以及通过<code>attrs</code>属性获取属性值，都可以成功。</p>
                  <h3 id="获取文本"><a href="#获取文本" class="headerlink" title="获取文本"></a>获取文本</h3>
                  <p>要获取文本，当然也可以用前面所讲的<code>string</code>属性。此外，还有一个方法，那就是<code>get_text()</code>，示例如下：</p>
                  <figure class="highlight moonscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line"><span class="keyword">for</span> li <span class="keyword">in</span> soup.<span class="built_in">select</span>(<span class="string">'li'</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'Get Text:'</span>, li.get_text())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'String:'</span>, li.<span class="built_in">string</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight mathematica">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Get</span> <span class="keyword">Text</span>: Foo</span><br><span class="line"><span class="keyword">String</span>: Foo</span><br><span class="line"><span class="keyword">Get</span> <span class="keyword">Text</span>: Bar</span><br><span class="line"><span class="keyword">String</span>: Bar</span><br><span class="line"><span class="keyword">Get</span> <span class="keyword">Text</span>: Jay</span><br><span class="line"><span class="keyword">String</span>: Jay</span><br><span class="line"><span class="keyword">Get</span> <span class="keyword">Text</span>: Foo</span><br><span class="line"><span class="keyword">String</span>: Foo</span><br><span class="line"><span class="keyword">Get</span> <span class="keyword">Text</span>: Bar</span><br><span class="line"><span class="keyword">String</span>: Bar</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，二者的效果完全一致。</p>
                  <p>到此，Beautiful Soup的用法基本就介绍完了，最后做一下简单的总结。</p>
                  <ul>
                    <li>推荐使用lxml解析库，必要时使用html.parser。</li>
                    <li>节点选择筛选功能弱但是速度快。</li>
                    <li>建议使用<code>find()</code>或者<code>find_all()</code>查询匹配单个结果或者多个结果。</li>
                    <li>如果对CSS选择器熟悉的话，可以使用<code>select()</code>方法选择。</li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-28 16:19:52" itemprop="dateCreated datePublished" datetime="2018-01-28T16:19:52+08:00">2018-01-28</time>
                </span>
                <span id="/5548.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 4.2-使用Beautiful Soup" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>22k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>20 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5545.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5545.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 4.1-使用XPath</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>XPath，全称XML Path Language，即XML路径语言，它是一门在XML文档中查找信息的语言。它最初是用来搜寻XML文档的，但是它同样适用于HTML文档的搜索。</p>
                  <p>所以在做爬虫时，我们完全可以使用XPath来做相应的信息抽取。本节中，我们就来介绍XPath的基本用法。</p>
                  <h2 id="1-XPath概览"><a href="#1-XPath概览" class="headerlink" title="1. XPath概览"></a>1. XPath概览</h2>
                  <p>XPath的选择功能十分强大，它提供了非常简洁明了的路径选择表达式。另外，它还提供了超过100个内建函数，用于字符串、数值、时间的匹配以及节点、序列的处理等。几乎所有我们想要定位的节点，都可以用XPath来选择。</p>
                  <p>XPath于1999年11月16日成为W3C标准，它被设计为供XSLT、XPointer以及其他XML解析软件使用，更多的文档可以访问其官方网站：<span class="exturl" data-url="aHR0cHM6Ly93d3cudzMub3JnL1RSL3hwYXRoLw==">https://www.w3.org/TR/xpath/<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="2-XPath常用规则"><a href="#2-XPath常用规则" class="headerlink" title="2. XPath常用规则"></a>2. XPath常用规则</h2>
                  <p>表4-1列举了XPath的几个常用规则。</p>
                  <p>表4-1 XPath常用规则</p>
                  <p>表达式</p>
                  <p>描述</p>
                  <p><code>nodename</code></p>
                  <p>选取此节点的所有子节点</p>
                  <p><code>/</code></p>
                  <p>从当前节点选取直接子节点</p>
                  <p><code>//</code></p>
                  <p>从当前节点选取子孙节点</p>
                  <p><code>.</code></p>
                  <p>选取当前节点</p>
                  <p><code>..</code></p>
                  <p>选取当前节点的父节点</p>
                  <p><code>@</code></p>
                  <p>选取属性</p>
                  <p>这里列出了XPath的常用匹配规则，示例如下：</p>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">//title[<span class="symbol">@lang</span>=<span class="string">'eng'</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这就是一个XPath规则，它代表选择所有名称为<code>title</code>，同时属性<code>lang</code>的值为<code>eng</code>的节点。</p>
                  <p>后面会通过Python的lxml库，利用XPath进行HTML的解析。</p>
                  <h2 id="3-准备工作"><a href="#3-准备工作" class="headerlink" title="3. 准备工作"></a>3. 准备工作</h2>
                  <p>使用之前，首先要确保安装好lxml库，若没有安装，可以参考第1章的安装过程。</p>
                  <h2 id="4-实例引入"><a href="#4-实例引入" class="headerlink" title="4. 实例引入"></a>4. 实例引入</h2>
                  <p>现在通过实例来感受一下使用XPath来对网页进行解析的过程，相关代码如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line">text = '''</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link1.html"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-inactive"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">'''</span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = etree.tostring(html)</span><br><span class="line">print(result.decode('utf-8'))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先导入lxml库的etree模块，然后声明了一段HTML文本，调用HTML类进行初始化，这样就成功构造了一个XPath解析对象。这里需要注意的是，HTML文本中的最后一个<code>li</code>节点是没有闭合的，但是etree模块可以自动修正HTML文本。</p>
                  <p>这里我们调用<code>tostring()</code>方法即可输出修正后的HTML代码，但是结果是<code>bytes</code>类型。这里利用<code>decode()</code>方法将其转成<code>str</code>类型，结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link1.html"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-inactive"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，经过处理之后，<code>li</code>节点标签被补全，并且还自动添加了<code>body</code>、<code>html</code>节点。</p>
                  <p>另外，也可以直接读取文本文件进行解析，示例如下：</p>
                  <figure class="highlight moonscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.parse(<span class="string">'./test.html'</span>, etree.HTMLParser())</span><br><span class="line">result = etree.<span class="built_in">tostring</span>(html)</span><br><span class="line"><span class="built_in">print</span>(result.decode(<span class="string">'utf-8'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中test.html的内容就是上面例子中的HTML代码，内容如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link1.html"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-inactive"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这次的输出结果略有不同，多了一个<code>DOCTYPE</code>的声明，不过对解析无任何影响，结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//W3C//DTD HTML 4.0 Transitional//EN"</span> <span class="meta-string">"http://www.w3.org/TR/REC-html40/loose.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link1.html"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-inactive"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="5-所有节点"><a href="#5-所有节点" class="headerlink" title="5. 所有节点"></a>5. 所有节点</h2>
                  <p>我们一般会用//开头的XPath规则来选取所有符合要求的节点。这里以前面的HTML文本为例，如果要选取所有节点，可以这样实现：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line"><span class="selector-tag">html</span> = etree.parse(<span class="string">'./test.html'</span>, etree.HTMLParser())</span><br><span class="line">result = <span class="selector-tag">html</span>.xpath(<span class="string">'//*'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight x86asm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[&lt;Element html <span class="meta">at</span> <span class="number">0x10510d9c8</span>&gt;, &lt;Element body <span class="meta">at</span> <span class="number">0x10510da08</span>&gt;, &lt;Element <span class="keyword">div</span> <span class="meta">at</span> <span class="number">0x10510da48</span>&gt;, &lt;Element ul <span class="meta">at</span> <span class="number">0x10510da88</span>&gt;, &lt;Element li <span class="meta">at</span> <span class="number">0x10510dac8</span>&gt;, &lt;Element a <span class="meta">at</span> <span class="number">0x10510db48</span>&gt;, &lt;Element li <span class="meta">at</span> <span class="number">0x10510db88</span>&gt;, &lt;Element a <span class="meta">at</span> <span class="number">0x10510dbc8</span>&gt;, &lt;Element li <span class="meta">at</span> <span class="number">0x10510dc08</span>&gt;, &lt;Element a <span class="meta">at</span> <span class="number">0x10510db08</span>&gt;, &lt;Element li <span class="meta">at</span> <span class="number">0x10510dc48</span>&gt;, &lt;Element a <span class="meta">at</span> <span class="number">0x10510dc88</span>&gt;, &lt;Element li <span class="meta">at</span> <span class="number">0x10510dcc8</span>&gt;, &lt;Element a <span class="meta">at</span> <span class="number">0x10510dd08</span>&gt;]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里使用*代表匹配所有节点，也就是整个HTML文本中的所有节点都会被获取。可以看到，返回形式是一个列表，每个元素是<code>Element</code>类型，其后跟了节点的名称，如<code>html</code>、<code>body</code>、<code>div</code>、<code>ul</code>、<code>li</code>、<code>a</code>等，所有节点都包含在列表中了。</p>
                  <p>当然，此处匹配也可以指定节点名称。如果想获取所有<code>li</code>节点，示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line"><span class="selector-tag">html</span> = etree.parse(<span class="string">'./test.html'</span>, etree.HTMLParser())</span><br><span class="line">result = <span class="selector-tag">html</span>.xpath(<span class="string">'//li'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result[<span class="number">0</span>])</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里要选取所有<code>li</code>节点，可以使用<code>//</code>，然后直接加上节点名称即可，调用时直接使用<code>xpath()</code>方法即可。</p>
                  <p>运行结果：</p>
                  <figure class="highlight maxima">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[&lt;Element <span class="built_in">li</span> <span class="built_in">at</span> <span class="number">0x105849208</span>&gt;, &lt;Element <span class="built_in">li</span> <span class="built_in">at</span> <span class="number">0x105849248</span>&gt;, &lt;Element <span class="built_in">li</span> <span class="built_in">at</span> <span class="number">0x105849288</span>&gt;, &lt;Element <span class="built_in">li</span> <span class="built_in">at</span> <span class="number">0x1058492c8</span>&gt;, &lt;Element <span class="built_in">li</span> <span class="built_in">at</span> <span class="number">0x105849308</span>&gt;]</span><br><span class="line">&lt;Element <span class="built_in">li</span> <span class="built_in">at</span> <span class="number">0x105849208</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里可以看到提取结果是一个列表形式，其中每个元素都是一个 <code>Element</code>对象。如果要取出其中一个对象，可以直接用中括号加索引，如<code>[0]</code>。</p>
                  <h2 id="6-子节点"><a href="#6-子节点" class="headerlink" title="6. 子节点"></a>6. 子节点</h2>
                  <p>我们通过<code>/</code>或<code>//</code>即可查找元素的子节点或子孙节点。假如现在想选择<code>li</code>节点的所有直接<code>a</code>子节点，可以这样实现：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span> = etree.parse(<span class="string">'./test.html'</span>, etree.HTMLParser())</span><br><span class="line">result = <span class="selector-tag">html</span>.xpath(<span class="string">'//li/a'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里通过追加<code>/a</code>即选择了所有<code>li</code>节点的所有直接<code>a</code>子节点。因为<code>//li</code>用于选中所有<code>li</code>节点，<code>/a</code>用于选中<code>li</code>节点的所有直接子节点<code>a</code>，二者组合在一起即获取所有<code>li</code>节点的所有直接<code>a</code>子节点。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight fsharp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">[&lt;Element a at 0x106ee8688&gt;, &lt;Element a at 0x106ee86c8&gt;, &lt;Element a at 0x106ee8708&gt;, &lt;Element a at 0x106ee8748&gt;, &lt;Element a at 0x106ee8788&gt;]</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此处的<code>/</code>用于选取直接子节点，如果要获取所有子孙节点，就可以使用<code>//</code>。例如，要获取<code>ul</code>节点下的所有子孙<code>a</code>节点，可以这样实现：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span> = etree.parse(<span class="string">'./test.html'</span>, etree.HTMLParser())</span><br><span class="line">result = <span class="selector-tag">html</span>.xpath(<span class="string">'//ul//a'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果是相同的。</p>
                  <p>但是如果这里用<code>//ul/a</code>，就无法获取任何结果了。因为<code>/</code>用于获取直接子节点，而在<code>ul</code>节点下没有直接的<code>a</code>子节点，只有<code>li</code>节点，所以无法获取任何匹配结果，代码如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span> = etree.parse(<span class="string">'./test.html'</span>, etree.HTMLParser())</span><br><span class="line">result = <span class="selector-tag">html</span>.xpath(<span class="string">'//ul/a'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>因此，这里我们要注意<code>/</code>和<code>//</code>的区别，其中<code>/</code>用于获取直接子节点，<code>//</code>用于获取子孙节点。</p>
                  <h2 id="7-父节点"><a href="#7-父节点" class="headerlink" title="7. 父节点"></a>7. 父节点</h2>
                  <p>我们知道通过连续的<code>/</code>或<code>//</code>可以查找子节点或子孙节点，那么假如我们知道了子节点，怎样来查找父节点呢？这可以用<code>..</code>来实现。</p>
                  <p>比如，现在首先选中<code>href</code>属性为<code>link4.html</code>的<code>a</code>节点，然后再获取其父节点，然后再获取其<code>class</code>属性，相关代码如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span> = etree.parse(<span class="string">'./test.html'</span>, etree.HTMLParser())</span><br><span class="line">result = <span class="selector-tag">html</span>.xpath(<span class="string">'//a[@href="link4.html"]/../@class'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'item-1</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>检查一下结果发现，这正是我们获取的目标<code>li</code>节点的<code>class</code>。</p>
                  <p>同时，我们也可以通过<code>parent::</code>来获取父节点，代码如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span> = etree.parse(<span class="string">'./test.html'</span>, etree.HTMLParser())</span><br><span class="line">result = <span class="selector-tag">html</span>.xpath(<span class="string">'//a[@href="link4.html"]/parent::*/@class'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="8-属性匹配"><a href="#8-属性匹配" class="headerlink" title="8. 属性匹配"></a>8. 属性匹配</h2>
                  <p>在选取的时候，我们还可以用<code>@</code>符号进行属性过滤。比如，这里如果要选取<code>class</code>为<code>item-1</code>的<code>li</code>节点，可以这样实现:</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line"><span class="selector-tag">html</span> = etree.parse(<span class="string">'./test.html'</span>, etree.HTMLParser())</span><br><span class="line">result = <span class="selector-tag">html</span>.xpath(<span class="string">'//li[@class="item-0"]'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们通过加入<code>[@class=&quot;item-0&quot;]</code>，限制了节点的<code>class</code>属性为<code>item-0</code>，而HTML文本中符合条件的<code>li</code>节点有两个，所以结果应该返回两个匹配到的元素。结果如下：</p>
                  <figure class="highlight fsharp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">[&lt;Element li at 0x10a399288&gt;, &lt;Element li at 0x10a3992c8&gt;]</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可见，匹配结果正是两个，至于是不是那正确的两个，后面再验证。</p>
                  <h2 id="9-文本获取"><a href="#9-文本获取" class="headerlink" title="9. 文本获取"></a>9. 文本获取</h2>
                  <p>我们用XPath中的<code>text()</code>方法获取节点中的文本，接下来尝试获取前面<code>li</code>节点中的文本，相关代码如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span> = etree.parse(<span class="string">'./test.html'</span>, etree.HTMLParser())</span><br><span class="line">result = <span class="selector-tag">html</span>.xpath(<span class="string">'//li[@class="item-0"]/text()'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">['\n     ']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>奇怪的是，我们并没有获取到任何文本，只获取到了一个换行符，这是为什么呢？因为XPath中<code>text()</code>前面是<code>/</code>，而此处<code>/</code>的含义是选取直接子节点，很明显<code>li</code>的直接子节点都是<code>a</code>节点，文本都是在<code>a</code>节点内部的，所以这里匹配到的结果就是被修正的<code>li</code>节点内部的换行符，因为自动修正的<code>li</code>节点的尾标签换行了。</p>
                  <p>即选中的是这两个节点：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link1.html"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中一个节点因为自动修正，<code>li</code>节点的尾标签添加的时候换行了，所以提取文本得到的唯一结果就是<code>li</code>节点的尾标签和<code>a</code>节点的尾标签之间的换行符。</p>
                  <p>因此，如果想获取<code>li</code>节点内部的文本，就有两种方式，一种是先选取<code>a</code>节点再获取文本，另一种就是使用<code>//</code>。接下来，我们来看下二者的区别。</p>
                  <p>首先，选取到<code>a</code>节点再获取文本，代码如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span> = etree.parse(<span class="string">'./test.html'</span>, etree.HTMLParser())</span><br><span class="line">result = <span class="selector-tag">html</span>.xpath(<span class="string">'//li[@class="item-0"]/a/text()'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'first</span> item', <span class="symbol">'fifth</span> item']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这里的返回值是两个，内容都是属性为<code>item-0</code>的<code>li</code>节点的文本，这也印证了前面属性匹配的结果是正确的。</p>
                  <p>这里我们是逐层选取的，先选取了<code>li</code>节点，又利用<code>/</code>选取了其直接子节点<code>a</code>，然后再选取其文本，得到的结果恰好是符合我们预期的两个结果。</p>
                  <p>再来看下用另一种方式（即使用<code>//</code>）选取的结果，代码如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span> = etree.parse(<span class="string">'./test.html'</span>, etree.HTMLParser())</span><br><span class="line">result = <span class="selector-tag">html</span>.xpath(<span class="string">'//li[@class="item-0"]//text()'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'first</span> item', <span class="symbol">'fifth</span> item', '\n     ']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>不出所料，这里的返回结果是3个。可想而知，这里是选取所有子孙节点的文本，其中前两个就是<code>li</code>的子节点<code>a</code>节点内部的文本，另外一个就是最后一个<code>li</code>节点内部的文本，即换行符。</p>
                  <p>所以说，如果要想获取子孙节点内部的所有文本，可以直接用<code>//</code>加<code>text()</code>的方式，这样可以保证获取到最全面的文本信息，但是可能会夹杂一些换行符等特殊字符。如果想获取某些特定子孙节点下的所有文本，可以先选取到特定的子孙节点，然后再调用<code>text()</code>方法获取其内部文本，这样可以保证获取的结果是整洁的。</p>
                  <h2 id="10-属性获取"><a href="#10-属性获取" class="headerlink" title="10. 属性获取"></a>10. 属性获取</h2>
                  <p>我们知道用<code>text()</code>可以获取节点内部文本，那么节点属性该怎样获取呢？其实还是用<code>@</code>符号就可以。例如，我们想获取所有<code>li</code>节点下所有<code>a</code>节点的<code>href</code>属性，代码如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span> = etree.parse(<span class="string">'./test.html'</span>, etree.HTMLParser())</span><br><span class="line">result = <span class="selector-tag">html</span>.xpath(<span class="string">'//li/a/@href'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们通过<code>@href</code>即可获取节点的<code>href</code>属性。注意，此处和属性匹配的方法不同，属性匹配是中括号加属性名和值来限定某个属性，如<code>[@href=&quot;link1.html&quot;]</code>，而此处的<code>@href</code>指的是获取节点的某个属性，二者需要做好区分。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'link1.html</span>', <span class="symbol">'link2.html</span>', <span class="symbol">'link3.html</span>', <span class="symbol">'link4.html</span>', <span class="symbol">'link5.html</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，我们成功获取了所有<code>li</code>节点下<code>a</code>节点的<code>href</code>属性，它们以列表形式返回。</p>
                  <h2 id="11-属性多值匹配"><a href="#11-属性多值匹配" class="headerlink" title="11. 属性多值匹配"></a>11. 属性多值匹配</h2>
                  <p>有时候，某些节点的某个属性可能有多个值，例如：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">text = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;li class="li li-first"&gt;&lt;a href="link.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">'//li[@class="li"]/a/text()'</span>)</span><br><span class="line">print(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里HTML文本中<code>li</code>节点的<code>class</code>属性有两个值<code>li</code>和<code>li-first</code>，此时如果还想用之前的属性匹配获取，就无法匹配了，此时的运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时就需要用<code>contains()</code>函数了，代码可以改写如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">text = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;li class="li li-first"&gt;&lt;a href="link.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">'//li[contains(@class, "li")]/a/text()'</span>)</span><br><span class="line">print(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样通过<code>contains()</code>方法，第一个参数传入属性名称，第二个参数传入属性值，只要此属性包含所传入的属性值，就可以完成匹配了。</p>
                  <p>此时运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'first</span> item']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此种方式在某个节点的某个属性有多个值时经常用到，如某个节点的<code>class</code>属性通常有多个。</p>
                  <h2 id="12-多属性匹配"><a href="#12-多属性匹配" class="headerlink" title="12. 多属性匹配"></a>12. 多属性匹配</h2>
                  <p>另外，我们可能还遇到一种情况，那就是根据多个属性确定一个节点，这时就需要同时匹配多个属性。此时可以使用运算符<code>and</code>来连接，示例如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">text = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;li class="li li-first" name="item"&gt;&lt;a href="link.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">'//li[contains(@class, "li") and @name="item"]/a/text()'</span>)</span><br><span class="line">print(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的<code>li</code>节点又增加了一个属性<code>name</code>。要确定这个节点，需要同时根据<code>class</code>和<code>name</code>属性来选择，一个条件是<code>class</code>属性里面包含<code>li</code>字符串，另一个条件是<code>name</code>属性为<code>item</code>字符串，二者需要同时满足，需要用<code>and</code>操作符相连，相连之后置于中括号内进行条件筛选。运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'first</span> item']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的<code>and</code>其实是XPath中的运算符。另外，还有很多运算符，如<code>or</code>、<code>mod</code>等，在此总结为表4-2。</p>
                  <p>表4-2 运算符及其介绍</p>
                  <p>运算符</p>
                  <p>描述</p>
                  <p>实例</p>
                  <p>返回值</p>
                  <p><code>or</code></p>
                  <p>或</p>
                  <p><code>age=19 or age=20</code></p>
                  <p>如果<code>age</code>是19，则返回<code>true</code>。如果<code>age</code>是21，则返回<code>false</code></p>
                  <p><code>and</code></p>
                  <p>与</p>
                  <p><code>age&gt;19 and age&lt;21</code></p>
                  <p>如果<code>age</code>是20，则返回<code>true</code>。如果<code>age</code>是<code>18</code>，则返回<code>false</code></p>
                  <p><code>mod</code></p>
                  <p>计算除法的余数</p>
                  <p><code>5 mod 2</code></p>
                  <p>1</p>
                  <p><code>|</code></p>
                  <p>计算两个节点集</p>
                  <p><code>//book | //cd</code></p>
                  <p>返回所有拥有<code>book</code>和<code>cd</code>元素的节点集</p>
                  <p><code>+</code></p>
                  <p>加法</p>
                  <p><code>6 + 4</code></p>
                  <p>10</p>
                  <p><code>\-</code></p>
                  <p>减法</p>
                  <p><code>6 - 4</code></p>
                  <p>2</p>
                  <p><code>*</code></p>
                  <p>乘法</p>
                  <p><code>6 * 4</code></p>
                  <p>24</p>
                  <p><code>div</code></p>
                  <p>除法</p>
                  <p><code>8 div 4</code></p>
                  <p>2</p>
                  <p><code>\=</code></p>
                  <p>等于</p>
                  <p><code>age=19</code></p>
                  <p>如果<code>age</code>是19，则返回<code>true</code>。如果<code>age</code>是20，则返回<code>false</code></p>
                  <p><code>!=</code></p>
                  <p>不等于</p>
                  <p><code>age!=19</code></p>
                  <p>如果<code>age</code>是18，则返回<code>true</code>。如果<code>age</code>是19，则返回<code>false</code></p>
                  <p><code>&lt;</code></p>
                  <p>小于</p>
                  <p><code>age&lt;19</code></p>
                  <p>如果<code>age</code>是18，则返回<code>true</code>。如果<code>age</code>是19，则返回<code>false</code></p>
                  <p><code>&lt;=</code></p>
                  <p>小于或等于</p>
                  <p><code>age&lt;=19</code></p>
                  <p>如果<code>age</code>是19，则返回<code>true</code>。如果<code>age</code>是20，则返回<code>false</code></p>
                  <p><code>\&gt;</code></p>
                  <p>大于</p>
                  <p><code>age&gt;19</code></p>
                  <p>如果<code>age</code>是20，则返回<code>true</code>。如果<code>age</code>是19，则返回<code>false</code></p>
                  <p><code>\&gt;=</code></p>
                  <p>大于或等于</p>
                  <p><code>age&gt;=19</code></p>
                  <p>如果<code>age</code>是19，则返回<code>true</code>。如果<code>age</code>是18，则返回<code>false</code></p>
                  <p>此表参考来源：<span class="exturl" data-url="aHR0cDovL3d3dy53M3NjaG9vbC5jb20uY24veHBhdGgveHBhdGhfb3BlcmF0b3JzLmFzcA==">http://www.w3school.com.cn/xpath/xpath_operators.asp<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="13-按序选择"><a href="#13-按序选择" class="headerlink" title="13. 按序选择"></a>13. 按序选择</h2>
                  <p>有时候，我们在选择的时候某些属性可能同时匹配了多个节点，但是只想要其中的某个节点，如第二个节点或者最后一个节点，这时该怎么办呢？</p>
                  <p>这时可以利用中括号传入索引的方法获取特定次序的节点，示例如下：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line"></span><br><span class="line">text = '''</span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">         &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-0"</span>&gt;&lt;a href=<span class="string">"link1.html"</span>&gt;first item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-1"</span>&gt;&lt;a href=<span class="string">"link2.html"</span>&gt;second item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-inactive"</span>&gt;&lt;a href=<span class="string">"link3.html"</span>&gt;third item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-1"</span>&gt;&lt;a href=<span class="string">"link4.html"</span>&gt;fourth item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-0"</span>&gt;&lt;a href=<span class="string">"link5.html"</span>&gt;fifth item&lt;/a&gt;</span><br><span class="line">     &lt;/ul&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">'''</span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath('<span class="comment">//li[1]/a/text()')</span></span><br><span class="line"><span class="keyword">print</span>(result)</span><br><span class="line">result = html.xpath('<span class="comment">//li[last()]/a/text()')</span></span><br><span class="line"><span class="keyword">print</span>(result)</span><br><span class="line">result = html.xpath('<span class="comment">//li[position()&lt;3]/a/text()')</span></span><br><span class="line"><span class="keyword">print</span>(result)</span><br><span class="line">result = html.xpath('<span class="comment">//li[last()-2]/a/text()')</span></span><br><span class="line"><span class="keyword">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>第一次选择时，我们选取了第一个<code>li</code>节点，中括号中传入数字1即可。注意，这里和代码中不同，序号是以1开头的，不是以0开头。</p>
                  <p>第二次选择时，我们选取了最后一个<code>li</code>节点，中括号中传入<code>last()</code>即可，返回的便是最后一个<code>li</code>节点。</p>
                  <p>第三次选择时，我们选取了位置小于3的<code>li</code>节点，也就是位置序号为1和2的节点，得到的结果就是前两个<code>li</code>节点。</p>
                  <p>第四次选择时，我们选取了倒数第三个<code>li</code>节点，中括号中传入<code>last()-2</code>即可。因为<code>last()</code>是最后一个，所以<code>last()-2</code>就是倒数第三个。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'first</span> item']</span><br><span class="line">[<span class="symbol">'fifth</span> item']</span><br><span class="line">[<span class="symbol">'first</span> item', <span class="symbol">'second</span> item']</span><br><span class="line">[<span class="symbol">'third</span> item']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们使用了<code>last()</code>、<code>position()</code>等函数。在XPath中，提供了100多个函数，包括存取、数值、字符串、逻辑、节点、序列等处理功能，它们的具体作用可以参考：<span class="exturl" data-url="aHR0cDovL3d3dy53M3NjaG9vbC5jb20uY24veHBhdGgveHBhdGhfZnVuY3Rpb25zLmFzcA==">http://www.w3school.com.cn/xpath/xpath_functions.asp<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="14-节点轴选择"><a href="#14-节点轴选择" class="headerlink" title="14. 节点轴选择"></a>14. 节点轴选择</h2>
                  <p>XPath提供了很多节点轴选择方法，包括获取子元素、兄弟元素、父元素、祖先元素等，示例如下：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line"></span><br><span class="line">text = '''</span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">         &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-0"</span>&gt;&lt;a href=<span class="string">"link1.html"</span>&gt;&lt;span&gt;first item&lt;/span&gt;&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-1"</span>&gt;&lt;a href=<span class="string">"link2.html"</span>&gt;second item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-inactive"</span>&gt;&lt;a href=<span class="string">"link3.html"</span>&gt;third item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-1"</span>&gt;&lt;a href=<span class="string">"link4.html"</span>&gt;fourth item&lt;/a&gt;&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">li</span> <span class="keyword">class</span>=<span class="string">"item-0"</span>&gt;&lt;a href=<span class="string">"link5.html"</span>&gt;fifth item&lt;/a&gt;</span><br><span class="line">     &lt;/ul&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">'''</span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath('<span class="comment">//li[1]/ancestor::*')</span></span><br><span class="line"><span class="keyword">print</span>(result)</span><br><span class="line">result = html.xpath('<span class="comment">//li[1]/ancestor::div')</span></span><br><span class="line"><span class="keyword">print</span>(result)</span><br><span class="line">result = html.xpath('<span class="comment">//li[1]/attribute::*')</span></span><br><span class="line"><span class="keyword">print</span>(result)</span><br><span class="line">result = html.xpath('<span class="comment">//li[1]/child::a[@href="link1.html"]')</span></span><br><span class="line"><span class="keyword">print</span>(result)</span><br><span class="line">result = html.xpath('<span class="comment">//li[1]/descendant::span')</span></span><br><span class="line"><span class="keyword">print</span>(result)</span><br><span class="line">result = html.xpath('<span class="comment">//li[1]/following::*[2]')</span></span><br><span class="line"><span class="keyword">print</span>(result)</span><br><span class="line">result = html.xpath('<span class="comment">//li[1]/following-sibling::*') `print(result)`</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight fsharp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">[&lt;Element html at 0x107941808&gt;, &lt;Element body at 0x1079418c8&gt;, &lt;Element div at 0x107941908&gt;, &lt;Element ul at 0x107941948&gt;]</span></span><br><span class="line"><span class="meta">[&lt;Element div at 0x107941908&gt;]</span></span><br><span class="line">['item<span class="number">-0</span>']</span><br><span class="line"><span class="meta">[&lt;Element a at 0x1079418c8&gt;]</span></span><br><span class="line"><span class="meta">[&lt;Element span at 0x107941948&gt;]</span></span><br><span class="line"><span class="meta">[&lt;Element a at 0x1079418c8&gt;]</span></span><br><span class="line"><span class="meta">[&lt;Element li at 0x107941948&gt;, &lt;Element li at 0x107941988&gt;, &lt;Element li at 0x1079419c8&gt;, &lt;Element li at 0x107941a08&gt;]</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>第一次选择时，我们调用了<code>ancestor</code>轴，可以获取所有祖先节点。其后需要跟两个冒号，然后是节点的选择器，这里我们直接使用*，表示匹配所有节点，因此返回结果是第一个<code>li</code>节点的所有祖先节点，包括<code>html</code>、<code>body</code>、<code>div</code>和<code>ul</code>。</p>
                  <p>第二次选择时，我们又加了限定条件，这次在冒号后面加了<code>div</code>，这样得到的结果就只有<code>div</code>这个祖先节点了。</p>
                  <p>第三次选择时，我们调用了<code>attribute</code>轴，可以获取所有属性值，其后跟的选择器还是*，这代表获取节点的所有属性，返回值就是<code>li</code>节点的所有属性值。</p>
                  <p>第四次选择时，我们调用了<code>child</code>轴，可以获取所有直接子节点。这里我们又加了限定条件，选取<code>href</code>属性为<code>link1.html</code>的<code>a</code>节点。</p>
                  <p>第五次选择时，我们调用了<code>descendant</code>轴，可以获取所有子孙节点。这里我们又加了限定条件获取<code>span</code>节点，所以返回的结果只包含<code>span</code>节点而不包含<code>a</code>节点。</p>
                  <p>第六次选择时，我们调用了<code>following</code>轴，可以获取当前节点之后的所有节点。这里我们虽然使用的是*匹配，但又加了索引选择，所以只获取了第二个后续节点。</p>
                  <p>第七次选择时，我们调用了<code>following-sibling</code>轴，可以获取当前节点之后的所有同级节点。这里我们使用*匹配，所以获取了所有后续同级节点。</p>
                  <p>以上是XPath轴的简单用法，更多轴的用法可以参考：<span class="exturl" data-url="aHR0cDovL3d3dy53M3NjaG9vbC5jb20uY24veHBhdGgveHBhdGhfYXhlcy5hc3A=">http://www.w3school.com.cn/xpath/xpath_axes.asp<i class="fa fa-external-link-alt"></i></span>。</p>
                  <h2 id="15-结语"><a href="#15-结语" class="headerlink" title="15. 结语"></a>15. 结语</h2>
                  <p>到现在为止，我们基本上把可能用到的XPath选择器介绍完了。XPath功能非常强大，内置函数非常多，熟练使用之后，可以大大提升HTML信息的提取效率。</p>
                  <p>如果想查询更多XPath的用法，可以查看：<span class="exturl" data-url="aHR0cDovL3d3dy53M3NjaG9vbC5jb20uY24veHBhdGgvaW5kZXguYXNw">http://www.w3school.com.cn/xpath/index.asp<i class="fa fa-external-link-alt"></i></span>。</p>
                  <p>如果想查询更多Python lxml库的用法，可以查看<span class="exturl" data-url="aHR0cDovL2x4bWwuZGUv">http://lxml.de/<i class="fa fa-external-link-alt"></i></span>。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-28 16:03:48" itemprop="dateCreated datePublished" datetime="2018-01-28T16:03:48+08:00">2018-01-28</time>
                </span>
                <span id="/5545.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 4.1-使用XPath" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>13k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>12 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5542.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5542.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 4-解析库的使用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>上一章中，我们实现了一个最基本的爬虫，但提取页面信息时使用的是正则表达式，这还是比较烦琐，而且万一有地方写错了，可能导致匹配失败，所以使用正则表达式提取页面信息多多少少还是有些不方便。</p>
                  <p>对于网页的节点来说，它可以定义<code>id</code>、<code>class</code>或其他属性。而且节点之间还有层次关系，在网页中可以通过XPath或CSS选择器来定位一个或多个节点。那么，在页面解析时，利用XPath或CSS选择器来提取某个节点，然后再调用相应方法获取它的正文内容或者属性，不就可以提取我们想要的任意信息了吗？</p>
                  <p>在Python中，怎样实现这个操作呢？不用担心，这种解析库已经非常多，其中比较强大的库有lxml、Beautiful Soup、pyquery等，本章就来介绍这3个解析库的用法。有了它们，我们就不用再为正则表达式发愁，而且解析效率也会大大提高。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-28 15:58:40" itemprop="dateCreated datePublished" datetime="2018-01-28T15:58:40+08:00">2018-01-28</time>
                </span>
                <span id="/5542.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 4-解析库的使用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>358</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5534.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5534.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 3.4-抓取猫眼电影排行</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本节中，我们利用requests库和正则表达式来抓取猫眼电影TOP100的相关内容。requests比urllib使用更加方便，而且目前我们还没有系统学习HTML解析库，所以这里就选用正则表达式来作为解析工具。</p>
                  <h2 id="1-本节目标"><a href="#1-本节目标" class="headerlink" title="1. 本节目标"></a>1. 本节目标</h2>
                  <p>本节中，我们要提取出猫眼电影TOP100的电影名称、时间、评分、图片等信息，提取的站点URL为<span class="exturl" data-url="aHR0cDovL21hb3lhbi5jb20vYm9hcmQvNA==">http://maoyan.com/board/4<i class="fa fa-external-link-alt"></i></span>，提取的结果会以文件形式保存下来。</p>
                  <h2 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2. 准备工作"></a>2. 准备工作</h2>
                  <p>在本节开始之前，请确保已经正确安装好了requests库。如果没有安装，可以参考第1章的安装说明。</p>
                  <h2 id="3-抓取分析"><a href="#3-抓取分析" class="headerlink" title="3. 抓取分析"></a>3. 抓取分析</h2>
                  <p>我们需要抓取的目标站点为<span class="exturl" data-url="aHR0cDovL21hb3lhbi5jb20vYm9hcmQvNA==">http://maoyan.com/board/4<i class="fa fa-external-link-alt"></i></span>，打开之后便可以查看到榜单信息，如图3-11所示。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/3-11.jpg" alt="">图3-11 榜单信息</p>
                  <p>排名第一的电影是霸王别姬，页面中显示的有效信息有影片名称、主演、上映时间、上映地区、评分、图片等信息。</p>
                  <p>将网页滚动到最下方，可以发现有分页的列表，直接点击第2页，观察页面的URL和内容发生了怎样的变化，如图3-12所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/3-12.jpg" alt="">图3-12 页面URL变化</p>
                  <p>可以发现页面的URL变成<span class="exturl" data-url="aHR0cDovL21hb3lhbi5jb20vYm9hcmQvND9vZmZzZXQ9MTA=">http://maoyan.com/board/4?offset=10<i class="fa fa-external-link-alt"></i></span>，比之前的URL多了一个参数，那就是<code>offset=10</code>，而目前显示的结果是排行11~20名的电影，初步推断这是一个偏移量的参数。再点击下一页，发现页面的URL变成了<span class="exturl" data-url="aHR0cDovL21hb3lhbi5jb20vYm9hcmQvND9vZmZzZXQ9MjA=">http://maoyan.com/board/4?offset=20<i class="fa fa-external-link-alt"></i></span>，参数<code>offset</code>变成了20，而显示的结果是排行21~30的电影。</p>
                  <p>由此可以总结出规律，<code>offset</code>代表偏移量值，如果偏移量为<code>n</code>，则显示的电影序号就是<code>n+1</code>到<code>n+10</code>，每页显示10个。所以，如果想获取TOP100电影，只需要分开请求10次，而10次的<code>offset</code>参数分别设置为0、10、20、…90即可，这样获取不同的页面之后，再用正则表达式提取出相关信息，就可以得到TOP100的所有电影信息了。</p>
                  <h2 id="4-抓取首页"><a href="#4-抓取首页" class="headerlink" title="4. 抓取首页"></a>4. 抓取首页</h2>
                  <p>接下来用代码实现这个过程。首先抓取第一页的内容。我们实现了<code>get_one_page()</code>方法，并给它传入<code>url</code>参数。然后将抓取的页面结果返回，再通过<code>main()</code>方法调用。初步代码实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span><span class="params">(url)</span>:</span></span><br><span class="line">    response = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">return</span> response.text</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    url = <span class="string">'http://maoyan.com/board/4'</span></span><br><span class="line">    html = get_one_page(url)</span><br><span class="line">    print(html)</span><br><span class="line"></span><br><span class="line">main()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样运行之后，就可以成功获取首页的源代码了。获取源代码后，就需要解析页面，提取出我们想要的信息。</p>
                  <h2 id="5-正则提取"><a href="#5-正则提取" class="headerlink" title="5. 正则提取"></a>5. 正则提取</h2>
                  <p>接下来，回到网页看一下页面的真实源码。在开发者模式下的Network监听组件中查看源代码，如图3-13所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/3-13.jpg" alt="">图3-13 源代码</p>
                  <p>注意，这里不要在Elements选项卡中直接查看源码，因为那里的源码可能经过JavaScript操作而与原始请求不同，而是需要从Network选项卡部分查看原始请求得到的源码。</p>
                  <p>查看其中一个条目的源代码，如图3-14所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/3-14.jpg" alt="">图3-14 源代码</p>
                  <p>可以看到，一部电影信息对应的源代码是一个<code>dd</code>节点，我们用正则表达式来提取这里面的一些电影信息。首先，需要提取它的排名信息。而它的排名信息是在<code>class</code>为<code>board-index</code>的<code>i</code>节点内，这里利用非贪婪匹配来提取<code>i</code>节点内的信息，正则表达式写为：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">dd</span>&gt;</span>.*?board-index.*?&gt;(.*?)<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>随后需要提取电影的图片。可以看到，后面有<code>a</code>节点，其内部有两个<code>img</code>节点。经过检查后发现，第二个<code>img</code>节点的<code>data-src</code>属性是图片的链接。这里提取第二个<code>img</code>节点的<code>data-src</code>属性，正则表达式可以改写如下：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="params">&lt;dd&gt;</span>.*?board-index.*?&gt;(.*?)<span class="params">&lt;/i&gt;</span>.*?data-src=<span class="string">"(.*?)"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>再往后，需要提取电影的名称，它在后面的<code>p</code>节点内，<code>class</code>为<code>name</code>。所以，可以用<code>name</code>做一个标志位，然后进一步提取到其内<code>a</code>节点的正文内容，此时正则表达式改写如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;dd&gt;.*?board-index.*<span class="meta">?&gt;</span>(.*?)&lt;/i&gt;.*?data-src=<span class="string">"(.*?)"</span>.*?name.*?<span class="keyword">a</span>.*<span class="meta">?&gt;</span>(.*?)&lt;/<span class="keyword">a</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>再提取主演、发布时间、评分等内容时，都是同样的原理。最后，正则表达式写为：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;dd&gt;.<span class="strong">*?board-index.*</span>?&gt;(.<span class="strong">*?)&lt;/i&gt;.*</span>?data-src="(.<span class="strong">*?)".*</span>?name.<span class="strong">*?a.*</span>?&gt;(.<span class="strong">*?)&lt;/a&gt;.*</span>?star.<span class="strong">*?&gt;(.*</span>?)&lt;/p&gt;.<span class="strong">*?releasetime.*</span>?&gt;(.<span class="strong">*?)&lt;/p&gt;.*</span>?integer.<span class="strong">*?&gt;(.*</span>?)&lt;/i&gt;.<span class="strong">*?fraction.*</span>?&gt;(.<span class="strong">*?)&lt;/i&gt;.*</span>?&lt;/dd&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样一个正则表达式可以匹配一个电影的结果，里面匹配了7个信息。接下来，通过调用<code>findall()</code>方法提取出所有的内容。</p>
                  <p>接下来，我们再定义解析页面的方法<code>parse_one_page()</code>，主要是通过正则表达式来从结果中提取出我们想要的内容，实现代码如下：</p>
                  <figure class="highlight vbnet">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def parse_one_page(html):</span><br><span class="line">    pattern = re.compile(</span><br><span class="line">        <span class="comment">'<span class="doctag">&lt;dd&gt;</span>.*?board-index.*?&gt;(.*?)<span class="doctag">&lt;/i&gt;</span>.*?data-src="(.*?)".*?name.*?a.*?&gt;(.*?)<span class="doctag">&lt;/a&gt;</span>.*?star.*?&gt;(.*?)<span class="doctag">&lt;/p&gt;</span>.*?releasetime.*?&gt;(.*?)<span class="doctag">&lt;/p&gt;</span>.*?integer.*?&gt;(.*?)<span class="doctag">&lt;/i&gt;</span>.*?fraction.*?&gt;(.*?)<span class="doctag">&lt;/i&gt;</span>.*?<span class="doctag">&lt;/dd&gt;</span>',</span></span><br><span class="line">        re.S)</span><br><span class="line">    items = re.findall(pattern, html)</span><br><span class="line">    print(items)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就可以成功地将一页的10个电影信息都提取出来，这是一个列表形式，输出结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[(<span class="symbol">'1</span>', <span class="symbol">'http://p1.meituan.net/movie/20803f59291c47e1e116c11963ce019e68711.jpg@160w_220h_1e_1c</span>', <span class="symbol">'霸王别姬</span>', '\n                主演：张国荣,张丰毅,巩俐\n        ', <span class="symbol">'上映时间：1993-01-01</span>(<span class="name">中国香港</span>)', <span class="symbol">'9.</span>', <span class="symbol">'6</span>'), (<span class="symbol">'2</span>', <span class="symbol">'http://p0.meituan.net/movie/__40191813__4767047.jpg@160w_220h_1e_1c</span>', <span class="symbol">'肖申克的救赎</span>', '\n                主演：蒂姆·罗宾斯,摩根·弗里曼,鲍勃·冈顿\n        ', <span class="symbol">'上映时间：1994-10-14</span>(<span class="name">美国</span>)', <span class="symbol">'9.</span>', <span class="symbol">'5</span>'), (<span class="symbol">'3</span>', <span class="symbol">'http://p0.meituan.net/movie/fc9d78dd2ce84d20e53b6d1ae2eea4fb1515304.jpg@160w_220h_1e_1c</span>', <span class="symbol">'这个杀手不太冷</span>', '\n                主演：让·雷诺,加里·奥德曼,娜塔莉·波特曼\n        ', <span class="symbol">'上映时间：1994-09-14</span>(<span class="name">法国</span>)', <span class="symbol">'9.</span>', <span class="symbol">'5</span>'), (<span class="symbol">'4</span>', <span class="symbol">'http://p0.meituan.net/movie/23/6009725.jpg@160w_220h_1e_1c</span>', <span class="symbol">'罗马假日</span>', '\n                主演：格利高利·派克,奥黛丽·赫本,埃迪·艾伯特\n        ', <span class="symbol">'上映时间：1953-09-02</span>(<span class="name">美国</span>)', <span class="symbol">'9.</span>', <span class="symbol">'1</span>'), (<span class="symbol">'5</span>', <span class="symbol">'http://p0.meituan.net/movie/53/1541925.jpg@160w_220h_1e_1c</span>', <span class="symbol">'阿甘正传</span>', '\n                主演：汤姆·汉克斯,罗宾·怀特,加里·西尼斯\n        ', <span class="symbol">'上映时间：1994-07-06</span>(<span class="name">美国</span>)', <span class="symbol">'9.</span>', <span class="symbol">'4</span>'), (<span class="symbol">'6</span>', <span class="symbol">'http://p0.meituan.net/movie/11/324629.jpg@160w_220h_1e_1c</span>', <span class="symbol">'泰坦尼克号</span>', '\n                主演：莱昂纳多·迪卡普里奥,凯特·温丝莱特,比利·赞恩\n        ', <span class="symbol">'上映时间：1998-04-03</span>', <span class="symbol">'9.</span>', <span class="symbol">'5</span>'), (<span class="symbol">'7</span>', <span class="symbol">'http://p0.meituan.net/movie/99/678407.jpg@160w_220h_1e_1c</span>', <span class="symbol">'龙猫</span>', '\n                主演：日高法子,坂本千夏,糸井重里\n        ', <span class="symbol">'上映时间：1988-04-16</span>(<span class="name">日本</span>)', <span class="symbol">'9.</span>', <span class="symbol">'2</span>'), (<span class="symbol">'8</span>', <span class="symbol">'http://p0.meituan.net/movie/92/8212889.jpg@160w_220h_1e_1c</span>', <span class="symbol">'教父</span>', '\n                主演：马龙·白兰度,阿尔·帕西诺,詹姆斯·凯恩\n        ', <span class="symbol">'上映时间：1972-03-24</span>(<span class="name">美国</span>)', <span class="symbol">'9.</span>', <span class="symbol">'3</span>'), (<span class="symbol">'9</span>', <span class="symbol">'http://p0.meituan.net/movie/62/109878.jpg@160w_220h_1e_1c</span>', <span class="symbol">'唐伯虎点秋香</span>', '\n                主演：周星驰,巩俐,郑佩佩\n        ', <span class="symbol">'上映时间：1993-07-01</span>(<span class="name">中国香港</span>)', <span class="symbol">'9.</span>', <span class="symbol">'2</span>'), (<span class="symbol">'10</span>', <span class="symbol">'http://p0.meituan.net/movie/9bf7d7b81001a9cf8adbac5a7cf7d766132425.jpg@160w_220h_1e_1c</span>', <span class="symbol">'千与千寻</span>', '\n                主演：柊瑠美,入野自由,夏木真理\n        ', <span class="symbol">'上映时间：2001-07-20</span>(<span class="name">日本</span>)', <span class="symbol">'9.</span>', <span class="symbol">'3</span>')]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但这样还不够，数据比较杂乱，我们再将匹配结果处理一下，遍历提取结果并生成字典，此时方法改写如下：</p>
                  <figure class="highlight xquery">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def parse_one_page(html):</span><br><span class="line">    pattern = re.compile(</span><br><span class="line">        <span class="string">'&lt;dd&gt;.*?board-index.*?&gt;(.*?)&lt;/i&gt;.*?data-src="(.*?)".*?name.*?a.*?&gt;(.*?)&lt;/a&gt;.*?star.*?&gt;(.*?)&lt;/p&gt;.*?releasetime.*?&gt;(.*?)&lt;/p&gt;.*?integer.*?&gt;(.*?)&lt;/i&gt;.*?fraction.*?&gt;(.*?)&lt;/i&gt;.*?&lt;/dd&gt;'</span>,</span><br><span class="line">        re.S)</span><br><span class="line">    items = re.findall(pattern, html)</span><br><span class="line">    <span class="keyword">for</span> <span class="type">item</span> <span class="keyword">in</span> items:</span><br><span class="line">        yield &#123;</span><br><span class="line">            <span class="string">'index'</span>: <span class="type">item</span>[<span class="number">0</span>],</span><br><span class="line">            <span class="string">'image'</span>: <span class="type">item</span>[<span class="number">1</span>],</span><br><span class="line">            <span class="string">'title'</span>: <span class="type">item</span>[<span class="number">2</span>].<span class="keyword">strip</span>(),</span><br><span class="line">            <span class="string">'actor'</span>: <span class="type">item</span>[<span class="number">3</span>].<span class="keyword">strip</span>()[<span class="number">3</span>:] <span class="keyword">if</span> len(<span class="type">item</span>[<span class="number">3</span>]) &gt; <span class="number">3</span> <span class="keyword">else</span> <span class="string">''</span>,</span><br><span class="line">            <span class="string">'time'</span>: <span class="type">item</span>[<span class="number">4</span>].<span class="keyword">strip</span>()[<span class="number">5</span>:] <span class="keyword">if</span> len(<span class="type">item</span>[<span class="number">4</span>]) &gt; <span class="number">5</span> <span class="keyword">else</span> <span class="string">''</span>,</span><br><span class="line">            <span class="string">'score'</span>: <span class="type">item</span>[<span class="number">5</span>].<span class="keyword">strip</span>() + <span class="type">item</span>[<span class="number">6</span>].<span class="keyword">strip</span>()</span><br><span class="line">        &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就可以成功提取出电影的排名、图片、标题、演员、时间、评分等内容了，并把它赋值为一个个的字典，形成结构化数据。运行结果如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;'image': 'http://p1.meituan.net/movie/<span class="number">2080</span>3f<span class="number">5929</span>1c47e1e116c<span class="number">1196</span>3ce019e<span class="number">6871</span>1.jpg@160w_220h_1e_1c', 'actor': '张国荣,张丰毅,巩俐', 'score': '9.6', 'index': '1', 'title': '霸王别姬', 'time': '<span class="number">1993-01-01</span>(中国香港)'&#125;</span><br><span class="line">&#123;'image': 'http://p0.meituan.net/movie/__<span class="number">40191813</span>__<span class="number">476704</span>7.jpg@160w_220h_1e_1c', 'actor': '蒂姆·罗宾斯,摩根·弗里曼,鲍勃·冈顿', 'score': '9.5', 'index': '2', 'title': '肖申克的救赎', 'time': '<span class="number">1994-10-14</span>(美国)'&#125;</span><br><span class="line">&#123;'image': 'http://p0.meituan.net/movie/fc9d78dd2ce84d20e53b6d1ae2eea4fb<span class="number">151530</span>4.jpg@160w_220h_1e_1c', 'actor': '让·雷诺,加里·奥德曼,娜塔莉·波特曼', 'score': '9.5', 'index': '3', 'title': '这个杀手不太冷', 'time': '<span class="number">1994-09-14</span>(法国)'&#125;</span><br><span class="line">&#123;'image': 'http://p0.meituan.net/movie/23/<span class="number">600972</span>5.jpg@160w_220h_1e_1c', 'actor': '格利高利·派克,奥黛丽·赫本,埃迪·艾伯特', 'score': '9.1', 'index': '4', 'title': '罗马假日', 'time': '<span class="number">1953-09-02</span>(美国)'&#125;</span><br><span class="line">&#123;'image': 'http://p0.meituan.net/movie/53/<span class="number">154192</span>5.jpg@160w_220h_1e_1c', 'actor': '汤姆·汉克斯,罗宾·怀特,加里·西尼斯', 'score': '9.4', 'index': '5', 'title': '阿甘正传', 'time': '<span class="number">1994-07-06</span>(美国)'&#125;</span><br><span class="line">&#123;'image': 'http://p0.meituan.net/movie/11/<span class="number">324629</span>.jpg@160w_220h_1e_1c', 'actor': '莱昂纳多·迪卡普里奥,凯特·温丝莱特,比利·赞恩', 'score': '9.5', 'index': '6', 'title': '泰坦尼克号', 'time': '<span class="number">1998-04-03</span>'&#125;</span><br><span class="line">&#123;'image': 'http://p0.meituan.net/movie/99/<span class="number">678407</span>.jpg@160w_220h_1e_1c', 'actor': '日高法子,坂本千夏,糸井重里', 'score': '9.2', 'index': '7', 'title': '龙猫', 'time': '<span class="number">1988-04-16</span>(日本)'&#125;</span><br><span class="line">&#123;'image': 'http://p0.meituan.net/movie/92/<span class="number">821288</span>9.jpg@160w_220h_1e_1c', 'actor': '马龙·白兰度,阿尔·帕西诺,詹姆斯·凯恩', 'score': '9.3', 'index': '8', 'title': '教父', 'time': '<span class="number">1972-03-24</span>(美国)'&#125;</span><br><span class="line">&#123;'image': 'http://p0.meituan.net/movie/62/<span class="number">109878</span>.jpg@160w_220h_1e_1c', 'actor': '周星驰,巩俐,郑佩佩', 'score': '9.2', 'index': '9', 'title': '唐伯虎点秋香', 'time': '<span class="number">1993-07-01</span>(中国香港)'&#125;</span><br><span class="line">&#123;'image': 'http://p0.meituan.net/movie/9bf7d7b<span class="number">8100</span>1a9cf8adbac5a7cf7d<span class="number">76613242</span>5.jpg@160w_220h_1e_1c', 'actor': '柊瑠美,入野自由,夏木真理', 'score': '9.3', 'index': '10', 'title': '千与千寻', 'time': '<span class="number">2001-07-20</span>(日本)'&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>到此为止，我们就成功提取了单页的电影信息。</p>
                  <h2 id="6-写入文件"><a href="#6-写入文件" class="headerlink" title="6. 写入文件"></a>6. 写入文件</h2>
                  <p>随后，我们将提取的结果写入文件，这里直接写入到一个文本文件中。这里通过JSON库的<code>dumps()</code>方法实现字典的序列化，并指定<code>ensure_ascii</code>参数为<code>False</code>，这样可以保证输出结果是中文形式而不是Unicode编码。代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_json</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'result.txt'</span>, <span class="string">'a'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        print(type(json.dumps(content)))</span><br><span class="line">        f.write(json.dumps(content, ensure_ascii=<span class="literal">False</span>,).encode(<span class="string">'utf-8'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过调用<code>write_to_json()</code>方法即可实现将字典写入到文本文件的过程，此处的<code>content</code>参数就是一部电影的提取结果，是一个字典。</p>
                  <h2 id="7-整合代码"><a href="#7-整合代码" class="headerlink" title="7. 整合代码"></a>7. 整合代码</h2>
                  <p>最后，实现<code>main()</code>方法来调用前面实现的方法，将单页的电影结果写入到文件。相关代码如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">def</span> <span class="function"><span class="title">main</span>():</span></span><br><span class="line"><span class="function">    <span class="variable">url</span> = <span class="string">'http://maoyan.com/board/4'</span></span></span><br><span class="line"><span class="function">    <span class="variable">html</span> = <span class="title">get_one_page</span>(<span class="variable">url</span>)</span></span><br><span class="line">    <span class="variable">for</span> <span class="variable">item</span> <span class="variable"><span class="keyword">in</span></span> <span class="function"><span class="title">parse_one_page</span>(<span class="variable">html</span>):</span></span><br><span class="line"><span class="function">        <span class="title">write_to_json</span>(<span class="variable">item</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>到此为止，我们就完成了单页电影的提取，也就是首页的10部电影可以成功提取并保存到文本文件中了。</p>
                  <h2 id="8-分页爬取"><a href="#8-分页爬取" class="headerlink" title="8. 分页爬取"></a>8. 分页爬取</h2>
                  <p>因为我们需要抓取的是TOP100的电影，所以还需要遍历一下，给这个链接传入<code>offset</code>参数，实现其他90部电影的爬取，此时添加如下调用即可：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">__name__</span> == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="variable">for</span> <span class="variable">i</span> <span class="variable"><span class="keyword">in</span></span> <span class="function"><span class="title">range</span>(<span class="number">10</span>):</span></span><br><span class="line"><span class="function">        <span class="title">main</span>(<span class="variable">offset</span>=<span class="variable">i</span> * <span class="number">10</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里还需要将<code>main()</code>方法修改一下，接收一个<code>offset</code>值作为偏移量，然后构造URL进行爬取。实现代码如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">def</span> <span class="function"><span class="title">main</span>(<span class="variable">offset</span>):</span></span><br><span class="line"><span class="function">    <span class="variable">url</span> = <span class="string">'http://maoyan.com/board/4?offset='</span> + <span class="title">str</span>(<span class="variable">offset</span>)</span></span><br><span class="line">    <span class="variable">html</span> = <span class="function"><span class="title">get_one_page</span>(<span class="variable">url</span>)</span></span><br><span class="line">    <span class="variable">for</span> <span class="variable">item</span> <span class="variable"><span class="keyword">in</span></span> <span class="function"><span class="title">parse_one_page</span>(<span class="variable">html</span>):</span></span><br><span class="line"><span class="function">        <span class="title">print</span>(<span class="variable">item</span>)</span></span><br><span class="line">        <span class="function"><span class="title">write_to_file</span>(<span class="variable">item</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>到此为止，我们的猫眼电影TOP100的爬虫就全部完成了，再稍微整理一下，完整的代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> RequestException:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_one_page</span><span class="params">(html)</span>:</span></span><br><span class="line">    pattern = re.compile(<span class="string">'&lt;dd&gt;.*?board-index.*?&gt;(\d+)&lt;/i&gt;.*?data-src="(.*?)".*?name"&gt;&lt;a'</span></span><br><span class="line">                         + <span class="string">'.*?&gt;(.*?)&lt;/a&gt;.*?star"&gt;(.*?)&lt;/p&gt;.*?releasetime"&gt;(.*?)&lt;/p&gt;'</span></span><br><span class="line">                         + <span class="string">'.*?integer"&gt;(.*?)&lt;/i&gt;.*?fraction"&gt;(.*?)&lt;/i&gt;.*?&lt;/dd&gt;'</span>, re.S)</span><br><span class="line">    items = re.findall(pattern, html)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        <span class="keyword">yield</span> &#123;</span><br><span class="line">            <span class="string">'index'</span>: item[<span class="number">0</span>],</span><br><span class="line">            <span class="string">'image'</span>: item[<span class="number">1</span>],</span><br><span class="line">            <span class="string">'title'</span>: item[<span class="number">2</span>],</span><br><span class="line">            <span class="string">'actor'</span>: item[<span class="number">3</span>].strip()[<span class="number">3</span>:],</span><br><span class="line">            <span class="string">'time'</span>: item[<span class="number">4</span>].strip()[<span class="number">5</span>:],</span><br><span class="line">            <span class="string">'score'</span>: item[<span class="number">5</span>] + item[<span class="number">6</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_file</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'result.txt'</span>, <span class="string">'a'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(json.dumps(content, ensure_ascii=<span class="literal">False</span>) + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(offset)</span>:</span></span><br><span class="line">    url = <span class="string">'http://maoyan.com/board/4?offset='</span> + str(offset)</span><br><span class="line">    html = get_one_page(url)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> parse_one_page(html):</span><br><span class="line">        print(item)</span><br><span class="line">        write_to_file(item)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        main(offset=i * <span class="number">10</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>现在猫眼多了反爬虫，如果速度过快，则会无响应，所以这里又增加了一个延时等待。</p>
                  <h2 id="9-运行结果"><a href="#9-运行结果" class="headerlink" title="9. 运行结果"></a>9. 运行结果</h2>
                  <p>最后，我们运行一下代码，输出结果类似如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;'index': '1', 'image': 'http://p1.meituan.net/movie/<span class="number">2080</span>3f<span class="number">5929</span>1c47e1e116c<span class="number">1196</span>3ce019e<span class="number">6871</span>1.jpg@160w_220h_1e_1c', 'title': '霸王别姬', 'actor': '张国荣,张丰毅,巩俐', 'time': '<span class="number">1993-01-01</span>(中国香港)', 'score': '9.6'&#125;</span><br><span class="line">&#123;'index': '2', 'image': 'http://p0.meituan.net/movie/__<span class="number">40191813</span>__<span class="number">476704</span>7.jpg@160w_220h_1e_1c', 'title': '肖申克的救赎', 'actor': '蒂姆·罗宾斯,摩根·弗里曼,鲍勃·冈顿', 'time': '<span class="number">1994-10-14</span>(美国)', 'score': '9.5'&#125;</span><br><span class="line">...</span><br><span class="line">&#123;'index': '98', 'image': 'http://p0.meituan.net/movie/76/<span class="number">707338</span>9.jpg@160w_220h_1e_1c', 'title': '东京物语', 'actor': '笠智众,原节子,杉村春子', 'time': '<span class="number">1953-11-03</span>(日本)', 'score': '9.1'&#125;</span><br><span class="line">&#123;'index': '99', 'image': 'http://p0.meituan.net/movie/52/<span class="number">342029</span>3.jpg@160w_220h_1e_1c', 'title': '我爱你', 'actor': '宋在河,李彩恩,吉海延', 'time': '<span class="number">2011-02-17</span>(韩国)', 'score': '9.0'&#125;</span><br><span class="line">&#123;'index': '100', 'image': 'http://p1.meituan.net/movie/__<span class="number">44335138</span>__<span class="number">847077</span>9.jpg@160w_220h_1e_1c', 'title': '迁徙的鸟', 'actor': '雅克·贝汉,菲利普·拉波洛,Philippe Labro', 'time': '<span class="number">2001-12-12</span>(法国)', 'score': '9.1'&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里省略了中间的部分输出结果。可以看到，这样就成功地把TOP100的电影信息爬取下来了。</p>
                  <p>这时我们再看下文本文件，结果如图3-15所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/3-15.jpg" alt="">图3-15 运行结果</p>
                  <p>可以看到，电影信息也已全部保存到了文本文件中了，大功告成！</p>
                  <h2 id="10-本节代码"><a href="#10-本节代码" class="headerlink" title="10. 本节代码"></a>10. 本节代码</h2>
                  <p>本节的代码地址为<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1B5dGhvbjNXZWJTcGlkZXIvTWFvWWFu">https://github.com/Python3WebSpider/MaoYan<i class="fa fa-external-link-alt"></i></span>。</p>
                  <p>本节中，我们通过爬取猫眼TOP100的电影信息练习了requests和正则表达式的用法。这是一个最基础的实例，希望大家可以通过这个实例对爬虫的实现有一个最基本的思路，也对这两个库的用法有更深一步的了解。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-27 14:40:15" itemprop="dateCreated datePublished" datetime="2018-01-27T14:40:15+08:00">2018-01-27</time>
                </span>
                <span id="/5534.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 3.4-抓取猫眼电影排行" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>10k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>9 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5530.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5530.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 3.3-正则表达式</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本节中，我们看一下正则表达式的相关用法。正则表达式是处理字符串的强大工具，它有自己特定的语法结构，有了它，实现字符串的检索、替换、匹配验证都不在话下。</p>
                  <p>当然，对于爬虫来说，有了它，从HTML里提取想要的信息就非常方便了。</p>
                  <h2 id="1-实例引入"><a href="#1-实例引入" class="headerlink" title="1. 实例引入"></a>1. 实例引入</h2>
                  <p>说了这么多，可能我们对它到底是个什么还是比较模糊，下面就用几个实例来看一下正则表达式的用法。</p>
                  <p>打开开源中国提供的正则表达式测试工具<span class="exturl" data-url="aHR0cDovL3Rvb2wub3NjaGluYS5uZXQvcmVnZXgv">http://tool.oschina.net/regex/<i class="fa fa-external-link-alt"></i></span>，输入待匹配的文本，然后选择常用的正则表达式，就可以得出相应的匹配结果了。例如，这里输入待匹配的文本如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Hello, my phone number <span class="keyword">is</span> <span class="number">010</span><span class="number">-86432100</span> <span class="keyword">and</span> email <span class="keyword">is</span> <span class="symbol">cqc@</span>cuiqingcai.com, <span class="keyword">and</span> my website <span class="keyword">is</span> http:<span class="comment">//cuiqingcai.com.</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这段字符串中包含了一个电话号码和一个电子邮件，接下来就尝试用正则表达式提取出来，如图3-10所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/3-10.jpg" alt="">图3-10 运行页面</p>
                  <p>在网页右侧选择“匹配Email地址”，就可以看到下方出现了文本中的E-mail。如果选择“匹配网址URL”，就可以看到下方出现了文本中的URL。是不是非常神奇？</p>
                  <p>其实，这里就是用了正则表达式匹配，也就是用一定的规则将特定的文本提取出来。比如，电子邮件开头是一段字符串，然后是一个@符号，最后是某个域名，这是有特定的组成格式的。另外，对于URL，开头是协议类型，然后是冒号加双斜线，最后是域名加路径。</p>
                  <p>对于URL来说，可以用下面的正则表达式匹配：</p>
                  <figure class="highlight cs">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="meta">a-zA-z</span>]+:<span class="comment">//[^\s]*</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>用这个正则表达式去匹配一个字符串，如果这个字符串中包含类似URL的文本，那就会被提取出来。</p>
                  <p>这个正则表达式看上去是乱糟糟的一团，其实不然，这里面都是有特定的语法规则的。比如，<code>a-z</code>代表匹配任意的小写字母，<code>\\s</code>表示匹配任意的空白字符，<code>*</code>就代表匹配前面的字符任意多个，这一长串的正则表达式就是这么多匹配规则的组合。</p>
                  <p>写好正则表达式后，就可以拿它去一个长字符串里匹配查找了。不论这个字符串里面有什么，只要符合我们写的规则，统统可以找出来。对于网页来说，如果想找出网页源代码里有多少URL，用匹配URL的正则表达式去匹配即可。</p>
                  <p>上面我们说了几个匹配规则，表3-2列出了常用的匹配规则。</p>
                  <p>表3-2 常用的匹配规则</p>
                  <p>模式</p>
                  <p>描述</p>
                  <p><code>\\w</code></p>
                  <p>匹配字母、数字及下划线</p>
                  <p><code>\\W</code></p>
                  <p>匹配不是字母、数字及下划线的字符</p>
                  <p><code>\\s</code></p>
                  <p>匹配任意空白字符，等价于<code>[\\t\\n\\r\\f]</code></p>
                  <p><code>\\S</code></p>
                  <p>匹配任意非空字符</p>
                  <p><code>\\d</code></p>
                  <p>匹配任意数字，等价于<code>[0-9]</code></p>
                  <p><code>\\D</code></p>
                  <p>匹配任意非数字的字符</p>
                  <p><code>\\A</code></p>
                  <p>匹配字符串开头</p>
                  <p><code>\\Z</code></p>
                  <p>匹配字符串结尾，如果存在换行，只匹配到换行前的结束字符串</p>
                  <p><code>\\z</code></p>
                  <p>匹配字符串结尾，如果存在换行，同时还会匹配换行符</p>
                  <p><code>\\G</code></p>
                  <p>匹配最后匹配完成的位置</p>
                  <p><code>\\n</code></p>
                  <p>匹配一个换行符</p>
                  <p><code>\\t</code></p>
                  <p>匹配一个制表符</p>
                  <p><code>^</code></p>
                  <p>匹配一行字符串的开头</p>
                  <p><code>$</code></p>
                  <p>匹配一行字符串的结尾</p>
                  <p><code>.</code></p>
                  <p>匹配任意字符，除了换行符，当<code>re.DOTALL</code>标记被指定时，则可以匹配包括换行符的任意字符</p>
                  <p><code>[...]</code></p>
                  <p>用来表示一组字符，单独列出，比如<code>[amk]</code>匹配<code>a</code>、<code>m</code>或<code>k</code></p>
                  <p><code>[^...]</code></p>
                  <p>不在<code>[]</code>中的字符，比如<code>[^abc]</code>匹配除了<code>a</code>、<code>b</code>、<code>c</code>之外的字符</p>
                  <p><code>*</code></p>
                  <p>匹配0个或多个表达式</p>
                  <p><code>+</code></p>
                  <p>匹配1个或多个表达式</p>
                  <p><code>?</code></p>
                  <p>匹配0个或1个前面的正则表达式定义的片段，非贪婪方式</p>
                  <p><code>{n}</code></p>
                  <p>精确匹配<code>n</code>个前面的表达式</p>
                  <p><code>{n, m}</code></p>
                  <p>匹配<code>n</code>到<code>m</code>次由前面正则表达式定义的片段，贪婪方式</p>
                  <p><code>a|b</code></p>
                  <p>匹配<code>a</code>或<code>b</code></p>
                  <p><code>( )</code></p>
                  <p>匹配括号内的表达式，也表示一个组</p>
                  <p>看完了之后，可能有点晕晕的吧，不过不用担心，后面我们会详细讲解一些常见规则的用法。</p>
                  <p>其实正则表达式不是Python独有的，它也可以用在其他编程语言中。但是Python的re库提供了整个正则表达式的实现，利用这个库，可以在Python中使用正则表达式。在Python中写正则表达式几乎都用这个库，下面就来了解它的一些常用方法。</p>
                  <h2 id="2-match"><a href="#2-match" class="headerlink" title="2. match()"></a>2. <code>match()</code></h2>
                  <p>这里首先介绍第一个常用的匹配方法——<code>match()</code>，向它传入要匹配的字符串以及正则表达式，就可以检测这个正则表达式是否匹配字符串。</p>
                  <p><code>match()</code>方法会尝试从字符串的起始位置匹配正则表达式，如果匹配，就返回匹配成功的结果；如果不匹配，就返回<code>None</code>。示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="attribute">content</span> = <span class="string">'Hello 123 4567 World_This is a Regex Demo'</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(len(content)</span></span>)</span><br><span class="line">result = re.match(<span class="string">'^Hello\s\d\d\d\s\d&#123;4&#125;\s\w&#123;10&#125;'</span>, <span class="attribute">content</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result.group()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result.span()</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">41</span></span><br><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">0</span>, <span class="number">25</span>), match='Hello <span class="number">123</span> <span class="number">4567</span> World_This'&gt;</span><br><span class="line">Hello <span class="number">123</span> <span class="number">4567</span> World_This</span><br><span class="line">(<span class="number">0</span>, <span class="number">25</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先声明了一个字符串，其中包含英文字母、空白字符、数字等。接下来，我们写一个正则表达式：</p>
                  <figure class="highlight tex">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">^Hello<span class="tag">\<span class="name">s</span></span><span class="tag">\<span class="name">d</span></span><span class="tag">\<span class="name">d</span></span><span class="tag">\<span class="name">d</span></span><span class="tag">\<span class="name">s</span></span><span class="tag">\<span class="name">d</span><span class="string">&#123;4&#125;</span></span><span class="tag">\<span class="name">s</span></span><span class="tag">\<span class="name">w</span><span class="string">&#123;10&#125;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>用它来匹配这个长字符串。开头的<code>^</code>是匹配字符串的开头，也就是以<code>Hello</code>开头；然后<code>\\s</code>匹配空白字符，用来匹配目标字符串的空格；<code>\\d</code>匹配数字，3个<code>\\d</code>匹配123；然后再写1个<code>\\s</code>匹配空格；后面还有<code>4567</code>，我们其实可以依然用4个<code>\\d</code>来匹配，但是这么写比较烦琐，所以后面可以跟<code>{4}</code>以代表匹配前面的规则4次，也就是匹配4个数字；然后后面再紧接1个空白字符，最后<code>\\w{10}</code>匹配10个字母及下划线。我们注意到，这里其实并没有把目标字符串匹配完，不过这样依然可以进行匹配，只不过匹配结果短一点而已。</p>
                  <p>而在<code>match()</code>方法中，第一个参数传入了正则表达式，第二个参数传入了要匹配的字符串。</p>
                  <p>打印输出结果，可以看到结果是<code>SRE_Match</code>对象，这证明成功匹配。该对象有两个方法：<code>group()</code>方法可以输出匹配到的内容，结果是<code>Hello 123 4567 World_This</code>，这恰好是正则表达式规则所匹配的内容；<code>span()</code>方法可以输出匹配的范围，结果是<code>(0, 25)</code>，这就是匹配到的结果字符串在原字符串中的位置范围。</p>
                  <p>通过上面的例子，我们基本了解了如何在Python中使用正则表达式来匹配一段文字。</p>
                  <h3 id="匹配目标"><a href="#匹配目标" class="headerlink" title="匹配目标"></a>匹配目标</h3>
                  <p>刚才我们用<code>match()</code>方法可以得到匹配到的字符串内容，但是如果想从字符串中提取一部分内容，该怎么办呢？就像最前面的实例一样，从一段文本中提取出邮件或电话号码等内容。</p>
                  <p>这里可以使用<code>()</code>括号将想提取的子字符串括起来。<code>()</code>实际上标记了一个子表达式的开始和结束位置，被标记的每个子表达式会依次对应每一个分组，调用<code>group()</code>方法传入分组的索引即可获取提取的结果。示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="attribute">content</span> = <span class="string">'Hello 1234567 World_This is a Regex Demo'</span></span><br><span class="line">result = re.match(<span class="string">'^Hello\s(\d+)\sWorld'</span>, <span class="attribute">content</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result.group()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result.group(<span class="number">1</span>)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result.span()</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们想把字符串中的<code>1234567</code>提取出来，此时可以将数字部分的正则表达式用<code>()</code>括起来，然后调用了<code>group(1)</code>获取匹配结果。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">0</span>, <span class="number">19</span>), match='Hello <span class="number">1234567</span> World'&gt;</span><br><span class="line">Hello <span class="number">1234567</span> World</span><br><span class="line"><span class="number">1234567</span></span><br><span class="line">(<span class="number">0</span>, <span class="number">19</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，我们成功得到了<code>1234567</code>。这里用的是<code>group(1)</code>，它与<code>group()</code>有所不同，后者会输出完整的匹配结果，而前者会输出第一个被<code>()</code>包围的匹配结果。假如正则表达式后面还有<code>()</code>包括的内容，那么可以依次用<code>group(2)</code>、<code>group(3)</code>等来获取。</p>
                  <h3 id="通用匹配"><a href="#通用匹配" class="headerlink" title="通用匹配"></a>通用匹配</h3>
                  <p>刚才我们写的正则表达式其实比较复杂，出现空白字符我们就写<code>\\s</code>匹配，出现数字我们就用<code>\\d</code>匹配，这样的工作量非常大。其实完全没必要这么做，因为还有一个万能匹配可以用，那就是<code>.*</code>（点星）。其中<code>.</code>（点）可以匹配任意字符（除换行符），<code>*</code>（星）代表匹配前面的字符无限次，所以它们组合在一起就可以匹配任意字符了。有了它，我们就不用挨个字符地匹配了。</p>
                  <p>接着上面的例子，我们可以改写一下正则表达式：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="attribute">content</span> = <span class="string">'Hello 123 4567 World_This is a Regex Demo'</span></span><br><span class="line">result = re.match(<span class="string">'^Hello.*Demo$'</span>, <span class="attribute">content</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result.group()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result.span()</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们将中间部分直接省略，全部用<code>.*</code>来代替，最后加一个结尾字符串就好了。运行结果如下：</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">0</span>, <span class="number">41</span>), match='Hello <span class="number">123</span> <span class="number">4567</span> World_This is a Regex Demo'&gt;</span><br><span class="line">Hello <span class="number">123</span> <span class="number">4567</span> World_This is a Regex Demo</span><br><span class="line">(<span class="number">0</span>, <span class="number">41</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，<code>group()</code>方法输出了匹配的全部字符串，也就是说我们写的正则表达式匹配到了目标字符串的全部内容；<code>span()</code>方法输出<code>(0, 41)</code>，这是整个字符串的长度。</p>
                  <p>因此，我们可以使用<code>.*</code>简化正则表达式的书写。</p>
                  <h3 id="贪婪与非贪婪"><a href="#贪婪与非贪婪" class="headerlink" title="贪婪与非贪婪"></a>贪婪与非贪婪</h3>
                  <p>使用上面的通用匹配<code>.*</code>时，可能有时候匹配到的并不是我们想要的结果。看下面的例子：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="attribute">content</span> = <span class="string">'Hello 1234567 World_This is a Regex Demo'</span></span><br><span class="line">result = re.match(<span class="string">'^He.*(\d+).*Demo$'</span>, <span class="attribute">content</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result.group(<span class="number">1</span>)</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们依然想获取中间的数字，所以中间依然写的是<code>(\\d+)</code>。而数字两侧由于内容比较杂乱，所以想省略来写，都写成 <code>.*</code>。最后，组成<code>^He.*(\\d+).*Demo$</code>，看样子并没有什么问题。我们看下运行结果：</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">0</span>, <span class="number">40</span>), match='Hello <span class="number">1234567</span> World_This is a Regex Demo'&gt;</span><br><span class="line"><span class="number">7</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>奇怪的事情发生了，我们只得到了7这个数字，这是怎么回事呢？</p>
                  <p>这里就涉及一个贪婪匹配与非贪婪匹配的问题了。在贪婪匹配下，<code>.*</code>会匹配尽可能多的字符。正则表达式中<code>.*</code>后面是<code>\\d+</code>，也就是至少一个数字，并没有指定具体多少个数字，因此，<code>.*</code>就尽可能匹配多的字符，这里就把<code>123456</code>匹配了，给<code>\\d+</code>留下一个可满足条件的数字7，最后得到的内容就只有数字7了。</p>
                  <p>但这很明显会给我们带来很大的不便。有时候，匹配结果会莫名其妙少了一部分内容。其实，这里只需要使用非贪婪匹配就好了。非贪婪匹配的写法是<code>.*?</code>，多了一个<code>?</code>，那么它可以达到怎样的效果？我们再用实例看一下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="attribute">content</span> = <span class="string">'Hello 1234567 World_This is a Regex Demo'</span></span><br><span class="line">result = re.match(<span class="string">'^He.*?(\d+).*Demo$'</span>, <span class="attribute">content</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result.group(<span class="number">1</span>)</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们只是将第一个<code>.*</code>改成了<code>.*?</code>，转变为非贪婪匹配。结果如下：</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">0</span>, <span class="number">40</span>), match='Hello <span class="number">1234567</span> World_This is a Regex Demo'&gt;</span><br><span class="line"><span class="number">1234567</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此时就可以成功获取<code>1234567</code>了。原因可想而知，贪婪匹配是尽可能匹配多的字符，非贪婪匹配就是尽可能匹配少的字符。当<code>.*?</code>匹配到<code>Hello</code>后面的空白字符时，再往后的字符就是数字了，而<code>\\d+</code>恰好可以匹配，那么这里<code>.*?</code>就不再进行匹配，交给<code>\\d+</code>去匹配后面的数字。所以这样<code>.*?</code>匹配了尽可能少的字符，<code>\\d+</code>的结果就是<code>1234567</code>了。</p>
                  <p>所以说，在做匹配的时候，字符串中间尽量使用非贪婪匹配，也就是用<code>.*?</code>来代替<code>.*</code>，以免出现匹配结果缺失的情况。</p>
                  <p>但这里需要注意，如果匹配的结果在字符串结尾，<code>.*?</code>就有可能匹配不到任何内容了，因为它会匹配尽可能少的字符。例如：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="attribute">content</span> = <span class="string">'http://weibo.com/comment/kEraCN'</span></span><br><span class="line">result1 = re.match(<span class="string">'http.*?comment/(.*?)'</span>, <span class="attribute">content</span>)</span><br><span class="line">result2 = re.match(<span class="string">'http.*?comment/(.*)'</span>, <span class="attribute">content</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'result1'</span>, result1.group(<span class="number">1</span>)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'result2'</span>, result2.group(<span class="number">1</span>)</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">result1</span> <span class="string"></span></span><br><span class="line"><span class="attr">result2</span> <span class="string">kEraCN</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以观察到，<code>.*?</code>没有匹配到任何结果，而<code>.*</code>则尽量匹配多的内容，成功得到了匹配结果。</p>
                  <h3 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h3>
                  <p>正则表达式可以包含一些可选标志修饰符来控制匹配的模式。修饰符被指定为一个可选的标志。我们用实例来看一下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'''Hello 1234567 World_This</span></span><br><span class="line"><span class="string">is a Regex Demo</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">result = re.match(<span class="string">'^He.*?(\d+).*?Demo$'</span>, content)</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>和上面的例子相仿，我们在字符串中加了换行符，正则表达式还是一样的，用来匹配其中的数字。看一下运行结果：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">AttributeError Traceback (most recent <span class="keyword">call</span> last)</span><br><span class="line">&lt;ipython-<span class="keyword">input</span><span class="number">-18</span>-c7d232b39645&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">      <span class="number">5</span> <span class="string">'''</span></span><br><span class="line"><span class="string">      6 result = re.match('</span>^He.*?(\d+).*?Demo$<span class="string">', content)</span></span><br><span class="line"><span class="string">----&gt; 7 print(result.group(1))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">AttributeError: '</span>NoneTyp<span class="string">e' object has no attribute '</span><span class="keyword">group</span><span class="string">'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行直接报错，也就是说正则表达式没有匹配到这个字符串，返回结果为<code>None</code>，而我们又调用了<code>group()</code>方法导致<code>AttributeError</code>。</p>
                  <p>那么，为什么加了一个换行符，就匹配不到了呢？这是因为<code>\\.</code>匹配的是除换行符之外的任意字符，当遇到换行符时，<code>.*?</code>就不能匹配了，所以导致匹配失败。这里只需加一个修饰符<code>re.S</code>，即可修正这个错误：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">result</span> = re.match(<span class="string">'^He.*?(\d+).*?Demo$'</span>, content, re.S)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个修饰符的作用是使<code>.</code>匹配包括换行符在内的所有字符。此时运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">1234567</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个<code>re.S</code>在网页匹配中经常用到。因为HTML节点经常会有换行，加上它，就可以匹配节点与节点之间的换行了。</p>
                  <p>另外，还有一些修饰符，在必要的情况下也可以使用，如表3-3所示。</p>
                  <p>表3-3 修饰符</p>
                  <p>修饰符</p>
                  <p>描述</p>
                  <p><code>re.I</code></p>
                  <p>使匹配对大小写不敏感</p>
                  <p><code>re.L</code></p>
                  <p>做本地化识别（locale-aware）匹配</p>
                  <p><code>re.M</code></p>
                  <p>多行匹配，影响<code>^</code>和<code>$</code></p>
                  <p><code>re.S</code></p>
                  <p>使<code>.</code>匹配包括换行在内的所有字符</p>
                  <p><code>re.U</code></p>
                  <p>根据Unicode字符集解析字符。这个标志影响<code>\\w</code>、<code>\\W</code>、 <code>\\b</code>和<code>\\B</code></p>
                  <p><code>re.X</code></p>
                  <p>该标志通过给予你更灵活的格式以便你将正则表达式写得更易于理解</p>
                  <p>在网页匹配中，较为常用的有<code>re.S</code>和<code>re.I</code>。</p>
                  <h3 id="转义匹配"><a href="#转义匹配" class="headerlink" title="转义匹配"></a>转义匹配</h3>
                  <p>我们知道正则表达式定义了许多匹配模式，如<code>.</code>匹配除换行符以外的任意字符，但是如果目标字符串里面就包含<code>.</code>，那该怎么办呢？</p>
                  <p>这里就需要用到转义匹配了，示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="attribute">content</span> = <span class="string">'(百度)www.baidu.com'</span></span><br><span class="line">result = re.match(<span class="string">'\(百度\)www\.baidu\.com'</span>, <span class="attribute">content</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当遇到用于正则匹配模式的特殊字符时，在前面加反斜线转义一下即可。例如<code>.</code>就可以用<code>\\.</code>来匹配，运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">_sre.SRE_Match</span> <span class="attr">object</span>; <span class="attr">span</span>=<span class="string">(0,</span> <span class="attr">17</span>), <span class="attr">match</span>=<span class="string">'(百度)www.baidu.com'</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这里成功匹配到了原字符串。</p>
                  <p>这些是写正则表达式常用的几个知识点，熟练掌握它们对后面写正则表达式匹配非常有帮助。</p>
                  <h2 id="3-search"><a href="#3-search" class="headerlink" title="3. search()"></a>3. <code>search()</code></h2>
                  <p>前面提到过，<code>match()</code>方法是从字符串的开头开始匹配的，一旦开头不匹配，那么整个匹配就失败了。我们看下面的例子：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="attribute">content</span> = <span class="string">'Extra stings Hello 1234567 World_This is a Regex Demo Extra stings'</span></span><br><span class="line">result = re.match(<span class="string">'Hello.*?(\d+).*?Demo'</span>, <span class="attribute">content</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的字符串以<code>Extra</code>开头，但是正则表达式以<code>Hello</code>开头，整个正则表达式是字符串的一部分，但是这样匹配是失败的。运行结果如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">None</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>因为<code>match()</code>方法在使用时需要考虑到开头的内容，这在做匹配时并不方便。它更适合用来检测某个字符串是否符合某个正则表达式的规则。</p>
                  <p>这里就有另外一个方法<code>search()</code>，它在匹配时会扫描整个字符串，然后返回第一个成功匹配的结果。也就是说，正则表达式可以是字符串的一部分，在匹配时，<code>search()</code>方法会依次扫描字符串，直到找到第一个符合规则的字符串，然后返回匹配内容，如果搜索完了还没有找到，就返回<code>None</code>。</p>
                  <p>我们把上面代码中的<code>match()</code>方法修改成<code>search()</code>，再看下运行结果：</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">13</span>, <span class="number">53</span>), match='Hello <span class="number">1234567</span> World_This is a Regex Demo'&gt;</span><br><span class="line"><span class="number">1234567</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时就得到了匹配结果。</p>
                  <p>因此，为了匹配方便，我们可以尽量使用<code>search()</code>方法。</p>
                  <p>下面再用几个实例来看看<code>search()</code>方法的用法。</p>
                  <p>首先，这里有一段待匹配的HTML文本，接下来写几个正则表达式实例来实现相应信息的提取：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = '''<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"songs-list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>经典老歌<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"introduction"</span>&gt;</span></span><br><span class="line">        经典老歌列表</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"list"</span> <span class="attr">class</span>=<span class="string">"list-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-view</span>=<span class="string">"2"</span>&gt;</span>一路上有你<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-view</span>=<span class="string">"7"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/2.mp3"</span> <span class="attr">singer</span>=<span class="string">"任贤齐"</span>&gt;</span>沧海一声笑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-view</span>=<span class="string">"4"</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/3.mp3"</span> <span class="attr">singer</span>=<span class="string">"齐秦"</span>&gt;</span>往事随风<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-view</span>=<span class="string">"6"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/4.mp3"</span> <span class="attr">singer</span>=<span class="string">"beyond"</span>&gt;</span>光辉岁月<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-view</span>=<span class="string">"5"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/5.mp3"</span> <span class="attr">singer</span>=<span class="string">"陈慧琳"</span>&gt;</span>记事本<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-view</span>=<span class="string">"5"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/6.mp3"</span> <span class="attr">singer</span>=<span class="string">"邓丽君"</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-user"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>但愿人长久<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>'''</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以观察到，<code>ul</code>节点里有许多<code>li</code>节点，其中<code>li</code>节点中有的包含<code>a</code>节点，有的不包含<code>a</code>节点，<code>a</code>节点还有一些相应的属性——超链接和歌手名。</p>
                  <p>首先，我们尝试提取<code>class</code>为<code>active</code>的<code>li</code>节点内部的超链接包含的歌手名和歌名，此时需要提取第三个<code>li</code>节点下<code>a</code>节点的<code>singer</code>属性和文本。</p>
                  <p>此时正则表达式可以以<code>li</code>开头，然后寻找一个标志符<code>active</code>，中间的部分可以用<code>.*?</code>来匹配。接下来，要提取<code>singer</code>这个属性值，所以还需要写入<code>singer=&quot;(.*?)&quot;</code>，这里需要提取的部分用小括号括起来，以便用<code>group()</code>方法提取出来，它的两侧边界是双引号。然后还需要匹配<code>a</code>节点的文本，其中它的左边界是<code>\&gt;</code>，右边界是<code>&lt;/a&gt;</code>。然后目标内容依然用<code>(.*?)</code>来匹配，所以最后的正则表达式就变成了：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;li.*?active.*?<span class="attribute">singer</span>=<span class="string">"(.*?)"</span>&gt;(.*?)&lt;/a&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后再调用<code>search()</code>方法，它会搜索整个HTML文本，找到符合正则表达式的第一个内容返回。</p>
                  <p>另外，由于代码有换行，所以这里第三个参数需要传入<code>re.S</code>。整个匹配代码如下：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">result = re.<span class="keyword">search</span>('&lt;<span class="keyword">li</span>.*?active.*?singer=<span class="string">"(.*?)"</span>&gt;(.*?)&lt;/a&gt;', html, re.S)</span><br><span class="line"><span class="keyword">if</span> result:</span><br><span class="line">    <span class="keyword">print</span>(result.<span class="built_in">group</span>(1), result.<span class="built_in">group</span>(2))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>由于需要获取的歌手和歌名都已经用小括号包围，所以可以用<code>group()</code>方法获取。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">齐秦 往事随风</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这正是<code>class</code>为<code>active</code>的<code>li</code>节点内部的超链接包含的歌手名和歌名。</p>
                  <p>如果正则表达式不加<code>active</code>（也就是匹配不带<code>class</code>为<code>active</code>的节点内容），那会怎样呢？我们将正则表达式中的<code>active</code>去掉，代码改写如下：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">result = re.<span class="keyword">search</span>('&lt;<span class="keyword">li</span>.*?singer=<span class="string">"(.*?)"</span>&gt;(.*?)&lt;/a&gt;', html, re.S)</span><br><span class="line"><span class="keyword">if</span> result:</span><br><span class="line">    <span class="keyword">print</span>(result.<span class="built_in">group</span>(1), result.<span class="built_in">group</span>(2))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>由于search()方法会返回第一个符合条件的匹配目标，这里结果就变了：</p>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">任贤齐 沧海一声笑</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>把<code>active</code>标签去掉后，从字符串开头开始搜索，此时符合条件的节点就变成了第二个<code>li</code>节点，后面的就不再匹配，所以运行结果就变成第二个<code>li</code>节点中的内容。</p>
                  <p>注意，在上面的两次匹配中，<code>search()</code>方法的第三个参数都加了<code>re.S</code>，这使得<code>.*?</code>可以匹配换行，所以含有换行的<code>li</code>节点被匹配到了。如果我们将其去掉，结果会是什么？代码如下：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">result = re.<span class="keyword">search</span>('&lt;<span class="keyword">li</span>.*?singer=<span class="string">"(.*?)"</span>&gt;(.*?)&lt;/a&gt;', html)</span><br><span class="line"><span class="keyword">if</span> result:</span><br><span class="line">    <span class="keyword">print</span>(result.<span class="built_in">group</span>(1), result.<span class="built_in">group</span>(2))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">beyond </span>光辉岁月</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，结果变成了第四个<code>li</code>节点的内容。这是因为第二个和第三个<code>li</code>节点都包含了换行符，去掉<code>re.S</code>之后，<code>.*?</code>已经不能匹配换行符，所以正则表达式不会匹配到第二个和第三个<code>li</code>节点，而第四个<code>li</code>节点中不包含换行符，所以成功匹配。</p>
                  <p>由于绝大部分的HTML文本都包含了换行符，所以尽量都需要加上<code>re.S</code>修饰符，以免出现匹配不到的问题。</p>
                  <h2 id="4-findall"><a href="#4-findall" class="headerlink" title="4. findall()"></a>4. <code>findall()</code></h2>
                  <p>前面我们介绍了<code>search()</code>方法的用法，它可以返回匹配正则表达式的第一个内容，但是如果想要获取匹配正则表达式的所有内容，那该怎么办呢？这时就要借助<code>findall()</code>方法了。该方法会搜索整个字符串，然后返回匹配正则表达式的所有内容。</p>
                  <p>还是上面的HTML文本，如果想获取所有<code>a</code>节点的超链接、歌手和歌名，就可以将<code>search()</code>方法换成<code>findall()</code>方法。如果有返回结果的话，就是列表类型，所以需要遍历一下来依次获取每组内容。代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">results = re.findall(<span class="string">'&lt;li.*?href="(.*?)".*?singer="(.*?)"&gt;(.*?)&lt;/a&gt;'</span>, html, re.S)</span><br><span class="line"><span class="builtin-name">print</span>(results)</span><br><span class="line"><span class="builtin-name">print</span>(type(results))</span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">    <span class="builtin-name">print</span>(result)</span><br><span class="line">    <span class="builtin-name">print</span>(result[0], result[1], result[2])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[(<span class="string">'/2.mp3'</span>, <span class="string">'任贤齐'</span>, <span class="string">'沧海一声笑'</span>), (<span class="string">'/3.mp3'</span>, <span class="string">'齐秦'</span>, <span class="string">'往事随风'</span>), (<span class="string">'/4.mp3'</span>, <span class="string">'beyond'</span>, <span class="string">'光辉岁月'</span>), (<span class="string">'/5.mp3'</span>, <span class="string">'陈慧琳'</span>, <span class="string">'记事本'</span>), (<span class="string">'/6.mp3'</span>, <span class="string">'邓丽君'</span>, <span class="string">'但愿人长久'</span>)]</span><br><span class="line">&lt;class <span class="string">'list'</span>&gt;</span><br><span class="line">(<span class="string">'/2.mp3'</span>, <span class="string">'任贤齐'</span>, <span class="string">'沧海一声笑'</span>)</span><br><span class="line">/<span class="number">2</span><span class="selector-class">.mp3</span> 任贤齐 沧海一声笑</span><br><span class="line">(<span class="string">'/3.mp3'</span>, <span class="string">'齐秦'</span>, <span class="string">'往事随风'</span>)</span><br><span class="line">/<span class="number">3</span><span class="selector-class">.mp3</span> 齐秦 往事随风</span><br><span class="line">(<span class="string">'/4.mp3'</span>, <span class="string">'beyond'</span>, <span class="string">'光辉岁月'</span>)</span><br><span class="line">/<span class="number">4</span><span class="selector-class">.mp3</span> beyond 光辉岁月</span><br><span class="line">(<span class="string">'/5.mp3'</span>, <span class="string">'陈慧琳'</span>, <span class="string">'记事本'</span>)</span><br><span class="line">/<span class="number">5</span><span class="selector-class">.mp3</span> 陈慧琳 记事本</span><br><span class="line">(<span class="string">'/6.mp3'</span>, <span class="string">'邓丽君'</span>, <span class="string">'但愿人长久'</span>)</span><br><span class="line">/<span class="number">6</span><span class="selector-class">.mp3</span> 邓丽君 但愿人长久</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，返回的列表中的每个元素都是元组类型，我们用对应的索引依次取出即可。</p>
                  <p>如果只是获取第一个内容，可以用<code>search()</code>方法。当需要提取多个内容时，可以用<code>findall()</code>方法。</p>
                  <h2 id="5-sub"><a href="#5-sub" class="headerlink" title="5. sub()"></a>5. <code>sub()</code></h2>
                  <p>除了使用正则表达式提取信息外，有时候还需要借助它来修改文本。比如，想要把一串文本中的所有数字都去掉，如果只用字符串的<code>replace()</code>方法，那就太烦琐了，这时可以借助<code>sub()</code>方法。示例如下：</p>
                  <figure class="highlight coffeescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'54aK54yr5oiR54ix5L2g'</span></span><br><span class="line">content = re.sub(<span class="string">'\d+'</span>, <span class="string">''</span>, content)</span><br><span class="line"><span class="built_in">print</span>(content)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">aKyroiRixLg</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里只需要给第一个参数传入<code>\\d+</code>来匹配所有的数字，第二个参数为替换成的字符串（如果去掉该参数的话，可以赋值为空），第三个参数是原字符串。</p>
                  <p>在上面的HTML文本中，如果想获取所有<code>li</code>节点的歌名，直接用正则表达式来提取可能比较烦琐。比如，可以写成这样子：</p>
                  <figure class="highlight vbnet">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">results = re.findall(<span class="comment">'<span class="doctag">&lt;li.*?&gt;</span>\s*?(<span class="doctag">&lt;a.*?&gt;</span>)?(\w+)(<span class="doctag">&lt;/a&gt;</span>)?\s*?<span class="doctag">&lt;/li&gt;</span>', html, re.S)</span></span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">    print(result[<span class="number">1</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">一路上有你</span><br><span class="line">沧海一声笑</span><br><span class="line">往事随风</span><br><span class="line">光辉岁月</span><br><span class="line">记事本</span><br><span class="line">但愿人长久</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此时借助<code>sub()</code>方法就比较简单了。可以先用<code>sub()</code>方法将<code>a</code>节点去掉，只留下文本，然后再利用<code>findall()</code>提取就好了：</p>
                  <figure class="highlight vbnet">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">html = re.<span class="keyword">sub</span>(<span class="comment">'<span class="doctag">&lt;a.*?&gt;</span>|<span class="doctag">&lt;/a&gt;</span>', '', html)</span></span><br><span class="line">print(html)</span><br><span class="line">results = re.findall(<span class="comment">'<span class="doctag">&lt;li.*?&gt;</span>(.*?)<span class="doctag">&lt;/li&gt;</span>', html, re.S)</span></span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">    print(result.strip())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;div id=<span class="string">"songs-list"</span>&gt;</span><br><span class="line">    &lt;h2 <span class="keyword">class</span>=<span class="string">"title"</span>&gt;经典老歌&lt;/h2&gt;</span><br><span class="line">    &lt;p <span class="keyword">class</span>=<span class="string">"introduction"</span>&gt;</span><br><span class="line">        经典老歌列表</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;ul id=<span class="string">"list"</span> <span class="keyword">class</span>=<span class="string">"list-group"</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">li</span> data-<span class="keyword">view</span>=<span class="string">"2"</span>&gt;一路上有你&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">li</span> data-<span class="keyword">view</span>=<span class="string">"7"</span>&gt;</span><br><span class="line">            沧海一声笑</span><br><span class="line">        &lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">li</span> data-<span class="keyword">view</span>=<span class="string">"4"</span> <span class="keyword">class</span>=<span class="string">"active"</span>&gt;</span><br><span class="line">            往事随风</span><br><span class="line">        &lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">li</span> data-<span class="keyword">view</span>=<span class="string">"6"</span>&gt;光辉岁月&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">li</span> data-<span class="keyword">view</span>=<span class="string">"5"</span>&gt;记事本&lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">li</span> data-<span class="keyword">view</span>=<span class="string">"5"</span>&gt;</span><br><span class="line">            但愿人长久</span><br><span class="line">        &lt;/<span class="keyword">li</span>&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">一路上有你</span><br><span class="line">沧海一声笑</span><br><span class="line">往事随风</span><br><span class="line">光辉岁月</span><br><span class="line">记事本</span><br><span class="line">但愿人长久</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，<code>a</code>节点经过<code>sub()</code>方法处理后就没有了，然后再通过<code>findall()</code>方法直接提取即可。可以看到，在适当的时候，借助<code>sub()</code>方法可以起到事半功倍的效果。</p>
                  <h2 id="6-compile"><a href="#6-compile" class="headerlink" title="6. compile()"></a>6. <code>compile()</code></h2>
                  <p>前面所讲的方法都是用来处理字符串的方法，最后再介绍一下<code>compile()</code>方法，这个方法可以将正则字符串编译成正则表达式对象，以便在后面的匹配中复用。示例代码如下：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"></span><br><span class="line">content1 = <span class="string">'2016-12-15 12:00'</span></span><br><span class="line">content2 = <span class="string">'2016-12-17 12:55'</span></span><br><span class="line">content3 = <span class="string">'2016-12-22 13:21'</span></span><br><span class="line">pattern = re.compile(<span class="string">'\d&#123;2&#125;:\d&#123;2&#125;'</span>)</span><br><span class="line">result1 = re.<span class="built_in">sub</span>(pattern, <span class="string">''</span>, content1)</span><br><span class="line">result2 = re.<span class="built_in">sub</span>(pattern, <span class="string">''</span>, content2)</span><br><span class="line">result3 = re.<span class="built_in">sub</span>(pattern, <span class="string">''</span>, content3)</span><br><span class="line"><span class="built_in">print</span>(result1, result2, result3)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>例如，这里有3个日期，我们想分别将3个日期中的时间去掉，这时可以借助<code>sub()</code>方法。该方法的第一个参数是正则表达式，但是这里没有必要重复写3个同样的正则表达式，此时可以借助<code>compile()</code>方法将正则表达式编译成一个正则表达式对象，以便复用。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2016</span><span class="number">-12</span><span class="number">-15</span>  <span class="number">2016</span><span class="number">-12</span><span class="number">-17</span>  <span class="number">2016</span><span class="number">-12</span><span class="number">-22</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外，<code>compile()</code>还可以传入修饰符，例如<code>re.S</code>等修饰符，这样在<code>search()</code>、<code>findall()</code>等方法中就不需要额外传了。所以，<code>compile()</code>方法可以说是给正则表达式做了一层封装，以便我们更好地复用。</p>
                  <p>到此为止，正则表达式的基本用法就介绍完了，后面会通过具体的实例来讲解正则表达式的用法。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-27 14:32:40" itemprop="dateCreated datePublished" datetime="2018-01-27T14:32:40+08:00">2018-01-27</time>
                </span>
                <span id="/5530.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 3.3-正则表达式" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>12k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>11 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5523.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5523.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 3.2.2-高级用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在前一节中，我们了解了requests的基本用法，如基本的GET、POST请求以及<code>Response</code>对象。本节中，我们再来了解下requests的一些高级用法，如文件上传、cookie设置、代理设置等。</p>
                  <h2 id="1-文件上传"><a href="#1-文件上传" class="headerlink" title="1. 文件上传"></a>1. 文件上传</h2>
                  <p>我们知道requests可以模拟提交一些数据。假如有的网站需要上传文件，我们也可以用它来实现，这非常简单，示例如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">files</span> = &#123;<span class="string">'file'</span>: <span class="keyword">open</span>(<span class="string">'favicon.ico'</span>, <span class="string">'rb'</span>)&#125;</span><br><span class="line">r = requests.post(<span class="string">"http://httpbin.org/post"</span>, <span class="keyword">files</span>=<span class="keyword">files</span>)</span><br><span class="line"><span class="keyword">print</span>(r.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在前一节中我们保存了一个文件favicon.ico，这次用它来模拟文件上传的过程。需要注意的是，favicon.ico需要和当前脚本在同一目录下。如果有其他文件，当然也可以使用其他文件来上传，更改下代码即可。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"data"</span>: <span class="string">""</span>, </span><br><span class="line">  <span class="attr">"files"</span>: &#123;</span><br><span class="line">    <span class="attr">"file"</span>: <span class="string">"data:application/octet-stream;base64,AAAAAA...="</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"form"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"*/*"</span>, </span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="attr">"Content-Length"</span>: <span class="string">"6665"</span>, </span><br><span class="line">    <span class="attr">"Content-Type"</span>: <span class="string">"multipart/form-data; boundary=809f80b1a2974132b133ade1a8e8e058"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"python-requests/2.10.0"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"json"</span>: <span class="literal">null</span>, </span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"60.207.237.16"</span>, </span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"http://httpbin.org/post"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上省略部分内容，这个网站会返回响应，里面包含<code>files</code>这个字段，而<code>form</code>字段是空的，这证明文件上传部分会单独有一个<code>files</code>字段来标识。</p>
                  <h2 id="2-Cookies"><a href="#2-Cookies" class="headerlink" title="2. Cookies"></a>2. Cookies</h2>
                  <p>前面我们使用urllib处理过Cookies，写法比较复杂，而有了requests，获取和设置Cookies只需一步即可完成。</p>
                  <p>我们先用一个实例看一下获取Cookies的过程：</p>
                  <figure class="highlight processing">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.<span class="built_in">get</span>(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line"><span class="built_in">print</span>(r.cookies)</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">key</span>, value in r.cookies.items():</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">key</span> + <span class="string">'='</span> + value)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight fsharp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;RequestsCookieJar<span class="meta">[&lt;Cookie BDORZ=27315 for .baidu.com/&gt;, &lt;Cookie __bsi=13533594356813414194_00_14_N_N_2_0303_C02F_N_N_N_0 for .www.baidu.com/&gt;]</span>&gt;</span><br><span class="line">BDORZ=<span class="number">27315</span></span><br><span class="line">__bsi=<span class="number">13533594356813414194</span>_00_14_N_N_2_0303_C02F_N_N_N_0</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们首先调用<code>cookies</code>属性即可成功得到Cookies，可以发现它是<code>RequestCookieJar</code>类型。然后用<code>items()</code>方法将其转化为元组组成的列表，遍历输出每一个Cookie的名称和值，实现Cookie的遍历解析。</p>
                  <p>当然，我们也可以直接用Cookie来维持登录状态，下面以知乎为例来说明。首先登录知乎，将<code>Headers</code>中的<code>Cookie</code>内容复制下来，如图3-6所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/3-6.png" alt="">图3-6 <code>Cookie</code></p>
                  <p>这里可以替换成你自己的<code>Cookie</code>，将其设置到<code>Headers</code>里面，然后发送请求，示例如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    'Cookie': 'q_c1=<span class="number">3165</span>3b264a074fc9a<span class="number">5781</span>6d1ea93ed8b|<span class="number">147427393800</span>0|<span class="number">147427393800</span>0; d_c0="AGDAs254kAqPTr6NW1U3XTLFzKhMPQ6H_nc=|<span class="number">1474273938</span>"; __utmv=<span class="number">51854390.10</span>0-1|2=registration_date=<span class="number">20130902</span>=1^3=entry_date=<span class="number">20130902</span>=1;a_t="2.0AACAfbwdAAAXAAAAso0QWAAAgH28HQAAAGDAs254kAoXAAAAYQJVTQ4FCVgA360us8BAklzLYNEHUd6kmHtRQX5a6hiZxKCynnycerLQ3gIkoJLOCQ==";z_c0=Mi4wQUFDQWZid2RBQUFBWU1DemJuaVFDaGNBQUFCaEFsVk5EZ1VKV0FEZnJTNnp3RUNTWE10ZzBRZFIzcVNZZTFGQmZn|<span class="number">1474887858</span>|64b4d<span class="number">4234</span>a21de774c42c837fe0b672fdb<span class="number">5763</span>b0',</span><br><span class="line">    'Host': 'www.zhihu.com',</span><br><span class="line">    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.<span class="number">2785.11</span>6 Safari/537.36',</span><br><span class="line">&#125;</span><br><span class="line">r = requests.get('https://www.zhihu.com', headers=headers)</span><br><span class="line">print(r.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们发现，结果中包含了登录后的结果，如图3-7所示，这证明登录成功。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/3-7.jpg" alt="">图3-7 运行结果</p>
                  <p>当然，你也可以通过<code>cookies</code>参数来设置，不过这样就需要构造<code>RequestsCookieJar</code>对象，而且需要分割一下<code>cookies</code>。这相对烦琐，不过效果是相同的，示例如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">cookies = 'q_c1=<span class="number">3165</span>3b264a074fc9a<span class="number">5781</span>6d1ea93ed8b|<span class="number">147427393800</span>0|<span class="number">147427393800</span>0; d_c0="AGDAs254kAqPTr6NW1U3XTLFzKhMPQ6H_nc=|<span class="number">1474273938</span>"; __utmv=<span class="number">51854390.10</span>0-1|2=registration_date=<span class="number">20130902</span>=1^3=entry_date=<span class="number">20130902</span>=1;a_t="2.0AACAfbwdAAAXAAAAso0QWAAAgH28HQAAAGDAs254kAoXAAAAYQJVTQ4FCVgA360us8BAklzLYNEHUd6kmHtRQX5a6hiZxKCynnycerLQ3gIkoJLOCQ==";z_c0=Mi4wQUFDQWZid2RBQUFBWU1DemJuaVFDaGNBQUFCaEFsVk5EZ1VKV0FEZnJTNnp3RUNTWE10ZzBRZFIzcVNZZTFGQmZn|<span class="number">1474887858</span>|64b4d<span class="number">4234</span>a21de774c42c837fe0b672fdb<span class="number">5763</span>b0'</span><br><span class="line">jar = requests.cookies.RequestsCookieJar()</span><br><span class="line">headers = &#123;</span><br><span class="line">    'Host': 'www.zhihu.com',</span><br><span class="line">    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.<span class="number">2785.11</span>6 Safari/537.36'</span><br><span class="line">&#125;</span><br><span class="line">for cookie in cookies.split(';'):</span><br><span class="line">    key, value = cookie.split('=', <span class="number">1</span>)</span><br><span class="line">    jar.set(key, value)</span><br><span class="line">r = requests.get(<span class="string">"http://www.zhihu.com"</span>, cookies=jar, headers=headers)</span><br><span class="line">print(r.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们首先新建了一个<code>RequestCookieJar</code>对象，然后将复制下来的<code>cookies</code>利用<code>split()</code>方法分割，接着利用<code>set()</code>方法设置好每个Cookie的<code>key</code>和<code>value</code>，然后通过调用requests的<code>get()</code>方法并传递给<code>cookies</code>参数即可。当然，由于知乎本身的限制，<code>headers</code>参数也不能少，只不过不需要在原来的<code>headers</code>参数里面设置<code>cookie</code>字段了。</p>
                  <p>测试后，发现同样可以正常登录知乎。</p>
                  <h2 id="3-会话维持"><a href="#3-会话维持" class="headerlink" title="3. 会话维持"></a>3. 会话维持</h2>
                  <p>在requests中，如果直接利用<code>get()</code>或<code>post()</code>等方法的确可以做到模拟网页的请求，但是这实际上是相当于不同的会话，也就是说相当于你用了两个浏览器打开了不同的页面。</p>
                  <p>设想这样一个场景，第一个请求利用<code>post()</code>方法登录了某个网站，第二次想获取成功登录后的自己的个人信息，你又用了一次<code>get()</code>方法去请求个人信息页面。实际上，这相当于打开了两个浏览器，是两个完全不相关的会话，能成功获取个人信息吗？那当然不能。</p>
                  <p>有小伙伴可能说了，我在两次请求时设置一样的<code>cookies</code>不就行了？可以，但这样做起来显得很烦琐，我们有更简单的解决方法。</p>
                  <p>其实解决这个问题的主要方法就是维持同一个会话，也就是相当于打开一个新的浏览器选项卡而不是新开一个浏览器。但是我又不想每次设置<code>cookies</code>，那该怎么办呢？这时候就有了新的利器——<code>Session</code>对象。</p>
                  <p>利用它，我们可以方便地维护一个会话，而且不用担心<code>cookies</code>的问题，它会帮我们自动处理好。示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">requests.<span class="builtin-name">get</span>(<span class="string">'http://httpbin.org/cookies/set/number/123456789'</span>)</span><br><span class="line">r = requests.<span class="builtin-name">get</span>(<span class="string">'http://httpbin.org/cookies'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(r.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们请求了一个测试网址<span class="exturl" data-url="aHR0cDovL2h0dHBiaW4ub3JnL2Nvb2tpZXMvc2V0L251bWJlci8xMjM0NTY3ODk=">http://httpbin.org/cookies/set/number/123456789<i class="fa fa-external-link-alt"></i></span>。请求这个网址时，可以设置一个cookie，名称叫作number，内容是123456789，随后又请求了<span class="exturl" data-url="aHR0cDovL2h0dHBiaW4ub3JnL2Nvb2tpZXM=">http://httpbin.org/cookies<i class="fa fa-external-link-alt"></i></span>，此网址可以获取当前的Cookies。</p>
                  <p>这样能成功获取到设置的Cookies吗？试试看。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"cookies"</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这并不行。我们再用<code>Session</code>试试看：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line">s.<span class="builtin-name">get</span>(<span class="string">'http://httpbin.org/cookies/set/number/123456789'</span>)</span><br><span class="line">r = s.<span class="builtin-name">get</span>(<span class="string">'http://httpbin.org/cookies'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(r.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>再看下运行结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"cookies"</span>: &#123;</span><br><span class="line">    <span class="attr">"number"</span>: <span class="string">"123456789"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>成功获取！这下能体会到同一个会话和不同会话的区别了吧！</p>
                  <p>所以，利用<code>Session</code>，可以做到模拟同一个会话而不用担心Cookies的问题。它通常用于模拟登录成功之后再进行下一步的操作。</p>
                  <p><code>Session</code>在平常用得非常广泛，可以用于模拟在一个浏览器中打开同一站点的不同页面，后面会有专门的章节来讲解这部分内容。</p>
                  <h2 id="4-SSL证书验证"><a href="#4-SSL证书验证" class="headerlink" title="4. SSL证书验证"></a>4. SSL证书验证</h2>
                  <p>此外，requests还提供了证书验证的功能。当发送HTTP请求的时候，它会检查SSL证书，我们可以使用<code>verify</code>参数控制是否检查此证书。其实如果不加<code>verify</code>参数的话，默认是<code>True</code>，会自动验证。</p>
                  <p>前面我们提到过，12306的证书没有被官方CA机构信任，会出现证书验证错误的结果。我们现在访问它，都可以看到一个证书问题的页面，如图3-8所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/3-8.png" alt="">图3-8 错误页面</p>
                  <p>现在我们用requests来测试一下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">response = requests.<span class="builtin-name">get</span>(<span class="string">'https://www.12306.cn'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(response.status_code)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">requests</span><span class="selector-class">.exceptions</span><span class="selector-class">.SSLError</span>: ("<span class="selector-tag">bad</span> <span class="selector-tag">handshake</span>: <span class="selector-tag">Error</span>(<span class="selector-attr">[(<span class="string">'SSL routines'</span>, <span class="string">'tls_process_server_certificate'</span>, <span class="string">'certificate verify failed'</span>)]</span>,)",)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里提示一个错误<code>SSLError</code>，表示证书验证错误。所以，如果请求一个HTTPS站点，但是证书验证错误的页面时，就会报这样的错误，那么如何避免这个错误呢？很简单，把<code>verify</code>参数设置为<code>False</code>即可。相关代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">response = requests.<span class="builtin-name">get</span>(<span class="string">'https://www.12306.cn'</span>, <span class="attribute">verify</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="builtin-name">print</span>(response.status_code)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就会打印出请求成功的状态码：</p>
                  <figure class="highlight crystal">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">/usr/local/<span class="class"><span class="keyword">lib</span>/<span class="title">python3</span>.6/<span class="title">site</span>-<span class="title">packages</span>/<span class="title">urllib3</span>/<span class="title">connectionpool</span>.<span class="title">py</span>:852: <span class="title">InsecureRequestWarning</span>: <span class="title">Unverified</span> <span class="title">HTTPS</span> <span class="title">request</span> <span class="title">is</span> <span class="title">being</span> <span class="title">made</span>. <span class="title">Adding</span> <span class="title">certificate</span> <span class="title">verification</span> <span class="title">is</span> <span class="title">strongly</span> <span class="title">advised</span>. <span class="title">See</span>: <span class="title">https</span>://<span class="title">urllib3</span>.<span class="title">readthedocs</span>.<span class="title">io</span>/<span class="title">en</span>/<span class="title">latest</span>/<span class="title">advanced</span>-<span class="title">usage</span>.<span class="title">html</span><span class="comment">#ssl-warnings</span></span></span><br><span class="line">  InsecureRequestWarning)</span><br><span class="line"><span class="number">200</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>不过我们发现报了一个警告，它建议我们给它指定证书。我们可以通过设置忽略警告的方式来屏蔽这个警告：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"><span class="keyword">from</span> requests.packages import urllib3</span><br><span class="line"></span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line">response = requests.<span class="builtin-name">get</span>(<span class="string">'https://www.12306.cn'</span>, <span class="attribute">verify</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="builtin-name">print</span>(response.status_code)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或者通过捕获警告到日志的方式忽略警告：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line">import requests</span><br><span class="line">logging.captureWarnings(<span class="literal">True</span>)</span><br><span class="line">response = requests.<span class="builtin-name">get</span>(<span class="string">'https://www.12306.cn'</span>, <span class="attribute">verify</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="builtin-name">print</span>(response.status_code)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然，我们也可以指定一个本地证书用作客户端证书，这可以是单个文件（包含密钥和证书）或一个包含两个文件路径的元组：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">response = requests.<span class="builtin-name">get</span>(<span class="string">'https://www.12306.cn'</span>, cert=(<span class="string">'/path/server.crt'</span>, <span class="string">'/path/key'</span>))</span><br><span class="line"><span class="builtin-name">print</span>(response.status_code)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然，上面的代码是演示实例，我们需要有crt和key文件，并且指定它们的路径。注意，本地私有证书的<code>key</code>必须是解密状态，加密状态的<code>key</code>是不支持的。</p>
                  <h2 id="5-代理设置"><a href="#5-代理设置" class="headerlink" title="5. 代理设置"></a>5. 代理设置</h2>
                  <p>对于某些网站，在测试的时候请求几次，能正常获取内容。但是一旦开始大规模爬取，对于大规模且频繁的请求，网站可能会弹出验证码，或者跳转到登录认证页面，更甚者可能会直接封禁客户端的IP，导致一定时间段内无法访问。</p>
                  <p>那么，为了防止这种情况发生，我们需要设置代理来解决这个问题，这就需要用到<code>proxies</code>参数。可以用这样的方式设置：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">  <span class="string">"http"</span>: <span class="string">"http://10.10.1.10:3128"</span>,</span><br><span class="line">  <span class="string">"https"</span>: <span class="string">"http://10.10.1.10:1080"</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requests.<span class="builtin-name">get</span>(<span class="string">"https://www.taobao.com"</span>, <span class="attribute">proxies</span>=proxies)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然，直接运行这个实例可能不行，因为这个代理可能是无效的，请换成自己的有效代理试验一下。</p>
                  <p>若代理需要使用HTTP Basic Auth，可以使用类似<span class="exturl" data-url="aHR0cDovL3VzZXI6cGFzc3dvcmRAaG9zdDpwb3J06L+Z5qC355qE6K+t5rOV5p2l6K6+572u5Luj55CG77yM56S65L6L5aaC5LiL77ya">http://user:password@host:port这样的语法来设置代理，示例如下：<i class="fa fa-external-link-alt"></i></span></p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">"http"</span>: <span class="string">"http://user:password@10.10.1.10:3128/"</span>,</span><br><span class="line">&#125;</span><br><span class="line">requests.<span class="builtin-name">get</span>(<span class="string">"https://www.taobao.com"</span>, <span class="attribute">proxies</span>=proxies)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>除了基本的HTTP代理外，requests还支持SOCKS协议的代理。</p>
                  <p>首先，需要安装socks这个库：</p>
                  <figure class="highlight nginx">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">pip3</span> install <span class="string">'requests[socks]'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后就可以使用SOCKS协议代理了，示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'socks5://user:password@host:port'</span>,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'socks5://user:password@host:port'</span></span><br><span class="line">&#125;</span><br><span class="line">requests.<span class="builtin-name">get</span>(<span class="string">"https://www.taobao.com"</span>, <span class="attribute">proxies</span>=proxies)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="6-超时设置"><a href="#6-超时设置" class="headerlink" title="6. 超时设置"></a>6. 超时设置</h2>
                  <p>在本机网络状况不好或者服务器网络响应太慢甚至无响应时，我们可能会等待特别久的时间才可能收到响应，甚至到最后收不到响应而报错。为了防止服务器不能及时响应，应该设置一个超时时间，即超过了这个时间还没有得到响应，那就报错。这需要用到<code>timeout</code>参数。这个时间的计算是发出请求到服务器返回响应的时间。示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">r = requests.<span class="builtin-name">get</span>(<span class="string">"https://www.taobao.com"</span>, timeout = 1)</span><br><span class="line"><span class="builtin-name">print</span>(r.status_code)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过这样的方式，我们可以将超时时间设置为1秒，如果1秒内没有响应，那就抛出异常。</p>
                  <p>实际上，请求分为两个阶段，即连接（connect）和读取（read）。</p>
                  <p>上面设置的<code>timeout</code>将用作连接和读取这二者的<code>timeout</code>总和。</p>
                  <p>如果要分别指定，就可以传入一个元组：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">r = requests.<span class="keyword">get</span>(<span class="string">'https://www.taobao.com'</span>, timeout=(<span class="number">5</span>,<span class="number">11</span>, <span class="number">30</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果想永久等待，可以直接将<code>timeout</code>设置为<code>None</code>，或者不设置直接留空，因为默认是<code>None</code>。这样的话，如果服务器还在运行，但是响应特别慢，那就慢慢等吧，它永远不会返回超时错误的。其用法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">r = requests.<span class="builtin-name">get</span>(<span class="string">'https://www.taobao.com'</span>, <span class="attribute">timeout</span>=None)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或直接不加参数：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">r</span> = requests.get(<span class="string">'https://www.taobao.com'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="7-身份认证"><a href="#7-身份认证" class="headerlink" title="7. 身份认证"></a>7. 身份认证</h2>
                  <p>在访问网站时，我们可能会遇到这样的认证页面，如图3-9所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/3-9.jpg" alt="">图3-9 认证页面</p>
                  <p>此时可以使用requests自带的身份认证功能，示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"><span class="keyword">from</span> requests.auth import HTTPBasicAuth</span><br><span class="line"></span><br><span class="line">r = requests.<span class="builtin-name">get</span>(<span class="string">'http://localhost:5000'</span>, <span class="attribute">auth</span>=HTTPBasicAuth('username', <span class="string">'password'</span>))</span><br><span class="line"><span class="builtin-name">print</span>(r.status_code)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果用户名和密码正确的话，请求时就会自动认证成功，会返回200状态码，如果认证失败，则返回401状态码。</p>
                  <p>当然，如果参数都传一个<code>HTTPBasicAuth</code>类，就显得有点烦琐了，所以requests提供了一个更简单的写法，可以直接传一个元组，它会默认使用<code>HTTPBasicAuth</code>这个类来认证。</p>
                  <p>所以上面的代码可以直接简写如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">r = requests.<span class="builtin-name">get</span>(<span class="string">'http://localhost:5000'</span>, auth=(<span class="string">'username'</span>, <span class="string">'password'</span>))</span><br><span class="line"><span class="builtin-name">print</span>(r.status_code)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此外，requests还提供了其他认证方式，如OAuth认证，不过此时需要安装oauth包，安装命令如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> requests_oauthlib</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>使用OAuth1认证的方法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"><span class="keyword">from</span> requests_oauthlib import OAuth1</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://api.twitter.com/1.1/account/verify_credentials.json'</span></span><br><span class="line">auth = OAuth1(<span class="string">'YOUR_APP_KEY'</span>, <span class="string">'YOUR_APP_SECRET'</span>,</span><br><span class="line">              <span class="string">'USER_OAUTH_TOKEN'</span>, <span class="string">'USER_OAUTH_TOKEN_SECRET'</span>)</span><br><span class="line">requests.<span class="builtin-name">get</span>(url, <span class="attribute">auth</span>=auth)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>更多详细的功能可以参考requests_oauthlib的官方文档<span class="exturl" data-url="aHR0cHM6Ly9yZXF1ZXN0cy1vYXV0aGxpYi5yZWFkdGhlZG9jcy5vcmcv">https://requests-oauthlib.readthedocs.org/<i class="fa fa-external-link-alt"></i></span>，在此不再赘述了。</p>
                  <h2 id="8-Prepared-Request"><a href="#8-Prepared-Request" class="headerlink" title="8. Prepared Request"></a>8. Prepared Request</h2>
                  <p>前面介绍urllib时，我们可以将请求表示为数据结构，其中各个参数都可以通过一个<code>Request</code>对象来表示。这在requests里同样可以做到，这个数据结构就叫Prepared Request。我们用实例看一下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> requests import Request, Session</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://httpbin.org/post'</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'germey'</span></span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">s = Session()</span><br><span class="line">req = Request(<span class="string">'POST'</span>, url, <span class="attribute">data</span>=data, <span class="attribute">headers</span>=headers)</span><br><span class="line">prepped = s.prepare_request(req)</span><br><span class="line">r = s.send(prepped)</span><br><span class="line"><span class="builtin-name">print</span>(r.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们引入了<code>Request</code>，然后用<code>url</code>、<code>data</code>和<code>headers</code>参数构造了一个<code>Request</code>对象，这时需要再调用<code>Session</code>的<code>prepare_request()</code>方法将其转换为一个Prepared Request对象，然后调用<code>send()</code>方法发送即可，运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"data"</span>: <span class="string">""</span>, </span><br><span class="line">  <span class="attr">"files"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"form"</span>: &#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"germey"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"*/*"</span>, </span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="attr">"Connection"</span>: <span class="string">"close"</span>, </span><br><span class="line">    <span class="attr">"Content-Length"</span>: <span class="string">"11"</span>, </span><br><span class="line">    <span class="attr">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"json"</span>: <span class="literal">null</span>, </span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"182.32.203.166"</span>, </span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"http://httpbin.org/post"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，我们达到了同样的POST请求效果。</p>
                  <p>有了<code>Request</code>这个对象，就可以将请求当作独立的对象来看待，这样在进行队列调度时会非常方便。后面我们会用它来构造一个<code>Request</code>队列。</p>
                  <p>本节讲解了requests的一些高级用法，这些用法在后面实战部分会经常用到，需要熟练掌握。更多的用法可以参考requests的官方文档：<span class="exturl" data-url="aHR0cDovL2RvY3MucHl0aG9uLXJlcXVlc3RzLm9yZy8=">http://docs.python-requests.org/<i class="fa fa-external-link-alt"></i></span>。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-27 14:26:20" itemprop="dateCreated datePublished" datetime="2018-01-27T14:26:20+08:00">2018-01-27</time>
                </span>
                <span id="/5523.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 3.2.2-高级用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>10k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>9 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5517.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5517.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 3.2.1-基本用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h2>
                  <p>在开始之前，请确保已经正确安装好了requests库。如果没有安装，可以参考1.2.1节安装。</p>
                  <h2 id="2-实例引入"><a href="#2-实例引入" class="headerlink" title="2. 实例引入"></a>2. 实例引入</h2>
                  <p>urllib库中的<code>urlopen()</code>方法实际上是以GET方式请求网页，而requests中相应的方法就是<code>get()</code>方法，是不是感觉表达更明确一些？下面通过实例来看一下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'https://www.baidu.com/'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(type(r)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(r.status_code)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(type(r.text)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(r.text)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(r.cookies)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight django">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">class</span> '<span class="attr">requests.models.Response</span>'&gt;</span></span></span><br><span class="line"><span class="xml">200</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">class</span> '<span class="attr">str</span>'&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml">        location.replace(location.href.replace("https://","http://"));</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"0;url=http://www.baidu.com/"</span>&gt;</span><span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">RequestsCookieJar[</span>&lt;<span class="attr">Cookie</span> <span class="attr">BIDUPSID</span>=<span class="string">992C3B26F4C4D09505C5E959D5FBC005</span> <span class="attr">for</span> <span class="attr">.baidu.com</span>/&gt;</span>, <span class="tag">&lt;<span class="name">Cookie</span> <span class="attr">PSTM</span>=<span class="string">1472227535</span> <span class="attr">for</span> <span class="attr">.baidu.com</span>/&gt;</span>, <span class="tag">&lt;<span class="name">Cookie</span> <span class="attr">__bsi</span>=<span class="string">15304754498609545148_00_40_N_N_2_0303_C02F_N_N_N_0</span> <span class="attr">for</span> <span class="attr">.www.baidu.com</span>/&gt;</span>, <span class="tag">&lt;<span class="name">Cookie</span> <span class="attr">BD_NOT_HTTPS</span>=<span class="string">1</span> <span class="attr">for</span> <span class="attr">www.baidu.com</span>/&gt;</span>]&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们调用<code>get()</code>方法实现与<code>urlopen()</code>相同的操作，得到一个<code>Response</code>对象，然后分别输出了<code>Response</code>的类型、状态码、响应体的类型、内容以及Cookies。</p>
                  <p>通过运行结果可以发现，它的返回类型是<code>requests.models.Response</code>，响应体的类型是字符串<code>str</code>，Cookies的类型是<code>RequestsCookieJar</code>。</p>
                  <p>使用<code>get()</code>方法成功实现一个GET请求，这倒不算什么，更方便之处在于其他的请求类型依然可以用一句话来完成，示例如下：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">r</span> = requests.post(<span class="string">'http://httpbin.org/post'</span>)</span><br><span class="line"><span class="attr">r</span> = requests.put(<span class="string">'http://httpbin.org/put'</span>)</span><br><span class="line"><span class="attr">r</span> = requests.delete(<span class="string">'http://httpbin.org/delete'</span>)</span><br><span class="line"><span class="attr">r</span> = requests.head(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line"><span class="attr">r</span> = requests.options(<span class="string">'http://httpbin.org/get'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里分别用<code>post()</code>、<code>put()</code>、<code>delete()</code>等方法实现了POST、PUT、DELETE等请求。是不是比urllib简单太多了？</p>
                  <p>其实这只是冰山一角，更多的还在后面。</p>
                  <h2 id="3-GET请求"><a href="#3-GET请求" class="headerlink" title="3. GET请求"></a>3. GET请求</h2>
                  <p>HTTP中最常见的请求之一就是GET请求，下面首先来详细了解一下利用requests构建GET请求的方法。</p>
                  <h3 id="基本实例"><a href="#基本实例" class="headerlink" title="基本实例"></a>基本实例</h3>
                  <p>首先，构建一个最简单的GET请求，请求的链接为<span class="exturl" data-url="aHR0cDovL2VwdWIuaXR1cmluZy5jb20uY24vYXJ0aWNsZS9lZGl0L1todHRwOi8vaHR0cGJpbi5vcmcvZ2V0">http://httpbin.org/get<i class="fa fa-external-link-alt"></i></span>，该网站会判断如果客户端发起的是GET请求的话，它返回相应的请求信息：</p>
                  <figure class="highlight processing">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.<span class="built_in">get</span>(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line"><span class="built_in">print</span>(r.<span class="built_in">text</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"*/*"</span>, </span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"python-requests/2.10.0"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"122.4.215.33"</span>, </span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"http://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，我们成功发起了GET请求，返回结果中包含请求头、URL、IP等信息。</p>
                  <p>那么，对于GET请求，如果要附加额外的信息，一般怎样添加呢？比如现在想添加两个参数，其中<code>name</code>是<code>germey</code>，<code>age</code>是22。要构造这个请求链接，是不是要直接写成：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">r</span> = requests.get(<span class="string">'http://httpbin.org/get?name=germey&amp;age=22'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样也可以，但是是不是有点不人性化呢？一般情况下，这种信息数据会用字典来存储。那么，怎样来构造这个链接呢？</p>
                  <p>这同样很简单，利用<code>params</code>这个参数就好了，示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'germey'</span>,</span><br><span class="line">    <span class="string">'age'</span>: 22</span><br><span class="line">&#125;</span><br><span class="line">r = requests.<span class="builtin-name">get</span>(<span class="string">"http://httpbin.org/get"</span>, <span class="attribute">params</span>=data)</span><br><span class="line"><span class="builtin-name">print</span>(r.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;</span><br><span class="line">    <span class="attr">"age"</span>: <span class="string">"22"</span>, </span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"germey"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"*/*"</span>, </span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"python-requests/2.10.0"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"122.4.215.33"</span>, </span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"http://httpbin.org/get?age=22&amp;name=germey"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过运行结果可以判断，请求的链接自动被构造成了：<span class="exturl" data-url="aHR0cDovL2h0dHBiaW4ub3JnL2dldD9hZ2U9MjImYW1wO25hbWU9Z2VybWV5">http://httpbin.org/get?age=22&amp;name=germey<i class="fa fa-external-link-alt"></i></span>。</p>
                  <p>另外，网页的返回类型实际上是<code>str</code>类型，但是它很特殊，是JSON格式的。所以，如果想直接解析返回结果，得到一个字典格式的话，可以直接调用<code>json()</code>方法。示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">"http://httpbin.org/get"</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(type(r.text)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(r.json()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(type(r.json()</span></span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight ceylon">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;<span class="keyword">class</span> <span class="string">'str'</span>&gt;</span><br><span class="line">&#123;<span class="string">'headers'</span>: &#123;<span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span>, <span class="string">'Accept'</span>: <span class="string">'*/*'</span>, <span class="string">'Host'</span>: <span class="string">'httpbin.org'</span>, <span class="string">'User-Agent'</span>: <span class="string">'python-requests/2.10.0'</span>&#125;, <span class="string">'url'</span>: <span class="string">'http://httpbin.org/get'</span>, <span class="string">'args'</span>: &#123;&#125;, <span class="string">'origin'</span>: <span class="string">'182.33.248.131'</span>&#125;</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">'dict'</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，调用<code>json()</code>方法，就可以将返回结果是JSON格式的字符串转化为字典。</p>
                  <p>但需要注意的书，如果返回结果不是JSON格式，便会出现解析错误，抛出<code>json.decoder.JSONDecodeError</code>异常。</p>
                  <h3 id="抓取网页"><a href="#抓取网页" class="headerlink" title="抓取网页"></a>抓取网页</h3>
                  <p>上面的请求链接返回的是JSON形式的字符串，那么如果请求普通的网页，则肯定能获得相应的内容了。下面以“知乎”→“发现”页面为例来看一下：</p>
                  <figure class="highlight roboconf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    '<span class="attribute">User-Agent'</span>: 'Mozilla/5.0 (Macintosh; <span class="attribute">Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36'</span></span><br><span class="line"><span class="attribute">&#125;</span></span><br><span class="line"><span class="attribute">r = requests.get("https</span>://www<span class="variable">.zhihu</span><span class="variable">.com</span>/explore", headers=headers)</span><br><span class="line">pattern = re<span class="variable">.compile</span>('explore-feed.*?question_link.*?&gt;(.*?)&lt;/a&gt;', re<span class="variable">.S</span>)</span><br><span class="line">titles = re<span class="variable">.findall</span>(pattern, r<span class="variable">.text</span>)</span><br><span class="line">print(titles)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们加入了<code>headers</code>信息，其中包含了<code>User-Agent</code>字段信息，也就是浏览器标识信息。如果不加这个，知乎会禁止抓取。</p>
                  <p>接下来我们用到了最基础的正则表达式来匹配出所有的问题内容。关于正则表达式的相关内容，我们会在3.3节中详细介绍，这里作为实例来配合讲解。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">['\n为什么很多人喜欢提及「拉丁语系」这个词？\n', '\n在没有水的情况下水系宝可梦如何战斗？\n', '\n有哪些经验可以送给 Kindle 新人？\n', '\n谷歌的广告业务是如何赚钱的？\n', '\n程序员该学习什么，能在上学期间挣钱？\n', '\n有哪些原本只是一个小消息，但回看发现是个惊天大新闻的例子？\n', '\n如何评价今敏？\n', '\n源氏是怎么把那么长的刀从背后拔出来的？\n', '\n年轻时得了绝症或大病是怎样的感受？\n', '\n年轻时得了绝症或大病是怎样的感受？\n']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们发现，这里成功提取出了所有的问题内容。</p>
                  <h3 id="抓取二进制数据"><a href="#抓取二进制数据" class="headerlink" title="抓取二进制数据"></a>抓取二进制数据</h3>
                  <p>在上面的例子中，我们抓取的是知乎的一个页面，实际上它返回的是一个HTML文档。如果想抓去图片、音频、视频等文件，应该怎么办呢？</p>
                  <p>图片、音频、视频这些文件本质上都是由二进制码组成的，由于有特定的保存格式和对应的解析方式，我们才可以看到这些形形色色的多媒体。所以，想要抓取它们，就要拿到它们的二进制码。</p>
                  <p>下面以GitHub的站点图标为例来看一下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">r = requests.<span class="builtin-name">get</span>(<span class="string">"https://github.com/favicon.ico"</span>)</span><br><span class="line"><span class="builtin-name">print</span>(r.text)</span><br><span class="line"><span class="builtin-name">print</span>(r.content)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里抓取的内容是站点图标，也就是在浏览器每一个标签上显示的小图标，如图3-3所示。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/3-3.png" alt="">图3-3 站点图标</p>
                  <p>这里打印了<code>Response</code>对象的两个属性，一个是<code>text</code>，另一个是<code>content</code>。</p>
                  <p>运行结果如图3-4所示，其中前两行是<code>r.text</code>的结果，最后一行是<code>r.content</code>的结果。</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/3-4.png" alt="">图3-4 运行结果</p>
                  <p>可以注意到，前者出现了乱码，后者结果前带有一个<code>b</code>，这代表是<code>bytes</code>类型的数据。由于图片是二进制数据，所以前者在打印时转化为<code>str</code>类型，也就是图片直接转化为字符串，这理所当然会出现乱码。</p>
                  <p>接着，我们将刚才提取到的图片保存下来：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">r = requests.<span class="built_in">get</span>(<span class="string">"https://github.com/favicon.ico"</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'favicon.ico'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.<span class="built_in">write</span>(r.content)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里用了<code>open()</code>方法，它的第一个参数是文件名称，第二个参数代表以二进制写的形式打开，可以向文件里写入二进制数据。</p>
                  <p>运行结束之后，可以发现在文件夹中出现了名为favicon.ico的图标，如图3-5所示。</p>
                  <p><a href="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/3-5.ico" target="_blank" rel="noopener"><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/3-5.ico" alt=""></a>图3-5 图标</p>
                  <p>同样地，音频和视频文件也可以用这种方法获取。</p>
                  <h3 id="添加headers"><a href="#添加headers" class="headerlink" title="添加headers"></a>添加<code>headers</code></h3>
                  <p>与<code>urllib.request</code>一样，我们也可以通过<code>headers</code>参数来传递头信息。</p>
                  <p>比如，在上面“知乎”的例子中，如果不传递<code>headers</code>，就不能正常请求：</p>
                  <figure class="highlight arduino">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.<span class="built_in">get</span>(<span class="string">"https://www.zhihu.com/explore"</span>)</span><br><span class="line"><span class="built_in">print</span>(r.<span class="built_in">text</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>500 Server Error<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">An internal server error occured.</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但如果加上<code>headers</code>并加上<code>User-Agent</code>信息，那就没问题了：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">r = requests.<span class="builtin-name">get</span>(<span class="string">"https://www.zhihu.com/explore"</span>, <span class="attribute">headers</span>=headers)</span><br><span class="line"><span class="builtin-name">print</span>(r.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然，我们可以在<code>headers</code>这个参数中任意添加其他的字段信息。</p>
                  <h2 id="4-POST请求"><a href="#4-POST请求" class="headerlink" title="4. POST请求"></a>4. POST请求</h2>
                  <p>前面我们了解了最基本的GET请求，另外一种比较常见的请求方式是POST。使用<code>requests</code>实现POST请求同样非常简单，示例如下：</p>
                  <figure class="highlight xl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> = &#123;<span class="string">'name'</span>: <span class="string">'germey'</span>, <span class="string">'age'</span>: <span class="string">'22'</span>&#125;</span><br><span class="line">r = requests.post(<span class="string">"http://httpbin.org/post"</span>, <span class="keyword">data</span>=<span class="keyword">data</span>)</span><br><span class="line">print(r.<span class="keyword">text</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里还是请求<span class="exturl" data-url="aHR0cDovL2h0dHBiaW4ub3JnL3Bvc3Q=">http://httpbin.org/post<i class="fa fa-external-link-alt"></i></span>，该网站可以判断如果请求是POST方式，就把相关请求信息返回。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"data"</span>: <span class="string">""</span>, </span><br><span class="line">  <span class="attr">"files"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"form"</span>: &#123;</span><br><span class="line">    <span class="attr">"age"</span>: <span class="string">"22"</span>, </span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"germey"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"*/*"</span>, </span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="attr">"Content-Length"</span>: <span class="string">"18"</span>, </span><br><span class="line">    <span class="attr">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"python-requests/2.10.0"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"json"</span>: <span class="literal">null</span>, </span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"182.33.248.131"</span>, </span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"http://httpbin.org/post"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，我们成功获得了返回结果，其中<code>form</code>部分就是提交的数据，这就证明POST请求成功发送了。</p>
                  <h2 id="5-响应"><a href="#5-响应" class="headerlink" title="5. 响应"></a>5. 响应</h2>
                  <p>发送请求后，得到的自然就是响应。在上面的实例中，我们使用<code>text</code>和<code>content</code>获取了响应的内容。此外，还有很多属性和方法可以用来获取其他信息，比如状态码、响应头、Cookies等。示例如下：</p>
                  <figure class="highlight haskell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="title">r</span> = requests.get('http://www.jianshu.com')</span><br><span class="line"><span class="title">print</span>(<span class="class"><span class="keyword">type</span>(<span class="title">r</span>.<span class="title">status_code</span>), r.status_code)</span></span><br><span class="line"><span class="title">print</span>(<span class="class"><span class="keyword">type</span>(<span class="title">r</span>.<span class="title">headers</span>), r.headers)</span></span><br><span class="line"><span class="title">print</span>(<span class="class"><span class="keyword">type</span>(<span class="title">r</span>.<span class="title">cookies</span>), r.cookies)</span></span><br><span class="line"><span class="title">print</span>(<span class="class"><span class="keyword">type</span>(<span class="title">r</span>.<span class="title">url</span>), r.url)</span></span><br><span class="line"><span class="title">print</span>(<span class="class"><span class="keyword">type</span>(<span class="title">r</span>.<span class="title">history</span>), r.history)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里分别打印输出<code>status_code</code>属性得到状态码，输出<code>headers</code>属性得到响应头，输出<code>cookies</code>属性得到Cookies，输出<code>url</code>属性得到URL，输出<code>history</code>属性得到请求历史。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight kotlin">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">int</span>'&gt; 200</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">requests</span>.<span class="title">structures</span>.<span class="title">CaseInsensitiveDict</span>'&gt; </span>&#123;<span class="string">'X-Runtime'</span>: <span class="string">'0.006363'</span>, <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span>, <span class="string">'Content-Type'</span>: <span class="string">'text/html; charset=utf-8'</span>, <span class="string">'X-Content-Type-Options'</span>: <span class="string">'nosniff'</span>, <span class="string">'Date'</span>: <span class="string">'Sat, 27 Aug 2016 17:18:51 GMT'</span>, <span class="string">'Server'</span>: <span class="string">'nginx'</span>, <span class="string">'X-Frame-Options'</span>: <span class="string">'DENY'</span>, <span class="string">'Content-Encoding'</span>: <span class="string">'gzip'</span>, <span class="string">'Vary'</span>: <span class="string">'Accept-Encoding'</span>, <span class="string">'ETag'</span>: <span class="string">'W/"3abda885e0e123bfde06d9b61e696159"'</span>, <span class="string">'X-XSS-Protection'</span>: <span class="string">'1; mode=block'</span>, <span class="string">'X-Request-Id'</span>: <span class="string">'a8a3c4d5-f660-422f-8df9-49719dd9b5d4'</span>, <span class="string">'Transfer-Encoding'</span>: <span class="string">'chunked'</span>, <span class="string">'Set-Cookie'</span>: <span class="string">'read_mode=day; path=/, default_font=font2; path=/, _session_id=xxx; path=/; HttpOnly'</span>, <span class="string">'Cache-Control'</span>: <span class="string">'max-age=0, private, must-revalidate'</span>&#125;</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">requests</span>.<span class="title">cookies</span>.<span class="title">RequestsCookieJar</span>'&gt; &lt;<span class="type">RequestsCookieJar[&lt;Cookie _session_id=xxx for www.jianshu.com/</span>&gt;, <span class="type"></span>&lt;<span class="type">Cookie default_font=font2 for www.jianshu.com/</span>&gt;, <span class="type"></span>&lt;<span class="type">Cookie read_mode=day for www.jianshu.com/</span>&gt;]&gt;</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt; <span class="title">http</span>:<span class="type">//www.jianshu.com/</span></span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">list</span>'&gt; []</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>因为<code>session_id</code>过长，在此简写。可以看到，<code>headers</code>和<code>cookies</code>这两个属性得到的结果分别是<code>CaseInsensitiveDict</code>和<code>RequestsCookieJar</code>类型。</p>
                  <p>状态码常用来判断请求是否成功，而requests还提供了一个内置的状态码查询对象<code>requests.codes</code>，示例如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://www.jianshu.com'</span>)</span><br><span class="line"><span class="keyword">exit</span>() <span class="keyword">if</span> not r.status_code == requests.codes.ok <span class="keyword">else</span> print(<span class="string">'Request Successfully'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里通过比较返回码和内置的成功的返回码，来保证请求得到了正常响应，输出成功请求的消息，否则程序终止，这里我们用<code>requests.codes.ok</code>得到的是成功的状态码200。</p>
                  <p>那么，肯定不能只有<code>ok</code>这个条件码。下面列出了返回码和相应的查询条件：</p>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># 信息性状态码</span><br><span class="line"><span class="selector-tag">100</span>: (<span class="string">'continue'</span>,),</span><br><span class="line"><span class="selector-tag">101</span>: (<span class="string">'switching_protocols'</span>,),</span><br><span class="line"><span class="selector-tag">102</span>: (<span class="string">'processing'</span>,),</span><br><span class="line"><span class="selector-tag">103</span>: (<span class="string">'checkpoint'</span>,),</span><br><span class="line"><span class="selector-tag">122</span>: (<span class="string">'uri_too_long'</span>, <span class="string">'request_uri_too_long'</span>),</span><br><span class="line"></span><br><span class="line"># 成功状态码</span><br><span class="line"><span class="selector-tag">200</span>: (<span class="string">'ok'</span>, <span class="string">'okay'</span>, <span class="string">'all_ok'</span>, <span class="string">'all_okay'</span>, <span class="string">'all_good'</span>, <span class="string">'\\o/'</span>, <span class="string">'✓'</span>),</span><br><span class="line"><span class="selector-tag">201</span>: (<span class="string">'created'</span>,),</span><br><span class="line"><span class="selector-tag">202</span>: (<span class="string">'accepted'</span>,),</span><br><span class="line"><span class="selector-tag">203</span>: (<span class="string">'non_authoritative_info'</span>, <span class="string">'non_authoritative_information'</span>),</span><br><span class="line"><span class="selector-tag">204</span>: (<span class="string">'no_content'</span>,),</span><br><span class="line"><span class="selector-tag">205</span>: (<span class="string">'reset_content'</span>, <span class="string">'reset'</span>),</span><br><span class="line"><span class="selector-tag">206</span>: (<span class="string">'partial_content'</span>, <span class="string">'partial'</span>),</span><br><span class="line"><span class="selector-tag">207</span>: (<span class="string">'multi_status'</span>, <span class="string">'multiple_status'</span>, <span class="string">'multi_stati'</span>, <span class="string">'multiple_stati'</span>),</span><br><span class="line"><span class="selector-tag">208</span>: (<span class="string">'already_reported'</span>,),</span><br><span class="line"><span class="selector-tag">226</span>: (<span class="string">'im_used'</span>,),</span><br><span class="line"></span><br><span class="line"># 重定向状态码</span><br><span class="line"><span class="selector-tag">300</span>: (<span class="string">'multiple_choices'</span>,),</span><br><span class="line"><span class="selector-tag">301</span>: (<span class="string">'moved_permanently'</span>, <span class="string">'moved'</span>, <span class="string">'\\o-'</span>),</span><br><span class="line"><span class="selector-tag">302</span>: (<span class="string">'found'</span>,),</span><br><span class="line"><span class="selector-tag">303</span>: (<span class="string">'see_other'</span>, <span class="string">'other'</span>),</span><br><span class="line"><span class="selector-tag">304</span>: (<span class="string">'not_modified'</span>,),</span><br><span class="line"><span class="selector-tag">305</span>: (<span class="string">'use_proxy'</span>,),</span><br><span class="line"><span class="selector-tag">306</span>: (<span class="string">'switch_proxy'</span>,),</span><br><span class="line"><span class="selector-tag">307</span>: (<span class="string">'temporary_redirect'</span>, <span class="string">'temporary_moved'</span>, <span class="string">'temporary'</span>),</span><br><span class="line"><span class="selector-tag">308</span>: (<span class="string">'permanent_redirect'</span>,</span><br><span class="line">      <span class="string">'resume_incomplete'</span>, <span class="string">'resume'</span>,), # <span class="selector-tag">These</span> <span class="selector-tag">2</span> <span class="selector-tag">to</span> <span class="selector-tag">be</span> <span class="selector-tag">removed</span> <span class="selector-tag">in</span> <span class="selector-tag">3</span><span class="selector-class">.0</span></span><br><span class="line"></span><br><span class="line"># 客户端错误状态码</span><br><span class="line"><span class="selector-tag">400</span>: (<span class="string">'bad_request'</span>, <span class="string">'bad'</span>),</span><br><span class="line"><span class="selector-tag">401</span>: (<span class="string">'unauthorized'</span>,),</span><br><span class="line"><span class="selector-tag">402</span>: (<span class="string">'payment_required'</span>, <span class="string">'payment'</span>),</span><br><span class="line"><span class="selector-tag">403</span>: (<span class="string">'forbidden'</span>,),</span><br><span class="line"><span class="selector-tag">404</span>: (<span class="string">'not_found'</span>, <span class="string">'-o-'</span>),</span><br><span class="line"><span class="selector-tag">405</span>: (<span class="string">'method_not_allowed'</span>, <span class="string">'not_allowed'</span>),</span><br><span class="line"><span class="selector-tag">406</span>: (<span class="string">'not_acceptable'</span>,),</span><br><span class="line"><span class="selector-tag">407</span>: (<span class="string">'proxy_authentication_required'</span>, <span class="string">'proxy_auth'</span>, <span class="string">'proxy_authentication'</span>),</span><br><span class="line"><span class="selector-tag">408</span>: (<span class="string">'request_timeout'</span>, <span class="string">'timeout'</span>),</span><br><span class="line"><span class="selector-tag">409</span>: (<span class="string">'conflict'</span>,),</span><br><span class="line"><span class="selector-tag">410</span>: (<span class="string">'gone'</span>,),</span><br><span class="line"><span class="selector-tag">411</span>: (<span class="string">'length_required'</span>,),</span><br><span class="line"><span class="selector-tag">412</span>: (<span class="string">'precondition_failed'</span>, <span class="string">'precondition'</span>),</span><br><span class="line"><span class="selector-tag">413</span>: (<span class="string">'request_entity_too_large'</span>,),</span><br><span class="line"><span class="selector-tag">414</span>: (<span class="string">'request_uri_too_large'</span>,),</span><br><span class="line"><span class="selector-tag">415</span>: (<span class="string">'unsupported_media_type'</span>, <span class="string">'unsupported_media'</span>, <span class="string">'media_type'</span>),</span><br><span class="line"><span class="selector-tag">416</span>: (<span class="string">'requested_range_not_satisfiable'</span>, <span class="string">'requested_range'</span>, <span class="string">'range_not_satisfiable'</span>),</span><br><span class="line"><span class="selector-tag">417</span>: (<span class="string">'expectation_failed'</span>,),</span><br><span class="line"><span class="selector-tag">418</span>: (<span class="string">'im_a_teapot'</span>, <span class="string">'teapot'</span>, <span class="string">'i_am_a_teapot'</span>),</span><br><span class="line"><span class="selector-tag">421</span>: (<span class="string">'misdirected_request'</span>,),</span><br><span class="line"><span class="selector-tag">422</span>: (<span class="string">'unprocessable_entity'</span>, <span class="string">'unprocessable'</span>),</span><br><span class="line"><span class="selector-tag">423</span>: (<span class="string">'locked'</span>,),</span><br><span class="line"><span class="selector-tag">424</span>: (<span class="string">'failed_dependency'</span>, <span class="string">'dependency'</span>),</span><br><span class="line"><span class="selector-tag">425</span>: (<span class="string">'unordered_collection'</span>, <span class="string">'unordered'</span>),</span><br><span class="line"><span class="selector-tag">426</span>: (<span class="string">'upgrade_required'</span>, <span class="string">'upgrade'</span>),</span><br><span class="line"><span class="selector-tag">428</span>: (<span class="string">'precondition_required'</span>, <span class="string">'precondition'</span>),</span><br><span class="line"><span class="selector-tag">429</span>: (<span class="string">'too_many_requests'</span>, <span class="string">'too_many'</span>),</span><br><span class="line"><span class="selector-tag">431</span>: (<span class="string">'header_fields_too_large'</span>, <span class="string">'fields_too_large'</span>),</span><br><span class="line"><span class="selector-tag">444</span>: (<span class="string">'no_response'</span>, <span class="string">'none'</span>),</span><br><span class="line"><span class="selector-tag">449</span>: (<span class="string">'retry_with'</span>, <span class="string">'retry'</span>),</span><br><span class="line"><span class="selector-tag">450</span>: (<span class="string">'blocked_by_windows_parental_controls'</span>, <span class="string">'parental_controls'</span>),</span><br><span class="line"><span class="selector-tag">451</span>: (<span class="string">'unavailable_for_legal_reasons'</span>, <span class="string">'legal_reasons'</span>),</span><br><span class="line"><span class="selector-tag">499</span>: (<span class="string">'client_closed_request'</span>,),</span><br><span class="line"></span><br><span class="line"># 服务端错误状态码</span><br><span class="line"><span class="selector-tag">500</span>: (<span class="string">'internal_server_error'</span>, <span class="string">'server_error'</span>, <span class="string">'/o\\'</span>, <span class="string">'✗'</span>),</span><br><span class="line"><span class="selector-tag">501</span>: (<span class="string">'not_implemented'</span>,),</span><br><span class="line"><span class="selector-tag">502</span>: (<span class="string">'bad_gateway'</span>,),</span><br><span class="line"><span class="selector-tag">503</span>: (<span class="string">'service_unavailable'</span>, <span class="string">'unavailable'</span>),</span><br><span class="line"><span class="selector-tag">504</span>: (<span class="string">'gateway_timeout'</span>,),</span><br><span class="line"><span class="selector-tag">505</span>: (<span class="string">'http_version_not_supported'</span>, <span class="string">'http_version'</span>),</span><br><span class="line"><span class="selector-tag">506</span>: (<span class="string">'variant_also_negotiates'</span>,),</span><br><span class="line"><span class="selector-tag">507</span>: (<span class="string">'insufficient_storage'</span>,),</span><br><span class="line"><span class="selector-tag">509</span>: (<span class="string">'bandwidth_limit_exceeded'</span>, <span class="string">'bandwidth'</span>),</span><br><span class="line"><span class="selector-tag">510</span>: (<span class="string">'not_extended'</span>,),</span><br><span class="line"><span class="selector-tag">511</span>: (<span class="string">'network_authentication_required'</span>, <span class="string">'network_auth'</span>, <span class="string">'network_authentication'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>比如，如果想判断结果是不是404状态，可以用<code>requests.codes.not_found</code>来比对。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-27 14:14:47" itemprop="dateCreated datePublished" datetime="2018-01-27T14:14:47+08:00">2018-01-27</time>
                </span>
                <span id="/5517.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 3.2.1-基本用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>11k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>10 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5514.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5514.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 3.2-使用requests</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>上一节中，我们了解了urllib的基本用法，但是其中确实有不方便的地方，比如处理网页验证和Cookies时，需要写<code>Opener</code>和<code>Handler</code>来处理。为了更加方便地实现这些操作，就有了更为强大的库requests，有了它，Cookies、登录验证、代理设置等操作都不是事儿。</p>
                  <p>接下来，让我们领略一下它的强大之处吧。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-27 14:12:28" itemprop="dateCreated datePublished" datetime="2018-01-27T14:12:28+08:00">2018-01-27</time>
                </span>
                <span id="/5514.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 3.2-使用requests" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>156</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5511.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5511.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 3.1.4-分析Robots协议</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>利用urllib的<code>robotparser</code>模块，我们可以实现网站Robots协议的分析。本节中，我们来简单了解一下该模块的用法。</p>
                  <h2 id="1-Robots协议"><a href="#1-Robots协议" class="headerlink" title="1. Robots协议"></a>1. Robots协议</h2>
                  <p>Robots协议也称作爬虫协议、机器人协议，它的全名叫作网络爬虫排除标准（Robots Exclusion Protocol），用来告诉爬虫和搜索引擎哪些页面可以抓取，哪些不可以抓取。它通常是一个叫作robots.txt的文本文件，一般放在网站的根目录下。</p>
                  <p>当搜索爬虫访问一个站点时，它首先会检查这个站点根目录下是否存在robots.txt文件，如果存在，搜索爬虫会根据其中定义的爬取范围来爬取。如果没有找到这个文件，搜索爬虫便会访问所有可直接访问的页面。</p>
                  <p>下面我们看一个robots.txt的样例：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">User-<span class="string">agent:</span> *</span><br><span class="line"><span class="string">Disallow:</span> /</span><br><span class="line"><span class="string">Allow:</span> <span class="regexp">/public/</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这实现了对所有搜索爬虫只允许爬取public目录的功能，将上述内容保存成robots.txt文件，放在网站的根目录下，和网站的入口文件（比如index.php、index.html和index.jsp等）放在一起。</p>
                  <p>上面的<code>User-agent</code>描述了搜索爬虫的名称，这里将其设置为*则代表该协议对任何爬取爬虫有效。比如，我们可以设置：</p>
                  <figure class="highlight dockerfile">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">User</span>-agent: Baiduspider</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这就代表我们设置的规则对百度爬虫是有效的。如果有多条<code>User-agent</code>记录，则就会有多个爬虫会受到爬取限制，但至少需要指定一条。</p>
                  <p><code>Disallow</code>指定了不允许抓取的目录，比如上例子中设置为/则代表不允许抓取所有页面。</p>
                  <p><code>Allow</code>一般和<code>Disallow</code>一起使用，一般不会单独使用，用来排除某些限制。现在我们设置为<code>/public/</code>，则表示所有页面不允许抓取，但可以抓取public目录。</p>
                  <p>下面我们再来看几个例子。禁止所有爬虫访问任何目录的代码如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">User-<span class="string">agent:</span> * </span><br><span class="line"><span class="string">Disallow:</span> /</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>允许所有爬虫访问任何目录的代码如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">User-<span class="string">agent:</span> *</span><br><span class="line"><span class="string">Disallow:</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外，直接把robots.txt文件留空也是可以的。</p>
                  <p>禁止所有爬虫访问网站某些目录的代码如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">User-<span class="string">agent:</span> *</span><br><span class="line"><span class="string">Disallow:</span> <span class="regexp">/private/</span></span><br><span class="line"><span class="string">Disallow:</span> <span class="regexp">/tmp/</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>只允许某一个爬虫访问的代码如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">User-<span class="string">agent:</span> WebCrawler</span><br><span class="line"><span class="string">Disallow:</span></span><br><span class="line">User-<span class="string">agent:</span> *</span><br><span class="line"><span class="string">Disallow:</span> /</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这些是robots.txt的一些常见写法。</p>
                  <h2 id="2-爬虫名称"><a href="#2-爬虫名称" class="headerlink" title="2. 爬虫名称"></a>2. 爬虫名称</h2>
                  <p>大家可能会疑惑，爬虫名是哪儿来的？为什么就叫这个名？其实它是有固定名字的了，比如百度的就叫作BaiduSpider。表3-1列出了一些常见的搜索爬虫的名称及对应的网站。</p>
                  <p>表3-1 一些常见搜索爬虫的名称及其对应的网站</p>
                  <p>爬虫名称</p>
                  <p>名称</p>
                  <p>网站</p>
                  <p>BaiduSpider</p>
                  <p>百度</p>
                  <p>www.baidu.com</p>
                  <p>Googlebot</p>
                  <p>谷歌</p>
                  <p>www.google.com</p>
                  <p>360Spider</p>
                  <p>360搜索</p>
                  <p>www.so.com</p>
                  <p>YodaoBot</p>
                  <p>有道</p>
                  <p>www.youdao.com</p>
                  <p>ia_archiver</p>
                  <p>Alexa</p>
                  <p>www.alexa.cn</p>
                  <p>Scooter</p>
                  <p>altavista</p>
                  <p>www.altavista.com</p>
                  <h2 id="3-robotparser"><a href="#3-robotparser" class="headerlink" title="3. robotparser"></a>3. robotparser</h2>
                  <p>了解Robots协议之后，我们就可以使用<code>robotparser</code>模块来解析robots.txt了。该模块提供了一个类<code>RobotFileParser</code>，它可以根据某网站的robots.txt文件来判断一个爬取爬虫是否有权限来爬取这个网页。</p>
                  <p>该类用起来非常简单，只需要在构造方法里传入robots.txt的链接即可。首先看一下它的声明：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">urllib.robotparser.RobotFileParser(<span class="attribute">url</span>=<span class="string">''</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然，也可以在声明时不传入，默认为空，最后再使用<code>set_url()</code>方法设置一下也可。</p>
                  <p>下面列出了这个类常用的几个方法。</p>
                  <ul>
                    <li><strong><code>set_url()</code></strong>：用来设置robots.txt文件的链接。如果在创建<code>RobotFileParser</code>对象时传入了链接，那么就不需要再使用这个方法设置了。</li>
                    <li><strong><code>read()</code></strong>：读取robots.txt文件并进行分析。注意，这个方法执行一个读取和分析操作，如果不调用这个方法，接下来的判断都会为<code>False</code>，所以一定记得调用这个方法。这个方法不会返回任何内容，但是执行了读取操作。</li>
                    <li><strong><code>parse()</code></strong>：用来解析robots.txt文件，传入的参数是robots.txt某些行的内容，它会按照robots.txt的语法规则来分析这些内容。</li>
                    <li><strong><code>can_fetch()</code></strong>：该方法传入两个参数，第一个是<code>User-agent</code>，第二个是要抓取的URL。返回的内容是该搜索引擎是否可以抓取这个URL，返回结果是<code>True</code>或<code>False</code>。</li>
                    <li><strong><code>mtime()</code></strong>：返回的是上次抓取和分析robots.txt的时间，这对于长时间分析和抓取的搜索爬虫是很有必要的，你可能需要定期检查来抓取最新的robots.txt。</li>
                    <li><strong><code>modified()</code></strong>：它同样对长时间分析和抓取的搜索爬虫很有帮助，将当前时间设置为上次抓取和分析robots.txt的时间。</li>
                  </ul>
                  <p>下面我们用实例来看一下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from urllib.robotparser import RobotFileParser</span><br><span class="line"></span><br><span class="line">rp = <span class="constructor">RobotFileParser()</span></span><br><span class="line">rp.set<span class="constructor">_url('<span class="params">http</span>:<span class="operator">/</span><span class="operator">/</span><span class="params">www</span>.<span class="params">jianshu</span>.<span class="params">com</span><span class="operator">/</span><span class="params">robots</span>.<span class="params">txt</span>')</span></span><br><span class="line">rp.read<span class="literal">()</span></span><br><span class="line">print(rp.can<span class="constructor">_fetch('<span class="operator">*</span>', '<span class="params">http</span>:<span class="operator">/</span><span class="operator">/</span><span class="params">www</span>.<span class="params">jianshu</span>.<span class="params">com</span><span class="operator">/</span><span class="params">p</span><span class="operator">/</span><span class="params">b67554025d7d</span>')</span>)</span><br><span class="line">print(rp.can<span class="constructor">_fetch('<span class="operator">*</span>', <span class="string">"http://www.jianshu.com/search?q=python&amp;page=1&amp;type=collections"</span>)</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里以简书为例，首先创建<code>RobotFileParser</code>对象，然后通过<code>set_url()</code>方法设置了robots.txt的链接。当然，不用这个方法的话，可以在声明时直接用如下方法设置：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">rp = <span class="constructor">RobotFileParser('<span class="params">http</span>:<span class="operator">/</span><span class="operator">/</span><span class="params">www</span>.<span class="params">jianshu</span>.<span class="params">com</span><span class="operator">/</span><span class="params">robots</span>.<span class="params">txt</span>')</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接着利用<code>can_fetch()</code>方法判断了网页是否可以被抓取。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">False</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里同样可以使用<code>parse()</code>方法执行读取和分析，示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from urllib<span class="selector-class">.robotparser</span> import RobotFileParser</span><br><span class="line">from urllib<span class="selector-class">.request</span> import urlopen</span><br><span class="line"></span><br><span class="line">rp = RobotFileParser()</span><br><span class="line">rp.parse(urlopen(<span class="string">'http://www.jianshu.com/robots.txt'</span>).read().decode(<span class="string">'utf-8'</span>).split(<span class="string">'\n'</span>))</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(rp.can_fetch(<span class="string">'*'</span>, <span class="string">'http://www.jianshu.com/p/b67554025d7d'</span>)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(rp.can_fetch(<span class="string">'*'</span>, <span class="string">"http://www.jianshu.com/search?q=python&amp;page=1&amp;type=collections"</span>)</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果一样：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">False</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>本节介绍了<code>robotparser</code>模块的基本用法和实例，利用它，我们可以方便地判断哪些页面可以抓取，哪些页面不可以抓取。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-27 14:09:21" itemprop="dateCreated datePublished" datetime="2018-01-27T14:09:21+08:00">2018-01-27</time>
                </span>
                <span id="/5511.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 3.1.4-分析Robots协议" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5508.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5508.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 3.1.3-解析链接</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>前面说过，urllib库里还提供了<code>parse</code>这个模块，它定义了处理URL的标准接口，例如实现URL各部分的抽取、合并以及链接转换。它支持如下协议的URL处理：file、ftp、gopher、hdl、http、https、imap、mailto、 mms、news、nntp、prospero、rsync、rtsp、rtspu、sftp、 sip、sips、snews、svn、svn+ssh、telnet和wais。本节中，我们介绍一下该模块中常用的方法来看一下它的便捷之处。</p>
                  <h2 id="1-urlparse"><a href="#1-urlparse" class="headerlink" title="1. urlparse()"></a>1. <code>urlparse()</code></h2>
                  <p>该方法可以实现URL的识别和分段，这里先用一个实例来看一下：</p>
                  <figure class="highlight nimrod">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"></span><br><span class="line"><span class="literal">result</span> = urlparse('http://www.baidu.com/index.html;user?id=<span class="number">5</span><span class="comment">#comment')</span></span><br><span class="line">print(<span class="keyword">type</span>(<span class="literal">result</span>), <span class="literal">result</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们利用<code>urlparse()</code>方法进行了一个URL的解析。首先，输出了解析结果的类型，然后将结果也输出出来。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;class <span class="string">'urllib.parse.ParseResult'</span>&gt;</span><br><span class="line">ParseResult(<span class="attribute">scheme</span>=<span class="string">'http'</span>, <span class="attribute">netloc</span>=<span class="string">'www.baidu.com'</span>, <span class="attribute">path</span>=<span class="string">'/index.html'</span>, <span class="attribute">params</span>=<span class="string">'user'</span>, <span class="attribute">query</span>=<span class="string">'id=5'</span>, <span class="attribute">fragment</span>=<span class="string">'comment'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，返回结果是一个<code>ParseResult</code>类型的对象，它包含6部分，分别是<code>scheme</code>、<code>netloc</code>、<code>path</code>、<code>params</code>、<code>query</code>和<code>fragment</code>。</p>
                  <p>观察一下该实例的URL：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">http://www.baidu.com/<span class="keyword">index</span>.html;<span class="keyword">user</span>?id=<span class="number">5</span>#<span class="keyword">comment</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，<code>urlparse()</code>方法将其拆分成了6部分。大体观察可以发现，解析时有特定的分隔符。比如，://前面的就是<code>scheme</code>，代表协议；第一个/前面便是<code>netloc</code>，即域名；分号;前面是<code>params</code>，代表参数。</p>
                  <p>所以，可以得出一个标准的链接格式，具体如下：</p>
                  <figure class="highlight crystal">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">scheme:</span>/<span class="regexp">/netloc/path</span>;parameters?query<span class="comment">#fragment</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>一个标准的URL都会符合这个规则，利用<code>urlparse()</code>方法可以将它拆分开来。</p>
                  <p>除了这种最基本的解析方式外，<code>urlparse()</code>方法还有其他配置吗？接下来，看一下它的API用法：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">urllib.parse.urlparse(urlstring, <span class="attribute">scheme</span>=<span class="string">''</span>, <span class="attribute">allow_fragments</span>=<span class="literal">True</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，它有3个参数。</p>
                  <ul>
                    <li><strong><code>urlstring</code></strong>：这是必填项，即待解析的URL。</li>
                    <li><strong><code>scheme</code></strong>：它是默认的协议（比如<code>http</code>或<code>https</code>等）。假如这个链接没有带协议信息，会将这个作为默认的协议。我们用实例来看一下：</li>
                  </ul>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> urllib.parse import urlparse</span><br><span class="line"></span><br><span class="line">result = urlparse(<span class="string">'www.baidu.com/index.html;user?id=5#comment'</span>, <span class="attribute">scheme</span>=<span class="string">'https'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ParseResult(<span class="attribute">scheme</span>=<span class="string">'https'</span>, <span class="attribute">netloc</span>=<span class="string">''</span>, <span class="attribute">path</span>=<span class="string">'www.baidu.com/index.html'</span>, <span class="attribute">params</span>=<span class="string">'user'</span>, <span class="attribute">query</span>=<span class="string">'id=5'</span>, <span class="attribute">fragment</span>=<span class="string">'comment'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，我们提供的URL没有包含最前面的<code>scheme</code>信息，但是通过指定默认的<code>scheme</code>参数，返回的结果是<code>https</code>。</p>
                  <p>假设我们带上了<code>scheme</code>：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">result</span> = urlparse(<span class="string">'http://www.baidu.com/index.html;user?id=5#comment'</span>, scheme=<span class="string">'https'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>则结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ParseResult(<span class="attribute">scheme</span>=<span class="string">'http'</span>, <span class="attribute">netloc</span>=<span class="string">'www.baidu.com'</span>, <span class="attribute">path</span>=<span class="string">'/index.html'</span>, <span class="attribute">params</span>=<span class="string">'user'</span>, <span class="attribute">query</span>=<span class="string">'id=5'</span>, <span class="attribute">fragment</span>=<span class="string">'comment'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可见，<code>scheme</code>参数只有在URL中不包含<code>scheme</code>信息时才生效。如果URL中有<code>scheme</code>信息，就会返回解析出的<code>scheme</code>。</p>
                  <ul>
                    <li><strong><code>allow_fragments</code></strong>：即是否忽略<code>fragment</code>。如果它被设置为<code>False</code>，<code>fragment</code>部分就会被忽略，它会被解析为<code>path</code>、<code>parameters</code>或者<code>query</code>的一部分，而<code>fragment</code>部分为空。下面我们用实例来看一下：</li>
                  </ul>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> urllib.parse import urlparse</span><br><span class="line"></span><br><span class="line">result = urlparse(<span class="string">'http://www.baidu.com/index.html;user?id=5#comment'</span>, <span class="attribute">allow_fragments</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ParseResult(<span class="attribute">scheme</span>=<span class="string">'http'</span>, <span class="attribute">netloc</span>=<span class="string">'www.baidu.com'</span>, <span class="attribute">path</span>=<span class="string">'/index.html'</span>, <span class="attribute">params</span>=<span class="string">'user'</span>, <span class="attribute">query</span>=<span class="string">'id=5#comment'</span>, <span class="attribute">fragment</span>=<span class="string">''</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>假设URL中不包含<code>params</code>和<code>query</code>，我们再通过实例看一下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> urllib.parse import urlparse</span><br><span class="line"></span><br><span class="line">result = urlparse(<span class="string">'http://www.baidu.com/index.html#comment'</span>, <span class="attribute">allow_fragments</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ParseResult(<span class="attribute">scheme</span>=<span class="string">'http'</span>, <span class="attribute">netloc</span>=<span class="string">'www.baidu.com'</span>, <span class="attribute">path</span>=<span class="string">'/index.html#comment'</span>, <span class="attribute">params</span>=<span class="string">''</span>, <span class="attribute">query</span>=<span class="string">''</span>, <span class="attribute">fragment</span>=<span class="string">''</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，当URL中不包含<code>params</code>和<code>query</code>时，<code>fragment</code>便会被解析为<code>path</code>的一部分。</p>
                  <p>返回结果<code>ParseResult</code>实际上是一个元组，我们可以用索引顺序来获取，也可以用属性名获取。示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> urllib.parse import urlparse</span><br><span class="line"></span><br><span class="line">result = urlparse(<span class="string">'http://www.baidu.com/index.html#comment'</span>, <span class="attribute">allow_fragments</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="builtin-name">print</span>(result.scheme, result[0], result.netloc, result[1], <span class="attribute">sep</span>=<span class="string">'\n'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们分别用索引和属性名获取了<code>scheme</code>和<code>netloc</code>，其运行结果如下：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">http</span></span><br><span class="line"><span class="selector-tag">http</span></span><br><span class="line"><span class="selector-tag">www</span><span class="selector-class">.baidu</span><span class="selector-class">.com</span></span><br><span class="line"><span class="selector-tag">www</span><span class="selector-class">.baidu</span><span class="selector-class">.com</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，二者的结果是一致的，两种方法都可以成功获取。</p>
                  <h2 id="2-urlunparse"><a href="#2-urlunparse" class="headerlink" title="2. urlunparse()"></a>2. <code>urlunparse()</code></h2>
                  <p>有了<code>urlparse()</code>，相应地就有了它的对立方法<code>urlunparse()</code>。它接受的参数是一个可迭代对象，但是它的长度必须是6，否则会抛出参数数量不足或者过多的问题。先用一个实例看一下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from urllib<span class="selector-class">.parse</span> import urlunparse</span><br><span class="line"></span><br><span class="line">data = [<span class="string">'http'</span>, <span class="string">'www.baidu.com'</span>, <span class="string">'index.html'</span>, <span class="string">'user'</span>, <span class="string">'a=6'</span>, <span class="string">'comment'</span>]</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(urlunparse(data)</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里参数<code>data</code>用了列表类型。当然，你也可以用其他类型，比如元组或者特定的数据结构。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">http:</span><span class="comment">//www.baidu.com/index.html;user?a=6#comment</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就成功实现了URL的构造。</p>
                  <h2 id="3-urlsplit"><a href="#3-urlsplit" class="headerlink" title="3. urlsplit()"></a>3. <code>urlsplit()</code></h2>
                  <p>这个方法和<code>urlparse()</code>方法非常相似，只不过它不再单独解析<code>params</code>这一部分，只返回5个结果。上面例子中的<code>params</code>会合并到<code>path</code>中。示例如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">from</span> <span class="variable">urllib.parse</span> <span class="variable">import</span> <span class="variable">urlsplit</span></span><br><span class="line"></span><br><span class="line"><span class="variable"><span class="class">result</span></span> = <span class="function"><span class="title">urlsplit</span>(<span class="string">'http://www.baidu.com/index.html;user?id=5#comment'</span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable"><span class="class">result</span></span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="constructor">SplitResult(<span class="params">scheme</span>='<span class="params">http</span>', <span class="params">netloc</span>='<span class="params">www</span>.<span class="params">baidu</span>.<span class="params">com</span>', <span class="params">path</span>='<span class="operator">/</span><span class="params">index</span>.<span class="params">html</span>;<span class="params">user</span>', <span class="params">query</span>='<span class="params">id</span>=5', <span class="params">fragment</span>='<span class="params">comment</span>')</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，返回结果是<code>SplitResult</code>，它其实也是一个元组类型，既可以用属性获取值，也可以用索引来获取。示例如下：</p>
                  <figure class="highlight nimrod">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlsplit</span><br><span class="line"></span><br><span class="line"><span class="literal">result</span> = urlsplit('http://www.baidu.com/index.html;user?id=<span class="number">5</span><span class="comment">#comment')</span></span><br><span class="line">print(<span class="literal">result</span>.scheme, <span class="literal">result</span>[<span class="number">0</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">http</span> <span class="keyword">http</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="4-urlunsplit"><a href="#4-urlunsplit" class="headerlink" title="4. urlunsplit()"></a>4. <code>urlunsplit()</code></h2>
                  <p>与<code>urlunparse()</code>类似，它也是将链接各个部分组合成完整链接的方法，传入的参数也是一个可迭代对象，例如列表、元组等，唯一的区别是长度必须为5。示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from urllib<span class="selector-class">.parse</span> import urlunsplit</span><br><span class="line"></span><br><span class="line">data = [<span class="string">'http'</span>, <span class="string">'www.baidu.com'</span>, <span class="string">'index.html'</span>, <span class="string">'a=6'</span>, <span class="string">'comment'</span>]</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(urlunsplit(data)</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">http:</span><span class="comment">//www.baidu.com/index.html?a=6#comment</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="5-urljoin"><a href="#5-urljoin" class="headerlink" title="5. urljoin()"></a>5. <code>urljoin()</code></h2>
                  <p>有了<code>urlunparse()</code>和<code>urlunsplit()</code>方法，我们可以完成链接的合并，不过前提必须要有特定长度的对象，链接的每一部分都要清晰分开。</p>
                  <p>此外，生成链接还有另一个方法，那就是<code>urljoin()</code>方法。我们可以提供一个<code>base_url</code>（基础链接）作为第一个参数，将新的链接作为第二个参数，该方法会分析<code>base_url</code>的<code>scheme</code>、<code>netloc</code>和<code>path</code>这3个内容并对新链接缺失的部分进行补充，最后返回结果。</p>
                  <p>下面通过几个实例看一下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from urllib<span class="selector-class">.parse</span> import urljoin</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(urljoin(<span class="string">'http://www.baidu.com'</span>, <span class="string">'FAQ.html'</span>)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(urljoin(<span class="string">'http://www.baidu.com'</span>, <span class="string">'https://cuiqingcai.com/FAQ.html'</span>)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(urljoin(<span class="string">'http://www.baidu.com/about.html'</span>, <span class="string">'https://cuiqingcai.com/FAQ.html'</span>)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(urljoin(<span class="string">'http://www.baidu.com/about.html'</span>, <span class="string">'https://cuiqingcai.com/FAQ.html?question=2'</span>)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(urljoin(<span class="string">'http://www.baidu.com?wd=abc'</span>, <span class="string">'https://cuiqingcai.com/index.php'</span>)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(urljoin(<span class="string">'http://www.baidu.com'</span>, <span class="string">'?category=2#comment'</span>)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(urljoin(<span class="string">'www.baidu.com'</span>, <span class="string">'?category=2#comment'</span>)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(urljoin(<span class="string">'www.baidu.com#comment'</span>, <span class="string">'?category=2'</span>)</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">http:</span><span class="comment">//www.baidu.com/FAQ.html</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//cuiqingcai.com/FAQ.html</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//cuiqingcai.com/FAQ.html</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//cuiqingcai.com/FAQ.html?question=2</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//cuiqingcai.com/index.php</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//www.baidu.com?category=2#comment</span></span><br><span class="line">www.baidu.com?category=<span class="number">2</span><span class="meta">#comment</span></span><br><span class="line">www.baidu.com?category=<span class="number">2</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，<code>base_url</code>提供了三项内容<code>scheme</code>、<code>netloc</code>和<code>path</code>。如果这3项在新的链接里不存在，就予以补充；如果新的链接存在，就使用新的链接的部分。而<code>base_url</code>中的<code>params</code>、<code>query</code>和<code>fragment</code>是不起作用的。</p>
                  <p>通过<code>urljoin()</code>方法，我们可以轻松实现链接的解析、拼合与生成。</p>
                  <h2 id="6-urlencode"><a href="#6-urlencode" class="headerlink" title="6. urlencode()"></a>6. <code>urlencode()</code></h2>
                  <p>这里我们再介绍一个常用的方法——<code>urlencode()</code>，它在构造GET请求参数的时候非常有用，示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from urllib<span class="selector-class">.parse</span> import urlencode</span><br><span class="line"></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'germey'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">22</span></span><br><span class="line">&#125;</span><br><span class="line">base_url = <span class="string">'http://www.baidu.com?'</span></span><br><span class="line">url = base_url + urlencode(params)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(url)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先声明了一个字典来将参数表示出来，然后调用<code>urlencode()</code>方法将其序列化为GET请求参数。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">http:</span><span class="comment">//www.baidu.com?name=germey&amp;age=22</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，参数就成功地由字典类型转化为GET请求参数了。</p>
                  <p>这个方法非常常用。有时为了更加方便地构造参数，我们会事先用字典来表示。要转化为URL的参数时，只需要调用该方法即可。</p>
                  <h2 id="7-parse-qs"><a href="#7-parse-qs" class="headerlink" title="7. parse_qs()"></a>7. <code>parse_qs()</code></h2>
                  <p>有了序列化，必然就有反序列化。如果我们有一串GET请求参数，利用<code>parse_qs()</code>方法，就可以将它转回字典，示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from urllib<span class="selector-class">.parse</span> import parse_qs</span><br><span class="line"></span><br><span class="line">query = <span class="string">'name=germey&amp;age=22'</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(parse_qs(query)</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="string">'name'</span>: [<span class="string">'germey'</span>], <span class="string">'age'</span>: [<span class="string">'22'</span>]&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这样就成功转回为字典类型了。</p>
                  <h2 id="8-parse-qsl"><a href="#8-parse-qsl" class="headerlink" title="8. parse_qsl()"></a>8. <code>parse_qsl()</code></h2>
                  <p>另外，还有一个<code>parse_qsl()</code>方法，它用于将参数转化为元组组成的列表，示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from urllib<span class="selector-class">.parse</span> import parse_qsl</span><br><span class="line"></span><br><span class="line">query = <span class="string">'name=germey&amp;age=22'</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(parse_qsl(query)</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[(<span class="symbol">'name</span>', <span class="symbol">'germey</span>'), (<span class="symbol">'age</span>', <span class="symbol">'22</span>')]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，运行结果是一个列表，而列表中的每一个元素都是一个元组，元组的第一个内容是参数名，第二个内容是参数值。</p>
                  <h2 id="9-quote"><a href="#9-quote" class="headerlink" title="9. quote()"></a>9. <code>quote()</code></h2>
                  <p>该方法可以将内容转化为URL编码的格式。URL中带有中文参数时，有时可能会导致乱码的问题，此时用这个方法可以将中文字符转化为URL编码，示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from urllib<span class="selector-class">.parse</span> import quote</span><br><span class="line"></span><br><span class="line">keyword = <span class="string">'壁纸'</span></span><br><span class="line">url = <span class="string">'https://www.baidu.com/s?wd='</span> + quote(keyword)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(url)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们声明了一个中文的搜索文字，然后用<code>quote()</code>方法对其进行URL编码，最后得到的结果如下：</p>
                  <figure class="highlight llvm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">https://www.baidu.com/s?wd=<span class="symbol">%E5</span><span class="symbol">%A3</span><span class="symbol">%81</span><span class="symbol">%E7</span><span class="symbol">%BA</span><span class="symbol">%B8</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="10-unquote"><a href="#10-unquote" class="headerlink" title="10. unquote()"></a>10. <code>unquote()</code></h2>
                  <p>有了<code>quote()</code>方法，当然还有<code>unquote()</code>方法，它可以进行URL解码，示例如下：</p>
                  <figure class="highlight llvm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from urllib.parse import unquote</span><br><span class="line"></span><br><span class="line">url = 'https://www.baidu.com/s?wd=<span class="symbol">%E5</span><span class="symbol">%A3</span><span class="symbol">%81</span><span class="symbol">%E7</span><span class="symbol">%BA</span><span class="symbol">%B8</span>'</span><br><span class="line">print(unquote(url))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这是上面得到的URL编码后的结果，这里利用<code>unquote()</code>方法还原，结果如下：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">https:</span><span class="comment">//www.baidu.com/s?wd=壁纸</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，利用<code>unquote()</code>方法可以方便地实现解码。</p>
                  <p>本节中，我们介绍了<code>parse</code>模块的一些常用URL处理方法。有了这些方法，我们可以方便地实现URL的解析和构造，建议熟练掌握。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-27 14:04:07" itemprop="dateCreated datePublished" datetime="2018-01-27T14:04:07+08:00">2018-01-27</time>
                </span>
                <span id="/5508.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 3.1.3-解析链接" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <script>
              document.querySelectorAll('.random').forEach(item => item.src = "https://picsum.photos/id/" + Math.floor(Math.random() * Math.floor(300)) + "/200/133")

            </script>
            <nav class="pagination">
              <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
            </nav>
          </div>
          <script>
            window.addEventListener('tabs:register', () =>
            {
              let
              {
                activeClass
              } = CONFIG.comments;
              if (CONFIG.comments.storage)
              {
                activeClass = localStorage.getItem('comments_active') || activeClass;
              }
              if (activeClass)
              {
                let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
                if (activeTab)
                {
                  activeTab.click();
                }
              }
            });
            if (CONFIG.comments.storage)
            {
              window.addEventListener('tabs:click', event =>
              {
                if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
                let commentClass = event.target.classList[1];
                localStorage.setItem('comments_active', commentClass);
              });
            }

          </script>
        </div>
        <div class="toggle sidebar-toggle">
          <span class="toggle-line toggle-line-first"></span>
          <span class="toggle-line toggle-line-middle"></span>
          <span class="toggle-line toggle-line-last"></span>
        </div>
        <aside class="sidebar">
          <div class="sidebar-inner">
            <ul class="sidebar-nav motion-element">
              <li class="sidebar-nav-toc"> 文章目录 </li>
              <li class="sidebar-nav-overview"> 站点概览 </li>
            </ul>
            <!--noindex-->
            <div class="post-toc-wrap sidebar-panel">
            </div>
            <!--/noindex-->
            <div class="site-overview-wrap sidebar-panel">
              <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <img class="site-author-image" itemprop="image" alt="崔庆才" src="/images/avatar.png">
                <p class="site-author-name" itemprop="name">崔庆才</p>
                <div class="site-description" itemprop="description">静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。</div>
              </div>
              <div class="site-state-wrap motion-element">
                <nav class="site-state">
                  <div class="site-state-item site-state-posts">
                    <a href="/archives/">
                      <span class="site-state-item-count">667</span>
                      <span class="site-state-item-name">日志</span>
                    </a>
                  </div>
                  <div class="site-state-item site-state-categories">
                    <a href="/categories/">
                      <span class="site-state-item-count">27</span>
                      <span class="site-state-item-name">分类</span></a>
                  </div>
                  <div class="site-state-item site-state-tags">
                    <a href="/tags/">
                      <span class="site-state-item-count">226</span>
                      <span class="site-state-item-name">标签</span></a>
                  </div>
                </nav>
              </div>
              <div class="links-of-author motion-element">
                <span class="links-of-author-item">
                  <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dlcm1leQ==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Germey"><i class="fab fa-github fa-fw"></i>GitHub</span>
                </span>
                <span class="links-of-author-item">
                  <span class="exturl" data-url="bWFpbHRvOmNxY0BjdWlxaW5nY2FpLmNvbS5jb20=" title="邮件 → mailto:cqc@cuiqingcai.com.com"><i class="fa fa-envelope fa-fw"></i>邮件</span>
                </span>
                <span class="links-of-author-item">
                  <span class="exturl" data-url="aHR0cHM6Ly93ZWliby5jb20vY3VpcWluZ2NhaQ==" title="微博 → https:&#x2F;&#x2F;weibo.com&#x2F;cuiqingcai"><i class="fab fa-weibo fa-fw"></i>微博</span>
                </span>
                <span class="links-of-author-item">
                  <span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9HZXJtZXk=" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;Germey"><i class="fa fa-magic fa-fw"></i>知乎</span>
                </span>
              </div>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/ei5og.jpg" style=" width: 100%;">
              </a>
            </div>
            <div class="sidebar-panel sidebar-panel-categories sidebar-panel-active">
              <h4 class="name"> 分类 </h4>
              <div class="content">
                <ul class="category-list">
                  <li class="category-list-item"><a class="category-list-link" href="/categories/C-C/">C/C++</a><span class="category-list-count">23</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><span class="category-list-count">14</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">5</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">26</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">15</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Net/">Net</a><span class="category-list-count">4</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a><span class="category-list-count">39</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">27</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Paper/">Paper</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">302</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/TypeScript/">TypeScript</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E5%B1%95%E7%A4%BA/">个人展示</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E6%97%A5%E8%AE%B0/">个人日记</a><span class="category-list-count">9</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E8%AE%B0%E5%BD%95/">个人记录</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94/">个人随笔</a><span class="category-list-count">21</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">安装配置</a><span class="category-list-count">59</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/">技术杂谈</a><span class="category-list-count">92</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a><span class="category-list-count">4</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E7%AC%94%E8%AE%B0/">生活笔记</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A6%8F%E5%88%A9%E4%B8%93%E5%8C%BA/">福利专区</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E8%81%8C%E4%BD%8D%E6%8E%A8%E8%8D%90/">职位推荐</a><span class="category-list-count">2</span></li>
                </ul>
              </div>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="http://www.ipidea.net/?utm-source=cqc&utm-keyword=?cqc" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/0ywun.png" style=" width: 100%;">
              </a>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://tutorial.lengyue.video/?coupon=12ef4b1a-a3db-11ea-bb37-0242ac130002_cqx_850" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/bco2a.png" style=" width: 100%;">
              </a>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://www.tianqiip.com/?did=OP6kGa" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/bv71c.png" style=" width: 100%;">
              </a>
            </div>
            <div class="sidebar-panel sidebar-panel-friends sidebar-panel-active">
              <h4 class="name"> 友情链接 </h4>
              <ul class="friends">
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/j2dub.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.findhao.net/" target="_blank" rel="noopener">FindHao</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/6apxu.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.51dev.com/" target="_blank" rel="noopener">IT技术社区</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/bqlbs.png">
                  </span>
                  <span class="link">
                    <a href="http://www.urselect.com/" target="_blank" rel="noopener">优社电商</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/8s88c.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yuanrenxue.com/" target="_blank" rel="noopener">猿人学</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/2wgg5.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yunlifang.cn/" target="_blank" rel="noopener">云立方</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/shwr6.png">
                  </span>
                  <span class="link">
                    <a href="http://lanbing510.info/" target="_blank" rel="noopener">冰蓝</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/blvoh.jpg">
                  </span>
                  <span class="link">
                    <a href="https://lengyue.me/" target="_blank" rel="noopener">冷月</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="http://qianxunclub.com/favicon.png">
                  </span>
                  <span class="link">
                    <a href="http://qianxunclub.com/" target="_blank" rel="noopener">千寻啊千寻</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/0044u.jpg">
                  </span>
                  <span class="link">
                    <a href="http://kodcloud.com/" target="_blank" rel="noopener">可道云</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ygnpn.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.kunkundashen.cn/" target="_blank" rel="noopener">坤坤大神</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.503error.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.503error.com/" target="_blank" rel="noopener">张志明个人博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/x714o.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.hubwiz.com/" target="_blank" rel="noopener">汇智网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.xiongge.club/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.xiongge.club/" target="_blank" rel="noopener">熊哥club</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/3w4fe.png">
                  </span>
                  <span class="link">
                    <a href="https://zerlong.com/" target="_blank" rel="noopener">知语</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/44hxf.png">
                  </span>
                  <span class="link">
                    <a href="http://redstonewill.com/" target="_blank" rel="noopener">红色石头</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/8g1fk.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.laodong.me/" target="_blank" rel="noopener">老董博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/wkaus.jpg">
                  </span>
                  <span class="link">
                    <a href="https://zhaoshuai.me/" target="_blank" rel="noopener">碎念</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/pgo0r.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.chenwenguan.com/" target="_blank" rel="noopener">陈文管的博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/kk82a.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.lxlinux.net/" target="_blank" rel="noopener">良许Linux教程网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/lj0t2.jpg">
                  </span>
                  <span class="link">
                    <a href="https://tanqingbo.cn/" target="_blank" rel="noopener">IT码农</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/i8cdr.png">
                  </span>
                  <span class="link">
                    <a href="https://junyiseo.com/" target="_blank" rel="noopener">均益个人博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/chwv2.png">
                  </span>
                  <span class="link">
                    <a href="https://brucedone.com/" target="_blank" rel="noopener">大鱼的鱼塘</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/2y43o.png">
                  </span>
                  <span class="link">
                    <a href="http://bbs.nightteam.cn/" target="_blank" rel="noopener">夜幕爬虫安全论坛</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/zvc3w.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.weishidong.com/" target="_blank" rel="noopener">韦世东的技术专栏</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ebudy.jpg">
                  </span>
                  <span class="link">
                    <a href="https://chuanjiabing.com/" target="_blank" rel="noopener">穿甲兵技术社区</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ala4d.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.91vps.com/" target="_blank" rel="noopener">91VPS</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/8y8y4.png">
                  </span>
                  <span class="link">
                    <a href="https://www.qg.net/" target="_blank" rel="noopener">青果网络</a>
                  </span>
                </li>
              </ul>
            </div>
            <div class="sidebar-panel sidebar-panel-tags sidebar-panel-active">
              <h4 class="name"> 标签云 </h4>
              <div class="content">
                <a href="/tags/2022/" style="font-size: 19px;">2022</a> <a href="/tags/2048/" style="font-size: 10px;">2048</a> <a href="/tags/ADSL/" style="font-size: 10px;">ADSL</a> <a href="/tags/API/" style="font-size: 13px;">API</a> <a href="/tags/Ajax/" style="font-size: 12px;">Ajax</a> <a href="/tags/Bootstrap/" style="font-size: 11px;">Bootstrap</a> <a href="/tags/Bug/" style="font-size: 10px;">Bug</a> <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/CQC/" style="font-size: 10px;">CQC</a> <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/CSS-%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 10px;">CSS 反爬虫</a> <a href="/tags/CV/" style="font-size: 10px;">CV</a> <a href="/tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/Eclipse/" style="font-size: 11px;">Eclipse</a> <a href="/tags/Elasticsearch/" style="font-size: 10px;">Elasticsearch</a> <a href="/tags/FTP/" style="font-size: 10px;">FTP</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/GitHub/" style="font-size: 13px;">GitHub</a> <a href="/tags/HTML5/" style="font-size: 10px;">HTML5</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Hook/" style="font-size: 10px;">Hook</a> <a href="/tags/IT/" style="font-size: 10px;">IT</a> <a href="/tags/JSON/" style="font-size: 10px;">JSON</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/JavaScript/" style="font-size: 14px;">JavaScript</a> <a href="/tags/K8s/" style="font-size: 10px;">K8s</a> <a href="/tags/LOGO/" style="font-size: 10px;">LOGO</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MIUI/" style="font-size: 10px;">MIUI</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/MongoDB/" style="font-size: 11px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/NBA/" style="font-size: 10px;">NBA</a> <a href="/tags/OCR/" style="font-size: 10px;">OCR</a> <a href="/tags/OpenCV/" style="font-size: 10px;">OpenCV</a> <a href="/tags/PHP/" style="font-size: 11px;">PHP</a> <a href="/tags/PPT/" style="font-size: 10px;">PPT</a> <a href="/tags/PS/" style="font-size: 10px;">PS</a> <a href="/tags/Pathlib/" style="font-size: 10px;">Pathlib</a> <a href="/tags/PhantomJS/" style="font-size: 10px;">PhantomJS</a> <a href="/tags/Playwright/" style="font-size: 10px;">Playwright</a> <a href="/tags/Python/" style="font-size: 16px;">Python</a> <a href="/tags/Python-%E7%88%AC%E8%99%AB/" style="font-size: 17px;">Python 爬虫</a> <a href="/tags/Python3/" style="font-size: 11px;">Python3</a> <a href="/tags/Python3%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/" style="font-size: 12px;">Python3爬虫教程</a> <a href="/tags/Pythonic/" style="font-size: 10px;">Pythonic</a> <a href="/tags/Python%E7%88%AC%E8%99%AB/" style="font-size: 18px;">Python爬虫</a> <a href="/tags/Python%E7%88%AC%E8%99%AB%E4%B9%A6/" style="font-size: 12px;">Python爬虫书</a> <a href="/tags/Python%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/" style="font-size: 15px;">Python爬虫教程</a> <a href="/tags/QQ/" style="font-size: 10px;">QQ</a> <a href="/tags/RabbitMQ/" style="font-size: 10px;">RabbitMQ</a> <a href="/tags/ReCAPTCHA/" style="font-size: 10px;">ReCAPTCHA</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SAE/" style="font-size: 10px;">SAE</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/SVG/" style="font-size: 10px;">SVG</a> <a href="/tags/Scrapy-redis/" style="font-size: 10px;">Scrapy-redis</a> <a href="/tags/Scrapy%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">Scrapy分布式</a> <a href="/tags/Selenium/" style="font-size: 11px;">Selenium</a> <a href="/tags/Session/" style="font-size: 10px;">Session</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/TKE/" style="font-size: 10px;">TKE</a> <a href="/tags/TXT/" style="font-size: 10px;">TXT</a> <a href="/tags/Terminal/" style="font-size: 10px;">Terminal</a> <a href="/tags/Ubuntu/" style="font-size: 11px;">Ubuntu</a> <a href="/tags/VS-Code/" style="font-size: 10px;">VS Code</a> <a href="/tags/Vs-Code/" style="font-size: 10px;">Vs Code</a> <a href="/tags/Vue/" style="font-size: 11px;">Vue</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/Web%E7%BD%91%E9%A1%B5/" style="font-size: 10px;">Web网页</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/Winpcap/" style="font-size: 10px;">Winpcap</a> <a href="/tags/WordPress/" style="font-size: 13px;">WordPress</a> <a href="/tags/XPath/" style="font-size: 12px;">XPath</a> <a href="/tags/Youtube/" style="font-size: 11px;">Youtube</a> <a href="/tags/aiohttp/" style="font-size: 10px;">aiohttp</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/cocos2d-x/" style="font-size: 10px;">cocos2d-x</a> <a href="/tags/dummy-change/" style="font-size: 10px;">dummy change</a> <a href="/tags/e6/" style="font-size: 10px;">e6</a> <a href="/tags/fitvids/" style="font-size: 10px;">fitvids</a> <a href="/tags/git/" style="font-size: 11px;">git</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/js%E9%80%86%E5%90%91/" style="font-size: 10px;">js逆向</a> <a href="/tags/kubernetes/" style="font-size: 10px;">kubernetes</a> <a href="/tags/log/" style="font-size: 10px;">log</a> <a href="/tags/log4j/" style="font-size: 10px;">log4j</a> <a href="/tags/logging/" style="font-size: 10px;">logging</a> <a href="/tags/matlab/" style="font-size: 11px;">matlab</a> <a href="/tags/parsel/" style="font-size: 10px;">parsel</a> <a href="/tags/pymongo/" style="font-size: 10px;">pymongo</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/pytube/" style="font-size: 11px;">pytube</a> <a href="/tags/pywin32/" style="font-size: 10px;">pywin32</a> <a href="/tags/requests/" style="font-size: 10px;">requests</a>
              </div>
              <script>
                const tagsColors = ['#00a67c', '#5cb85c', '#d9534f', '#567e95', '#b37333', '#f4843d', '#15a287']
                const tagsElements = document.querySelectorAll('.sidebar-panel-tags .content a')
                tagsElements.forEach((item) =>
                {
                  item.style.backgroundColor = tagsColors[Math.floor(Math.random() * tagsColors.length)]
                })

              </script>
            </div>
          </div>
        </aside>
        <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
        <div class="copyright">
          <span class="author" itemprop="copyrightHolder">崔庆才丨静觅</span> &copy; <span itemprop="copyrightYear">2022</span>
          <span class="with-love">
            <i class="fa fa-heart"></i>
          </span>
          <a href="https://cuiqingcai.com/sitemap.xml" style="display:none" title="爬虫教程" target="_blank"><strong>爬虫教程</strong></a>
          <a href="https://cuiqingcai.com/sitemap.html" style="display:none" title="爬虫教程" target="_blank"><strong>爬虫教程</strong></a>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-chart-area"></i>
          </span>
          <span title="站点总字数">3.1m</span>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-coffee"></i>
          </span>
          <span title="站点阅读时长">47:25</span>
        </div>
        <div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl theme-link" data-url="aHR0cHM6Ly9waXNjZXMudGhlbWUtbmV4dC5vcmc=">NexT.Pisces</span> 强力驱动 </div>
        <div class="beian"><span class="exturl" data-url="aHR0cHM6Ly9iZWlhbi5taWl0Lmdvdi5jbg==">京ICP备18015597号-1 </span>
        </div>
        <script>
          (function ()
          {
            function leancloudSelector(url)
            {
              url = encodeURI(url);
              return document.getElementById(url).querySelector('.leancloud-visitors-count');
            }

            function addCount(Counter)
            {
              var visitors = document.querySelector('.leancloud_visitors');
              var url = decodeURI(visitors.id);
              var title = visitors.dataset.flagTitle;
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                if (results.length > 0)
                {
                  var counter = results[0];
                  leancloudSelector(url).innerText = counter.time + 1;
                  Counter('put', '/classes/Counter/' + counter.objectId,
                  {
                    time:
                    {
                      '__op': 'Increment',
                      'amount': 1
                    }
                  }).catch(error =>
                  {
                    console.error('Failed to save visitor count', error);
                  });
                }
                else
                {
                  Counter('post', '/classes/Counter',
                  {
                    title,
                    url,
                    time: 1
                  }).then(response => response.json()).then(() =>
                  {
                    leancloudSelector(url).innerText = 1;
                  }).catch(error =>
                  {
                    console.error('Failed to create', error);
                  });
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }

            function showTime(Counter)
            {
              var visitors = document.querySelectorAll('.leancloud_visitors');
              var entries = [...visitors].map(element =>
              {
                return decodeURI(element.id);
              });
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url:
                {
                  '$in': entries
                }
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                for (let url of entries)
                {
                  let target = results.find(item => item.url === url);
                  leancloudSelector(url).innerText = target ? target.time : 0;
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }
            let
            {
              app_id,
              app_key,
              server_url
            } = {
              "enable": true,
              "app_id": "6X5dRQ0pnPWJgYy8SXOg0uID-gzGzoHsz",
              "app_key": "ziLDVEy73ne5HtFTiGstzHMS",
              "server_url": "https://6x5drq0p.lc-cn-n1-shared.com",
              "security": false
            };

            function fetchData(api_server)
            {
              var Counter = (method, url, data) =>
              {
                return fetch(`${api_server}/1.1${url}`,
                {
                  method,
                  headers:
                  {
                    'X-LC-Id': app_id,
                    'X-LC-Key': app_key,
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(data)
                });
              };
              if (CONFIG.page.isPost)
              {
                if (CONFIG.hostname !== location.hostname) return;
                addCount(Counter);
              }
              else if (document.querySelectorAll('.post-title-link').length >= 1)
              {
                showTime(Counter);
              }
            }
            let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;
            if (api_server)
            {
              fetchData(api_server);
            }
            else
            {
              fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id).then(response => response.json()).then((
              {
                api_server
              }) =>
              {
                fetchData('https://' + api_server);
              });
            }
          })();

        </script>
      </div>
      <div class="footer-stat">
        <span id="cnzz_stat_icon_1279355174"></span>
        <script type="text/javascript">
          document.write(unescape("%3Cspan id='cnzz_stat_icon_1279355174'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1279355174%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));

        </script>
      </div>
    </footer>
  </div>
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/js/utils.js"></script>
  <script src="/.js"></script>
  <script src="/js/schemes/pisces.js"></script>
  <script src="/.js"></script>
  <script src="/js/next-boot.js"></script>
  <script src="/.js"></script>
  <script>
    (function ()
    {
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x = document.getElementsByTagName("link");
      //Find the last canonical URL
      if (x.length > 0)
      {
        for (i = 0; i < x.length; i++)
        {
          if (x[i].rel.toLowerCase() == 'canonical' && x[i].href)
          {
            canonicalURL = x[i].href;
          }
        }
      }
      //Get protocol
      if (!canonicalURL)
      {
        curProtocol = window.location.protocol.split(':')[0];
      }
      else
      {
        curProtocol = canonicalURL.split(':')[0];
      }
      //Get current URL if the canonical URL does not exist
      if (!canonicalURL) canonicalURL = window.location.href;
      //Assign script content. Replace current URL with the canonical URL
      ! function ()
      {
        var e = /([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,
          r = canonicalURL,
          t = document.referrer;
        if (!e.test(r))
        {
          var n = (String(curProtocol).toLowerCase() === 'https') ? "https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif" : "//api.share.baidu.com/s.gif";
          t ? (n += "?r=" + encodeURIComponent(document.referrer), r && (n += "&l=" + r)) : r && (n += "?l=" + r);
          var i = new Image;
          i.src = n
        }
      }(window);
    })();

  </script>
  <script src="/js/local-search.js"></script>
  <script src="/.js"></script>
</body>

</html>
